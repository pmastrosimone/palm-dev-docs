<html>
<head>
<title>(68K) Palm System Support | Palm OS&#174; Programmer's Companion</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 10:43:16">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="1045397"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AttnsAndAlarms.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Localization.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">11 &nbsp;&nbsp;
Palm System Support</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Palm OS&#174; Programmer's Companion</p>
<p class="SubTitle">Volume I </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1"><a href="SystemFeatures.html">11  Palm System Support</a></h1>

   <h2 class="SideTOC2"><a href="#1045487">
   Features</a></h2>

      <h3 class="SideTOC3"><a href="#1045513">
      The System Version Feature</a></h3>

      <h3 class="SideTOC3"><a href="#1045572">
      Application-Defined Features</a></h3>

      <h3 class="SideTOC3"><a href="#1045577">
      Using the Feature Manager</a></h3>

      <h3 class="SideTOC3"><a href="#1045598">
      Feature Memory</a></h3>

   <h2 class="SideTOC2"><a href="#1045645">
   Preferences</a></h2>

      <h3 class="SideTOC3"><a href="#1045663">
      Accessing System Preferences</a></h3>

      <h3 class="SideTOC3"><a href="#1045753">
      Setting System Preferences</a></h3>

      <h3 class="SideTOC3"><a href="#1045772">
      Setting Application-Specific Preferences</a></h3>

   <h2 class="SideTOC2"><a href="#1045996">
   Sound</a></h2>

      <h3 class="SideTOC3"><a href="#1046010">
      Simple Sound</a></h3>

      <h3 class="SideTOC3"><a href="#1046024">
      Sampled Sound</a></h3>

      <h3 class="SideTOC3"><a href="#1046045">
      Simple vs Sampled</a></h3>

      <h3 class="SideTOC3"><a href="#1046053">
      Sound Preferences</a></h3>

      <h3 class="SideTOC3"><a href="#1046093">
      Standard MIDI Files</a></h3>

      <h3 class="SideTOC3"><a href="#1046179">
      Creating a Sound Stream</a></h3>

   <h2 class="SideTOC2"><a href="#1046202">
   System Boot and Reset</a></h2>

      <h3 class="SideTOC3"><a href="#1046206">
      Soft Reset</a></h3>

      <h3 class="SideTOC3"><a href="#1046214">
      Soft Reset + Up Arrow</a></h3>

      <h3 class="SideTOC3"><a href="#1046220">
      Hard Reset</a></h3>

      <h3 class="SideTOC3"><a href="#1046227">
      System Reset Calls</a></h3>

   <h2 class="SideTOC2"><a href="#1046506">
   Hardware Interaction</a></h2>

      <h3 class="SideTOC3"><a href="#1046524">
      Palm OS Power Modes</a></h3>

      <h3 class="SideTOC3"><a href="#1046542">
      Guidelines for Application Developers</a></h3>

      <h3 class="SideTOC3"><a href="#1046555">
      Power Management Calls</a></h3>

   <h2 class="SideTOC2"><a href="#1046570">
   The Microkernel</a></h2>

   <h2 class="SideTOC2"><a href="#1046593">
   Retrieving the ROM Serial Number</a></h2>

   <h2 class="SideTOC2"><a href="#1046640">
   Time</a></h2>

      <h3 class="SideTOC3"><a href="#1046669">
      Using Real-Time Clock Functions</a></h3>

      <h3 class="SideTOC3"><a href="#1046689">
      Using System Ticks Functions</a></h3>

   <h2 class="SideTOC2"><a href="#1046711">
   Floating-Point</a></h2>

   <h2 class="SideTOC2"><a href="#1046768">
   Summary of System Features</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1045435"> </a>In this chapter, you learn how to work with the miscellaneous supporting functionality that the Palm OS<sup>&#174;</sup> system provides, such as sound, time, and floating-point operations. Most parts of the Palm OS are controlled by a manager, which is a group of functions that work together to implement a certain functionality. As a rule, all functions that belong to one manager use the same prefix and work together to implement a certain aspect of functionality. </p>

<p><a name="1045437"> </a>This chapter discusses these topics: </p>
<ul type="disc">
  <li><a name="1045441"> </a><a href="SystemFeatures.html#1045487">Features</a> 
  <li><a name="1045445"> </a><a href="SystemFeatures.html#1045645">Preferences</a>
  <li><a name="1045449"> </a><a href="SystemFeatures.html#1045996">Sound</a> 
  <li><a name="1045453"> </a><a href="SystemFeatures.html#1046202">System Boot and Reset</a> 
  <li><a name="1045461"> </a><a href="SystemFeatures.html#1046506">Hardware Interaction</a>
  <li><a name="1045465"> </a><a href="SystemFeatures.html#1046570">The Microkernel</a>
  <li><a name="1045473"> </a><a href="SystemFeatures.html#1046593">Retrieving the ROM Serial Number</a> 
  <li><a name="1045477"> </a><a href="SystemFeatures.html#1046640">Time</a> 
  <li><a name="1045481"> </a><a href="SystemFeatures.html#1046711">Floating-Point</a> 
  <li><a name="1045485"> </a><a href="SystemFeatures.html#1046768">Summary of System Features</a>
</ul>

<h2 class="haH2">
  <a name="1045487"> </a>Features <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1045490"> </a>A <i>feature</i> is a 32-bit value that has special meaning to both the feature publisher and to users of that feature. Features can be published by the system or by applications. A complete list of all Palm OS system features can be found under <a href="../PalmOSReference/FeatureManager.html#1035813">"Feature Constants"</a> of the <i>Palm OS Programmer's API Reference</i>.</p>

<p><a name="1045491"> </a>Each feature is identified by a feature creator and a feature number: </p>
<ul type="disc">
  <li><a name="1045492"> </a>The feature creator is a unique creator registered with PalmSource, Inc. You usually use the creator type of the application that publishes the feature. 
  <li><a name="1045493"> </a>The feature number is any 16-bit value used to distinguish between different features of a particular creator.
</ul>

<p><a name="1045494"> </a>Once a feature is published, it remains present until it is explicitly unregistered or the handheld is reset. A feature published by an application sticks around even after the application quits.</p>

<p><a name="1045495"> </a>This section introduces the feature manager by discussing these topics: </p>
<ul type="disc">
  <li><a name="1045499"> </a><a href="SystemFeatures.html#1045513">The System Version Feature</a>
  <li><a name="1045503"> </a><a href="SystemFeatures.html#1045572">Application-Defined Features</a>
  <li><a name="1045507"> </a><a href="SystemFeatures.html#1045577">Using the Feature Manager</a>
  <li><a name="1045511"> </a><a href="SystemFeatures.html#1045598">Feature Memory</a>
</ul>
<h3 class="hbH3">
  <a name="1045513"> </a>The System Version Feature <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045515"> </a>An example for a feature is the system version. This feature is published by the system and contains a 32-bit representation of the system version. The system version has a feature creator of <code>sysFtrCreator</code> and a feature number of <code>sysFtrNumROMVersion</code>). Currently, the different versions of the system software have the following numbers:</p>


<div class="tablediv"><table cellspacing="0" class="tTableNR">

  <tr valign="top">
    <td><p class="tt"><a name="1045520"> </a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">0x01003001</span></p>
    </td>
    <td><p class="tt"><a name="1045522"> </a>Palm OS 1.0</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045524"> </a>0x02003000</p>
    </td>
    <td><p class="tt"><a name="1045526"> </a>Palm OS 2.0</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045528"> </a>0x03003000</p>
    </td>
    <td><p class="tt"><a name="1045530"> </a>Palm OS 3.0</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045532"> </a>0x03103000</p>
    </td>
    <td><p class="tt"><a name="1045534"> </a>Palm OS 3.1</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045536"> </a>0x03203000</p>
    </td>
    <td><p class="tt"><a name="1045538"> </a>Palm OS 3.2</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045540"> </a>0x03503000</p>
    </td>
    <td><p class="tt"><a name="1045542"> </a>Palm OS 3.5</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045544"> </a>0x04003000</p>
    </td>
    <td><p class="tt"><a name="1045546"> </a>Palm OS 4.0</p>
    </td>
  </tr>
</table>

</div>


<p><a name="1045548"> </a>Rather than hard wiring an obscure constant like one of the above into your code, however, you can use the <code>sysMakeROMVersion</code> macro (defined in <code>SystemMgr.h</code>) to construct a version number for comparison purposes. It takes five parameters:</p>
<ul type="disc">
  <li><a name="1045550"> </a>Major version number
  <li><a name="1045551"> </a>Minor version number
  <li><a name="1045552"> </a>Fix level
  <li><a name="1045553"> </a>Build stage (either <code>sysROMStageDevelopment</code>,<br><code>sysROMStageAlpha</code>, <code>sysROMStageBeta</code>, or<br><code>sysROMStageRelease</code>)
  <li><a name="1045554"> </a>Build number
</ul>

<p><a name="1045555"> </a>The fix level and build number parameters are normally set to zero, while build stage is usually set to <code>sysROMStageRelease</code>. Simply check to see whether <code>sysFtrNumROMVersion</code> is greater than or equal to the version number constructed with <code>sysMakeROMVersion</code>, as shown here:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
// See if we're on ROM version 3.1 or later.<a name="1045556"> </a>
FtrGet(sysFtrCreator, sysFtrNumROMVersion, &amp;romVersion);<a name="1045557"> </a>
if (romVersion &gt;= sysMakeROMVersion(3, 1, 0,<a name="1045558"> </a>
    sysROMStageRelease, 0)) {<a name="1045559"> </a>
   ....<a name="1045560"> </a>
}<a name="1045561"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1045563"> </a>Other system features are defined in <code>SystemMgr.h</code>. System features are stored in a feature table in the ROM. (In Palm OS 3.1 and higher, the contents of this table are copied into the RAM feature table at system startup.) Checking for the presence of system features allows an application to be compatible with multiple versions of the system by refining its behavior depending on which capabilities are present or not. Future hardware platforms may lack some capabilities present in the first platform, so checking the system version feature is important. </p>

<div><hr>
  <a name="1045564"> </a> <b>IMPORTANT: </b> For best results, we recommend that you check for specific features rather than relying on the system version number to determine if a specific API is available. For more details on checking for features, see the appendix <a href="../PalmOSReference/CompatibilityApdx.html#992643">Compatibility Guide</a> in <i>Palm OS Programmer's API Reference</i>.
<hr>
</div>
<h3 class="hbH3">
  <a name="1045572"> </a>Application-Defined Features <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045574"> </a>Applications may find the feature manager useful for their own private use. For example, an application may want to publish a feature that contains a pointer to some private data it needs for processing launch codes. Because an application's global data is not generally available while it processes launch codes, using the feature manager is usually the easiest way for an application to get to its data. </p>

<p><a name="1045575"> </a>The feature manager maintains one feature table in the RAM as well as the feature table in the ROM. Application-defined features are stored in the RAM feature table. </p>
<h3 class="hbH3">
  <a name="1045577"> </a>Using the Feature Manager <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045582"> </a>To check whether a particular feature is present, call <a href="../PalmOSReference/FeatureManager.html#1036943"><code>FtrGet</code></a> and pass it the feature creator and feature number. If the feature exists, <code>FtrGet</code> returns the 32-bit value of the feature. If the feature doesn't exist, an error code is returned.</p>

<p><a name="1045583"> </a>To publish a new feature or change the value of an existing one, call <a href="../PalmOSReference/FeatureManager.html#1037124"><code>FtrSet</code></a> and pass the feature creator, number, and the 32-bit value of the feature. A published feature remains available until it is explicitly removed by a call to <a href="../PalmOSReference/FeatureManager.html#1037160"><code>FtrUnregister</code></a> or until the system resets; simply quitting an application doesn't remove a feature published by that application. </p>

<p><a name="1045592"> </a>Call <code>FtrUnregister</code> to remove features that were created by calling <code>FtrSet</code>.</p>

<p><a name="1045593"> </a>You can get a complete list of all published features by calling <a href="../PalmOSReference/FeatureManager.html#1036971"><code>FtrGetByIndex</code></a> repeatedly. Passing an index value starting at 0 to <code>FtrGetByIndex</code> and incrementing repeatedly by 1 eventually returns all available features. <code>FtrGetByIndex</code> accepts a parameter that specifies whether to search the ROM feature table or RAM feature table. Note that in Palm OS version 3.1 and higher, the contents of the ROM table are copied into the RAM table at system startup; thus the RAM table serves the entire system. </p>
<h3 class="hbH3">
  <a name="1045598"> </a>Feature Memory <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045600"> </a>Palm OS 3.1 adds support for <b>feature memory</b>. Feature memory provides quick, efficient access to data that persists between invocations of an application. The values stored in feature memory persist until the handheld is reset or until you explicitly free the memory. Feature memory is memory allocated from the storage heap. Thus, you write to feature memory using <a href="../PalmOSReference/DataAndResourceManager.html#1052867"><code>DmWrite</code></a>, which means that writing to feature memory is no faster than writing to a database. However, feature memory can provide more efficient access to that data in certain circumstances.</p>

<p><a name="1045609"> </a>To allocate a chunk of feature memory, call <a href="../PalmOSReference/FeatureManager.html#1037029"><code>FtrPtrNew</code></a>, specifying a feature creator, a feature number, the number of bytes to allocate, and a location where the feature manager can return a pointer to the newly allocated memory chunk. For example:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
FtrPtrNew(appCreator, 
    myFtrMemFtr, 32, &amp;ftrMem);<a name="1045610"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1045611"> </a>Elsewhere in your application, you can obtain the pointer to the feature memory chunk using <a href="../PalmOSReference/FeatureManager.html#1036943"><code>FtrGet</code></a>. </p>

<div><hr>
  <a name="1045616"> </a> <b>NOTE: </b> Starting with Palm OS 3.5 <code>FtrPtrNew</code> allows allocating chunks larger than 64KB. Do keep in mind standard issues with allocating large chunks of memory: there might not be enough contiguous space, and it can impact system performance. 
<hr>
</div>

<p><a name="1045617"> </a>Feature memory is considered a performance optimization. The conditions under which you'd use it are not common, and you probably won't find them in a typical application. You use feature memory in code that: </p>
<ul type="disc">
  <li><a name="1045618"> </a>Is executed infrequently
  <li><a name="1045619"> </a>Does not have access to global variables
  <li><a name="1045620"> </a>Needs access to data whose contents change infrequently and that cannot be stored in a 32-bit feature value 
</ul>

<p><a name="1045621"> </a>For example, suppose you've written a function that is called in response to a launch code, and you expect to receive this launch code frequently. Suppose that function needs access to the application's preferences database. At the start of the function, you'd need to open the database and read the data from it. If the function is called frequently, opening the database each time can be a drain on performance. Instead, you can allocate a chunk of feature memory and write the values you need to that chunk. Because the chunk persists until the handheld is reset, you only need to open the database once. <a href="SystemFeatures.html#1045626">Listing 11.1</a> illustrates this example.</p>
<p class="CCodeCaption">
  <a name="1045626"> </a><b>Listing 11.1&nbsp;&nbsp;Using feature memory </b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
MyAppPreferencesType prefs; <a name="1045627"> </a>
 <a name="1045628"> </a>
if (FtrGet(appCreator, myPrefFtr, (UInt32*)&amp;prefs) != 0) {<a name="1045629"> </a>
 <a name="1045630"> </a>
   // Feature memory doesn't exist, so allocate it.<a name="1045631"> </a>
   FtrPtrNew(appCreator, myPrefFtr, 32, &amp;thePref);<a name="1045632"> </a>
 <a name="1045633"> </a>
   // Load the preferences database. <a name="1045634"> </a>
   PrefGetAppPreferences (appCreator, prefID, &amp;prefs, <a name="1045635"> </a>
      sizeof(prefs), true);<a name="1045636"> </a>
 <a name="1045637"> </a>
   // Write it to feature memory. <a name="1045638"> </a>
   DmWrite(thePref, 0, &amp;prefs, sizeof(prefs));<a name="1045639"> </a>
}<a name="1045640"> </a>
// Now prefs is guaranteed to be defined.<a name="1045641"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1045642"> </a>Another potential use of feature memory is to "publish" data from your application or library to other applications when that data doesn't fit in a normal 32-bit feature value. For example, suppose you are writing a communications library and you want to publish an icon that client applications can use to draw the current connection state. The library can use <code>FtrPtrNew</code> to allocate a feature memory chunk and store an icon representing the current state in that location. Applications can then use <code>FtrGet</code> to access the icon and pass the result to <code>WinDrawBitmap</code> to display the connection state on the screen. </p>

<h2 class="haH2">
  <a name="1045645"> </a>Preferences <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1045646"> </a>The Preferences Manager handles both system-wide preferences and application-specific preferences. The Preferences Manager maintains preferences in two separate databases: </p>
<ul type="disc">
  <li><a name="1045647"> </a>The "saved" preferences database contains preferences that are backed up during a HotSync operation. There is one "saved" preferences database that all applications use. This database contains all system-wide preferences as well as application-specific preferences. 
  <li><a name="1045648"> </a>The "unsaved" preferences database contains application-specific preferences that are not to be backed up during a HotSync operation. There is one "unsaved" preferences database that all application use. 
</ul>

<p><a name="1045649"> </a>This section describes how to obtain and set values for each of these preferences databases. It covers: </p>
<ul type="disc">
  <li><a name="1045653"> </a><a href="SystemFeatures.html#1045663">Accessing System Preferences</a>
  <li><a name="1045657"> </a><a href="SystemFeatures.html#1045753">Setting System Preferences</a>
  <li><a name="1045661"> </a><a href="SystemFeatures.html#1045772">Setting Application-Specific Preferences</a>
</ul>
<h3 class="hbH3">
  <a name="1045663"> </a>Accessing System Preferences <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045664"> </a>The system preferences specify how users want their Palm Powered<sup>&#8482;</sup> handhelds to behave. For example, system preferences specify how dates and times are displayed and whether the system plays a sound when an alarm fires. These values are typically set using the built-in Preferences or Security application. Applications should, as a rule, respect the values stored in the system preferences. </p>

<p><a name="1045665"> </a>To obtain the value of a system preference, use the <a href="../PalmOSReference/Preferences.html#1031531"><code>PrefGetPreference</code></a> function and pass one of the <a href="../PalmOSReference/Preferences.html#1030468"><code>SystemPreferencesChoice</code></a> enum constants. For example, if an application's user interface displays the current date and time, it could do the following to find out how the user wants the date and time displayed: </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
TimeFormatType timeFormat = (TimeFormatType)<a name="1045674"> </a>
   PrefGetPreference(prefTimeFormat);<a name="1045675"> </a>
DateFormatType dateFormat = (DateFormatType)<a name="1045676"> </a>
   PrefGetPreference(prefDateFormat);<a name="1045677"> </a>
</pre><div class="CodeRule"><hr></div>


<div><hr>
  <a name="1045678"> </a> <span class="warning">WARNING! </span> Do not confuse <code>PrefGetPreference</code> with <code>PrefGetPreferences</code>. The latter function is obsolete and retrieves the 1.0 version of the system preferences structure. 
<hr>
</div>

<p><a name="1045679"> </a>Note that the <code>PrefGetPreference</code> function by default returns a <code>UInt32</code> value. This return value must be cast to the appropriate type for the preference being returned. </p>

<p><a name="1045680"> </a>Also note that the system preferences structure has been updated many times and maintains its own version information. Each Palm OS release that modifies the system preferences structure adds its new values to the end and increments the structure's version number, as shown in <a href="SystemFeatures.html#1045690">Table 11.1</a>.</p>

<p class="caption"><a name="1045690"> </a><b>Table 11.1&nbsp;&nbsp;System preference version numbers </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1045694"> </a><b>Palm OS <br>Version</b></p>
    </th>
    <th><p class="tt"><a name="1045696"> </a><b>System Preference Version</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045698"> </a>2.0</p>
    </td>
    <td><p class="tt"><a name="1045700"> </a>2</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045702"> </a>3.0</p>
    </td>
    <td><p class="tt"><a name="1045704"> </a>3</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045706"> </a>3.0</p>
    </td>
    <td><p class="tt"><a name="1045708"> </a>4</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045710"> </a>3.1</p>
    </td>
    <td><p class="tt"><a name="1045712"> </a>5</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045714"> </a>3.2 </p>
    </td>
    <td><p class="tt"><a name="1045716"> </a>6</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045718"> </a>3.3 </p>
    </td>
    <td><p class="tt"><a name="1045720"> </a>7</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045722"> </a>3.5 </p>
    </td>
    <td><p class="tt"><a name="1045724"> </a>8</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1045726"> </a>4.0 </p>
    </td>
    <td><p class="tt"><a name="1045728"> </a>9</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1056437"> </a>Palm OS Garnet version 5.0</p>
    </td>
    <td><p class="tt"><a name="1056439"> </a>10</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1056433"> </a>Palm OS Garnet version 5.1</p>
    </td>
    <td><p class="tt"><a name="1056435"> </a>11</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1056429"> </a>Palm OS Garnet version 5.3SC</p>
    </td>
    <td><p class="tt"><a name="1056431"> </a>12</p>
    </td>
  </tr>
</table>

</div>


<p><a name="1045730"> </a>To learn which preferences were added in which version, as well as the return type expected for each preference, see <a href="../PalmOSReference/Preferences.html#1030505">Table 48.1 on page 900</a> in the <i>Palm OS Programmer's API Reference</i>. </p>

<p><a name="1045737"> </a>To maintain backward compatibility, check the preference version number before checking the value of any preference added after Palm OS 2.0. For example, Palm OS 4.0 added a preference that allows you to access the handheld's locale information (the country and language) as an <code>LmLocaleType</code> structure. Before you try to access that preference, you should check the preference version, as shown in <a href="SystemFeatures.html#1045742">Listing 11.2</a>. </p>
<p class="CCodeCaption">
  <a name="1045742"> </a><b>Listing 11.2&nbsp;&nbsp;Checking the system preference version</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
LmLocaleType currentLocale;<a name="1045743"> </a>
CountryType currentCountry; <a name="1045744"> </a>
if (PrefGetPreference(prefVersion) &gt;= <code>preferenceDataVer9</code>) {<a name="1045745"> </a>
   currentLocale = (LmLocaleType)
     PrefGetPreference(prefLocale);<a name="1045746"> </a>
} else { /* make do with the country */<a name="1045747"> </a>
   currentCountry = (CountryType)<a name="1045748"> </a>
     PrefGetPreference(prefCountry);<a name="1045749"> </a>
}<a name="1045750"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1045751"> </a>In some cases, a newer preference is intended to replace an existing preference. For example, the <code>prefAutoOffDuration</code> preference is replaced by <code>prefAutoOffDurationSecs </code>in version 8 of the preference structure. The older preference stored the auto-off time in minutes, and the newer one stores the time in seconds. If you use <code>prefAutoOffDuration</code> in Palm OS 4.0, the system still returns the current auto-off time in minutes; however, to obtain this value, the system converts the value in seconds to minutes and rounds the result if necessary. You'll receive a more precise value if you use <code>prefAutoOffDurationSecs</code>. </p>
<h3 class="hbH3">
  <a name="1045753"> </a>Setting System Preferences <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045754"> </a>Occasionally, an application may need to set the value of a system-wide preference. It is strongly recommended that you not override the system preferences without user input. </p>

<p><a name="1045755"> </a>For example, suppose you are writing a replacement for the built-in Address Book application. The Preferences application contains a panel where the user can remap the Address Book hard key to open any application they choose. However, you want to make it more convenient for your users to remap the Address Book button, so you might display an alert that asks first-time users if they want the button remapped. If they tap Yes, then you should call <a href="../PalmOSReference/Preferences.html#1031747"><code>PrefSetPreference</code></a> with the new value. The code might look like the following: </p>
<p class="CCodeCaption">
  <a name="1045759"> </a><b>Listing 11.3&nbsp;&nbsp;Setting a system preference</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
if (PrefGetPreference(prefHard2CharAppCreator != <a name="1045760"> </a>
      myAppCreatorId)) {<a name="1045761"> </a>
   if (FrmAlert(MakeMeTheDefaultAlert) == 0) { <a name="1045762"> </a>
      /* user pressed Yes */<a name="1045763"> </a>
      PrefSetPreference(prefHard2CharAppCreator, <a name="1045764"> </a>
         myAppCreatorId);<a name="1045765"> </a>
   }<a name="1045766"> </a>
}<a name="1045767"> </a>
</pre><div class="CodeRule"><hr></div>


<div><hr>
  <a name="1045768"> </a> <span class="warning">WARNING! </span> Do not confuse <code>PrefSetPreference</code> with <code>PrefSetPreferences</code>. The latter function is obsolete and sets the entire system preferences structure for version 1.0. 
<hr>
</div>
<h3 class="hbH3">
  <a name="1045772"> </a>Setting Application-Specific Preferences <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1045773"> </a>You can use the Preferences Manager to set and retrieve preferences specific to your application. You do this by storing the preferences in one of two databases: the "saved" preferences database or the "unsaved" preferences database. </p>

<p><a name="1045774"> </a>To write application preferences, you use <a href="../PalmOSReference/Preferences.html#1031657"><code>PrefSetAppPreferences</code></a>. To read them back in, you use <a href="../PalmOSReference/Preferences.html#1031434"><code>PrefGetAppPreferences</code></a>. Typically, you write the preferences in response to the <code>appStopEvent</code> when control is about to pass to another application. You read the preferences in response to a normal launch. </p>

<p><a name="1045781"> </a><code>PrefSetAppPreferences</code> and <code>PrefGetAppPreferences</code> take roughly the same parameters: the application creator ID, a preference ID that uniquely identifies this preference resource, a pointer to a structure that holds the preference values, the size of the preferences structure, and a Boolean that indicates whether the "saved" or the "unsaved" preferences database is to be used. <code>PrefSetAppPreferences</code> also takes a version number for the preference structure. This value is the return value for <code>PrefGetAppPreferences</code>. </p>

<p><a name="1045782"> </a>The following sections discuss the issues involved in using application-specific preferences:</p>
<ul type="disc">
  <li><a name="1045786"> </a><a href="SystemFeatures.html#1045800">When to Use Application Preferences</a>
  <li><a name="1045790"> </a><a href="SystemFeatures.html#1045816">How to Store Preferences</a>
  <li><a name="1045794"> </a><a href="SystemFeatures.html#1045826">Which Preferences Database to Use</a>
  <li><a name="1045798"> </a><a href="SystemFeatures.html#1045906">Updating Preferences Upon a New Release</a>
</ul>

<h4 class="hcH4">
  <a name="1045800"> </a>When to Use Application Preferences
</h4>

<p><a name="1045801"> </a>You use application preferences to store state specific to your application that should persist across invocations of your application. For example, the built-in applications store information about the last form and the last record or records displayed before control switched to another application. This way, the user can be returned to the same view when he or she goes back to that application. </p>

<p><a name="1045802"> </a>You can also use preferences for other values. You might allow the user to customize the way the application behaves and store such information in the preferences database. You might also use the preferences database as a way to share information with other applications. </p>

<p><a name="1045803"> </a>Make sure that the preference values you choose are as concise as possible. In games, for example, it is often tempting to store a bitmap for the current state of the screen. Such a bitmap is over 25KB on a color handheld, and it is therefore best avoided. Instead, it is better to store items that let you recreate the current state, such as the player's position in pixels and the current level. </p>

<p><a name="1045804"> </a>There are other ways to store values pertinent to your application. For example, you can store a single value as a feature using the Feature Manager. The differences between storing application value as preferences and storing application values as features are: </p>
<ul type="disc">
  <li><a name="1045805"> </a>Preferences (including those stored in the "unsaved" database) survive a soft reset because they reside in the storage heap. Features are deleted upon a soft reset. For this reason, preferences are more appropriate for storing application state than are features. 
  <li><a name="1045806"> </a>An application preference is a database record, so it has a size limit of 64KB. Multiple application preferences are allowed. The features that are supported by all releases of Palm OS have a maximum size of 4KB. 
   <p><a name="1045807"> </a>In Palm OS 3.1 and higher, you can create features greater than 4KB by using feature memory. Feature memory has a maximum size of 64KB before Palm OS 3.5. Palm OS 3.5 and higher allows allocating a chunk of feature memory that is larger than 64KB. However, feature memory is intended to be used in different situations than an application preference is. See the section <a href="SystemFeatures.html#1045598">"Feature Memory"</a> for more information. </p>
</ul>

<p><a name="1045811"> </a>Instead of storing application state values as preferences or features, you could also use a database that your application creates and maintains itself. If you choose this method of storing application preference values, you must write your own functions to read the preferences from the database and write the preferences to the database. If you want the preferences backed up, you need to set the backup bit. However, there may be cases where using your own database has advantages. See <a href="SystemFeatures.html#1045826">"Which Preferences Database to Use"</a>. </p>

<h4 class="hcH4">
  <a name="1045816"> </a>How to Store Preferences
</h4>

<p><a name="1045817"> </a>Most applications store a single preference structure under a single preference resource ID. When the application receives an <code>appStopEvent</code>, it writes the entire structure to the resource using <a href="../PalmOSReference/Preferences.html#1031657"><code>PrefSetAppPreferences</code></a>. When it receives a <code>sysAppLaunchCmdNormalLaunch</code>, it reads the structure back in using <a href="../PalmOSReference/Preferences.html#1031434"><code>PrefGetAppPreferences</code></a>. </p>

<p><a name="1045824"> </a>Storing a single preference structure in the database is a convention that most applications follow because it is convenient to access all preferences at once. The Preferences Manager does allow an application to store more than one preference resource. This requires more calls to <code>PrefSetAppPreferences</code> and <code>PrefGetAppPreferences</code>, but you may find it more convenient to use several preference resources if you have several variable-length preferences. </p>

<h4 class="hcH4">
  <a name="1045826"> </a>Which Preferences Database to Use
</h4>

<p><a name="1045833"> </a>Both <a href="../PalmOSReference/Preferences.html#1031434"><code>PrefGetAppPreferences</code></a> and <a href="../PalmOSReference/Preferences.html#1031657"><code>PrefSetAppPreferences</code></a> take a Boolean value that indicates whether the value is to be read from and written to the "saved" or the "unsaved" preferences database. To write the preference to the "saved" preferences database, use <code>true</code>. To write to the "unsaved" preferences database, use <code>false</code>. </p>

<p><a name="1045834"> </a>The only difference between the two databases is that the "saved" preferences database is backed up when a user performs the HotSync operation, and the "unsaved" preferences database is not backed up by default. (The user can use a third-party tool to set the backup bit in the "unsaved" preferences database, which would cause it to be backed up.) Both the "saved" and the "unsaved" preferences reside in the storage heap and thus persist across soft resets. The only way that preferences are lost is if a hard reset is performed. </p>

<p><a name="1045835"> </a>Use the "saved" preferences only for items that must be restored after a hard reset, and use the "unsaved" preferences for the current state of the application. For example, if your application has a registration code, you might write that to the "saved" preferences database so that the user does not have to look up the registration code and re-enter it after a hard reset. However, such items as the current form being displayed and the current database record being displayed can be lost, so they are written to the "unsaved" preferences database. For games, you might write the high score to the "saved" preferences database and any information about the current game to the "unsaved" preferences database. </p>

<p><a name="1045836"> </a>It is important to use the "saved" preferences database sparingly. Any time that any application stores or changes a preference in the "saved" preferences database, the <i>entire</i> database is backed up during the next HotSync operation. For users with a large number of applications, this practice can seriously impact the time that it takes to perform a HotSync operation. </p>

<p><a name="1045840"> </a><a href="SystemFeatures.html#1045842">Listing 11.4</a> shows the preferences structures and the <code>StopApplication</code> function from the HardBall application. The <code>HardBallPreferenceType</code>, which is written to the "saved" preferences database, only stores the high score information and accumulated time. All other preferences are stored in <code>GameStatusType</code>, which is written to the "unsaved" preferences database. </p>
<p class="CCodeCaption">
  <a name="1045842"> </a><b>Listing 11.4&nbsp;&nbsp;Saving application-specific preferences</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct {<a name="1045843"> </a>
   SavedScore highScore[highScoreMax];<a name="1045844"> </a>
   UInt8 lastHighScore;<a name="1045845"> </a>
   UInt8 startLevel;<a name="1045846"> </a>
   UInt32  accumulatedTime;<a name="1045847"> </a>
} HardBallPreferenceType;<a name="1045848"> </a>
 <a name="1045849"> </a>
typedef struct {<a name="1045850"> </a>
   enum gameProgress  status;<a name="1045851"> </a>
   UInt8  periodLength;<a name="1045852"> </a>
   UInt32 nextPeriodTime;<a name="1045853"> </a>
   UInt32 periodsToWait;<a name="1045854"> </a>
   Boolean  paused;<a name="1045855"> </a>
   UInt32  pausedTime;<a name="1045856"> </a>
   BrickType  brick[rowsOfBricks][columnsOfBricks];<a name="1045857"> </a>
   UInt8  bricksRemaining;<a name="1045858"> </a>
   UInt8 level;<a name="1045859"> </a>
   WorldState last;<a name="1045860"> </a>
   WorldState next;<a name="1045861"> </a>
   RemovedBrick brokenBricks[brokenBricksMax];<a name="1045862"> </a>
   Int16  brokenBricksCount;<a name="1045863"> </a>
   UInt8 ballsRemaining;<a name="1045864"> </a>
   Boolean movePaddleLeft;<a name="1045865"> </a>
   Boolean movePaddleRight;<a name="1045866"> </a>
   SoundType  soundToMake;<a name="1045867"> </a>
   Int8  soundPeriodsRemaining;<a name="1045868"> </a>
   Int32  scoreToAwardBonusBall;<a name="1045869"> </a>
   Boolean lowestHighScorePassed;<a name="1045870"> </a>
   Boolean highestHighScorePassed;<a name="1045871"> </a>
   Boolean gameSpedUp;<a name="1045872"> </a>
   Boolean  cheatMode;<a name="1045873"> </a>
   UInt32 startTime;<a name="1045874"> </a>
} GameStatusType;<a name="1045875"> </a>
 <a name="1045876"> </a>
HardBallPreferenceType Prefs;<a name="1045877"> </a>
static GameStatusType GameStatus;<a name="1045878"> </a>
 <a name="1045879"> </a>
static void StopApplication (void)<a name="1045880"> </a>
{<a name="1045881"> </a>
   ...<a name="1045882"> </a>
   // Update the time accounting.<a name="1045883"> </a>
   Prefs.accumulatedTime += (TimGetTicks() - <a name="1045884"> </a>
      GameStatus.startTime);<a name="1045885"> </a>
   <a name="1045886"> </a>
   // If we are saving a game resuming (it hasn't started <a name="1045887"> </a>
   // playing yet) then preserve the game status.<a name="1045888"> </a>
   if (GameStatus.status == gameResuming) {<a name="1045889"> </a>
      GameStatus.status = SavedGameStatus;<a name="1045890"> </a>
   }<a name="1045891"> </a>
   <a name="1045892"> </a>
   // Save state/prefs.<a name="1045893"> </a>
   PrefSetAppPreferences (appFileCreator, appPrefID, <a name="1045894"> </a>
      appPrefVersion, &amp;Prefs, sizeof (Prefs), true);<a name="1045895"> </a>
   <a name="1045896"> </a>
   PrefSetAppPreferences (appFileCreator, appSavedGameID, <a name="1045897"> </a>
      appSavedGameVersion, &amp;GameStatus, sizeof (GameStatus), <a name="1045898"> </a>
      false);<a name="1045899"> </a>
      <a name="1045900"> </a>
   // Close all the open forms.<a name="1045901"> </a>
   FrmCloseAllForms ();<a name="1045902"> </a>
}<a name="1045903"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1045904"> </a>If you have a large amount of preference data that must be backed up during a HotSync operation and is frequently changed, you could, as a performance optimization, store the preferences in a database that your own application creates and maintains rather than in the "saved" preferences database. This saves the user from having to have the entire "saved" preferences database backed up on every HotSync operation. The disadvantage of this method of saving application preferences is that you must write all code to maintain the database and to retrieve information from it. </p>

<h4 class="hcH4">
  <a name="1045906"> </a>Updating Preferences Upon a New Release
</h4>

<p><a name="1045907"> </a>When you update your application, you may have new items that you want to store in the preferences database. You may choose to write a separate preference record to the database. However, it is better to update the current preference structure, size permitting. </p>

<p><a name="1045914"> </a>The <a href="../PalmOSReference/Preferences.html#1031657"><code>PrefSetAppPreferences</code></a> and <a href="../PalmOSReference/Preferences.html#1031434"><code>PrefGetAppPreferences</code></a> functions use a versioning system that allows you to update an existing preference structure. To use it, keep track of the version number that you pass to <code>PrefSetAppPreferences</code>. Add any new preferences to the end of the preferences structure, and then increment the version number. You might use a macro for this purpose: </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define CurrentPrefsVersion 2<a name="1045915"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1045916"> </a>When a user launches the new version of the application, <code>PrefGetAppPreferences</code> is called before <code>PrefSetAppPreferences</code>. The <code>PrefGetAppPreferences</code> function returns the version number of the preference structure that it retrieved from the database. For example, if the new version is version 2, <code>PrefGetAppPreferences</code> returns 1 the first time that version 2 is run. If the returned version does not match the current version, you know that the user does not have values for the new preferences introduced in version 2. You can then decide to provide default values for those new preferences. </p>

<p><a name="1045917"> </a>The first time any version of your application is run, <code>PrefGetAppPreferences</code> returns <code>noPreferenceFound</code>. This indicates that the user does not have any preferences for the current application and the application must supply default values for the entire preferences structure. <a href="SystemFeatures.html#1045922">Listing 11.5</a> shows how the Datebook handles retrieving the version number from <code>PrefGetAppPreferences</code>.</p>
<p class="CCodeCaption">
  <a name="1045922"> </a><b>Listing 11.5&nbsp;&nbsp;Checking the preference version number</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define datebookPrefsVersionNum 4<a name="1045923"> </a>
 <a name="1045924"> </a>
Int16 DatebookLoadPrefs (DatebookPreferenceType* prefsP)<a name="1045925"> </a>
{<a name="1045926"> </a>
   UInt16 prefsSize;<a name="1045927"> </a>
   Int16 prefsVersion = noPreferenceFound;<a name="1045928"> </a>
   Boolean haveDefaultFont = false;<a name="1045929"> </a>
   UInt32 defaultFont;<a name="1045930"> </a>
   <a name="1045931"> </a>
   ErrNonFatalDisplayIf(!prefsP, "null prefP arg");<a name="1045932"> </a>
   <a name="1045933"> </a>
   <a name="1045934"> </a>
   // Read the preferences / saved-state information.  Fix-up if no prefs or <a name="1045935"> </a>
   // older/newer version<a name="1045936"> </a>
   prefsSize = sizeof (DatebookPreferenceType);<a name="1045937"> </a>
   prefsVersion = PrefGetAppPreferences (sysFileCDatebook, datebookPrefID, <a name="1045938"> </a>
      prefsP, &amp;prefsSize, true);<a name="1045939"> </a>
   <a name="1045940"> </a>
   // If the preferences version is from a future release (as can happen when <a name="1045941"> </a>
   // going back and syncing to an older version of the device), treat it the <a name="1045942"> </a>
   // same as "not found" because it could be significantly different<a name="1045943"> </a>
   if ( prefsVersion &gt; datebookPrefsVersionNum )<a name="1045944"> </a>
      prefsVersion = noPreferenceFound;<a name="1045945"> </a>
   <a name="1045946"> </a>
   if ( prefsVersion == noPreferenceFound ) {<a name="1045947"> </a>
      // Version 1 and 2 preferences<a name="1045948"> </a>
      prefsP-&gt;dayStartHour = defaultDayStartHour;<a name="1045949"> </a>
      prefsP-&gt;dayEndHour = defaultDayEndHour;<a name="1045950"> </a>
      prefsP-&gt;alarmPreset.advance = defaultAlarmPresetAdvance;<a name="1045951"> </a>
      prefsP-&gt;alarmPreset.advanceUnit = defaultAlarmPresetUnit;<a name="1045952"> </a>
      prefsP-&gt;saveBackup = defaultSaveBackup;<a name="1045953"> </a>
      prefsP-&gt;showTimeBars = defaultShowTimeBars;<a name="1045954"> </a>
      prefsP-&gt;compressDayView = defaultCompressDayView;<a name="1045955"> </a>
      prefsP-&gt;showTimedAppts = defaultShowTimedAppts;<a name="1045956"> </a>
      prefsP-&gt;showUntimedAppts = defaultShowUntimedAppts;<a name="1045957"> </a>
      prefsP-&gt;showDailyRepeatingAppts = <a name="1045958"> </a>
         defaultShowDailyRepeatingAppts;<a name="1045959"> </a>
 <a name="1045960"> </a>
      // We need to set up the note font with a default value for the system.<a name="1045961"> </a>
      FtrGet(sysFtrCreator, sysFtrDefaultFont, &amp;defaultFont);<a name="1045962"> </a>
      haveDefaultFont = true;<a name="1045963"> </a>
      <a name="1045964"> </a>
      prefsP-&gt;v20NoteFont = (FontID)defaultFont;<a name="1045965"> </a>
   }<a name="1045966"> </a>
   <a name="1045967"> </a>
   if ((prefsVersion == noPreferenceFound) || (prefsVersion &lt; <a name="1045968"> </a>
         datebookPrefsVersionNum)) {<a name="1045969"> </a>
      // Version 3 preferences<a name="1045970"> </a>
      prefsP-&gt;alarmSoundRepeatCount = defaultAlarmSoundRepeatCount;<a name="1045971"> </a>
      prefsP-&gt;alarmSoundRepeatInterval = defaultAlarmSoundRepeatInterval;<a name="1045972"> </a>
      prefsP-&gt;alarmSoundUniqueRecID = defaultAlarmSoundUniqueRecID;<a name="1045973"> </a>
      prefsP-&gt;noteFont = prefsP-&gt;v20NoteFont;<a name="1045974"> </a>
      <a name="1045975"> </a>
      // Fix up the note font if we copied from older preferences.<a name="1045976"> </a>
      if ((prefsVersion != noPreferenceFound) &amp;&amp; (prefsP-&gt;noteFont == <a name="1045977"> </a>
            largeFont))<a name="1045978"> </a>
         prefsP-&gt;noteFont = largeBoldFont;<a name="1045979"> </a>
      <a name="1045980"> </a>
      if (!haveDefaultFont)<a name="1045981"> </a>
         FtrGet(sysFtrCreator, sysFtrDefaultFont, &amp;defaultFont);<a name="1045982"> </a>
      <a name="1045983"> </a>
      prefsP-&gt;apptDescFont = (FontID)defaultFont;<a name="1045984"> </a>
   }<a name="1045985"> </a>
   <a name="1045986"> </a>
   if ((prefsVersion == noPreferenceFound) || (prefsVersion &lt; <a name="1045987"> </a>
         datebookPrefsVersionNum)) {<a name="1045988"> </a>
      // Version 4 preferences<a name="1045989"> </a>
      prefsP-&gt;alarmSnooze = defaultAlarmSnooze;<a name="1045990"> </a>
   }<a name="1045991"> </a>
   <a name="1045992"> </a>
   return prefsVersion;<a name="1045993"> </a>
}<a name="1045994"> </a>
</pre><div class="CodeRule"><hr></div>


<h2 class="haH2">
  <a name="1045996"> </a>Sound <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1045999"> </a>The Palm OS Garnet Sound Manager controls two independent sound facilities: </p>
<ul type="disc">
  <li><a name="1046000"> </a><b>Simple sound</b>: Single voice, monophonic, square-wave sound synthesis, useful for system beeps. This is the traditional (pre-Palm OS Garnet) Palm OS sound.
  <li><a name="1046001"> </a><b>Sampled sound</b>: Stereo, multi-format, sampled data recording and playback (new in Palm OS Garnet). Sampled sounds can be generated programmatically or read from a soundfile.
</ul>

<p><a name="1046002"> </a>These facilities are independent of each other. Although you can play a simple sound and a sampled sound at the same time, their respective APIs have no effect on each other. For example, you can't use the sampled sound volume-setting function (<a href="../PalmOSReference/SoundManager.html#1041051"><code>SndStreamSetVolume</code></a>) to change the volume of a simple sound. </p>

<p><a name="1046006"> </a>The following sections take a look at the concepts introduced by the Sound Manager. For detailed API descriptions, and for more guidance with regard to the sampled data concepts presented here, see <a href="../PalmOSReference/SoundManager.html#1039079">Chapter 50, "Sound Manager."</a></p>
<h3 class="hbH3">
  <a name="1046010"> </a>Simple Sound <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046011"> </a>There are three ways to play a simple sound: </p>
<ul type="disc">
  <li><a name="1046012"> </a>You can play a single tone of a given pitch, amplitude, and duration by calling <a href="../PalmOSReference/SoundManager.html#1039640"><code>SndDoCmd</code></a>.
  <li><a name="1046016"> </a>You can play a pre-defined system sound ("Information," "Warning," "Error," and so on) through <a href="../PalmOSReference/SoundManager.html#1040018"><code>SndPlaySystemSound</code></a>. 
  <li><a name="1046020"> </a>You can play a tune by passing in a Level 0 Standard MIDI File (SMF) through the <a href="../PalmOSReference/SoundManager.html#1039782"><code>SndPlaySmf</code></a> function. For example, the alarm sounds used in the built-in Date Book application are MIDI records stored in the System MIDI database. MIDI support is included with Palm OS 3.0 and later. For information on MIDI and the SMF format, go to the official MIDI website, <code>http://www.midi.org</code>.
</ul>
<h3 class="hbH3">
  <a name="1046024"> </a>Sampled Sound <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046025"> </a>Over in the sampled sound facilities, there are two fundamental functions: </p>
<ul type="disc">
  <li><a name="1046029"> </a><a href="../PalmOSReference/SoundManager.html#1040695"><code>SndStreamCreate</code></a> opens a new sampled sound "stream" from/into which you record/playback buffers of "raw" data. The trick is that you first have to configure the stream to tell it how to interpret the data. (An alternate function, <a href="../PalmOSReference/SoundManager.html#1040787"><code>SndStreamCreateExtended</code></a>, lets you declare an encoding format.)
  <li><a name="1046036"> </a><a href="../PalmOSReference/SoundManager.html#1040637"><code>SndPlayResource</code></a> is used to play sound data that's read from a (formatted) soundfile. The function configures the playback stream for you, based on the format information in the soundfile header. Currently, only uncompressed WAV and IMA ADPCM WAV formats are recognized. (Note that IMA ADPCM is also known as DVI ADPCM). <code>SndPlayResource</code> is <i>only</i> used to play back sound; it can't be used for recording.
</ul>

<p><a name="1046037"> </a>The Sound Manager also provides functions that let you set the volume and stereo panning for individual recording and playback streams. See <a href="../PalmOSReference/SoundManager.html#1041051"><code>SndStreamSetVolume</code></a> and <a href="../PalmOSReference/SoundManager.html#1040994"><code>SndStreamSetPan</code></a>.</p>
<h3 class="hbH3">
  <a name="1046045"> </a>Simple vs Sampled <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046046"> </a>Comparing the two facilities, simple sound is easy to understand and requires very little programming: In most cases, you load up a structure, call a function, and out pops a beep. Unfortunately, the sound itself is primitive. (An example of simple sound programming is given in <a href="SystemFeatures.html#1046053">"Sound Preferences,"</a> below.)</p>

<p><a name="1046050"> </a>Sampled sound, on the other hand, is (or can be) much more satisfying, but requires more planning than simple sound. How much more depends on what you're doing. Playing samples from a soundfile isn't much more difficult than playing a simple sound, but you have to supply a soundfile. Generating samples programmatically&#8212;and recording sound&#8212;requires more work: You have to implement a callback function that knows something about sound data.</p>

<div><hr>
  <a name="1046051"> </a> <b>IMPORTANT: </b> One significant difference between simple sounds and sampled sounds is that they use different volume scales: Simple sound volumes are in the range [0, 64]; sampled sound volumes are [0, 1024]. 
<hr>
</div>
<h3 class="hbH3">
  <a name="1046053"> </a>Sound Preferences <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046054"> </a>If you're adding short, "informative" sounds to your application, such as system beeps, alarms, and the like, you should first consider using the (simple) system sounds that are defined by the Palm OS, as listed in the reference documentation for <a href="../PalmOSReference/SoundManager.html#1040018"><code>SndPlaySystemSound</code></a>.</p>

<p><a name="1046058"> </a>If you want to create your own system-like sounds, you should at least respect the user's preferences settings with regard to sound volume. In Palm OS 3.0 and later, there are three sound preference constants:</p>
<ul type="disc">
  <li><a name="1046059"> </a><code>prefSysSoundVolume</code> is the default system volume.
  <li><a name="1046060"> </a><code>prefGameSoundVolume</code> is used for game sounds.
  <li><a name="1046061"> </a><code>prefAlarmSoundVolume</code> is used for alarms.
</ul>

<p><a name="1046062"> </a>To apply a sound preference setting to a simple sound volume, you have to retrieve the setting and apply it yourself. For example, here we retrieve the alarm sound volume and use it to set the volume of a simple sound:</p>
<p class="CCodeCaption">
  <a name="1056401"> </a><b>Listing 11.6&nbsp;&nbsp;Obtaining the alarm sound volume preference</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
/* Create a 'sound command' structure. This will encode the parameters of the
tone we want to generate.<a name="1046063"> </a>
*/<a name="1046064"> </a>
SndCommandType sndCommand;<a name="1046065"> </a>
<a name="1046066"> </a>
/* Ask for the 'play a tone' command. */<a name="1046067"> </a>
sndCommand.cmd = sndCmdFreqDurationAmp;<a name="1046068"> </a>
<a name="1046069"> </a>
/* Set the frequency and duration. */<a name="1046070"> </a>
sndCommand.param1 = 1760;<a name="1046071"> </a>
sndCommand.param2 = 500;<a name="1046072"> </a>
<a name="1046073"> </a>
/* Now get the alarm volume and set it in the struct. */<a name="1046074"> </a>
sndCommand.param3 = PrefGetPreference (prefAlarmSoundVolume);<a name="1046075"> </a>
<a name="1046076"> </a>
/* Play the tone. */<a name="1046077"> </a>
SndDoCmd( 0, &amp;sndCommand, true);<a name="1046078"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1046079"> </a>The sampled sound API, on the other hand, provides volume constants (<code>sndSystemVolume</code>, <code>sndGameVolume</code>, and <code>sndSysVolume</code>) that look up a preference setting for you:</p>
<p class="CCodeCaption">
  <a name="1056413"> </a><b>Listing 11.7&nbsp;&nbsp;Using volume constants with sampled sound APIs</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
/* Point our sound data pointer to a record that contains WAV data (record
retrieval isn't shown). <a name="1046080"> </a>
*/<a name="1046081"> </a>
SndPtr soundData = MemHandleLock(...);<a name="1046082"> </a>
<a name="1046083"> </a>
/* Play the data using the default alarm volume setting. */<a name="1046084"> </a>
SndPlayResource(soundData, sndAlarmVolume, sndFlagNormal);<a name="1046085"> </a>
<a name="1046086"> </a>
/* Unlock the data. */<a name="1046087"> </a>
MemPtrUnlock(soundData);<a name="1046088"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1046089"> </a>For greatest compatibility with multiple versions of the sound preferences mechanism, your application should check the version of Palm OS on which it is running. See <a href="SystemFeatures.html#1045513">"The System Version Feature"</a> for more information.</p>
<h3 class="hbH3">
  <a name="1046093"> </a>Standard MIDI Files <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046094"> </a>Although you can use a Level 0 Standard MIDI File to control simple sound generation, this doesn't imply broad support for MIDI messages: Only key down, key up, and tempo change messages are recognized.</p>

<p><a name="1046095"> </a>You can store your MIDI data in a MIDI database:</p>
<ul type="disc">
  <li><a name="1046096"> </a>The database type <code>sysFileTMidi</code> identifies MIDI record databases. 
  <li><a name="1046097"> </a>The system MIDI database is further identified by the creator <code>sysFileCSystem</code>. The database holds a number of system alarm sounds. 
</ul>

<p><a name="1046098"> </a>You can add MIDI records to the system MIDI database, or you can store them in your own.</p>

<p><a name="1046099"> </a>Each record in a MIDI database is a concatenation of a PalmSource-defined MIDI record header, the human-readable name of the MIDI data, and then the MIDI data itself. <a href="SystemFeatures.html#1046104">Figure 11.1</a> depicts a complete Palm OS<sup>&#174;</sup> MIDI record.</p>

<p class="FFigureCaption">
  <a name="1046104"> </a><b>Figure 11.1&nbsp;&nbsp;Palm OS Midi Record</b>
</p>
<div align="left"><img src="images/SndMidiRecHead.gif" border="0" hspace="0" vspace="0">
</div>

<p><a name="1046124"> </a>Note that to get to the track name, use a <a href="../PalmOSReference/SoundManager.html#1039282"><code>SndMidiRecType</code></a> structure; it encapsulates both the record header and the track name. The MIDI track name is <code>null</code>-terminated, even if it's empty. It's at least one byte long and at most <a href="../PalmOSReference/SoundManager.html#1039504"><code>sndMidiNameLength</code></a> bytes long.</p>

<p><a name="1046128"> </a>The following code creates a new MIDI record and adds it to the system MIDI database. </p>
<p class="CCodeCaption">
  <a name="1056414"> </a><b>Listing 11.8&nbsp;&nbsp;Adding a new MIDI record to the system MIDI database</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
/* We need three things: A header, a name, and some data. We'll get the name
and data from somewhere, and create the header ourselves.<a name="1046129"> </a>
*/<a name="1046130"> </a>
char *midiName = ...;<a name="1046131"> </a>
MemHandle midiData = ...;<a name="1046132"> </a>
SndMidiRecHdrType midiHeader;<a name="1046133"> </a>
<a name="1046134"> </a>
/* Database and record gadgetry. */<a name="1046135"> </a>
DmOpenRef database;<a name="1046136"> </a>
MemHandler record;<a name="1046137"> </a>
UInt16 *recordIndex = dmMaxRecordIndex;<a name="1046138"> </a>
UInt8* recordPtr;<a name="1046139"> </a>
UInt8* midiPtr;<a name="1046140"> </a>
<a name="1046141"> </a>
/* MIDI header values: Always set the signature to sndMidiRecSignature, and<a name="1046142"> </a>
reserved to 0. bDataOffset is an offset from the beginning of the header to the<a name="1046143"> </a>
first byte of actual MIDI data. The name includes a null-terminator, hence the<a name="1046144"> </a>
'+ 1'.<a name="1046145"> </a>
*/<a name="1046146"> </a>
midiHeader.signature = sndMidiRecSignature;<a name="1046147"> </a>
midiHeader.reserved = 0;<a name="1046148"> </a>
midiHeader.bDataOffset = sizeof(SndMidiRecHdrType) + StrLen(midiName) + 1;<a name="1046149"> </a>
<a name="1046150"> </a>
/* Open the database and allocate a record. */<a name="1046151"> </a>
database = DmOpenDatabaseByTypeCreator( sysFileTMidi, sysFileCSystem,<a name="1046152"> </a>
               dmModeReadWrite | dmModeExclusive);<a name="1046153"> </a>
record = DmNewRecord(database, &amp;recordIndex, <a name="1046154"> </a>
               midiHeader.bDataOffset + MemHandleSize(midiData));<a name="1046155"> </a>
<a name="1046156"> </a>
/* Lock the data and the record. */<a name="1046157"> </a>
midiDataPtr = MemHandleLock(midiData);<a name="1046158"> </a>
recordPtr = MemHandleLock(record);<a name="1046159"> </a>
<a name="1046160"> </a>
/* Write the MIDI header. */<a name="1046161"> </a>
DmWrite( recordPtr, 0, &amp;midiHeader, sizeof(midiHeader));<a name="1046162"> </a>
<a name="1046163"> </a>
/* Write the track name. */<a name="1046164"> </a>
DmStrCopy( recordPtr, ((Uint32)(&amp;((SndMidiRecType *)0)-&gt;name)), midiName);<a name="1046165"> </a>
<a name="1046166"> </a>
/* Write the MIDI data. */<a name="1046167"> </a>
DmWrite( recordPtr, midiHeader.bDataOffset, midiDataPtr, 
               MemHandleSize(midiData));<a name="1046168"> </a>
<a name="1046169"> </a>
/* Unlock the handles, release the record, close the database. */<a name="1046170"> </a>
MemHandleUnlock( midiData);<a name="1046171"> </a>
MemHandleUnlock( record);<a name="1046172"> </a>
DmReleaseRecord( database, recordIndex, 1);<a name="1046173"> </a>
DmCloseDatabase( database);<a name="1046174"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1046178"> </a>To retrieve a MIDI record, you can use the <a href="../PalmOSReference/SoundManager.html#1039614"><code>SndCreateMidiList</code></a> function if you know the record's creator, or you can use the Data Manager functions to iterate through all MIDI records.</p>
<h3 class="hbH3">
  <a name="1046179"> </a>Creating a Sound Stream <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046180"> </a>The sound stream API, part of the sampled sound facility, is the most flexible part of the Sound Manager. A sound stream sends sampled data to or reads sampled data from the sound hardware. There are 15 sound output streams and one input stream, all running (or potentially running) concurrently. </p>

<p><a name="1046181"> </a>To use a sound stream, you have to tell it what sort of data you're going to give it or that you expect to get from it. All of the sound format information that you need to supply to set up the stream&#8212;data quantization, sampling rate, channel count, and so on&#8212;is passed in the <a href="../PalmOSReference/SoundManager.html#1040695"><code>SndStreamCreate</code></a> or <a href="../PalmOSReference/SoundManager.html#1040787"><code>SndStreamCreateExtended</code></a> function.</p>

<p><a name="1046188"> </a>You also have to pass the function a pointer to a callback function (see <a href="../PalmOSReference/SoundManager.html#1041156"><code>SndStreamBufferCallback</code></a> or <a href="../PalmOSReference/SoundManager.html#1041201"><code>SndStreamVariableBufferCallback</code></a>); implementing this function is where you'll be doing most of your work. When you tell your stream to start running (<a href="../PalmOSReference/SoundManager.html#1041089"><code>SndStreamStart</code></a>), the callback function is called automatically, once per buffer of data. If you're operating on an input stream (in other words, if you're recording), your callback function is expected to empty the buffer, do something with the data, and then return before the next buffer shows up. Output stream callbacks do the opposite&#8212;they fill the buffer with data.</p>

<p><a name="1046198"> </a>Because of the amount of data involved, the callbacks must operate as quickly as possible. This is particularly important for output stream callbacks: Not only can there be more than one stream competing for attention, but all output callbacks run in the same task (which is created and managed by the Sound Manager). If the callback for (output) stream A takes too long to fill the stream with data, the callbacks for stream B, C, and so on, will starve. Starving threads make glitchy sounds.</p>

<p><a name="1046199"> </a>The formats that are supported by the sampled sound functions are described in the functions themselves. </p>

<h2 class="haH2">
  <a name="1046202"> </a>System Boot and Reset <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1046205"> </a>Any reset is normally performed by sticking a bent-open paper clip into the small hole in the back of the handheld. This hole, known as the "reset switch" is above and to the right of the serial number sticker (on Palm III handhelds). Depending on additional keys held down, the reset behavior varies, as follows:</p>
<h3 class="hbH3">
  <a name="1046206"> </a>Soft Reset <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046208"> </a>A soft reset clears all of the dynamic heap (Heap 0, Card 0). The storage heaps remain untouched. The operating system restarts from scratch with a new stack, new global variables, restarted drivers, and a reset communication port. All applications on the handheld receive a <a href="../PalmOSReference/AppLaunchCodes.html#1012412"><code>sysAppLaunchCmdSystemReset</code></a> launch code. </p>
<h3 class="hbH3">
  <a name="1046214"> </a>Soft Reset + Up Arrow <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046216"> </a>Holding the up-arrow down while pressing the reset switch with a paper clip causes the same soft reset logic with the following two exceptions:</p>
<ul type="disc">
  <li><a name="1046217"> </a>The <code>sysAppLaunchCmdSystemReset</code> launch code is not sent to applications. This is useful if there is an application on the handheld that crashes upon receiving this launch code (not uncommon) and therefore prevents the system from booting. 
  <li><a name="1046219"> </a>The OS won't load any system patches during startup. This is useful if you have to delete or replace a system patch database. If the system patches are loaded and therefore open, they cannot be replaced or deleted from the system. 
</ul>
<h3 class="hbH3">
  <a name="1046220"> </a>Hard Reset <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046222"> </a>A hard reset is performed by pressing the reset switch with a paper clip while holding down the power key. This has all the effects of the soft reset. In addition, the storage heaps are erased. As a result, all programs, data, patches, user information, etc. are lost. A confirmation message is displayed asking the user to confirm the deletion of all data. </p>

<p><a name="1046224"> </a>The <code>sysAppLaunchCmdSystemReset</code> launch code is sent to the applications at this time. If the user selected the "Delete all data" option, the digitizer calibration screen comes up first. The default databases for the four main applications is copied out of the ROM. </p>

<p><a name="1046226"> </a>If you hold down the up arrow key when the "Delete all data" message is displayed, and then press the other four application buttons while still holding the up arrow key, the system is booted without reading the default databases for the four main applications out of ROM. </p>
<h3 class="hbH3">
  <a name="1046227"> </a>System Reset Calls <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046228"> </a>The system manager provides support for rebooting the Palm Powered handheld. It calls <a href="../PalmOSReference/SystemManager.html#1076840"><code>SysReset</code></a> to reset the handheld. This call does a soft reset and has the same effect as pressing the reset switch on the unit. <i>Normally applications should not use this call.</i> </p>

<p><a name="1046233"> </a><code>SysReset</code> is used, for example, by the Sync application. When the user copies an extension onto the Palm Powered handheld, the Sync application automatically resets the handheld after the sync is completed to allow the extension to install itself. </p>

<h2 class="haH2">
  <a name="1046506"> </a>Hardware Interaction <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1046509"> </a>Palm OS differs from a traditional desktop system in that it's never really turned off. Power is constantly supplied to essential subsystems and the on/off key is merely a way of bringing the handheld in or out of low-power mode. The obvious effect of pressing the on/off key is that the LCD turns on or off. When the user presses the power key to turn the handheld off, the LCD is disabled, which makes it appear as if power to the entire unit is turned off. In fact, the memory system, real-time clock, and the interrupt generation circuitry are still running, though they are consuming little current. </p>

<p><a name="1046510"> </a>This section looks at Palm OS power management, discussing the following topics:</p>
<ul type="disc">
  <li><a name="1046514"> </a><a href="SystemFeatures.html#1046524">Palm OS Power Modes</a>
  <li><a name="1046518"> </a><a href="SystemFeatures.html#1046542">Guidelines for Application Developers</a>
  <li><a name="1046522"> </a><a href="SystemFeatures.html#1046555">Power Management Calls</a>
</ul>
<h3 class="hbH3">
  <a name="1046524"> </a>Palm OS Power Modes <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046526"> </a>To minimize power consumption, the operating system dynamically switches between three different modes of operation: sleep mode, doze mode, and running mode. The system manager controls transitions between different power modes and provides an API for controlling some aspects of the power management. </p>
<ul type="disc">
  <li><a name="1046529"> </a>In <b>sleep mode</b>, the handheld looks like it's turned off: the display is blank, the digitizer is inactive, and the main clock is stopped. The only circuits still active are the real-time clock and interrupt generation circuitry. 
   <p><a name="1046530"> </a>The handheld enters this mode when there is no user activity for a number of minutes or when the user presses the off button. The handheld comes out of sleep mode only when there is an interrupt, for example, when the user presses a button. </p>
   <p><a name="1046531"> </a>To enter sleep mode, the system puts as many peripherals as possible into low-power mode and sets up the hardware so that an interrupt from any hard key or the real-time clock wakes up the system. When the system gets one of these interrupts while in sleep mode, it quickly checks that the battery is strong enough to complete the wake-up and then takes each of the peripherals, for example, the LCD, serial port, and timers, out of low-power mode. </p>
  <li><a name="1046533"> </a>In <b>doze mode</b>, the main clock is running, the handheld appears to be turned on, the LCD is on, and the processor's clock is running but it's not executing instructions (that is, it's halted). When the processor receives an interrupt, it comes out of halt and starts processing the interrupt. 
   <p><a name="1046534"> </a>The handheld enters this mode whenever it's on but has no user input to process.</p>
   <p><a name="1046535"> </a>The system can come out of doze mode much faster than it can come out of sleep mode since none of the peripherals need to be woken up. In fact, it takes no longer to come out of doze mode than to process an interrupt. Usually, when the system appears on, it is actually in doze mode and goes into running mode only for short periods of time to process an interrupt or respond to user input like a pen tap or key press. </p>
  <li><a name="1046537"> </a>In <b>running mode</b>, the processor is actually executing instructions. 
   <p><a name="1046538"> </a>The handheld enters this mode when it detects user input (like a tap on the screen) while in doze mode or when it detects an interrupt while in doze or sleep mode. The handheld stays in running mode only as long as it takes to process the user input (most likely less than a second), then it immediately reenters doze mode. A typical application puts the system into running mode only about 5% of the time. </p>
</ul>

<p><a name="1046540"> </a>To maximize battery life, the processor on the Palm Powered handheld is kept out of running mode as much as possible. Any interrupt generated on the handheld must therefore be capable of "waking" up the processor. The processor can receive interrupts from the serial port, the hard buttons on the case, the button on the cradle, the programmable timer, the memory module slot, the real-time clock (for alarms), the low-battery detector, and any built-in peripherals such as a pager or modem. </p>
<h3 class="hbH3">
  <a name="1046542"> </a>Guidelines for Application Developers <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046544"> </a>Normally, applications don't need to be aware of power management except for a few simple guidelines. When an application calls <a href="../PalmOSReference/SystemEventManager.html#1071061"><code>EvtGetEvent</code></a> to ask the system for the next event to process, the system automatically puts itself into doze mode until there is an event to process. As long as an application uses <code>EvtGetEvent</code>, power management occurs automatically. If there has been no user input for the amount of time determined by the current setting of the auto-off preference, the system automatically enters sleep mode without intervention from the application.</p>

<p><a name="1046549"> </a>Applications should avoid providing their own delay loops. Instead, they should use <a href="../PalmOSReference/SystemManager.html#1076935"><code>SysTaskDelay</code></a>, which puts the system into doze mode during the delay to conserve as much power as possible. If an application needs to perform periodic work, it can pass a time out to <code>EvtGetEvent</code>; this forces the unit to wake up out of doze mode and to return to the application when the time out expires, even if there is no event to process. Using these mechanisms provides the longest possible battery life.</p>
<h3 class="hbH3">
  <a name="1046555"> </a>Power Management Calls <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046556"> </a>The system calls <code>SysSleep</code> to put itself immediately into low-power sleep mode. Normally, the system puts itself to sleep when there has been no user activity for the minimum auto-off time or when the user presses the power key. </p>

<p><a name="1046561"> </a>The <a href="../PalmOSReference/SystemManager.html#1076860"><code>SysSetAutoOffTime</code></a> routine changes the auto-off time value. This routine is normally used by the system only during boot, and by the Preferences application. The Preferences application saves the user preference for the auto-off time in a preferences database, and the system initializes the auto-off time to the value saved in the preferences database during boot. While the auto-off feature can be disabled entirely by calling <code>SysSetAutoOffTime</code> with a time-out of 0, doing this depletes the battery. </p>

<p><a name="1046563"> </a>The current battery level and other information can be obtained through the <a href="../PalmOSReference/SystemManager.html#1075965"><code>SysBatteryInfo</code></a> routine. This call returns information about the battery, including the current battery voltage in hundredths of a volt, the warning thresholds for the low-battery alerts, the battery type, and whether external power is applied to the unit. This call can also change the battery warning thresholds and battery type. </p>

<h2 class="haH2">
  <a name="1046570"> </a>The Microkernel <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1046572"> </a>Palm OS has a preemptive multitasking kernel that provides basic task management.</p>

<p><a name="1046573"> </a>Most applications don't need the microkernel services because they are handled automatically by the system. This functionality is provided mainly for internal use by the system software or for certain special purpose applications. </p>

<p><a name="1046574"> </a>In this version of the Palm OS, there is only one user interface application running at a time. The User Interface Application Shell (UIAS) is responsible for managing the current user-interface application. The UIAS launches the current user-interface application as a subroutine and doesn't get control back until that application quits. When control returns to the UIAS, the UIAS immediately launches the next application as another subroutine. See <a href="SystemFeatures.html#1046555">"Power Management Calls"</a> for more information. </p>

<p><a name="1046580"> </a>Usually, the UIAS is the only task running. Occasionally though, an application launches another task as a part of its normal operation. One example of this is the Sync application, which launches a second task to handle the serial communication with the desktop. The Sync application creates a second task dedicated to the serial communication and gives this task a lower priority than the main user-interface task. The result is optimal performance over the serial port without a delay in response to the user-interface controls. </p>

<p><a name="1046582"> </a>Normally, there is no user interaction during a sync, so that the serial communication task gets all of the processor's time. However, if the user does tap on the screen, for example, to cancel the sync, the user-interface task immediately processes the tap, since it has a higher priority. Alternatively, the Sync application could have been written to use just one task, but then it would have to periodically poll for user input during the serial communication, which would hamper performance and user-interface response time.</p>

<div><hr>
  <a name="1046585"> </a> <b>NOTE: </b> Only system software can launch a separate task. The multi-tasking API is not available to developer applications.
<hr>
</div>

<h2 class="haH2">
  <a name="1046593"> </a>Retrieving the ROM Serial Number <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1046594"> </a>Some Palm<sup>&#8482;</sup> handhelds, beginning with the Palm III product, hold a 12-digit serial number that identifies the handheld uniquely. (Earlier handhelds do not have this identifier.) The serial number is held in a displayable text buffer with no null terminator. The user can view the serial number in the <a href="UserInterface.html#1011190">Application Launcher</a> application. (The pop-up version of the Launcher does not display the serial number.) The Application Launcher also displays to the user a checksum digit that you can use to validate user entry of the serial number. </p>

<p><a name="1046598"> </a>To retrieve the ROM serial number programmatically, pass the <code>sysROMTokenSnum</code> selector to the <a href="../PalmOSReference/SystemManager.html#1076426"><code>SysGetROMToken</code></a> function. If the <a href="../PalmOSReference/SystemManager.html#1076426"><code>SysGetROMToken</code></a> function returns an error, or if the returned pointer to the buffer is <code>NULL</code>, or if the first byte of the text buffer is <code>0xFF</code>, then no serial number is available.</p>

<p><a name="1046608"> </a>The <code>DrawSerialNumOrMessage</code> function shown in <a href="SystemFeatures.html#1046611">Listing 11.9</a> retrieves the ROM serial number, calculates the checksum, and draws both on the screen at a specified location. If the handheld has no serial number, this function draws a message you specify. This function accepts as its input a pair of coordinates at which it draws output, and a pointer to the message it draws when a serial number is not available. </p>
<p class="CCodeCaption">
  <a name="1046611"> </a><b>Listing 11.9&nbsp;&nbsp;DrawSerialNumOrMessage</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void DrawSerialNumOrMessage(Int16 x, Int16 y, Char*
noNumberMessage)<a name="1046612"> </a>
{<a name="1046613"> </a>
   Char* bufP;<a name="1046614"> </a>
   UInt16* bufLen;<a name="1046615"> </a>
   Err retval;<a name="1046616"> </a>
   Int16    count;<a name="1046617"> </a>
   UInt8    checkSum;<a name="1046618"> </a>
   Char    checksumStr[2];<a name="1046619"> </a>
      // holds the dash and the checksum digit<a name="1046620"> </a>
 <a name="1046621"> </a>
   retval = SysGetROMToken (0, sysROMTokenSnum,
                                      (UInt8**) &amp;bufP, 
&amp;bufLen);<a name="1046622"> </a>
   if ((!retval) &amp;&amp; (bufP) &amp;&amp; ((UInt8) *bufP != 0xFF)) { 
      // there's a valid serial number!<a name="1046623"> </a>
      // Calculate the checksum:  Start with zero, add each 
digit,
      // then rotate the result one bit to the left and 
repeat.<a name="1046624"> </a>
         checkSum = 0;<a name="1046625"> </a>
         for (count=0; count&lt;bufLen; count++) {<a name="1046626"> </a>
            checkSum += bufP[count];<a name="1046627"> </a>
            checkSum = (checkSum&lt;&lt;1) | ((checkSum &amp; 0x80) &gt;&gt; 
7);<a name="1046628"> </a>
            }<a name="1046629"> </a>
      // Add the two hex digits (nibbles) together, +2 
      // (range: 2 - 31 ==&gt; 2-9, A-W)<a name="1046630"> </a>
      // By adding 2 to the result before converting to 
ascii,
      // we eliminate the numbers 0 and 1, which can be
      // difficult to distinguish from the letters O and I.
      checkSum = ((checkSum&gt;&gt;4) &amp; 0x0F) + (checkSum &amp; 0x0F) + 
2;<a name="1046631"> </a>
 <a name="1046632"> </a>
      // draw the serial number and find out how wide it was
      WinDrawChars(bufP, bufLen, x, y);
      x += FntCharsWidth(bufP, bufLen);<a name="1046633"> </a>
 <a name="1046634"> </a>
      // draw the dash and the checksum digit right after it
      checksumStr[0] = '-';
      checksumStr[1] = 
         ((checkSum &lt; 10) ? (checkSum +'0'):(checkSum -10 
+'A'));
      WinDrawChars (checksumStr, 2, x, y);
      }<a name="1046635"> </a>
      else // there's no serial number
      // draw a status message if the caller provided one
      if (noNumberMessage)
         WinDrawChars(noNumberMessage, 
StrLen(noNumberMessage),x, y);<a name="1046636"> </a>
}<a name="1046638"> </a>
</pre><div class="CodeRule"><hr></div>


<h2 class="haH2">
  <a name="1046640"> </a>Time <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1046645"> </a>The Palm Powered handheld has a real-time clock and programmable timer as part of the 68328 processor. The real-time clock maintains the current time even when the system is in sleep mode (turned off). It's capable of generating an interrupt to wake the handheld when an alarm is set by the user. The programmable timer is used to generate the system tick count interrupts (100 times/second) while the processor is in doze or running mode. The system tick interrupts are required for periodic activity such as polling the digitizer for user input, key debouncing, etc.</p>

<p><a name="1046651"> </a>The date and time manager (called time manager in this chapter) provides access to both the 1-second and 0.01-second timing resources on the Palm Powered handheld. </p>
<ul type="disc">
  <li><a name="1046654"> </a>The 1-second timer keeps track of the real-time clock (date and time), even when the unit is in sleep mode. 
  <li><a name="1046657"> </a>The 0.01-second timer, also referred to as the <i>system ticks</i>, can be used for finer timing tasks. This timer is not updated when the unit is in sleep mode and is reset to 0 each time the unit resets.
</ul>

<p><a name="1046658"> </a>The basic time-manager API provides support for setting and getting the real-time clock in seconds and for getting the current system ticks value (but not for setting it). The system manager provides more advanced functionality for setting up a timer task that executes periodically or in a given number of system ticks.</p>

<p><a name="1046659"> </a>This section discusses the following topics: </p>
<ul type="disc">
  <li><a name="1046663"> </a><a href="SystemFeatures.html#1046669">Using Real-Time Clock Functions</a>
  <li><a name="1046667"> </a><a href="SystemFeatures.html#1046689">Using System Ticks Functions</a>
</ul>
<h3 class="hbH3">
  <a name="1046669"> </a>Using Real-Time Clock Functions <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046671"> </a>The real-time clock functions of the time manager include <a href="../PalmOSReference/DateAndTimeManager.html#1098594"><code>TimSetSeconds</code></a> and <a href="../PalmOSReference/DateAndTimeManager.html#1098520"><code>TimGetSeconds</code></a>. Real time on the Palm Powered handheld is measured in seconds from midnight, Jan. 1, 1904. Call <a href="../PalmOSReference/DateAndTimeManager.html#1098565"><code>TimSecondsToDateTime</code></a> and <a href="../PalmOSReference/DateAndTimeManager.html#1098496"><code>TimDateTimeToSeconds</code></a> to convert between seconds and a structure specifying year, month, day, hour, minute, and second.</p>
<h3 class="hbH3">
  <a name="1046689"> </a>Using System Ticks Functions <a href="#1045397"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1046690"> </a>The Palm Powered handheld maintains a tick count that starts at 0 when the handheld is reset. This tick increments </p>
<ul type="disc">
  <li><a name="1046691"> </a>100 times per second when running on the Palm Powered handheld
  <li><a name="1046693"> </a>60 times per second when running on the Macintosh under the Simulator
</ul>

<p><a name="1046696"> </a>For tick-based timing purposes, applications should use the macro <a href="../PalmOSReference/SystemManager.html#1076960"><code>SysTicksPerSecond</code></a>, which is conditionally compiled for different platforms. Use the function <a href="../PalmOSReference/DateAndTimeManager.html#1098540"><code>TimGetTicks</code></a> to read the current tick count.</p>

<p><a name="1046705"> </a>Although the <code>TimGetTicks</code> function could be used in a loop to implement a delay, it is recommended that applications use the <a href="../PalmOSReference/SystemManager.html#1076935"><code>SysTaskDelay</code></a> function instead. The <code>SysTaskDelay</code> function automatically puts the unit into low-power mode during the delay. Using <code>TimGetTicks</code> in a loop consumes much more current.</p>

<h2 class="haH2">
  <a name="1046711"> </a>Floating-Point <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1046712"> </a>The Palm OS supports IEEE-754 single and double precision floating-point numbers declared with the C types <code>float</code> and <code>double</code>. Numbers of type <code>float</code> occupy four bytes and have an effective range of 1.17549e-38 to 3.40282e+38. Numbers of type <code>double</code> occupy eight bytes and have an effective range of <br>2.22507e-308 to 1.79769e+308.</p>

<p><a name="1046713"> </a>You can use basic arithmetic operations to add, subtract, multiply, and divide numbers of type <code>float</code> and <code>double</code>. Higher-level functions such as those in the standard C header file <code>math.h</code> are not part of the core OS; you must either write them yourself, or you must employ a third-party math library.</p>

<p><a name="1046714"> </a>The standard IEEE-754 special "non-number" values of NaN (not a number), +INF (positive infinity), and -INF (negative infinity) are generated as appropriate if you perform an operation that produces a result outside the range of numbers that can be represented. For instance, dividing a positive number by 0 returns +INF.</p>

<p><a name="1046715"> </a>The Float Manager contains functions that convert double-precision floating-point numbers to and from a string using scientific notation. It also contains <a href="../PalmOSReference/FloatManager.html#996095"><code>FlpBufferCorrectedAdd</code></a> and <a href="../PalmOSReference/FloatManager.html#996129"><code>FlpBufferCorrectedSub</code></a>, which perform the indicated operation and correct the result in those situations where the result should be zero but isn't due to the way that floating-point numbers are represented. All of the Float Manager functions that either accept or return a floating-point number require it to be declared as an <code>FlpDouble</code>. The Float Manager defines a union, <a href="../PalmOSReference/FloatManager.html#995822"><code>FlpCompDouble</code></a>, that you use to declare values that can be interpreted either as a <code>double</code> or as an <code>FlpDouble</code>. You use this union as shown here:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
double dblFlpCorrectedAdd (double d1, double d2, Int16 acc) {<a name="1046725"> </a>
    FlpCompDouble fcd1, fcd2, fcdResult;<a name="1046726"> </a>
 <a name="1046727"> </a>
    fcd1.d = d1;<a name="1046728"> </a>
    fcd2.d = d2;<a name="1046729"> </a>
    FlpBufferCorrectedAdd(&amp;fcdResult.fd, fcd1.fd, fcd2.fd,
        acc);<a name="1046730"> </a>
    return fcdResult.d;<a name="1046731"> </a>
}<a name="1046732"> </a>
</pre><div class="CodeRule"><hr></div>


<div><hr>
  <a name="1046733"> </a> <b>NOTE: </b> If you are using CodeWarrior, you have the option of using <a href="../PalmOSReference/FloatManager.html#995906"><code>FlpAToF</code></a>, <a href="../PalmOSReference/FloatManager.html#996163"><code>FlpCorrectedAdd</code></a>, and <a href="../PalmOSReference/FloatManager.html#996200"><code>FlpCorrectedSub</code></a> instead of <a href="../PalmOSReference/FloatManager.html#996065"><code>FlpBufferAToF</code></a>, <a href="../PalmOSReference/FloatManager.html#996095"><code>FlpBufferCorrectedAdd</code></a>, and <a href="../PalmOSReference/FloatManager.html#996129"><code>FlpBufferCorrectedSub</code></a>. These "non-buffer" functions all return their results directly, rather than updating a value pointed to by the first parameter. Because they return an <code>FlpDouble</code>&#8212;which is a struct&#8212;and because the GCC compiler's convention for returning structures from functions is incompatible with Palm OS, GCC users can only use the <code>FlpBuffer... </code>versions.
<hr>
</div>

<p><a name="1046752"> </a>In the rare event that you need to work with the binary representation of a <code>double</code>, the Float Manager also contains a number of functions and macros that allow you to obtain and in some cases alter the sign, mantissa, and exponent of a 64-bit floating-point number. See <a href="../PalmOSReference/FloatManager.html#995796">Chapter 36, "Float Manager,"</a> of the <i>Palm OS Programmer's API Reference</i> for the functions and macros that make up the Float Manager.</p>

<p><a name="1046759"> </a>The Float Manager, which was introduced in Palm OS 2.0, is sometimes referred to as the New Float Manager to distinguish it from the Float Manager that was part of Palm OS 1.0. The 1.0 Float Manager, which is less accurate and less convenient to use (simple operations such as addition require a call to a Float Manager function), remains in the ROM solely for backward compatibility; its functions are no longer publicly declared in the Palm OS SDK and should no longer be used. The functions in the old Float Manager all begin with "Fpl" rather than the current "Flp"; see <a href="../PalmOSReference/FloatManagerOld.html#1007747">Appendix C, "1.0 Float Manager,"</a> of the <i>Palm OS Programmer's API Reference</i> for the functions that make up the original Float Manager.</p>

<h2 class="haH2">
  <a name="1046768"> </a>Summary of System Features <a href="#1045397"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1046772"> </a><b>Feature Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1046774"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="2"><p class="tt"><a name="1046779"> </a><a href="../PalmOSReference/FeatureManager.html#1036943">FtrGet</a><br><a href="../PalmOSReference/FeatureManager.html#1037124">FtrSet</a><br><a href="../PalmOSReference/FeatureManager.html#1037029">FtrPtrNew</a><br><a href="../PalmOSReference/FeatureManager.html#1037083">FtrPtrResize</a></p>
    </td>
    <td colspan="1" rowspan="2"><p class="tt"><a name="1046793"> </a><a href="../PalmOSReference/FeatureManager.html#1036971">FtrGetByIndex</a><br><a href="../PalmOSReference/FeatureManager.html#1037160">FtrUnregister</a><br><a href="../PalmOSReference/FeatureManager.html#1037001">FtrPtrFree</a></p>
    </td>
  </tr>
  <tr valign="top">
  </tr>
</table>

</div>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1046807"> </a><b>Preferences Functions</b></p>
    </th>
    <th><p class="tt"><a name="1046809"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="2"><p class="tt"><a name="1046814"> </a><a href="../PalmOSReference/Preferences.html#1031434">PrefGetAppPreferences</a><br><a href="../PalmOSReference/Preferences.html#1031657">PrefSetAppPreferences</a><br><a href="../PalmOSReference/Preferences.html#1031531">PrefGetPreference</a><br><a href="../PalmOSReference/Preferences.html#1031600">PrefOpenPreferenceDB</a><br><a href="../PalmOSReference/Preferences.html#1031574">PrefGetPreferences</a></p>
    </td>
    <td colspan="1" rowspan="2"><p class="tt"><a name="1046831"> </a><a href="../PalmOSReference/Preferences.html#1031497">PrefGetAppPreferencesV10</a><br><a href="../PalmOSReference/Preferences.html#1031713">PrefSetAppPreferencesV10</a><br><a href="../PalmOSReference/Preferences.html#1031747">PrefSetPreference</a><br><a href="../PalmOSReference/Preferences.html#1031632">PrefOpenPreferenceDBV10</a><br><a href="../PalmOSReference/Preferences.html#1031773">PrefSetPreferences</a></p>
    </td>
  </tr>
  <tr valign="top">
  </tr>
</table>

</div>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1046851"> </a><b>Sound Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1046853"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="3"><p class="tt"><a name="1046858"> </a><a href="../PalmOSReference/SoundManager.html#1039614">SndCreateMidiList</a><br><a href="../PalmOSReference/SoundManager.html#1039733">SndGetDefaultVolume</a><br><a href="../PalmOSReference/SoundManager.html#1039782">SndPlaySmf</a><br><a href="../PalmOSReference/SoundManager.html#1039933">SndPlaySmfResource</a><br><a href="../PalmOSReference/SoundManager.html#1040018">SndPlaySystemSound</a></p>
    </td>
    <td colspan="1" rowspan="3"><p class="tt"><a name="1046875"> </a><a href="../PalmOSReference/SoundManager.html#1039640">SndDoCmd</a><br><a href="../PalmOSReference/SoundManager.html#1039759">SndInterruptSmfIrregardless</a><br><a href="../PalmOSReference/SoundManager.html#1039856">SndPlaySmfIrregardless</a><br><a href="../PalmOSReference/SoundManager.html#1039973">SndPlaySmfResourceIrregardless</a></p>
    </td>
  </tr>
  <tr valign="top">
  </tr>
  <tr valign="top">
  </tr>
</table>

</div>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1046897"> </a><b>System Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1046899"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046901"> </a><b>System Dialogs</b></p>
    </td>
    <td><p class="tt"><a name="1046903"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046908"> </a><a href="../PalmOSReference/SystemDialogs.html#995849">SysGraffitiReferenceDialog</a><br><a href="../PalmOSReference/SystemManager.html#1076645">SysKeyboardDialogV10</a></p>
    </td>
    <td><p class="tt"><a name="1046916"> </a><a href="../PalmOSReference/SystemManager.html#1076616">SysKeyboardDialog</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046918"> </a><b>Power Management</b></p>
    </td>
    <td><p class="tt"><a name="1046920"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046925"> </a><a href="../PalmOSReference/SystemManager.html#1075965">SysBatteryInfo</a><br><a href="../PalmOSReference/SystemManager.html#1076860">SysSetAutoOffTime</a></p>
    </td>
    <td><p class="tt"><a name="1046933"> </a><a href="../PalmOSReference/SystemManager.html#1076013">SysBatteryInfoV20</a><br><a href="../PalmOSReference/SystemManager.html#1076935">SysTaskDelay</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046938"> </a><b>System Management</b></p>
    </td>
    <td><p class="tt"><a name="1046940"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046945"> </a><a href="../PalmOSReference/SystemManager.html#1076670">SysLibFind</a><br><a href="../PalmOSReference/SystemManager.html#1076823">SysRandom</a><br><a href="../PalmOSReference/SystemManager.html#1076513">SysGremlins</a></p>
    </td>
    <td><p class="tt"><a name="1046956"> </a><a href="../PalmOSReference/SystemManager.html#1076720">SysLibLoad</a><br><a href="../PalmOSReference/SystemManager.html#1076840">SysReset</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1046961"> </a><b>Working With Strings and Resources</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046968"> </a><a href="../PalmOSReference/SystemManager.html#1076059">SysBinarySearch</a><br><a href="../PalmOSReference/SystemManager.html#1076775">SysQSort</a><br><a href="../PalmOSReference/SystemManager.html#1076226">SysCreatePanelList</a><br><a href="../PalmOSReference/SystemManager.html#1076316">SysFormPointerArrayToStrings</a></p>
    </td>
    <td><p class="tt"><a name="1046982"> </a><a href="../PalmOSReference/SystemManager.html#1076571">SysInsertionSort</a><br><a href="../PalmOSReference/SystemManager.html#1076144">SysCopyStringResource</a><br><a href="../PalmOSReference/SystemManager.html#1076907">SysStringByIndex</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046990"> </a><b>Database Support</b></p>
    </td>
    <td><p class="tt"><a name="1046992"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1046997"> </a><a href="../PalmOSReference/SystemManager.html#1076162">SysCreateDataBaseList</a></p>
    </td>
    <td><p class="tt"><a name="1047002"> </a><a href="../PalmOSReference/SystemManager.html#1076261">SysCurAppDatabase</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047004"> </a><b>Error Handling</b></p>
    </td>
    <td><p class="tt"><a name="1047006"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047011"> </a><a href="../PalmOSReference/SystemManager.html#1076288">SysErrString</a></p>
    </td>
    <td><p class="tt"><a name="1047013"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047015"> </a><b>Event Handling</b></p>
    </td>
    <td><p class="tt"><a name="1047017"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047022"> </a><a href="../PalmOSReference/SystemManager.html#1076542">SysHandleEvent</a></p>
    </td>
    <td><p class="tt"><a name="1047024"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047026"> </a><b>System Information</b></p>
    </td>
    <td><p class="tt"><a name="1047028"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047033"> </a><a href="../PalmOSReference/SystemManager.html#1076402">SysGetOSVersionString</a><br><a href="../PalmOSReference/SystemManager.html#1076426">SysGetROMToken</a></p>
    </td>
    <td><p class="tt"><a name="1047041"> </a><a href="../PalmOSReference/SystemManager.html#1076464">SysGetStackInfo</a><br><a href="../PalmOSReference/SystemManager.html#1076960">SysTicksPerSecond</a></p>
    </td>
  </tr>
</table>

</div>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1047049"> </a><b>Time Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1047051"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1047053"> </a><b>Allowing User to Change Date and Time</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047060"> </a><a href="../PalmOSReference/DateAndTimeSelector.html#995843">DayDrawDays</a><br><a href="../PalmOSReference/DateAndTimeSelector.html#995870">DayDrawDaySelector</a><br><a href="../PalmOSReference/DateAndTimeSelector.html#995897">DayHandleEvent</a></p>
    </td>
    <td><p class="tt"><a name="1047071"> </a><a href="../PalmOSReference/DateAndTimeSelector.html#995932">SelectDay</a><br><a href="../PalmOSReference/DateAndTimeSelector.html#996064">SelectTimeV33</a><br><a href="../PalmOSReference/DateAndTimeSelector.html#995968">SelectDayV10</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047079"> </a><b>Changing the Date</b></p>
    </td>
    <td><p class="tt"><a name="1047081"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047086"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1097894">DateAdjust</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098594">TimSetSeconds</a></p>
    </td>
    <td><p class="tt"><a name="1047094"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1098468">TimAdjust</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047096"> </a><b>Converting to Date Format</b></p>
    </td>
    <td><p class="tt"><a name="1047098"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047103"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1097922">DateDaysToDate</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098565">TimSecondsToDateTime</a></p>
    </td>
    <td><p class="tt"><a name="1047111"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1097954">DateSecondsToDate</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1047113"> </a><b>Converting Dates to Other Formats</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047120"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1098231">DateToAscii</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098285">DateToDays</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098520">TimGetSeconds</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098540">TimGetTicks</a></p>
    </td>
    <td><p class="tt"><a name="1047134"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1098624">TimeToAscii</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098312">DateToDOWDMFormat</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098496">TimDateTimeToSeconds</a><br></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047142"> </a><b>Date Information</b></p>
    </td>
    <td><p class="tt"><a name="1047144"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1047149"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1098371">DayOfMonth</a><br><a href="../PalmOSReference/DateAndTimeManager.html#1098450">DaysInMonth</a></p>
    </td>
    <td><p class="tt"><a name="1047157"> </a><a href="../PalmOSReference/DateAndTimeManager.html#1098396">DayOfWeek</a></p>
    </td>
  </tr>
</table>

</div>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1047161"> </a><b>Float Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1047163"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="6"><p class="tt"><a name="1047168"> </a><a href="../PalmOSReference/FloatManager.html#995906">FlpAToF</a><br><a href="../PalmOSReference/FloatManager.html#996095">FlpBufferCorrectedAdd</a><br><a href="../PalmOSReference/FloatManager.html#996163">FlpCorrectedAdd</a><br><a href="../PalmOSReference/FloatManager.html#996232">FlpFToA</a><br><a href="../PalmOSReference/FloatManager.html#996376">FlpSetNegative</a></p>
    </td>
    <td colspan="1" rowspan="6"><p class="tt"><a name="1047185"> </a><a href="../PalmOSReference/FloatManager.html#996065">FlpBufferAToF</a><br><a href="../PalmOSReference/FloatManager.html#996129">FlpBufferCorrectedSub</a><br><a href="../PalmOSReference/FloatManager.html#996200">FlpCorrectedSub</a><br><a href="../PalmOSReference/FloatManager.html#996345">FlpNegate</a><br><a href="../PalmOSReference/FloatManager.html#996407">FlpSetPositive</a></p>
    </td>
  </tr>
  <tr valign="top">
  </tr>
  <tr valign="top">
  </tr>
  <tr valign="top">
  </tr>
  <tr valign="top">
  </tr>
  <tr valign="top">
  </tr>
</table>

</div>


<p><a name="1047219"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996-2004, PalmSource, Inc. and its affiliates.  All rights reserved. <br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="Companion_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AttnsAndAlarms.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Localization.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>