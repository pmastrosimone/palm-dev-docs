<html>
<head>
<title>(68K) Text | Palm OS&#174; Programmer's Companion</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 10:43:14">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="1036996"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExpAndVFSConcepts.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PIMConcept.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">8 &nbsp;&nbsp;
Text</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Palm OS&#174; Programmer's Companion</p>
<p class="SubTitle">Volume I </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1"><a href="Text.html">8  Text</a></h1>

   <h2 class="SideTOC2"><a href="#1037031">
   Text Manager and International Manager</a></h2>

   <h2 class="SideTOC2"><a href="#1037043">
   Characters</a></h2>

      <h3 class="SideTOC3"><a href="#1037071">
      Declaring Character Variables</a></h3>

      <h3 class="SideTOC3"><a href="#1037084">
      Using Character Constants</a></h3>

      <h3 class="SideTOC3"><a href="#1037093">
      Missing and Invalid Characters</a></h3>

      <h3 class="SideTOC3"><a href="#1037124">
      Retrieving a Character's Attributes</a></h3>

      <h3 class="SideTOC3"><a href="#1037130">
      Virtual Characters</a></h3>

      <h3 class="SideTOC3"><a href="#1037155">
      Retrieving the Character Encoding</a></h3>

   <h2 class="SideTOC2"><a href="#1037178">
   Strings</a></h2>

      <h3 class="SideTOC3"><a href="#1037225">
      Manipulating Strings</a></h3>

      <h3 class="SideTOC3"><a href="#1037278">
      Performing String Pointer Manipulation</a></h3>

      <h3 class="SideTOC3"><a href="#1037291">
      Truncating Displayed Text</a></h3>

      <h3 class="SideTOC3"><a href="#1037325">
      Comparing Strings</a></h3>

      <h3 class="SideTOC3"><a href="#1037342">
      Global Find</a></h3>

      <h3 class="SideTOC3"><a href="#1037449">
      Dynamically Creating String Content</a></h3>

      <h3 class="SideTOC3"><a href="#1037506">
      Using the StrVPrintF Function</a></h3>

   <h2 class="SideTOC2"><a href="#1037531">
   Fonts </a></h2>

      <h3 class="SideTOC3"><a href="#1037570">
      Built-in Fonts</a></h3>

      <h3 class="SideTOC3"><a href="#1037659">
      Selecting Which Font to Use</a></h3>

      <h3 class="SideTOC3"><a href="#1037691">
      Fonts for High-Density Displays</a></h3>

      <h3 class="SideTOC3"><a href="#1037726">
      Setting the Font Programmatically</a></h3>

      <h3 class="SideTOC3"><a href="#1037820">
      Obtaining Font Information</a></h3>

      <h3 class="SideTOC3"><a href="#1037919">
      Creating Custom Fonts</a></h3>

   <h2 class="SideTOC2"><a href="#1038038">
   Summary of Text API</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1037002"> </a>This chapter describes how to work with text in the user interface&#8212;whether it's text the user has entered or text that your application has created to display on the screen. When you work with text, you must take special care to do so in a way that makes your application easily localizable. This chapter describes how to write code that manipulates characters and strings in such a way that it works properly for any language that is supported by Palm OS<sup>&#174;</sup>. It covers: </p>
<ul type="disc">
  <li><a name="1037006"> </a><a href="Text.html#1037031">Text Manager and International Manager</a>
  <li><a name="1037010"> </a><a href="Text.html#1037043">Characters</a>
  <li><a name="1037014"> </a><a href="Text.html#1037178">Strings</a>
  <li><a name="1037018"> </a><a href="Text.html#1037531">Fonts</a>
</ul>

<p><a name="1037019"> </a>When you work with text, you work mainly with the Text Manager and the String Manager. Text Manager support begins in Palm OS 3.1. If you want to support releases earlier than Palm OS 3.1, use the PalmOSGlue library described in <a href="Nutshell.html#996095">"Backward Compatibility with PalmOSGlue."</a> This chapter notes all functions that have a glue equivalent in parentheses and shows code examples using the PalmOSGlue equivalents. </p>

<div><hr>
  <a name="1037023"> </a> <b>IMPORTANT: </b> Palm OS version 3.1 introduced some changes to the Latin character encoding and to some of the String Manager functions. If you are updating a legacy application written before the release of Palm OS 3.1, these changes may affect your application. See <a href="../PalmOSReference/CompatibilityApdx.html#993788">"3.1 New Feature Set"</a> of the <i>Palm OS Programmer's API Reference</i> for details about these changes. 
<hr>
</div>

<h2 class="haH2">
  <a name="1037031"> </a>Text Manager and International Manager <a href="#1036996"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1037032"> </a>The Palm OS provides two managers that help you work with localizable strings and characters. These managers are called the Text Manager and the International Manager. </p>

<p><a name="1037035"> </a>Computers represent the characters in an alphabet with a numeric code. The set of numeric codes for a given alphabet is called a <b>character encoding</b>. Of course, a character encoding contains more than codes for the letters of an alphabet. It also encodes punctuation, numbers, control characters, and any other characters deemed necessary. The set of characters that a character encoding represents is called, appropriately enough, a <b>character set</b>. </p>

<p><a name="1037038"> </a>Different languages use different alphabets. Most European languages use the Latin alphabet. The Latin alphabet is relatively small, so its characters can be represented using a single-byte encoding ranging from 32 to 255. On the other hand, Asian languages such as Chinese, Korean, and Japanese require their own alphabets, which are much larger. These larger character sets are represented by a combination of single-byte and double-byte numeric codes ranging from 32 to 65,535. </p>

<p><a name="1037039"> </a>A given Palm Powered<sup>&#8482;</sup> handheld supports one character encoding. Although Palm OS supports multiple character encodings, a given handheld uses only one of those encodings. For example, a French handheld uses the Palm<sup>&#8482;</sup> Latin encoding, which is identical to the Microsoft<sup>&#174;</sup> Windows<sup>&#174;</sup> code page 1252 character encoding (an extension of ISO Latin 1) but includes Palm-specific characters in the control range. A Japanese handheld, on the other hand would use the Palm Shift JIS character encoding, which is identical to Microsoft Windows code page 932 (an extension of Shift JIS) but includes Palm-specific characters in the control range. Code page 932 is not supported on the French handheld, and code page 1252 is not supported on the Japanese handheld even though they both use the same version of Palm OS. No matter what the encoding is on a handheld, Palm guarantees that the low ASCII characters (0 to 0x7F) are the same. The exception to this rule is 0x5C, which is a yen symbol on Japanese handhelds and a backslash on all others.</p>

<p><a name="1037040"> </a>The Text Manager allows you to work with text, strings, and characters independent of the character encoding. If you use Text Manager routines and don't work directly with string data, your code should work on any system, regardless of which language and character encoding the handheld supports (as long as it supports the Text Manager). </p>

<p><a name="1037041"> </a>The International Manager's job is to detect which character encoding a handheld uses and initialize the corresponding version of the Text Manager. The International Manager also sets system features that identify which encoding and fonts are used. For the most part, you don't work with the International Manager directly. </p>

<h2 class="haH2">
  <a name="1037043"> </a>Characters <a href="#1036996"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1037044"> </a>Depending on the handheld's supported languages, Palm OS may encode characters using either a single-byte encoding or a multi-byte encoding. Because you do not know which character encoding is used until runtime, <i>you should never make an assumption about the size of a character</i>. </p>

<p><a name="1037045"> </a>For the most part, your application does not need to know which character encoding is used, and in fact, it should make no assumptions about the encoding or about the size of characters. Instead, your code should use Text Manager functions to manipulate characters. This section describes how to work with characters correctly. It covers: </p>
<ul type="disc">
  <li><a name="1037049"> </a><a href="Text.html#1037071">Declaring Character Variables</a>
  <li><a name="1037053"> </a><a href="Text.html#1037084">Using Character Constants</a>
  <li><a name="1037057"> </a><a href="Text.html#1037093">Missing and Invalid Characters</a>
  <li><a name="1037061"> </a><a href="Text.html#1037124">Retrieving a Character's Attributes</a>
  <li><a name="1037065"> </a><a href="Text.html#1037130">Virtual Characters</a>
  <li><a name="1037069"> </a><a href="Text.html#1037155">Retrieving the Character Encoding</a>
</ul>
<h3 class="hbH3">
  <a name="1037071"> </a>Declaring Character Variables <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037073"> </a>Declare all character variables to be of type <code>WChar</code>. <code>WChar</code> is a 16-bit unsigned type that can accommodate characters of any encoding. Don't use <code>Char</code>. <code>Char</code> is an 8-bit variable that cannot accommodate larger character encodings. The only time you should ever use <code>Char</code> is to pass a parameter to an older Palm OS function. </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
WChar ch; // Right. 16-bit character. <a name="1037075"> </a>
Char ch; // Wrong. 8-bit character. <a name="1037076"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037078"> </a>When you receive input characters through the <code>keyDownEvent</code>, you'll receive a <code>WChar</code> value. (That is, the <code>data.keyDown.chr</code> field is a <code>WChar</code>.)</p>

<p><a name="1037079"> </a>Even though character variables are now declared as <code>WChar</code>, string variables are still declared as <code>Char *</code>, even though they may contain multi-byte characters. See the section <a href="Text.html#1037178">"Strings"</a> for more information on strings. </p>
<h3 class="hbH3">
  <a name="1037084"> </a>Using Character Constants <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037085"> </a>Character constants are defined in several header files. The header file <code>Chars.h</code> contains characters that are guaranteed to be supported on all systems regardless of the encoding. Other header files exist for each supported character encoding and contain characters specific to that encoding. The character encoding-specific header files are not included in the <code>PalmOS.h</code> header by default because they define characters that are not available on every system. </p>

<p><a name="1037087"> </a>To make it easier for the compiler to find character encoding problems with your project, make a practice of using the character constants defined in these header files rather than directly assigning a character variable to a value. For example, suppose your code contained this statement: </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
WChar ch = 'å'; // WRONG! Don't use. <a name="1037088"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037089"> </a>This statement may work on a Latin system, but it would cause problems on an Asian-language system because the å character does not exist. If you instead assign the value this way:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
WChar ch = chrSmall_A_RingAbove; <a name="1037090"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037091"> </a>you'll find the problem at compile time because the <code>chrSmall_A_RingAbove</code> constant is defined in <code>CharLatin.h</code>, which is not included by default. </p>
<h3 class="hbH3">
  <a name="1037093"> </a>Missing and Invalid Characters <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037094"> </a>If during application testing, you see an open rectangle, a shaded rectangle, or a gray square displayed on the screen, you have a missing character. </p>

<p><a name="1037096"> </a>A <b>missing character</b> is one that is valid within the character encoding but the current font is not able to display it. In this case, nothing is wrong with your code other than you have chosen the wrong font. The system displays an open rectangle in place of a missing single-byte rectangle (see <a href="Text.html#1037101">Figure 8.1</a>). </p>

<p class="FFigureCaption">
  <a name="1037101"> </a><b>Figure 8.1&nbsp;&nbsp;Missing characters<div align="left"><img src="images/MissingChars.gif" border="0" hspace="0" vspace="0">
</div></b>
</p>


<p><a name="1037106"> </a>In multi-byte character encodings, a character may be missing as described above, or it may be invalid. In single-byte character encodings, there's a one-to-one correspondence between numeric values and characters to represent. This is not the case with multi-byte character encodings. In multi-byte character encodings, there are more possible values than there are characters to represent. Thus, a character variable could end up containing an <b>invalid character</b>&#8212;a value that doesn't actually represent a character. </p>

<p><a name="1037108"> </a>If the system is asked to display an invalid character, it prints an open rectangle for the first invalid byte. Then it starts over at the next byte. Thus, the next character displayed and possibly even the remaining text displayed is probably not what you want. Check your code for the following: </p>
<ul type="disc">
  <li><a name="1037109"> </a>Truncating strings. You might have truncated a string in the middle of a multi-byte character.
  <li><a name="1037110"> </a>Appending characters from one encoding set to a string in a different encoding. 
  <li><a name="1037111"> </a>Arithmetic on character variables that could result in an invalid character value. 
  <li><a name="1037112"> </a>Arithmetic on a string pointer that could result in pointing to an intra-character boundary. See <a href="Text.html#1037278">"Performing String Pointer Manipulation"</a> for more information. 
  <li><a name="1037116"> </a>Assumptions that a character is always a single byte long. 
</ul>

<p><a name="1037121"> </a>Use the Text Manager function <a href="../PalmOSReference/TextMgr.html#1121506"><code>TxtCharIsValid</code></a> (<code>TxtGlueCharIsValid</code>) to determine whether a character is valid or not. </p>
<h3 class="hbH3">
  <a name="1037124"> </a>Retrieving a Character's Attributes <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037125"> </a>The Text Manager defines certain functions that retrieve a character's attributes, such as whether the character is alphanumeric, and so on. You can use these functions on any character, regardless of its size and encoding. </p>

<p><a name="1037126"> </a>A character also has attributes unique to its encoding. Functions to retrieve those attributes are defined in the header files specific to the encoding. </p>

<div><hr>
  <a name="1037127"> </a> <span class="warning">WARNING! </span> In previous versions of the Palm OS, the header file <code>CharAttr.h</code> defined character attribute macros such as <code>IsAscii</code>. Using these macros on double-byte characters produces incorrect results. Use the Text Manager macros instead of the <code>CharAttr.h</code> macros. 
<hr>
</div>
<h3 class="hbH3">
  <a name="1037130"> </a>Virtual Characters <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037131"> </a>Virtual characters are nondisplayable characters that trigger special events in the operating system, such as displaying low battery warnings or displaying the keyboard dialog. Virtual characters should never occur in any data and should never appear on the screen. </p>

<p><a name="1037132"> </a>The Palm OS uses character codes 256 decimal and greater for virtual characters. The range for these characters may actually overlap the range for "real" characters (characters that should appear on the screen). The <code>keyDownEvent</code> distinguishes a virtual character from a displayable character by setting the command bit in the event record. </p>

<p><a name="1037133"> </a>The best way to check for virtual characters, including virtual characters that represent the hard keys, is to use the <a href="../PalmOSReference/PalmOSGlueLib.html#1032502"><code>TxtGlueCharIsVirtual</code></a> function defined in the PalmOSGlue library. See <a href="Text.html#1037142">Listing 8.1</a>. </p>
<p class="CCodeCaption">
  <a name="1037142"> </a><b>Listing 8.1&nbsp;&nbsp;Checking for virtual characters</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
if (TxtGlueCharIsVirtual (eventP-&gt;data.keyDown.modifiers, <a name="1037143"> </a>
   eventP-&gt;data.keyDown.chr)) {<a name="1037144"> </a>
   if (TxtCharIsHardKey (event-&gt;data.keyDown.modifiers, <a name="1037145"> </a>
      event-&gt;data.keyDown.chr)) {<a name="1037146"> </a>
      // Handle hard key virtual character.<a name="1037147"> </a>
   } else {<a name="1037148"> </a>
      // Handle standard virtual character.<a name="1037149"> </a>
   }<a name="1037150"> </a>
} else {<a name="1037151"> </a>
   // Handle regular character.<a name="1037152"> </a>
}<a name="1037153"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037155"> </a>Retrieving the Character Encoding <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037156"> </a>Occasionally, you may need to determine which character encoding is being used. For example, your application may need to do some unique text manipulation if it is being run on a European handheld. You can retrieve the character encoding from the system feature set using the <code>FtrGet</code> function as shown in <a href="Text.html#1037162">Listing 8.2</a>. </p>
<p class="CCodeCaption">
  <a name="1037162"> </a><b>Listing 8.2&nbsp;&nbsp;Retrieving the character encoding</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
UInt32 encoding; <a name="1037163"> </a>
Char* encodingName;<a name="1037164"> </a>
if (FtrGet(sysFtrCreator, sysFtrNumEncoding, &amp;encoding) != 0)
   encoding = charEncodingPalmLatin; <a name="1037165"> </a>
   //default encoding<a name="1037166"> </a>
if (encoding == charEncodingPalmSJIS) {<a name="1037167"> </a>
   // encoding for Palm Shift-JIS<a name="1037168"> </a>
} else if (encoding == charEncodingPalmLatin) {<a name="1037169"> </a>
   // extension of ISO Latin 1<a name="1037170"> </a>
}<a name="1037171"> </a>
 <a name="1037172"> </a>
// The following Text Manager function returns the <a name="1037173"> </a>
// official name of the encoding as required by <a name="1037174"> </a>
// Internet applications. <a name="1037175"> </a>
encodingName = TxtGlueEncodingName(encoding);<a name="1037176"> </a>
</pre><div class="CodeRule"><hr></div>


<h2 class="haH2">
  <a name="1037178"> </a>Strings <a href="#1036996"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1037179"> </a>When working with text as strings, you use the String Manager and the Text Manager. </p>

<p><a name="1037181"> </a>The String Manager is supported in all releases of Palm OS. It is closely modeled after the standard C string-manipulation functions like <code>strcpy</code>, <code>strcat</code>, and so on. Note that the standard C functions are not built in to Palm OS. Use String Manager calls instead of standard C calls to make your application smaller. </p>

<p><a name="1037182"> </a>The Text Manager was added in Palm OS 3.1 to provide support for multi-byte strings. On systems that support the Text Manager, strings are made up of characters that are either a single-byte long or multiple bytes long, up to four bytes. As stated previously, character variables are always two bytes long. However, when you add a character to a string, the operating system may shrink it down to a single byte if it's a low ASCII character. Thus, any string that you work with may contain a mix of single-byte and multi-byte characters. </p>

<p><a name="1037183"> </a>Applications can use both the Text Manager and the String Manager to work with strings. The String Manager functions in Palm OS 3.1 and later can work with strings containing multi-byte characters. Use the Text Manager functions when:</p>
<ul type="disc">
  <li><a name="1037184"> </a>A String Manager equivalent is not available. 
  <li><a name="1037185"> </a>The length of the matching strings are important. For example, to compare two strings, you can use either <a href="../PalmOSReference/StringManager.html#1065149"><code>StrCompare</code></a> or <a href="../PalmOSReference/TextMgr.html#1121637"><code>TxtCompare</code></a>. The difference between the two is that <code>StrCompare</code> does not return the length of the characters that matched. <code>TxtCompare</code> does. 
</ul>

<p><a name="1037194"> </a>This section discusses the following topics:</p>
<ul type="disc">
  <li><a name="1037198"> </a><a href="Text.html#1037225">Manipulating Strings</a>
  <li><a name="1037202"> </a><a href="Text.html#1037278">Performing String Pointer Manipulation</a>
  <li><a name="1037206"> </a><a href="Text.html#1037291">Truncating Displayed Text</a>
  <li><a name="1037210"> </a><a href="Text.html#1037325">Comparing Strings</a>
  <li><a name="1037214"> </a><a href="Text.html#1037342">Global Find</a>
  <li><a name="1037218"> </a><a href="Text.html#1037449">Dynamically Creating String Content</a>
  <li><a name="1037222"> </a><a href="Text.html#1037506">Using the StrVPrintF Function</a>
</ul>

<div><hr>
  <a name="1037223"> </a> <b>TIP: </b> Many of the pre-3.1 Palm OS functions have been modified to work with strings containing multi-byte characters. All Palm OS functions that return the length of a string, such as <code>FldGetTextLength</code> and <code>StrLen</code>, always return the size of the string in bytes, not the number of characters in the string. Similarly, functions that work with string offsets always use the offset in bytes, not characters.
<hr>
</div>
<h3 class="hbH3">
  <a name="1037225"> </a>Manipulating Strings <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037226"> </a>Any time that you want to work with character pointers, you need to be careful not to point to an intra-character boundary (a middle or end byte of a multi-byte character). For example, any time that you want to set the insertion point position in a text field or set the text field's selection, you must make sure that you use byte offsets that point to inter-character boundaries. (The <b>inter-character boundary</b> is both the start of one character and the end of the previous character, except when the offset points to the very beginning or very end of a string.) </p>

<p><a name="1037228"> </a>Suppose you want to iterate through a string character by character. Traditionally, C code uses a character pointer or byte counter to iterate through a string a character at a time. Such code will not work properly on systems with multi-byte characters. Instead, if you want to iterate through a string a character at a time, use Text Manager functions: </p>
<ul type="disc">
  <li><a name="1037233"> </a><a href="../PalmOSReference/TextMgr.html#1122131"><code>TxtGetNextChar</code></a> (<code>TxtGlueGetNextChar</code>) retrieves the next character in a string. 
  <li><a name="1037238"> </a><a href="../PalmOSReference/TextMgr.html#1122176"><code>TxtGetPreviousChar</code></a> (<code>TxtGlueGetPreviousChar) </code>retrieves the previous character in a string. 
  <li><a name="1037243"> </a><a href="../PalmOSReference/TextMgr.html#1122508"><code>TxtSetNextChar</code></a> (<code>TxtGlueSetNextChar) </code>changes the next character in a string and can be used to fill a string buffer. 
</ul>

<p><a name="1037244"> </a>Each of these three functions returns the size of the character in question, so you can use it to determine the offset to use for the next character. For example, <a href="Text.html#1037249">Listing 8.3</a> shows how to iterate through a string character by character until a particular character is found. </p>
<p class="CCodeCaption">
  <a name="1037249"> </a><b>Listing 8.3&nbsp;&nbsp;Iterating through a string or text</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
Char* buffer; // assume this exists<a name="1037250"> </a>
UInt16 bufLen = StrLen(buffer); <a name="1037251"> </a>
// Length of the input text. <a name="1037252"> </a>
WChar ch = 0;<a name="1037253"> </a>
UInt16 i = 0;<a name="1037254"> </a>
while ((i &lt; bufLen) &amp;&amp; (ch != chrAsterisk))<a name="1037255"> </a>
   i+= TxtGlueGetNextChar(buffer, i, &amp;ch));<a name="1037256"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037257"> </a>The Text Manager also contains functions that let you determine the size of a character in bytes without iterating through the string: </p>
<ul type="disc">
  <li><a name="1037262"> </a><a href="../PalmOSReference/TextMgr.html#1121539"><code>TxtCharSize</code></a> (<code>TxtGlueCharSize</code>) returns how much space a given character will take up inside of a string. 
  <li><a name="1037267"> </a><a href="../PalmOSReference/TextMgr.html#1121040"><code>TxtCharBounds</code></a> (<code>TxtGlueCharBounds</code>) determines the boundaries of a given character within a given string. 
</ul>
<p class="CCodeCaption">
  <a name="1037269"> </a><b>Listing 8.4&nbsp;&nbsp;Working with arbitrary limits</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
UInt32* charStart, charEnd;<a name="1037270"> </a>
Char* fldTextP = FldGetTextPtr(fld);<a name="1037271"> </a>
TxtGlueCharBounds(fldTextP, <a name="1037272"> </a>
   min(kMaxBytesToProcess, FldGetTextLength(fld)), <a name="1037273"> </a>
   &amp;charStart, &amp;charEnd);<a name="1037274"> </a>
// process only the first charStart bytes of text.<a name="1037275"> </a>
 <a name="1037276"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037278"> </a>Performing String Pointer Manipulation <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037279"> </a>Never perform any pointer manipulation on strings you pass to the Text Manager unless you use Text Manager calls to do the manipulation. For Text Manager functions to work properly, the string pointer must point to the first byte of a character. If you use Text Manager functions when manipulating a string pointer, you can be certain that your pointer always points to the beginning of a character. Otherwise, you run the risk of pointing to an inter-character boundary. </p>
<p class="CCodeCaption">
  <a name="1037280"> </a><b>Listing 8.5&nbsp;&nbsp;String pointer manipulation</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
// WRONG! buffer + kMaxStrLength is not <a name="1037281"> </a>
// guaranteed to point to start of character.<a name="1037282"> </a>
buffer[kMaxStrLength] = '\0';<a name="1037283"> </a>
 <a name="1037284"> </a>
// Right. Truncate at a character boundary.<a name="1037285"> </a>
UInt32 charStart, charEnd;<a name="1037286"> </a>
TxtCharBounds(buffer, kMaxStrLength, <a name="1037287"> </a>
  &amp;charStart, &amp;charEnd);<a name="1037288"> </a>
TxtGlueSetNextChar(buffer, charStart, chrNull);<a name="1037289"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037291"> </a>Truncating Displayed Text <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037292"> </a>If you're performing drawing operations, you often have to determine where to truncate a string if it's too long to fit in the available space. Two functions help you perform this task on strings with multi-byte characters:</p>
<ul type="disc">
  <li><a name="1037297"> </a><a href="../PalmOSReference/Window.html#1013790"><code>WinDrawTruncChars</code></a> (<code>WinGlueDrawTruncChars</code>) &#8212; This function draws a string within a specified width, determining automatically where to truncate the string. If it can, it draws the entire string. If the string doesn't fit in the space, it draws one less than the number of characters that fit and then ends the string with an ellipsis (...). 
  <li><a name="1037302"> </a><a href="../PalmOSReference/Font.html#1000807"><code>FntWidthToOffset</code></a> (<code>FntGlueWidthToOffset</code>) &#8212; This function returns the byte offset of the character displayed at a given pixel position. It can also return the width of the text up to that offset. 
   <p><a name="1037306"> </a><a href="Text.html#1037308">Listing 8.6</a> shows how you can use <code>FntWidthToOffset</code> to determine how many lines are necessary to write a string to the screen. This example passes 160 as the pixel position so that upon return, <code>widthToOffset</code> contains the byte offset of the last character in the string that can be displayed on a single line. The characters up to and including the one at <code>widthToOffset</code> are drawn, then the <code>msg</code> pointer is advanced in the string by <code>widthToOffset</code> characters, and <code>FntWidthToOffset</code> is called again to find out how many characters fit on the next line of text. The process is repeated until all of the characters in the string have been drawn. </p>
</ul>
<p class="CCodeCaption">
  <a name="1037308"> </a><b>Listing 8.6&nbsp;&nbsp;Drawing multiple lines of text</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
Coord y;<a name="1037309"> </a>
Char *msg;<a name="1037310"> </a>
Int16 msgWidth;<a name="1037311"> </a>
Int16 widthToOffset = 0;<a name="1037312"> </a>
Int16 pixelWidth = 160;<a name="1037313"> </a>
Int16 msgLength = StrLen(msg);<a name="1037314"> </a>
<a name="1037315"> </a>
while (msg &amp;&amp; *msg) {<a name="1037316"> </a>
   widthToOffset = FntGlueWidthToOffset(msg, msgLength, <a name="1037317"> </a>
      pixelWidth, NULL, &amp;msgWidth);<a name="1037318"> </a>
   WinDrawChars(msg, widthToOffset, 0, y);<a name="1037319"> </a>
   y += FntLineHeight();<a name="1037320"> </a>
   msg += widthToOffset;<a name="1037321"> </a>
   msgLength = StrLen(msg);<a name="1037322"> </a>
}<a name="1037323"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037325"> </a>Comparing Strings <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037330"> </a>Use the Text Manager functions <a href="../PalmOSReference/TextMgr.html#1121637"><code>TxtCompare</code></a> (<code>TxtGlueCompare</code>) and <a href="../PalmOSReference/TextMgr.html#1120896"><code>TxtCaselessCompare</code></a> (<code>TxtGlueCaselessCompare</code>) to perform comparisons of strings. </p>

<p><a name="1037335"> </a>In character encodings that use multi-byte characters, some characters are accurately represented as either single-byte characters or multi-byte characters. That is, a character might have both a single-byte representation and a double-byte representation. One string might use the single-byte representation and another might use the multi-byte representation. Users expect the characters to match regardless of how many bytes a string uses to store that character. <code>TxtCompare</code> and <code>TxtCaselessCompare</code> can accurately match single-byte characters with their multi-byte equivalents. </p>

<p><a name="1037336"> </a>Because a single-byte character might be matched with a multi-byte character, two strings might be considered equal even though they have different lengths. For this reason, <code>TxtCompare</code> and <code>TxtCaselessCompare</code> take two parameters in which they pass back the length of matching text in each of the two strings. See the function descriptions in the <i>Palm OS Programmer's API Reference</i> for more information. </p>

<p><a name="1037340"> </a>Note that the String Manager functions <code>StrCompare</code> and <code>StrCaselessCompare</code> are equivalent, but they do not pass back the length of the matching text. </p>
<h3 class="hbH3">
  <a name="1037342"> </a>Global Find <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037343"> </a>A special case of performing string comparison is implementing the global system find facility. To implement this facility, you should call <a href="../PalmOSReference/TextMgr.html#1122038"><code>TxtFindString</code></a> (<code>TxtGlueFindString</code>). As with <code>TxtCompare</code> and <code>TxtCaselessCompare</code>, <code>TxtFindString</code> accurately matches single-byte characters with their corresponding multi-byte characters. Plus, it passes back the length of the matched text. You'll need this value to highlight the matching text when the system requests that you display the matching record. </p>

<p><a name="1037352"> </a>Older versions of Palm OS use the function <a href="../PalmOSReference/Find.html#995917"><code>FindStrInStr</code></a>. <code>FindStrInStr</code> is not able to return the length of the matching text. Instead, it assumes that characters within the string are always one byte long. </p>

<p><a name="1037353"> </a>When the user taps the Find icon, the system sends the launch code <a href="../PalmOSReference/AppLaunchCodes.html#1012029"><code>sysAppLaunchCmdFind</code></a> to each application. <a href="Text.html#1037375">Listing 8.7</a> shows an example of a function that should be called in response to that launch code. This function implements a global find that works on all systems whether the Text Manager exists or not. When the user taps one of the results displayed in the Find Results dialog, the system sends a <a href="../PalmOSReference/AppLaunchCodes.html#1012140"><code>sysAppLaunchCmdGoTo</code></a> launch code to the application containing the matching record. <a href="Text.html#1037418">Listing 8.8</a> shows how to respond to the <code>sysAppLaunchCmdGoto</code> launch code. </p>

<p><a name="1037368"> </a>These two listings are only code excerpts. For the complete implementation of these two functions, see the example code in the Palm OS SDK. </p>

<p><a name="1037369"> </a>Note that if you want to use <code>TxtFindString</code> to implement a search within your application (as opposed to the global find facility), you need to call <a href="../PalmOSReference/PalmOSGlueLib.html#1032726"><code>TxtGluePrepFindString</code></a> before you call <code>TxtFindString</code> to ensure that the string is in the proper format. (In the global find facility, the system has already prepared the string before your code is executed.) </p>
<p class="CCodeCaption">
  <a name="1037375"> </a><b>Listing 8.7&nbsp;&nbsp;Implementing global find </b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void Search (FindParamsPtr findParams)<a name="1037376"> </a>
{<a name="1037377"> </a>
   UInt16 recordIndex = 0;<a name="1037378"> </a>
   DmOpenRef dbP;<a name="1037379"> </a>
   UInt16 cardNo = 0;<a name="1037380"> </a>
   LocalID dbID;<a name="1037381"> </a>
   MemoDBRecordPtr memoPadRecP;<a name="1037382"> </a>
 <a name="1037383"> </a>
 <a name="1037384"> </a>
   // Open the database to be searched.<a name="1037385"> </a>
   dbP = DmOpenDatabaseByTypeCreator(memoDBType, <a name="1037386"> </a>
      sysFileCMemo, findParams-&gt;dbAccesMode);<a name="1037387"> </a>
   DmOpenDatabaseInfo(dbP, &amp;dbID, 0, 0, &amp;cardNo, <a name="1037388"> </a>
      0);<a name="1037389"> </a>
 <a name="1037390"> </a>
   // Get first record to search. <a name="1037391"> </a>
   memoRecP = GetRecordPtr(dbP, recordIndex);<a name="1037392"> </a>
   while (memoRecP != NULL) {<a name="1037393"> </a>
      Boolean done;<a name="1037394"> </a>
      Boolean match;<a name="1037395"> </a>
      UInt32 matchPos, matchLength;<a name="1037396"> </a>
 <a name="1037397"> </a>
      // TxtGlueFindString calls TxtFindString if it<a name="1037398"> </a>
      // exists, or else it implements the Latin<a name="1037399"> </a>
      // equivalent of it. <a name="1037400"> </a>
      match = TxtGlueFindString (&amp;(memoRecP-&gt;note), <a name="1037401"> </a>
         findParams-&gt;strToFind, &amp;matchPos, <a name="1037402"> </a>
         &amp;matchLength);<a name="1037403"> </a>
      <a name="1037404"> </a>
      if (match) {<a name="1037405"> </a>
         done = FindSaveMatch (findParams, <a name="1037406"> </a>
            recordIndex, matchPos, 0, matchLength,<a name="1037407"> </a>
            cardNo, dbIDP);<a name="1037408"> </a>
      }<a name="1037409"> </a>
      MemPtrUnlock (memoRecP);<a name="1037410"> </a>
 <a name="1037411"> </a>
      if (done) break;<a name="1037412"> </a>
      recordIndex += 1;<a name="1037413"> </a>
   }<a name="1037414"> </a>
   DmCloseDatabase (dbP);<a name="1037415"> </a>
}<a name="1037416"> </a>
</pre><div class="CodeRule"><hr></div>

<p class="CCodeCaption">
  <a name="1037418"> </a><b>Listing 8.8&nbsp;&nbsp;Displaying the matching record</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void GoToRecord (GoToParamsPtr goToParams, Boolean 
launchingApp)<a name="1037419"> </a>
{<a name="1037420"> </a>
   UInt16 recordNum;<a name="1037421"> </a>
   EventType event;<a name="1037422"> </a>
 <a name="1037423"> </a>
   recordNum = goToParams-&gt;recordNum;<a name="1037424"> </a>
   ...<a name="1037425"> </a>
 <a name="1037426"> </a>
   // Send an event to goto a form and select the <a name="1037427"> </a>
   // matching text.<a name="1037428"> </a>
   MemSet (&amp;event, sizeof(EventType), 0);<a name="1037429"> </a>
 <a name="1037430"> </a>
   event.eType = frmLoadEvent;<a name="1037431"> </a>
   event.data.frmLoad.formID = EditView;<a name="1037432"> </a>
   EvtAddEventToQueue (&amp;event);<a name="1037433"> </a>
 <a name="1037434"> </a>
   MemSet (&amp;event, sizeof(EventType), 0);<a name="1037435"> </a>
   event.eType = frmGotoEvent;<a name="1037436"> </a>
   event.data.frmGoto.recordNum = recordNum;<a name="1037437"> </a>
   event.data.frmGoto.matchPos = <a name="1037438"> </a>
      goToParams-&gt;matchPos;<a name="1037439"> </a>
   event.data.formGoto.matchLen = <a name="1037440"> </a>
      goToParams-&gt;matchCustom;<a name="1037441"> </a>
   event.data.frmGoto.matchFieldNum = <a name="1037442"> </a>
      goToParams-&gt;matchFieldNum;<a name="1037443"> </a>
   event.data.frmGoto.formID = EditView;<a name="1037444"> </a>
   EvtAddEventToQueue (&amp;event);<a name="1037445"> </a>
   ...<a name="1037446"> </a>
}<a name="1037447"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037449"> </a>Dynamically Creating String Content <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037450"> </a>When working with strings in a localized application, you never hard code them. Instead, you store strings in a resource and use the resource to display the text. If you need to create the contents of the string at runtime, store a template for the string as a resource and then substitute values as needed. </p>

<p><a name="1037451"> </a>For example, consider the Edit view of the Memo application. Its title bar contains a string such as "Memo 3 of 10." The number of the memo being displayed and the total number of memos cannot be determined until runtime. </p>

<p><a name="1037452"> </a>To create such a string, use a template resource and the Text Manager function <a href="../PalmOSReference/TextMgr.html#1122391"><code>TxtParamString</code></a> (<code>TxtGlueParamString</code>). <code>TxtParamString</code> allows you to search for the sequence ^0, ^1, up to ^3 and replace each of these with a different string. If you need more parameters, you can use <a href="../PalmOSReference/TextMgr.html#1122473"><code>TxtReplaceStr</code></a> (<code>TxtGlueReplaceStr</code>), which allows you to replace up to ^9; however, <code>TxtReplaceStr</code> only allows you to replace one of these sequences at a time. </p>

<p><a name="1037461"> </a>In the Memo title bar example, you'd create a string resource that looks like this:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
Memo ^0 of ^1<a name="1037462"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037463"> </a>And your code might look like this: </p>
<p class="CCodeCaption">
  <a name="1037464"> </a><b>Listing 8.9&nbsp;&nbsp;Using string templates</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void EditViewSetTitle (void)<a name="1037465"> </a>
{<a name="1037466"> </a>
   Char* titleTemplateP;<a name="1037467"> </a>
   FormPtr frm;<a name="1037468"> </a>
   Char posStr [maxStrIToALen];<a name="1037469"> </a>
   Char totalStr [maxStrIToALen];<a name="1037470"> </a>
   UInt16 pos;<a name="1037471"> </a>
   UInt16 length;<a name="1037472"> </a>
 <a name="1037473"> </a>
   // Format as strings, the memo's postion within <a name="1037474"> </a>
   // its category, and the total number of memos <a name="1037475"> </a>
   // in the category.<a name="1037476"> </a>
   pos = DmPositionInCategory (MemoPadDB, <a name="1037477"> </a>
      CurrentRecord, RecordCategory);<a name="1037478"> </a>
   StrIToA (posStr, pos+1);<a name="1037479"> </a>
 <a name="1037480"> </a>
   if (MemosInCategory == memosInCategoryUnknown)<a name="1037481"> </a>
      MemosInCategory = DmNumRecordsInCategory <a name="1037482"> </a>
         (MemoPadDB, RecordCategory);<a name="1037483"> </a>
   StrIToA (totalStr, MemosInCategory);<a name="1037484"> </a>
 <a name="1037485"> </a>
   // Get the title template string.  It contains <a name="1037486"> </a>
   // '^0' and '^1' chars which we replace with the <a name="1037487"> </a>
   // position of CurrentRecord within <a name="1037488"> </a>
   // CurrentCategory and with the total count of <a name="1037489"> </a>
   // records in CurrentCategory ().<a name="1037490"> </a>
   titleTemplateP = MemHandleLock (DmGetResource <a name="1037491"> </a>
      (strRsc, EditViewTitleTemplateStringString));<a name="1037492"> </a>
 <a name="1037493"> </a>
   EditViewTitlePtr = <a name="1037494"> </a>
      TxtGlueParamString(titleTemplateP, posStr, <a name="1037495"> </a>
      totalStr, NULL, NULL);<a name="1037496"> </a>
 <a name="1037497"> </a>
   // Now set the title to use the new title <a name="1037498"> </a>
   // string.<a name="1037499"> </a>
   frm = FrmGetFormPtr (MemoPadEditForm);<a name="1037500"> </a>
   FrmSetTitle (frm, EditViewTitlePtr);<a name="1037501"> </a>
   MemPtrUnlock(titleTemplateP);<a name="1037502"> </a>
}<a name="1037503"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037506"> </a>Using the StrVPrintF Function <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037511"> </a>Like the C <code>vsprintf</code> function, the <a href="../PalmOSReference/StringManager.html#1065754"><code>StrVPrintF</code></a> function is designed to be called by your own function that takes a variable number of arguments and passes them to <code>StrVPrintF</code> for formatting. This section gives a brief overview of how to use <code>StrVPrintF</code>. For more details, refer to <code>vsprintf</code> and the use of the <code>stdarg.h</code> macros in a standard C reference book.</p>

<p><a name="1037512"> </a>When you call <code>StrVPrintF</code>, you must use the special macros from <code>stdarg.h</code> to access the optional arguments (those specified after the fixed arguments) passed to your function. This is necessary, because when you declare your function that takes an optional number of arguments, you declare it using an ellipsis at the end of the argument list:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
MyPrintF(CharPtr s, CharPtr formatStr, ...);<a name="1037513"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037514"> </a>The ellipsis indicates that zero or more optional arguments may be passed to the function following the <code>formatStr</code> argument. Since these optional arguments don't have names, the <code>stdarg.h</code> macros must be used to access them before they can be passed to <code>StrVPrintF</code>.</p>

<p><a name="1037515"> </a>To use these macros in your function, first declare an <code>args</code> variable as type <code>va_list</code>:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
va_list args;<a name="1037516"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037517"> </a>Next, initialize the <code>args</code> variable to point to the optional argument list by using <code>va_start</code>: </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
va_start(args, formatStr);<a name="1037518"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037519"> </a>Note that the second argument to the <code>va_start</code> macro is the last required argument to your function (last before the optional arguments begin). Now you can pass the <code>args</code> variable as the last parameter to the <code>StrVPrintF</code> function:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
StrVPrintF(text, formatStr, args);<a name="1037520"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037521"> </a>When you are finished, invoke the macro <code>va_end</code> before returning from your function:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
va_end(args);<a name="1037522"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037526"> </a>Note that the <a href="../PalmOSReference/StringManager.html#1065666"><code>StrPrintF</code></a> and <code>StrVPrintF</code> functions implement only a subset of the conversion specifications allowed by the ANSI C function <code>vsprintf</code>. See the <a href="../PalmOSReference/StringManager.html#1065754"><code>StrVPrintF</code></a> function reference for details.</p>

<h2 class="haH2">
  <a name="1037531"> </a>Fonts  <a href="#1036996"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1037534"> </a>All fonts in Palm OS are bitmapped fonts. A <b>bitmapped font</b> is one that provides a separate bitmap for each glyph in each size and style. Scalable fonts such as TrueType or PostScript fonts are not supported.</p>

<p><a name="1037535"> </a>Each font is associated with a particular character encoding. The font contains <b>glyphs</b> that define how to draw each character in the encoding. </p>

<p><a name="1037537"> </a>Palm OS provides built-in fonts, and in Palm OS 3.0 and later, allows you to create your own fonts. If the <a href="../PalmOSReference/CompatibilityApdx.html#996955">High-Density Display Feature Set</a> is present, high-density fonts are supported and used on high-density displays. This section describes the font support in Palm OS 3.0 and later. It covers: </p>
<ul type="disc">
  <li><a name="1037544"> </a><a href="Text.html#1037570">Built-in Fonts</a>
  <li><a name="1037548"> </a><a href="Text.html#1037659">Selecting Which Font to Use</a>
  <li><a name="1037552"> </a><a href="Text.html#1037691">Fonts for High-Density Displays</a>
  <li><a name="1037556"> </a><a href="Text.html#1037726">Setting the Font Programmatically</a>
  <li><a name="1037560"> </a><a href="Text.html#1037820">Obtaining Font Information</a>
  <li><a name="1037564"> </a><a href="Text.html#1037919">Creating Custom Fonts</a>
</ul>

<p><a name="1037567"> </a>For more general information on high-density displays, see <a href="UserInterface.html#1008086">"High-Density Displays."</a></p>
<h3 class="hbH3">
  <a name="1037570"> </a>Built-in Fonts <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037571"> </a>There are several fonts built into Palm OS. The <code>Font.h</code> file defines constants that can be used to access the built-in fonts programmatically. These constants are defined on all versions of Palm OS no matter what language or character code; however, they may point to different fonts. For example, <code>stdFont</code> on a Japanese system may be quite different from <code>stdFont</code> on a Latin system. </p>

<p><a name="1037575"> </a><a href="Text.html#1037582">Table 8.1</a> lists and describes the built-in fonts that may be used to display text. </p>

<p class="caption"><a name="1037582"> </a><b>Table 8.1&nbsp;&nbsp;Built-in text fonts </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1037586"> </a><b>Constant</b></p>
    </th>
    <th><p class="tt"><a name="1037588"> </a><b>Description</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037591"> </a><code>stdFont</code> </p>
    </td>
    <td><p class="tt"><a name="1037593"> </a>A small standard font used to display user input. This font is small to display as much text as possible. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037596"> </a><code>largeFont</code> </p>
    </td>
    <td><p class="tt"><a name="1037598"> </a>A larger font provided as an alternative for users who find the standard font too small to read. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037601"> </a><code>boldFont</code> </p>
    </td>
    <td><p class="tt"><a name="1037603"> </a>Same size as <code>stdFont</code> but bold for easier reading. Used for text labels in the user interface. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037606"> </a><code>largeBoldFont</code> </p>
    </td>
    <td><p class="tt"><a name="1037608"> </a>In Palm OS 3.0 and later only. Same size as <code>largeFont</code> but bold. </p>
    </td>
  </tr>
</table>

</div>


<p><a name="1037616"> </a><a href="Text.html#1037618">Figure 8.2</a> shows what each of the fonts in <a href="Text.html#1037582">Table 8.1</a> looks like. </p>

<p class="FFigureCaption">
  <a name="1037618"> </a><b>Figure 8.2&nbsp;&nbsp;Built-in text fonts<div align="left"><img src="images/Fonts.gif" border="0" hspace="0" vspace="0">
</div> </b>
</p>


<p><a name="1037626"> </a>Palm OS also defines the fonts listed in <a href="Text.html#1037630">Table 8.2</a>. These fonts do not contain most letters of the alphabet. They are used only for special purposes. </p>

<p class="caption"><a name="1037630"> </a><b>Table 8.2&nbsp;&nbsp;Built-in symbol fonts</b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1037634"> </a><b>Constant</b></p>
    </th>
    <th><p class="tt"><a name="1037636"> </a><b>Description</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037639"> </a><code>symbolFont</code> </p>
    </td>
    <td><p class="tt"><a name="1037641"> </a>Contains many special characters such as arrows, shift indicators, and so on. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037644"> </a><code>symbol11Font</code> </p>
    </td>
    <td><p class="tt"><a name="1037646"> </a>Contains the check boxes, the large left arrow, and the large right arrow. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037649"> </a><code>symbol7Font</code> </p>
    </td>
    <td><p class="tt"><a name="1037651"> </a>Contains the up and down arrows used for the repeating button scroll arrows and the dimmed version of the same arrows. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037654"> </a><code>ledFont</code> </p>
    </td>
    <td><p class="tt"><a name="1037656"> </a>Contains the numbers 0 through 9, &#8211;, ., and the comma (,). Used by the Calculator application for its numeric display. </p>
    </td>
  </tr>
</table>

</div>

<h3 class="hbH3">
  <a name="1037659"> </a>Selecting Which Font to Use <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037660"> </a>The default fonts used to display normal text and bold text vary based on the handheld's character encoding. Handhelds with the Palm Latin encoding typically use <code>stdFont</code> and <code>boldFont</code>, while Japanese handhelds use <code>largeFont</code> and <code>largeBoldFont</code> as the default. When your application starts up for the first time, it should respect the system defaults. Use the <a href="../PalmOSReference/PalmOSGlueLib.html#1031671"><code>FntGlueGetDefaultFontID</code></a> function to determine what the default fonts are (see <a href="Text.html#1037669">Listing 8.10</a>). </p>
<p class="CCodeCaption">
  <a name="1037669"> </a><b>Listing 8.10&nbsp;&nbsp;Determining the default system fonts</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
FontID textFont = FntGlueGetDefaultFontID(defaultSystemFont);<a name="1037670"> </a>
FontID labelFont = FntGlueGetDefaultFontID(defaultBoldFont);<a name="1037671"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037672"> </a>In general, where users can enter text, you should allow them to select the font through the Select Font dialog (see <a href="Text.html#1037678">Figure 8.3</a>). </p>

<p class="FFigureCaption">
  <a name="1037678"> </a><b>Figure 8.3&nbsp;&nbsp;Select Font dialog<div align="left"><img src="images/FontSelect.gif" border="0" hspace="0" vspace="0">
</div></b>
</p>


<p><a name="1037687"> </a>The <a href="../PalmOSReference/Font.html#1000893"><code>FontSelect</code></a> function displays the Select Font dialog. This function takes as an argument a <code>FontID</code>, which specifies the value that is initially selected in the dialog. It returns the <code>FontID</code> that the user selected. </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
newFontID = FontSelect(textFont);<a name="1037688"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037689"> </a>Because the default fonts vary based on the character encoding, the font size choices displayed in the Font Select dialog also vary based on character encoding. For this reason, you must call <code>FntGlueGetDefaultFontID</code> to obtain the default system font and pass the returned value to <code>FontSelect</code> when you call it for the first time. On subsequent calls to <code>FontSelect</code>, you can pass the user's current font choice. </p>
<h3 class="hbH3">
  <a name="1037691"> </a>Fonts for High-Density Displays <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037696"> </a>If the <a href="../PalmOSReference/CompatibilityApdx.html#996955">High-Density Display Feature Set</a> is defined, Palm OS supports both low-density (160 X 160) and double-density (320 X 320 displays. The <a href="../PalmOSReference/CompatibilityApdx.html#997148">1.5x Display Feature Set</a> adds support for 320 X 240&#8212;"one-and-a-half density," also known as 1.5x&#8212;displays. High-density displays, whether double or one-and-a-half density, pack more pixels into the same space to create a finer resolution. </p>

<p><a name="1037701"> </a>To support multiple display densities, Palm OS uses an <b>extended font resource</b>. An extended font resource contains a separate set of glyphs for each supported density. At runtime, Palm OS determines the current display density and then draws text using the glyphs that match the display density. On a double-density display, text is drawn using the double-density glyphs. On a low-density display, text is drawn using the low-density glyphs. </p>

<p><a name="1037702"> </a>Palm OS includes extended font resources for each of the built-in fonts when the high-density display feature set is defined. If your application uses only these fonts, your text is drawn by default using high-density glyphs on high-density displays. You do not have to make any changes to your code for this to occur. </p>

<p class="FFigureCaption">
  <a name="1037703"> </a><b>Figure 8.4&nbsp;&nbsp;Low-density and high-density fonts<div align="left"><img src="images/FontsWHighDens.gif" border="0" hspace="0" vspace="0">
</div></b>
</p>


<p><a name="1037710"> </a>You only need to be concerned about the font density if you need to display more text than normal on a single high-density screen (see the description of the <a href="../PalmOSReference/Window.html#1016731"><code>WinSetScalingMode</code></a> function in <i>Palm OS Programmer's API Reference</i>) or if you use custom fonts:</p>
<ul type="disc">
  <li><a name="1037717"> </a>When creating a custom font, you'll want to create an extended font resource. See <a href="Text.html#1037919">"Creating Custom Fonts."</a> If an extended font resource is not available or does not contain double-density glyphs, Palm OS pixel doubles the low-density glyphs when drawing to a double-density display. 
  <li><a name="1037722"> </a>When drawing text in a custom font to an off-screen window, you must take care. Off-screen windows also have a display density. If you create a low-density off-screen window and draw text to it, use a low-density font or an extended font with low-density glyphs. If the resource contains only high-density glyphs, the blitter shrinks the high-density font bitmaps. This results in poor quality text when the offscreen bitmap is subsequently transferred, and pixel-doubled, to a high-density display. If a low-density font is available, the blitter substitutes a low-density font when drawing text to the window in an attempt to produce the best possible aesthetic result.
   <p><a name="1037723"> </a>Because Palm OS includes low-density and high-density glyphs for each of the built-in fonts, this is only a potential problem if you are using a custom font. </p>
</ul>

<div><hr>
  <a name="1037724"> </a> <span class="warning">WARNING! </span> The blitter's behavior when attempting to draw double-density data (text or bitmap) to a 1.5x destination, or attempting to draw 1.5x data to a double-density destination, is undefined. Drawing low-density font or bitmap data to a high-density destination (either 1.5 or double density), however, works as expected.
<hr>
</div>
<h3 class="hbH3">
  <a name="1037726"> </a>Setting the Font Programmatically <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037727"> </a>To set the font that a user interface element uses for its label or for its textual contents, you use different functions depending on the element. <a href="Text.html#1037737">Table 8.3</a> shows which functions set fonts for which user interface elements. </p>

<p class="caption"><a name="1037737"> </a><b>Table 8.3&nbsp;&nbsp;Setting the font </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1037741"> </a><b>UI object</b></p>
    </th>
    <th><p class="tt"><a name="1037743"> </a><b>Function</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037745"> </a>Field </p>
    </td>
    <td><p class="tt"><a name="1037751"> </a><a href="../PalmOSReference/Field.html#997637"><code>FldSetFont</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037753"> </a>Field within a table </p>
    </td>
    <td><p class="tt"><a name="1037759"> </a><a href="../PalmOSReference/Table.html#998099"><code>TblSetItemFont</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037761"> </a>Command button, push button, pop-up trigger, selector trigger, or check box </p>
    </td>
    <td><p class="tt"><a name="1037767"> </a><a href="../PalmOSReference/PalmOSGlueLib.html#1031584"><code>CtlGlueSetFont</code></a> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037769"> </a>Label resource</p>
    </td>
    <td><p class="tt"><a name="1037775"> </a><a href="../PalmOSReference/PalmOSGlueLib.html#1031935"><code>FrmGlueSetLabelFont</code></a> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037777"> </a>List items </p>
    </td>
    <td><p class="tt"><a name="1037783"> </a><a href="../PalmOSReference/PalmOSGlueLib.html#1032087"><code>LstGlueSetFont</code></a> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037785"> </a>All other text (text drawn directly on the screen)</p>
    </td>
    <td><p class="tt"><a name="1037791"> </a><a href="../PalmOSReference/Font.html#1000753"><code>FntSetFont</code></a> </p>
    </td>
  </tr>
</table>

</div>


<p><a name="1037796"> </a>The <a href="../PalmOSReference/Font.html#1000753"><code>FntSetFont</code></a> function changes the font that the system uses by default. It returns the previously used font. You should save the font returned by <code>FntSetFont</code> and restore it once you are done. <a href="Text.html#1037802">Listing 8.11</a> shows an example of setting the font to draw items in the custom list drawing function. </p>
<p class="CCodeCaption">
  <a name="1037802"> </a><b>Listing 8.11&nbsp;&nbsp;Setting the font programmatically</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
void DrawOneRowInList(Int16 itemNum, RectangleType *bounds, <a name="1037803"> </a>
   Char **itemsText)<a name="1037804"> </a>
{<a name="1037805"> </a>
   Boolean didSetFont = false;<a name="1037806"> </a>
   FontID oldFont;<a name="1037807"> </a>
<a name="1037808"> </a>
   if ((itemNum % 5) == 0) {<a name="1037809"> </a>
      oldFont = FntSetFont(boldFont);<a name="1037810"> </a>
      didSetFont = true;<a name="1037811"> </a>
   }<a name="1037812"> </a>
   WinDrawChars(itemsText[itemNum],<a name="1037813"> </a>
     StrLen(itemsText[itemNum]), bounds.topLeft.x,<a name="1037814"> </a>
        bounds.topLeft.y);<a name="1037815"> </a>
   if (didSetFont)<a name="1037816"> </a>
      FntSetFont(oldFont);<a name="1037817"> </a>
}<a name="1037818"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037820"> </a>Obtaining Font Information <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037822"> </a>Use functions in the Font Manager to obtain information about a font and how it is drawn to the screen. <a href="Text.html#1037830">Figure 8.5</a> shows graphically the characteristics of a font. <a href="Text.html#1037838">Table 8.4</a> describes the types of information that can be retrieved with the Font Manager.</p>

<p class="FFigureCaption">
  <a name="1037830"> </a><b>Figure 8.5&nbsp;&nbsp;Font characteristics<div align="left"><img src="images/FontCharacteristics.gif" border="0" hspace="0" vspace="0">
</div></b>
</p>


<p class="caption"><a name="1037838"> </a><b>Table 8.4&nbsp;&nbsp;Obtaining font information</b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1037842"> </a><b>Characteristic</b></p>
    </th>
    <th><p class="tt"><a name="1037844"> </a><b>Function</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037846"> </a>Font height</p>
    </td>
    <td><p class="tt"><a name="1037852"> </a><a href="../PalmOSReference/Font.html#1000463"><code>FntCharHeight</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037854"> </a>Ascent</p>
    </td>
    <td><p class="tt"><a name="1037860"> </a><a href="../PalmOSReference/Font.html#1000449"><code>FntBaseLine</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037862"> </a>Descent</p>
    </td>
    <td><p class="tt"><a name="1037868"> </a><a href="../PalmOSReference/Font.html#1000609"><code>FntDescenderHeight</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037870"> </a>Leading + font height</p>
    </td>
    <td><p class="tt"><a name="1037876"> </a><a href="../PalmOSReference/Font.html#1000722"><code>FntLineHeight</code></a> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037878"> </a>Maximum width of a character in the font</p>
    </td>
    <td><p class="tt"><a name="1037884"> </a><a href="../PalmOSReference/Font.html#1000430"><code>FntAverageCharWidth</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037886"> </a>Width of a specific character</p>
    </td>
    <td><p class="tt"><a name="1037892"> </a><a href="../PalmOSReference/Font.html#1000776"><code>FntWCharWidth</code></a> (<code>FntGlueWCharWidth</code>)</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1037894"> </a>Character displayed at particular location</p>
    </td>
    <td><p class="tt"><a name="1037900"> </a><a href="../PalmOSReference/Font.html#1000807"><code>FntWidthToOffset</code></a> (<code>FntGlueWidthToOffset</code>)</p>
    </td>
  </tr>
</table>

</div>


<p><a name="1037905"> </a>The functions listed in <a href="Text.html#1037838">Table 8.4</a> all work on the current font, that is, the font listed in the draw state. To change the current font, use <a href="../PalmOSReference/Font.html#1000753"><code>FntSetFont</code></a>. For example, to determine the line height of the font used for text in a field, do the following:</p>
<p class="CCodeCaption">
  <a name="1037910"> </a><b>Listing 8.12&nbsp;&nbsp;Obtaining characteristics of a field font</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
FieldType *fieldP;<a name="1037911"> </a>
FontID oldFont;<a name="1037912"> </a>
Int16 lineHeight;<a name="1037913"> </a>
<a name="1037914"> </a>
oldFont = FntSetFont(FldGetFont(fieldP));<a name="1037915"> </a>
lineHeight = FntLineHeight();<a name="1037916"> </a>
FntSetFont(oldFont);<a name="1037917"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1037919"> </a>Creating Custom Fonts <a href="#1036996"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1037921"> </a>Palm OS 3.0 and later supports the use of custom fonts. You can create your own font resource (<code>'NFNT'</code>) and use it within your application. </p>

<p><a name="1037925"> </a>If the <a href="../PalmOSReference/CompatibilityApdx.html#996955">High-Density Display Feature Set</a> is present, you can use an extended font resource (<code>'nfnt'</code>) instead. The extended font resource contains a separate set of glyphs for each of the supported display densities. </p>

<p><a name="1037926"> </a>Both the font and extended font resources are only large enough to support a font for the Palm Latin character encoding (256 characters). Defining a custom font for larger character sets is not supported. </p>

<h4 class="hcH4">
  <a name="1037927"> </a>Creating a Font Resource
</h4>

<p><a name="1037928"> </a>The Palm OS SDK does not provide tools to create a custom font; however, several third party applications, such as xFont and PilRC, are available that support the creation of custom fonts. </p>

<div><hr>
  <a name="1037929"> </a> <b>TIP: </b> Leave a vertical column of blank space on the right side of each glyph in a font. Palm OS draws characters side by side, in contrast to the Mac OS, which draws a character, clears the pixels to its right and then draws the next character. If your font requires leading, you should leave blank space at the bottom of each glyph as well because Palm OS does not support leading. 
<hr>
</div>

<p><a name="1037931"> </a>To create an extended font resource, you use Constructor for Palm OS: </p>
<ol type="1">
  <li value="1"><a name="1037932"> </a>Create two font resources using a third party tool (such as xFont). Every aspect of the second font must be exactly double that of the first font. That is, the second font must be twice as many pixels high, twice as many pixels wide, and so on. 
  <li value="2"><a name="1037933"> </a>Create a font family using Constructor for Palm OS as described in the book <i>Constructor for Palm OS</i>. 
  <li value="3"><a name="1037937"> </a>Use the first <code>'NFNT'</code> resource as the Normal density font. Use the second <code>'NFNT'</code> resource as the Double density font. 
</ol>

<p><a name="1037939"> </a>The PalmRez post linker uses the font family resource to create the extended font resource that you use on the device. </p>

<h4 class="hcH4">
  <a name="1037941"> </a>Using a Custom Font in Your Application 
</h4>

<p><a name="1037942"> </a>Once you have defined a custom font in a resource file, you must assign it a font ID before you can use the font in your application. The font ID is different from the font's resource ID. It's a number between 0 and 255. The font ID you use must be greater than or equal to <code>fntAppFontCustomBase</code>. All IDs less than that are reserved for system use. The function <a href="../PalmOSReference/Font.html#1000560"><code>FntDefineFont</code></a> assigns a font ID to a font resource. The font resource must be locked for the entire time that the font is in use. It's a good idea to load the font resource, lock it, and assign a font ID in your application's <code>AppStart</code> function. Unlock and release the font resource in the <code>AppStop</code> function. </p>

<p><a name="1037952"> </a><a href="Text.html#1037954">Listing 8.13</a> shows code that loads a font resource, assigns a font ID to that resource, and then draws characters to the screen using the new font. </p>
<p class="CCodeCaption">
  <a name="1037954"> </a><b>Listing 8.13&nbsp;&nbsp;Loading and using a custom font</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define customFontID ((FontID) fntAppFontCustomBase)<a name="1037955"> </a>
<a name="1037956"> </a>
MemHandle customFontH;<a name="1037957"> </a>
FontType *customFontP;<a name="1037958"> </a>
<a name="1037959"> </a>
Err AppStart(void)<a name="1037960"> </a>
{<a name="1037961"> </a>
   ...<a name="1037962"> </a>
   // Load the font resource and assign it a font ID. <a name="1037963"> </a>
   customFontH = DmGetResource(fontRscType, MyCoolFontRscID);<a name="1037964"> </a>
   customFontP = (FontType *)MemHandleLock(customFontH);<a name="1037965"> </a>
   FntDefineFont(customFontID, customFontP);<a name="1037966"> </a>
   ...<a name="1037967"> </a>
}<a name="1037968"> </a>
<a name="1037969"> </a>
void AppStop(void)<a name="1037970"> </a>
{<a name="1037971"> </a>
   ...<a name="1037972"> </a>
   //Release the font resource when app quits. <a name="1037973"> </a>
   MemHandleUnlock(customFontH);<a name="1037974"> </a>
   DmReleaseResource(customFontH);<a name="1037975"> </a>
   ...<a name="1037976"> </a>
}<a name="1037977"> </a>
<a name="1037978"> </a>
void DrawCharsInNewFont(void) <a name="1037979"> </a>
{<a name="1037980"> </a>
   FontID oldFont = FntSetFont(customFontID);<a name="1037981"> </a>
   Char *msg = "Look, Mom. It's a new font!");<a name="1037982"> </a>
   WinDrawChars(msg, StrLen(msg), 28, 0);<a name="1037983"> </a>
   FntSetFont(oldFont);<a name="1037984"> </a>
}<a name="1037985"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037987"> </a>To use a extended font, you use essentially the same code as above, except that you must change the resource type used in the <code>DmGetResource</code> call to <code>fontExtRscType</code>:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
customFontH = DmGetResource(fontExtRscType, <a name="1037989"> </a>
   MyCoolExtFontRscID);<a name="1037990"> </a>
// rest as shown above. <a name="1037991"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1037992"> </a>Note that you still use a pointer to a <code>FontType</code> structure to access the extended font. </p>

<p><a name="1037993"> </a>The <code>'NFNT'</code> resources you created to build the extended font are discarded after the extended font is created. For a backward compatible application, you need to define a separate <code>'NFNT'</code> resource containing the low-density glyphs in your font. </p>

<p><a name="1037994"> </a>It's possible to create an extended font resource that contains only double-density glyphs and not low-density glyphs. You could define an <code>'NFNT'</code> resource for the low-density glyphs and an extended font resource with just the double-density glyphs. Then you could load and use the <code>'NFNT'</code> resource on all handhelds with low-density screens (including those that don't support the high-density feature set) and load and use the extended font resource when the display is not low-density. If you do this, you must carefully check the display density before deciding which resource to load (see <a href="Text.html#1038006">Listing 8.14</a>).</p>

<div><hr>
  <a name="1037998"> </a> <span class="warning">WARNING! </span> If you write text to a low-density off-screen window using double-density glyphs, the result is undefined and may cause Palm OS to crash. If you load your fonts as shown in <a href="Text.html#1038006">Listing 8.14</a>, load and use the old font resource when drawing text to a low-density off-screen window. See <a href="Text.html#1037691">"Fonts for High-Density Displays"</a> for more information. 
<hr>
</div>
<p class="CCodeCaption">
  <a name="1038006"> </a><b>Listing 8.14&nbsp;&nbsp;Conditionally loading a font resource</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define customFontID ((FontID) fntAppFontCustomBase)<a name="1038007"> </a>
MemHandle fontH = NULL;<a name="1038008"> </a>
FontType *fontP;<a name="1038009"> </a>
UInt16 winVersion;<a name="1038010"> </a>
Err error;<a name="1038011"> </a>
<a name="1038012"> </a>
error = FtrGet(sysFtrCreator, sysFtrNumWinVersion, <a name="1038013"> </a>
   &amp;winVersion);<a name="1038014"> </a>
// If winVersion is &gt;= 4, the high-density feature set<a name="1038015"> </a>
// is present. Check what type of display we are on<a name="1038016"> </a>
// and load the appropriate font resource. <a name="1038017"> </a>
if (!error &amp;&amp; (winVersion &gt;= 4)) {<a name="1038018"> </a>
   UInt32 density;<a name="1038019"> </a>
   error = WinScreenGetAttribute(winScreenDensity, &amp;density);<a name="1038020"> </a>
   if (!error &amp;&amp; (density != kDensityLow)) {<a name="1038021"> </a>
         // load and use the extended font <a name="1038022"> </a>
         // resource.<a name="1038023"> </a>
         fontH = DmGetResource(fontExtRscType, 
            MyNewFontRscID);<a name="1038024"> </a>
         fontP = MemHandleLock(fontH);<a name="1038025"> </a>
   }<a name="1038026"> </a>
}<a name="1038027"> </a>
<a name="1038028"> </a>
if (!fontH) {<a name="1038029"> </a>
  // Either the feature set is not present or we're on a <a name="1038030"> </a>
  // low-density screen. Load and use the 'NFNT' resource.<a name="1038031"> </a>
  fontH = DmGetResource(fontRscType, MyOldFontRscID);<a name="1038032"> </a>
  fontP = (FontType *)MemHandleLock(fontH);<a name="1038033"> </a>
}<a name="1038034"> </a>
<a name="1038035"> </a>
FntDefineFont(customFontID, fontP);<a name="1038036"> </a>
</pre><div class="CodeRule"><hr></div>


<h2 class="haH2">
  <a name="1038038"> </a>Summary of Text API <a href="#1036996"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1038041"> </a><b>Text Manager</b></p>
    </th>
    <th><p class="tt"><a name="1038043"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038045"> </a><b>Accessing Text</b></p>
    </td>
    <td><p class="tt"><a name="1038047"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038052"> </a><a href="../PalmOSReference/TextMgr.html#1121040">TxtCharBounds</a><br><a href="../PalmOSReference/TextMgr.html#1122436">TxtPreviousCharSize</a><br><a href="../PalmOSReference/TextMgr.html#1122131">TxtGetNextChar</a><br><a href="../PalmOSReference/TextMgr.html#1122094">TxtGetChar</a></p>
    </td>
    <td><p class="tt"><a name="1038066"> </a><a href="../PalmOSReference/TextMgr.html#1122176">TxtGetPreviousChar</a><br><a href="../PalmOSReference/TextMgr.html#1121539">TxtCharSize</a><br><a href="../PalmOSReference/TextMgr.html#1122358">TxtNextCharSize</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038074"> </a><b>Changing Text </b></p>
    </td>
    <td><p class="tt"><a name="1038076"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038081"> </a><a href="../PalmOSReference/TextMgr.html#1122473">TxtReplaceStr</a><br><a href="../PalmOSReference/TextMgr.html#1121709">TxtConvertEncoding</a></p>
    </td>
    <td><p class="tt"><a name="1038089"> </a><a href="../PalmOSReference/TextMgr.html#1122508">TxtSetNextChar</a><br><a href="../PalmOSReference/TextMgr.html#1122591">TxtTransliterate</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1038094"> </a><b>Segmenting Text</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038101"> </a><a href="../PalmOSReference/TextMgr.html#1122220">TxtGetTruncationOffset</a><br><a href="../PalmOSReference/TextMgr.html#1122248">TxtGetWordWrapOffset</a></p>
    </td>
    <td><p class="tt"><a name="1038109"> </a><a href="../PalmOSReference/TextMgr.html#1122651">TxtWordBounds</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1038111"> </a><b>Searching/Comparing Text</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038118"> </a><a href="../PalmOSReference/TextMgr.html#1120896">TxtCaselessCompare</a><br><a href="../PalmOSReference/TextMgr.html#1122038">TxtFindString</a></p>
    </td>
    <td><p class="tt"><a name="1038126"> </a><a href="../PalmOSReference/TextMgr.html#1121637">TxtCompare</a><br><a href="../PalmOSReference/PalmOSGlueLib.html#1032726">TxtGluePrepFindString</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1038131"> </a><b>Obtaining a Character's Attributes</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038138"> </a><a href="../PalmOSReference/TextMgr.html#1121122">TxtCharIsAlNum</a><br><a href="../PalmOSReference/TextMgr.html#1121237">TxtCharIsDigit</a><br><a href="../PalmOSReference/TextMgr.html#1121359">TxtCharIsLower</a><br><a href="../PalmOSReference/TextMgr.html#1121450">TxtCharIsSpace</a><br><a href="../PalmOSReference/TextMgr.html#1121506">TxtCharIsValid</a><br><a href="../PalmOSReference/TextMgr.html#1121189">TxtCharIsCntrl</a><br><a href="../PalmOSReference/TextMgr.html#1121426">TxtCharIsPunct</a></p>
    </td>
    <td><p class="tt"><a name="1038161"> </a><a href="../PalmOSReference/TextMgr.html#1121154">TxtCharIsAlpha</a><br><a href="../PalmOSReference/TextMgr.html#1121269">TxtCharIsGraph</a><br><a href="../PalmOSReference/TextMgr.html#1121391">TxtCharIsPrint</a><br><a href="../PalmOSReference/TextMgr.html#1121474">TxtCharIsUpper</a><br><a href="../PalmOSReference/TextMgr.html#1121596">TxtCharXAttr</a><br><a href="../PalmOSReference/TextMgr.html#1121330">TxtCharIsHex</a><br><a href="../PalmOSReference/TextMgr.html#1120960">TxtCharAttr</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1038181"> </a><b>Obtaining Character Encoding information</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038188"> </a><a href="../PalmOSReference/TextMgr.html#1122548">TxtStrEncoding</a><br><a href="../PalmOSReference/TextMgr.html#1122284">TxtMaxEncoding</a></p>
<p class="tt"><a name="1038195"> </a><a href="../PalmOSReference/TextMgr.html#1122324">TxtNameToEncoding</a></p>
    </td>
    <td><p class="tt"><a name="1038200"> </a><a href="../PalmOSReference/TextMgr.html#1122003">TxtEncodingName</a><br><a href="../PalmOSReference/TextMgr.html#1121075">TxtCharEncoding</a></p>
<p class="tt"><a name="1038204"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1038206"> </a><b>Working With Multi-Byte Characters</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038213"> </a><a href="../PalmOSReference/TextMgr.html#1120833">TxtByteAttr</a></p>
    </td>
    <td><p class="tt"><a name="1038215"> </a></p>
    </td>
  </tr>
</table>

</div>







<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1038221"> </a><b>String Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1038223"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038225"> </a><b>Length of a String</b></p>
    </td>
    <td><p class="tt"><a name="1038227"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038232"> </a><a href="../PalmOSReference/StringManager.html#1065371">StrLen</a></p>
    </td>
    <td><p class="tt"><a name="1038234"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038236"> </a><b>Comparing Strings</b></p>
    </td>
    <td><p class="tt"><a name="1038238"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038243"> </a><a href="../PalmOSReference/StringManager.html#1065149">StrCompare</a><br><a href="../PalmOSReference/StringManager.html#1065054">StrCaselessCompare</a></p>
    </td>
    <td><p class="tt"><a name="1038251"> </a><a href="../PalmOSReference/StringManager.html#1065527">StrNCompare</a><br><a href="../PalmOSReference/StringManager.html#1065444">StrNCaselessCompare</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038256"> </a><b>Changing Strings</b></p>
    </td>
    <td><p class="tt"><a name="1038258"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038263"> </a><a href="../PalmOSReference/StringManager.html#1065666">StrPrintF</a><br><a href="../PalmOSReference/StringManager.html#1065099">StrCat</a><br><a href="../PalmOSReference/StringManager.html#1065246">StrCopy</a><br><a href="../PalmOSReference/StringManager.html#1065733">StrToLower</a></p>
    </td>
    <td><p class="tt"><a name="1038277"> </a><a href="../PalmOSReference/StringManager.html#1065754">StrVPrintF</a><br><a href="../PalmOSReference/StringManager.html#1065494">StrNCat</a><br><a href="../PalmOSReference/StringManager.html#1065629">StrNCopy</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038285"> </a><b>Searching Strings</b></p>
    </td>
    <td><p class="tt"><a name="1038287"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038292"> </a><a href="../PalmOSReference/StringManager.html#1065705">StrStr</a></p>
    </td>
    <td><p class="tt"><a name="1038297"> </a><a href="../PalmOSReference/StringManager.html#1065120">StrChr</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038299"> </a><b>Converting </b></p>
    </td>
    <td><p class="tt"><a name="1038301"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038306"> </a><a href="../PalmOSReference/StringManager.html#1065035">StrAToI</a><br><a href="../PalmOSReference/StringManager.html#1065348">StrIToH</a></p>
    </td>
    <td><p class="tt"><a name="1038314"> </a><a href="../PalmOSReference/StringManager.html#1065321">StrIToA</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038316"> </a><b>Localized Numbers</b></p>
    </td>
    <td><p class="tt"><a name="1038318"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038323"> </a><a href="../PalmOSReference/StringManager.html#1065268">StrDelocalizeNumber</a></p>
    </td>
    <td><p class="tt"><a name="1038328"> </a><a href="../PalmOSReference/StringManager.html#1065393">StrLocalizeNumber</a></p>
    </td>
  </tr>
</table>

</div>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1038332"> </a><b>Font Functions</b></p>
    </th>
    <th><p class="tt"><a name="1038334"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038336"> </a><b>Changing the Font</b></p>
    </td>
    <td><p class="tt"><a name="1038338"> </a> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038343"> </a><a href="../PalmOSReference/Font.html#1000893">FontSelect</a><br><a href="../PalmOSReference/Field.html#997637">FldSetFont</a><br><a href="../PalmOSReference/PalmOSGlueLib.html#1031584">CtlGlueSetFont</a><br><a href="../PalmOSReference/PalmOSGlueLib.html#1032087">LstGlueSetFont</a></p>
    </td>
    <td><p class="tt"><a name="1038357"> </a><a href="../PalmOSReference/Font.html#1000753">FntSetFont</a> <br><a href="../PalmOSReference/Table.html#998099">TblSetItemFont</a><br><a href="../PalmOSReference/PalmOSGlueLib.html#1031935">FrmGlueSetLabelFont</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1038365"> </a><b>Accessing the Font Programmatically</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038372"> </a><a href="../PalmOSReference/Font.html#1000623">FntGetFont</a></p>
    </td>
    <td><p class="tt"><a name="1038377"> </a><a href="../PalmOSReference/Font.html#1000650">FntGetFontPtr</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038379"> </a><b>Wrapping Text</b></p>
    </td>
    <td><p class="tt"><a name="1038381"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038386"> </a><a href="../PalmOSReference/Font.html#1000839">FntWordWrap</a></p>
    </td>
    <td><p class="tt"><a name="1038391"> </a><a href="../PalmOSReference/Font.html#1000867">FntWordWrapReverseNLines</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038393"> </a><b>String Width</b></p>
    </td>
    <td><p class="tt"><a name="1038395"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038400"> </a><a href="../PalmOSReference/Font.html#1000477">FntCharsInWidth</a><br><a href="../PalmOSReference/Font.html#1000736">FntLineWidth</a></p>
    </td>
    <td><p class="tt"><a name="1038408"> </a><a href="../PalmOSReference/Font.html#1000505">FntCharsWidth</a><br><a href="../PalmOSReference/Font.html#1000807">FntWidthToOffset</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038413"> </a><b>Character Width</b></p>
    </td>
    <td><p class="tt"><a name="1038415"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038420"> </a><a href="../PalmOSReference/Font.html#1000430">FntAverageCharWidth</a></p>
<p class="tt"><a name="1038424"> </a><a href="../PalmOSReference/Font.html#1000776">FntWCharWidth</a></p>
    </td>
    <td><p class="tt"><a name="1038429"> </a><a href="../PalmOSReference/Font.html#1000530">FntCharWidth</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038431"> </a><b>Height</b></p>
    </td>
    <td><p class="tt"><a name="1038433"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038438"> </a><a href="../PalmOSReference/Font.html#1000463">FntCharHeight</a><br><a href="../PalmOSReference/Font.html#1000449">FntBaseLine</a></p>
    </td>
    <td><p class="tt"><a name="1038446"> </a><a href="../PalmOSReference/Font.html#1000722">FntLineHeight</a><br><a href="../PalmOSReference/Font.html#1000609">FntDescenderHeight</a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038451"> </a><b>Scrolling</b></p>
    </td>
    <td><p class="tt"><a name="1038453"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038458"> </a><a href="../PalmOSReference/Font.html#1000671">FntGetScrollValues</a></p>
    </td>
    <td><p class="tt"><a name="1038460"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038462"> </a><b>Creating a Font</b></p>
    </td>
    <td><p class="tt"><a name="1038464"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1038469"> </a><a href="../PalmOSReference/Font.html#1000560">FntDefineFont</a></p>
    </td>
    <td><p class="tt"><a name="1038474"> </a><a href="../PalmOSReference/Font.html#1000704">FntIsAppDefined</a></p>
    </td>
  </tr>
</table>

</div>


<p><a name="1038476"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996-2004, PalmSource, Inc. and its affiliates.  All rights reserved. <br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="Companion_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExpAndVFSConcepts.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PIMConcept.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>