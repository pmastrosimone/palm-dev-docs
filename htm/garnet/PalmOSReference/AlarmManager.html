<html>
<head>
<title>(68K) Alarm Manager | Palm OS&#174; Programmer's  API Reference</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 10:46:14">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="995796"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="ReferenceTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PartII.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AdnDebugMgr.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ReferenceIX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">24 &nbsp;&nbsp;
Alarm Manager</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Palm OS&#174; Programmer's  API Reference</p>
<p class="SubTitle">Palm OS&#174; 68K SDK </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="PartII.html">Part II: System Management</a> </h1>
<h1 class="SideTOC1"><a href="AlarmManager.html">24  Alarm Manager</a></h1>

   <h2 class="SideTOC2"><a href="#995817">
   Alarm Manager Functions</a></h2>

      <h3 class="SideTOC3"><a href="#995820">
      AlmGetAlarm</a></h3>

      <h3 class="SideTOC3"><a href="#995845">
      AlmGetProcAlarm</a></h3>

      <h3 class="SideTOC3"><a href="#995875">
      AlmSetAlarm</a></h3>

      <h3 class="SideTOC3"><a href="#995927">
      AlmSetProcAlarm</a></h3>

   <h2 class="SideTOC2"><a href="#995974">
   Application-Defined Functions</a></h2>

      <h3 class="SideTOC3"><a href="#995978">
      AlmAlarmProcPtr</a></h3>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="995798"> </a>This chapter provides reference material for the alarm manager:</p>
<ul type="disc">
  <li><a name="995802"> </a><a href="AlarmManager.html#995817">Alarm Manager Functions</a>
  <li><a name="995806"> </a><a href="AlarmManager.html#995974">Application-Defined Functions</a>
</ul>

<p><a name="995808"> </a>The alarm manager API is declared in the header file <code>AlarmMgr.h</code>. </p>

<p><a name="995809"> </a>For more information on the Alarm Manager, see the section <a href="../PalmOSCompanion/AttnsAndAlarms.html#1043036">"Alarms"</a> in the <i>Palm OS Programmer's Companion</i>, vol. I. </p>

<h2 class="haH2">
  <a name="995817"> </a>Alarm Manager Functions <a href="#995796"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="995820"> </a>AlmGetAlarm Function <a href="#995796"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995822"> </a>Purpose 
</h4>

<p><a name="995823"> </a>Return the date and time for the application's alarm, if one is set. </p>
<h4>
  <a name="995824"> </a>Declared In 
</h4>
<code>AlarmMgr.h<a name="995825"> </a></code><h4>
  <a name="995826"> </a>Prototype 
</h4>
<pre class="proto"><a name="995828"></a>UInt32 AlmGetAlarm (
   UInt16 cardNo,
   LocalID dbID,
   UInt32 *refP
)
</pre>
<h4>
  <a name="995829"> </a>Parameters 
</h4>

<dl>
<dt><a name="995830"> </a><code>&rarr;  <i><code>cardNo</code></i></code></dt>
<dd><a name="995831"> </a>Number of the storage card on which the application resides.</dd>

<dt><a name="995832"> </a><code>&rarr;  <i><code>dbID</code></i></code></dt>
<dd><a name="995833"> </a>Local ID of the application.</dd>

<dt><a name="995834"> </a><code>&larr;  <i><code>refP</code></i></code></dt>
<dd><a name="995835"> </a>The alarm's reference value is returned here. This value is passed to the application when the alarm is triggered. </dd>

</dl>
<h4>
  <a name="995836"> </a>Returns 
</h4>

<p><a name="995837"> </a>The date and time the alarm will trigger, given in seconds since 1/1/1904; if no alarm is active for the application, 0 is returned for the alarm seconds and the reference value is undefined.</p>
<h4>
  <a name="995838"> </a>See Also 
</h4>

<p><a name="995842"> </a><a href="AlarmManager.html#995875"><code>AlmSetAlarm()</code></a> </p>

<h3 class="hbH3">
  <a name="995845"> </a>AlmGetProcAlarm Macro <a href="#995796"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995847"> </a>Purpose 
</h4>

<p><a name="995848"> </a>Returns the date and time that a procedure alarm will trigger. Also returns the caller-defined alarm reference value. </p>
<h4>
  <a name="995849"> </a>Declared In 
</h4>
<code>AlarmMgr.h<a name="995850"> </a></code><h4>
  <a name="995851"> </a>Prototype 
</h4>
<pre class="proto"><a name="995852"></a>#define AlmGetProcAlarm (
   procP,
   refP
)
</pre>
<h4>
  <a name="995853"> </a>Parameters 
</h4>

<dl>
<dt><a name="995854"> </a><code>&rarr;  <i><code>procP</code></i></code></dt>
<dd><a name="995855"> </a>Pointer to a function that will be called when alarm is triggered. See <a href="AlarmManager.html#995978"><code>AlmAlarmProcPtr()</code></a>. </dd>

<dt><a name="995859"> </a><code>&larr;  <i><code>refP</code></i></code></dt>
<dd><a name="995860"> </a>A <code>UInt32</code> pointer to a location where the alarm's reference value is returned. This value is passed to the procedure when the alarm is triggered. </dd>

</dl>
<h4>
  <a name="995861"> </a>Returns 
</h4>

<p><a name="995862"> </a>The date and time the alarm will trigger, given in seconds since 1/1/1904; if no alarm is active for the procedure, 0 is returned for the alarm seconds and the reference value is undefined. </p>
<h4>
  <a name="995863"> </a>Compatibility 
</h4>

<p><a name="995867"> </a>Implemented only if <a href="CompatibilityApdx.html#993903">3.2 New Feature Set</a> is present.</p>
<h4>
  <a name="995868"> </a>See Also 
</h4>

<p><a name="995872"> </a><a href="AlarmManager.html#995927"><code>AlmSetProcAlarm()</code></a> </p>

<h3 class="hbH3">
  <a name="995875"> </a>AlmSetAlarm Function <a href="#995796"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995877"> </a>Purpose 
</h4>

<p><a name="995879"> </a>Set or cancel an alarm for the given application.</p>
<h4>
  <a name="995880"> </a>Declared In 
</h4>
<code>AlarmMgr.h<a name="995881"> </a></code><h4>
  <a name="995882"> </a>Prototype 
</h4>
<pre class="proto"><a name="995884"></a>Err AlmSetAlarm (
   UInt16 cardNo,
   LocalID dbID,
   UInt32 ref,
   UInt32 alarmSeconds,
   Boolean quiet
)
</pre>
<h4>
  <a name="995885"> </a>Parameters 
</h4>

<dl>
<dt><a name="995886"> </a><code>&rarr;  <i><code>cardNo</code></i></code></dt>
<dd><a name="995887"> </a>Number of the storage card on which the application resides.</dd>

<dt><a name="995888"> </a><code>&rarr;  <i><code>dbID</code></i></code></dt>
<dd><a name="995889"> </a>Local ID of the application.</dd>

<dt><a name="995890"> </a><code>&rarr;  <i><code>ref</code></i></code></dt>
<dd><a name="995891"> </a>Caller-defined value. This value is passed with the launch code that notifies the application that the alarm has been triggered.</dd>

<dt><a name="995892"> </a><code>&rarr;  <i><code>alarmSeconds</code></i></code></dt>
<dd><a name="995893"> </a>Alarm date/time in seconds since 1/1/1904, or 0 to cancel the current alarm (if any).</dd>

<dt><a name="995894"> </a><code>&rarr;  <i><code>quiet</code></i></code></dt>
<dd><a name="995895"> </a>Reserved for future upgrade. This value is not currently used.</dd>

</dl>
<h4>
  <a name="995896"> </a>Returns 
</h4>

<dl>
<dt><a name="995897"> </a><code><code>0</code></code></dt>
<dd><a name="995898"> </a>No error.</dd>

<dt><a name="995900"> </a><code><code>almErrMemory</code></code></dt>
<dd><a name="995901"> </a>Insufficient memory.</dd>

<dt><a name="995903"> </a><code><code>almErrFull</code></code></dt>
<dd><a name="995904"> </a>Alarm table is full.</dd>

</dl>
<h4>
  <a name="995905"> </a>Comments 
</h4>

<p><a name="995906"> </a>This function sets an alarm for the specified application. An application can have only one alarm set at a time. If an alarm for this application has already been set, it is replaced with the new alarm.</p>

<p><a name="995907"> </a>The <code>alarmSeconds</code> parameter specifies the time at which the alarm will be triggered. As soon as possible after this time, the alarm manager sends the <a href="AppLaunchCodes.html#1011569"><code>sysAppLaunchCmdAlarmTriggered</code></a> launch code to the specified application. If there is another alarm that should be set for this application, you can set it in response to this launch code. Following the <code>sysAppLaunchCmdAlarmTriggered</code> launch code, the alarm manager sends a <a href="AppLaunchCodes.html#1011800"><code>sysAppLaunchCmdDisplayAlarm</code></a> launch code. This is where your application should do things such as display a modal dialog indicating that the event has occurred. Read more about these launch codes in <a href="AppLaunchCodes.html#1011221">Chapter 1, "Application Launch Codes."</a></p>

<p><a name="995919"> </a>If your application needs access to any particular value to respond to the alarm, pass a pointer to that value in the <code>ref</code> parameter. The system will pass this pointer back to the application in the launch codes' parameter blocks. </p>
<h4>
  <a name="995920"> </a>See Also 
</h4>

<p><a name="995924"> </a><a href="AlarmManager.html#995820"><code>AlmGetAlarm()</code></a> </p>

<h3 class="hbH3">
  <a name="995927"> </a>AlmSetProcAlarm Macro <a href="#995796"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995929"> </a>Purpose 
</h4>

<p><a name="995931"> </a>Sets or cancels a procedure alarm.</p>
<h4>
  <a name="995932"> </a>Declared In 
</h4>
<code>AlarmMgr.h<a name="995933"> </a></code><h4>
  <a name="995934"> </a>Prototype 
</h4>
<pre class="proto"><a name="995935"></a>#define AlmSetProcAlarm (
   procP,
   ref,
   alarmSeconds
)
</pre>
<h4>
  <a name="995936"> </a>Parameters 
</h4>

<dl>
<dt><a name="995937"> </a><code>&rarr;  <i><code>procP</code></i></code></dt>
<dd><a name="995938"> </a>Pointer to a function that should be called when alarm is triggered. See <a href="AlarmManager.html#995978"><code>AlmAlarmProcPtr()</code></a>. </dd>

<dt><a name="995942"> </a><code>&rarr;  <i><code>ref</code></i></code></dt>
<dd><a name="995943"> </a>A caller-defined <code>UInt32</code> value. This value is passed with the launch code that notifies the application that the alarm has been triggered.</dd>

<dt><a name="995944"> </a><code>&rarr;  <i><code>alarmSeconds</code></i></code></dt>
<dd><a name="995945"> </a>A <code>UInt32</code> indicating the alarm date/time in seconds since 1/1/1904, or 0 to cancel the current alarm (if any).</dd>

</dl>
<h4>
  <a name="995946"> </a>Returns 
</h4>

<p><a name="995947"> </a>Returns one of the following error codes:</p>

<dl>
<dt><a name="995948"> </a><code><code>0</code></code></dt>
<dd><a name="995949"> </a>No error.</dd>

<dt><a name="995951"> </a><code><code>almErrMemory</code></code></dt>
<dd><a name="995952"> </a>Insufficient memory.</dd>

<dt><a name="995954"> </a><code><code>almErrFull</code></code></dt>
<dd><a name="995955"> </a>Alarm table is full.</dd>

</dl>
<h4>
  <a name="995956"> </a>Comments 
</h4>

<p><a name="995960"> </a>This macro is similar to the <a href="AlarmManager.html#995875"><code>AlmSetAlarm()</code></a> function, but it specifies a procedure to be called at the specified date and time rather than an application to be launched. With this macro, you can set alarms that are independent of any application. For example, a shared library can set procedure alarms that call a procedure implemented in the library. </p>

<p><a name="995961"> </a>Procedure alarms also differ from regular system alarms in that if they trigger when the device is in sleep mode, the LCD does not light up. Thus, you can use procedure alarms to perform a scheduled task in a manner that is entirely hidden from the user. </p>

<div><hr>
  <a name="995962"> </a> <b>IMPORTANT: </b> Because the <code>procP</code> pointer is used to directly call the procedure, the pointer must remain valid from the time <code>AlmSetProcAlarm</code> is called to the time the alarm is triggered. If the procedure is in a shared library, you must keep the library open. If the procedure is in a separately loaded code resource, the resource must remain locked until the alarm is triggered. When you close a library or unlock a resource, you must remove any pending alarms. If you don't, the system will crash when the alarm is triggered. 
<hr>
</div>
<h4>
  <a name="995963"> </a>Compatibility 
</h4>

<p><a name="995967"> </a>Implemented only if <a href="CompatibilityApdx.html#993903">3.2 New Feature Set</a> is present.</p>
<h4>
  <a name="995968"> </a>See Also 
</h4>

<p><a name="995972"> </a><a href="AlarmManager.html#995845"><code>AlmGetProcAlarm()</code></a> </p>

<h2 class="haH2">
  <a name="995974"> </a>Application-Defined Functions <a href="#995796"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="995978"> </a>AlmAlarmProcPtr Function <a href="#995796"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995980"> </a>Purpose 
</h4>

<p><a name="995981"> </a>A procedure to be executed when an alarm is triggered.</p>
<h4>
  <a name="995982"> </a>Declared In 
</h4>
<code>AlarmMgr.h<a name="995983"> </a></code><h4>
  <a name="995984"> </a>Prototype 
</h4>
<pre class="proto"><a name="995985"></a>void (
   *AlmAlarmProcPtr
) (
   UInt16 almProcCmd,
   SysAlarmTriggeredParamType *paramP
)
</pre>
<h4>
  <a name="995986"> </a>Parameters 
</h4>

<dl>
<dt><a name="995987"> </a><code>&rarr;  <i><code>almProcCmd</code></i></code></dt>
<dd><a name="995989"> </a>One of the <code>AlmProcCmdEnum</code> constants. These are commands that your function must handle. Possible values are:</dd>

<dl>
<dt><a name="995991"> </a><code><code>almProcCmdTriggered</code></code></dt>
<dd><a name="995992"> </a>The alarm's date and time has passed and the alarm has been triggered. The function should perform its main task in response to this command. </dd>

<dt><a name="995994"> </a><code>almProcCmdReschedule</code></dt>
<dd><a name="995995"> </a>A system time change occurred, so the function must reschedule the alarm. </dd>

</dl>
<dt><a name="995996"> </a><code>&rarr;  <i><code>paramP</code></i></code></dt>
<dd><a name="995997"> </a>Pointer to a <code>SysAlarmTriggeredParamType</code> structure. See below. </dd>

</dl>
<h4>
  <a name="995998"> </a>Returns 
</h4>

<p><a name="995999"> </a>Returns nothing. </p>
<h4>
  <a name="996000"> </a>Comments 
</h4>

<p><a name="996001"> </a><code>AlmAlarmProcPtr</code> procedures are called when an alarm set by <a href="AlarmManager.html#995927"><code>AlmSetProcAlarm()</code></a> is triggered. Your implementation should check the value of <code>almProcCmd</code> and respond accordingly. </p>

<p><a name="996005"> </a>The <code>paramP</code> parameter is a pointer to a <code>SysAlarmTriggeredParamType</code> structure. This structure is defined as: </p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct SysAlarmTriggeredParamType {<a name="996006"> </a>
  UInt32   ref;<a name="996007"> </a>
  UInt32   alarmSeconds;<a name="996008"> </a>
  Boolean purgeAlarm;
} SysAlarmTriggeredParamType;<a name="996009"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="996011"> </a><code>ref</code> and <code>alarmSeconds</code> are both values specified in <a href="AlarmManager.html#995927"><code>AlmSetProcAlarm()</code></a> when the alarm is set. The <code>purgeAlarm</code> field specifies if the alarm will be removed from the alarm table when the function returns so that the <a href="AppLaunchCodes.html#1011800"><code>sysAppLaunchCmdDisplayAlarm</code></a> launch code is not triggered. This should be <code>true</code> for all procedure alarms; the alarm manager set it to <code>true</code> for you after your function returns. </p>

<p><a name="996018"> </a>If necessary, you can define new values for the <code>almProcCmd</code> parameter to call the procedure for something other than a triggered alarm or a system time change. The value you use must be greater than the constant <code>almProcCmdCustom</code> as defined in <code>AlarmMgr.h</code>. </p>
<h4>
  <a name="996020"> </a>Compatibility 
</h4>

<p><a name="996024"> </a>Implemented only if <a href="CompatibilityApdx.html#993903">3.2 New Feature Set</a> is present.</p>
<h4>
  <a name="996025"> </a>See Also 
</h4>

<p><a name="996029"> </a><a href="AlarmManager.html#995845"><code>AlmGetProcAlarm()</code></a> </p>

<p><a name="996030"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996-2004, PalmSource, Inc. and its affiliates.  All rights reserved. <br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="Reference_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="ReferenceTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PartII.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AdnDebugMgr.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ReferenceIX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>