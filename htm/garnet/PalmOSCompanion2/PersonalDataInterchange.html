<html>
<head>
<title>(68K) Personal Data Interchange | Palm OS&#174; Programmer's Companion</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 10:43:43">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="1003927"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="Companion2TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExchangeLibraries.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Beaming.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Companion2IX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">3 &nbsp;&nbsp;
Personal Data Interchange</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Palm OS&#174; Programmer's Companion</p>
<p class="SubTitle">Volume II Communications </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1"><a href="PersonalDataInterchange.html">3  Personal Data Interchange</a></h1>

   <h2 class="SideTOC2"><a href="#1003980">
   About Personal Data Interchange</a></h2>

      <h3 class="SideTOC3"><a href="#1003988">
      About vObjects</a></h3>

      <h3 class="SideTOC3"><a href="#1003999">
      Overview of vObject Structure</a></h3>

   <h2 class="SideTOC2"><a href="#1004055">
   About the PDI Library</a></h2>

      <h3 class="SideTOC3"><a href="#1004076">
      PDI Property and Parameter Types</a></h3>

      <h3 class="SideTOC3"><a href="#1004125">
      The PDI Library Properties Dictionary</a></h3>

      <h3 class="SideTOC3"><a href="#1004143">
      PDI Readers</a></h3>

      <h3 class="SideTOC3"><a href="#1004173">
      PDI Writers</a></h3>

      <h3 class="SideTOC3"><a href="#1004184">
      Format Compatibility</a></h3>

      <h3 class="SideTOC3"><a href="#1004207">
      International Considerations</a></h3>

      <h3 class="SideTOC3"><a href="#1004215">
      Features Not Yet Supported</a></h3>

   <h2 class="SideTOC2"><a href="#1004227">
   Using the PDI Library</a></h2>

      <h3 class="SideTOC3"><a href="#1009807">
      Accessing the PDI Library</a></h3>

      <h3 class="SideTOC3"><a href="#1004411">
      Unloading the PDI Library</a></h3>

      <h3 class="SideTOC3"><a href="#1004431">
      Creating a PDI Reader</a></h3>

      <h3 class="SideTOC3"><a href="#1004463">
      Reading Properties</a></h3>

      <h3 class="SideTOC3"><a href="#1004505">
      Reading Property Values</a></h3>

      <h3 class="SideTOC3"><a href="#1004628">
      Creating a PDI Writer</a></h3>

      <h3 class="SideTOC3"><a href="#1004658">
      Writing Properties</a></h3>

      <h3 class="SideTOC3"><a href="#1004686">
      Writing Property Values</a></h3>

      <h3 class="SideTOC3"><a href="#1004701">
      Specifying PDI Versions</a></h3>

   <h2 class="SideTOC2"><a href="#1004714">
   Using UDA for Different Media</a></h2>

      <h3 class="SideTOC3"><a href="#1004722">
      About the UDA Library</a></h3>

   <h2 class="SideTOC2"><a href="#1004770">
   Using a PDI Reader - An Example</a></h2>

   <h2 class="SideTOC2"><a href="#1004949">
   Using a PDI Writer - An Example</a></h2>

   <h2 class="SideTOC2"><a href="#1005091">
   Summary of Personal Data Interchange</a></h2>

   <h2 class="SideTOC2"><a href="#1005216">
   Summary of Unified Data Access Manager</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1003937"> </a>The Palm OS<sup>&#174;</sup> provides the PDI library API for exchanging Personal Data Interchange (PDI) information with other devices and media. This chapter contains the following sections that describe how to use the Palm OS PDI library:</p>
<ul type="disc">
  <li><a name="1003941"> </a><a href="PersonalDataInterchange.html#1003980">About Personal Data Interchange</a> briefly introduces the PDI standard and provides links to sources of more complete information.
  <li><a name="1003945"> </a><a href="PersonalDataInterchange.html#1004055">About the PDI Library</a> describes how the Palm OS PDI library implements PDI reader and writer objects for exchanging information.
  <li><a name="1003949"> </a><a href="PersonalDataInterchange.html#1004227">Using the PDI Library</a> describes how to use the functions in the PDI library.
  <li><a name="1003953"> </a><a href="PersonalDataInterchange.html#1004714">Using UDA for Different Media</a> describes how you can use the Unified Data Access (UDA) Manager to access data from different media in your PDI reader or writer.
  <li><a name="1003957"> </a><a href="PersonalDataInterchange.html#1004770">Using a PDI Reader - An Example</a> provides a detailed walk-through of a code segment that creates a PDI reader and then uses it to parse vCard information.
  <li><a name="1003961"> </a><a href="PersonalDataInterchange.html#1004949">Using a PDI Writer - An Example</a> provides a detailed walk-through of a code segment that creates a PDI writer and then uses it to generate vCal information.
</ul>

<p><a name="1003962"> </a>For detailed information about the PDI library data types, constants, and functions, see <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

<p><a name="1003969"> </a>The PDI reader and writer objects make use of the United Data Access (UDA) Manager to manage input and output data streams. <a href="PersonalDataInterchange.html#1004714">"Using UDA for Different Media"</a> provides an overview of using the UDA Manager. The reference information for UDA functions is in <a href="../PalmOSReference/UDAMgr.html#1116357">Chapter 89, "Unified Data Access Manager,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

<h2 class="haH2">
  <a name="1003980"> </a>About Personal Data Interchange <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1003981"> </a>Personal data interchange involves the exchange of information using a communications medium. The Palm OS PDI Library facilitates the exchange of information using standard <b>vObjects</b>, including data formatted according to <b>vCard</b> and <b>vCal</b> standards.</p>

<p><a name="1003982"> </a>The vObject standards are maintained by a group known as the versit consortium, which consists of individuals from a number of companies and institutions. The best information about the PDI standards can be found at the consortium's web site:</p>
<pre class="proto"><a name="1003984"></a><a href="http://www.imc.org/pdi/"></a>http://www.imc.org/pdi/ 


</pre>

<p><a name="1003985"> </a>These standards are finding increased use in a number of computers and hand-held devices that wish to exchange personal data such as business card and calendar information.</p>

<p><a name="1003986"> </a>The PDI Library provides a <code>PdiReaderType</code> object for reading vObjects from an input stream, and a <code>PdiWriterType</code> object for writing vObjects to an output stream. The input streams and output streams can be connected to various data sources.</p>
<h3 class="hbH3">
  <a name="1003988"> </a>About vObjects <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1003989"> </a>This section provides a brief overview of vObject standards. Two common vObject types are vCards and vCals:</p>
<ul type="disc">
  <li><a name="1003991"> </a>vCards are used to exchange virtual business card information electronically. Each vCard can include a large variety of personal and business information about an individual, including name, address, and telecommunications numbers.
  <li><a name="1003993"> </a>vCals are used to exchange virtual calendaring and scheduling information electronically. Each vCal can include:
  <ul type="disc">
    <li><a name="1003995"> </a>vEvent objects, each of which represents a scheduled amount of time on a calendar
    <li><a name="1003997"> </a>vTodo objects, each of which defines an action item or assignment
  </ul>
</ul>
<h3 class="hbH3">
  <a name="1003999"> </a>Overview of vObject Structure <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004000"> </a>This section provides a brief overview of vObject standards, including the vCard and vCal standards. Each vObject standard provides the same, basic organizational structure:</p>
<ul type="disc">
  <li><a name="1004001"> </a>Each vObject is a collection of one or more property definitions. 
  <li><a name="1004002"> </a>Each property definition contains a name, a value, and an optional collection of property parameter definitions.
  <li><a name="1004003"> </a>Each property parameter definition contains a name and a value. Each parameter value qualifies the property definition with additional information.
  <li><a name="1004004"> </a>A property value can be structured to contain multiple values. The values are typically separated with commas or semicolons.
</ul>

<p><a name="1004005"> </a>The vObject standards also allow developers to add custom extensions. All vObject readers that conform to the standard, including the <code>PdiReaderType</code> object, can read these extensions, though not all readers will act upon the information contained in them. </p>

<p><a name="1004006"> </a>Each property has the following syntax:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
PropertyName [';' Parameters] ':' PropertyValue<a name="1004007"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004008"> </a>Note that property and parameter names are case insensitive.</p>

<p><a name="1004012"> </a><a href="PersonalDataInterchange.html#1004014">Listing 3.1</a> shows a typical vCard definition.</p>
<p class="CCodeCaption">
  <a name="1004014"> </a><b>Listing 3.1&nbsp;&nbsp;Example of a vCard definition</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
BEGIN:VCARD<a name="1004015"> </a>
VERSION:2.1<a name="1004016"> </a>
N:Smith, John;M.;Mr.; Esq.<a name="1004017"> </a>
TEL;WORK;VOICE; MSG:+1 (408) 555-1234<a name="1004018"> </a>
TEL;CELL:+1 (408) 555-4321<a name="1004019"> </a>
TEL;WORK;FAX:+1 (408) 555-9876<a name="1004020"> </a>
ADR;WORK;PARCEL;POSTAL;DOM:Suite 101;1 Central  St.;Any 
Town;NC;28654<a name="1004021"> </a>
END:VCARD<a name="1004022"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004026"> </a>Each line in <a href="PersonalDataInterchange.html#1004014">Listing 3.1</a> is a property definition, with the exception of the next to last line, which is a continuation of the <code>ADR</code> property definition, and begins with white space. Each property definition is delimited by a CR/LF sequence.</p>

<p><a name="1004027"> </a>The <code>BEGIN</code>, <code>VERSION</code>, and <code>END</code> lines are examples of simple property definitions. </p>

<p><a name="1004028"> </a>The <code>N</code> (Name) property has a structured value. The components of the name are separated by semicolons.</p>

<p><a name="1004029"> </a>Each <code>TEL</code> (Telephone) property has parameters that qualify the kind of telephone number that is being specified.</p>

<p><a name="1004030"> </a>The <code>ADR</code> (Address) property has parameters and a structured value.</p>

<div><hr>
  <a name="1004031"> </a> <b>NOTE: </b> The vObject specifications also allow long lines of text to be <b>folded</b>. This means that wherever you can have white space in a property definition, you can insert a CR/LF followed by white space, as shown in the next to last line in <a href="PersonalDataInterchange.html#1004014">Listing 3.1</a> When the vObject reader finds a CR/LF followed by white space, it <b>unfolds</b> the text back into one long line.
<hr>
</div>

<h4 class="hcH4">
  <a name="1004035"> </a>Grouping vObjects
</h4>

<p><a name="1004036"> </a>You can specify multiple vObjects in a single vObject data stream. You can also specify a vObject as the value of a property; for example, you can include a vCard as the value of the <code>ADR</code> property of another vCard. </p>

<h4 class="hcH4">
  <a name="1004038"> </a>Grouping Properties
</h4>

<p><a name="1004039"> </a>You can specify a name for a group of related properties within a vObject. The name is a single character that you use as a prefix to each property in the group.</p>

<p><a name="1004040"> </a>One use of this facility is to group a comment that describes a property with the property to keep the two together. For example, the following creates a group named <code>G</code> that includes a vCard home telephone property with a comment property:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
G.TEL;HOME:+1 (831) 555-1234<a name="1004041"> </a>
G.Note: This is my home office number.<a name="1004042"> </a>
</pre><div class="CodeRule"><hr></div>


<h4 class="hcH4">
  <a name="1004044"> </a>Encodings
</h4>

<p><a name="1004045"> </a>The default encoding for vObject properties is 7-bit. You can override this encoding for individual property values by using the <code>ENCODING</code> parameter. You can specify various encoding values, including <code>BASE64</code>, <code>QUOTED-PRINTABLE</code>, and <code>8-BIT</code>.</p>

<h4 class="hcH4">
  <a name="1004047"> </a>Character Sets
</h4>

<p><a name="1004048"> </a>The default character set for vObject properties is ASCII. You can override the character set for individual property values by using the <code>CHARSET</code> parameter. You can specify any character set that has been registered with the Internet Assigned Numbers Authority (IANA). For example, to specify the Latin/Hebrew encoding, you would use the value <code>ISO-8859-8</code>.</p>

<h4 class="hcH4">
  <a name="1004049"> </a>Finding More Information
</h4>

<p><a name="1004050"> </a>For a complete description of the vObject specifications, visit the versit consortium's web site:</p>
<pre class="proto"><a name="1004052"></a><a href="http://www.imc.org/pdi/"></a>http://www.imc.org/pdi/ 


</pre>

<h2 class="haH2">
  <a name="1004055"> </a>About the PDI Library <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1004056"> </a>The Palm OS PDI library is a shared library that provides objects and functions for:</p>
<ul type="disc">
  <li><a name="1004057"> </a>Reading vCard objects from an input data stream. The section <a href="PersonalDataInterchange.html#1004431">Creating a PDI Reader</a> describes how to create and use a PDI reader, and the section <a href="PersonalDataInterchange.html#1004770">Using a PDI Reader - An Example</a> provides an example of reading vCard data from an input stream.
  <li><a name="1004064"> </a>Writing vCard objects to an output data stream. The section <a href="PersonalDataInterchange.html#1004628">Creating a PDI Writer</a> describes how to create and use a PDI reader, and the section <a href="PersonalDataInterchange.html#1004949">Using a PDI Writer - An Example</a> provides an example of reading vCard data from an input stream.
</ul>

<p><a name="1004071"> </a>The PDI library handles reading and writing objects in a number of different formats, and from or to a variety of media. For more information about specifying the media, see <a href="PersonalDataInterchange.html#1004714">"Using UDA for Different Media."</a></p>
<h3 class="hbH3">
  <a name="1004076"> </a>PDI Property and Parameter Types <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004077"> </a>The PDI library provides constants that you can use with the reader and writer objects to specify property information. These include the following types of constants that specify vObject standard entities:</p>
<ul type="disc">
  <li><a name="1004078"> </a>The <b>Property Name</b> constants represent the PDI property names. Each of the property name constants starts with the <code>kPdiPRN_</code> prefix. For example, the <code>kPdiPRN_ADR</code> constant represents the <code>ADR</code> property name. For more information, see the section <a href="../PalmOSReference/PDILib.html#1105513">Property Name Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
  <li><a name="1004089"> </a>The <b>Property Value Field</b> constants represent the position of property value fields for properties with structured field values. Each of the property value field constants starts with the <code>kPdiPVF_</code> prefix. For example, the <code>kPdiPVF_ADR_COUNTRY</code> constant represents the <code>COUNTRY</code> field of an <code>ADR</code> property value. For more information, see the section <a href="../PalmOSReference/PDILib.html#1105630">Property Value Field Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
  <li><a name="1004100"> </a>The <b>Parameter Name</b> constants represent the names of vObject property parameters. Each of the parameter name constants starts with the <code>kPdiPAN_</code> prefix. For example, the <code>kPdiPAN_Type</code> constant represents the <code>TYPE</code> parameter, and the <code>kPdiPAN_Encoding</code> constant represents the <code>ENCODING</code> parameter. For more information, see the section <a href="../PalmOSReference/PDILib.html#1105461">Parameter Name Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
  <li><a name="1004111"> </a>The <b>Parameter Value</b> constants represent the combined name and value of parameters. Each of the parameter value constants starts with the <code>kPdiPAV_</code> prefix. For example, <code>kPdiPAV_ENCODING_BASE64</code> constant represents the <code>Base64</code> encoding. For more information, see the section <a href="../PalmOSReference/PDILib.html#1105485">Parameter Value Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
</ul>

<p><a name="1004122"> </a>For a complete list of all of these constants, see the <code>PdiConst.h</code> file.</p>
<h3 class="hbH3">
  <a name="1004125"> </a>The PDI Library Properties Dictionary <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004126"> </a>The PDI library features a dictionary that stores information about the properties that are considered "well-known." A well-known property is one that is defined in one of the vObject standard specifications, including the vCard and vCal standards. Both of these standards can be found online at the PDI developer's web page:</p>
<pre class="proto"><a name="1004128"></a><a href="http://www.imc.org/pdi/pdiproddev.html"></a>http://www.imc.org/pdi/pdiproddev.html 


</pre>

<p><a name="1004129"> </a>PDI readers and writers use information in the properties dictionary to determine how to read or write a certain property. Specifically, the dictionary stores information about the format of each property value; the reader uses this information to correctly parse the property value, and the writer uses this information to correctly format the written value. This information is important because some property values are structured with multiple fields, while others contain a single value field.</p>

<p><a name="1004130"> </a>For example, the standard address (<code>ADR</code>) property has a structured value with seven required fields, and the fields are separated by semicolons. The dictionary stores this information, and the PDI reader then knows to read seven, semicolon-separated fields when parsing an ADR property.</p>

<p><a name="1004131"> </a>By default, each PDI reader and writer uses a standard dictionary when parsing input and generating output. You can, however, override this behavior to parse or generate the value for a property in some other way. For more information, see <a href="PersonalDataInterchange.html#1004505">"Reading Property Values"</a> and <a href="PersonalDataInterchange.html#1004686">"Writing Property Values."</a></p>

<p><a name="1004138"> </a>You can also amend or replace the dictionary to add parsing and/or generation of customized PDI properties for your application. For more information, see <a href="PersonalDataInterchange.html#1004614">"Adding Custom Extensions."</a></p>
<h3 class="hbH3">
  <a name="1004143"> </a>PDI Readers <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004144"> </a>The PDI library provides the PDI reader object for reading and parsing vObject input. A PDI reader object is a structure that stores the current state of parsing through a PDI input stream. </p>

<p><a name="1004145"> </a>The PDI reader parses the input stream one property at a time, starting with the Begin Object property and finishing with the End Object property. </p>

<p><a name="1004149"> </a>The <a href="../PalmOSReference/PDILib.html#1105033"><code>PdiReaderType</code></a> structure stores a variety of information about the current state of parsing the input stream, including the following information about the current property:</p>
<ul type="disc">
  <li><a name="1004150"> </a>the encoding and character set
  <li><a name="1004151"> </a>the type of the current property, parameter, and property value
  <li><a name="1004152"> </a>the name of the current property and parameter
  <li><a name="1004153"> </a>the current property's value string
  <li><a name="1004154"> </a>a mask of the parsing events encountered for the current property
</ul>

<h4 class="hcH4">
  <a name="1004155"> </a>About Parsing Events
</h4>

<p><a name="1004156"> </a>The PDI reader records each parsing event that it encounters while processing a property. For example, when it parses a <code>BEGIN:VCARD</code> property, the PDI reader records the <code>kPdiBeginObjectEventMask</code>, and when it parses a property name, the PDI reader records the <code>kPdiPropertyNameEventMask</code>.</p>

<p><a name="1004160"> </a>Each event is represented by one of the <a href="../PalmOSReference/PDILib.html#1105801">Reader Event Constants</a>, which are described in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>. The PDI reader records the event by adding (<code>OR'</code>ing) the event constant into the <code>events</code> field of the <a href="../PalmOSReference/PDILib.html#1105033"><code>PdiReaderType</code></a> structure.</p>

<p><a name="1004170"> </a>You can determine if a specific event has occurred while parsing the current property by testing that event's constant against the <code>events</code> field in the reader structure. For example, the following statement returns <code>false</code> if the end of the input stream was reached.</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
return((reader-&gt;events &amp; kPdiEOFEventMask)==0);<a name="1004171"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1004173"> </a>PDI Writers <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004174"> </a>The PDI library provides the PDI writer object for writing vObject output. A PDI writer object is a structure that stores the current state of and manages the generation of PDI data.</p>

<p><a name="1004175"> </a>The PDI writer sends data to the output stream one property at a time, starting with the Begin Object property and finishing with the End Object property. </p>

<p><a name="1004179"> </a>The <a href="../PalmOSReference/PDILib.html#1105152"><code>PdiWriterType</code></a> structure stores information about the current state of writing the output stream, including the following:</p>
<ul type="disc">
  <li><a name="1004180"> </a>the encoding and character set of the current property
  <li><a name="1004181"> </a>the mode used to write the current property value, which specifies how the property value is structured
  <li><a name="1004182"> </a>the number of required fields for the current property value
</ul>
<h3 class="hbH3">
  <a name="1004184"> </a>Format Compatibility <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004185"> </a>The PDI library can read and write data streams in the following formats:</p>
<ul type="disc">
  <li><a name="1004186"> </a>vCard 3.0
  <li><a name="1004187"> </a>vCard 2.1
  <li><a name="1004188"> </a>vCal 1.0
  <li><a name="1004189"> </a>iCalendar
  <li><a name="1004190"> </a>Palm format
</ul>

<p><a name="1004191"> </a>You can use the PDI library to convert an input data stream that uses one format into an output data stream in another format. For more information, see <a href="PersonalDataInterchange.html#1004701">"Specifying PDI Versions."</a></p>

<h4 class="hcH4">
  <a name="1004195"> </a>Compatibility with Earlier Versions of the Palm OS
</h4>

<p><a name="1004196"> </a>The PDI library has been designed to maintain compatibility with earlier versions of the Palm OS, which means that you can use the library functions to receive vObjects from or send vObjects to devices that use those earlier versions. </p>

<p><a name="1004197"> </a>To take advantage of this compatibility, the PDI library has been built to send or receive data in different formats, one of which is the format supported by earlier versions of the Palm OS that included the <code>ImcUtils</code> implementation.</p>

<p><a name="1004198"> </a>To include support for this compatibility in a PDI Reader, specify the <code>kPdiOpenParser</code> constant in your call to the <a href="../PalmOSReference/PDILib.html#1106259"><code>PdiReaderNew</code></a> function.</p>

<p><a name="1004202"> </a>To include support for this compatibility in a PDI Writer, specify the <span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPalmCompatibility</span> option when calling the <a href="../PalmOSReference/PDILib.html#1107130"><code>PdiWriterNew</code></a> function. </p>
<h3 class="hbH3">
  <a name="1004207"> </a>International Considerations <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004208"> </a>The PDI library handles various character sets, including Katakana. If you specify the <code>CHARSET</code> parameter in the input stream, the PDI reader will correctly read the property value.</p>

<p><a name="1004209"> </a>The PDI library included with version 4.0 of the Palm OS<sup>&#174;</sup> understands the following character sets:</p>
<ul type="disc">
  <li><a name="1004210"> </a><code>charEncodingAscii</code>
  <li><a name="1004211"> </a><code>charEncodingISO8859_1</code>
  <li><a name="1004212"> </a><code>charEncodingShiftJIS</code>
  <li><a name="1004213"> </a><code>charEncodingISO2022Jp</code>
</ul>

<p><a name="1004214"> </a>If you specify an unknown character set, the current character set becomes unknown, as represented by the <code>charEncodingUnknown</code> constant.</p>
<h3 class="hbH3">
  <a name="1004215"> </a>Features Not Yet Supported <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004216"> </a>The PDI library included with version 4.0 of the Palm OS does not handle the following features:</p>
<ul type="disc">
  <li><a name="1004217"> </a>Multi-part MIME messages are not handled.
  <li><a name="1004218"> </a>The XML version of vObjects is not supported.
  <li><a name="1004219"> </a>Applications ignore grouping. The PDI reader parses group identifiers, but ignores them. However, the name of the group most recently parsed is stored in the <code>groupName</code> field of the <a href="../PalmOSReference/PDILib.html#1105033"><code>PdiReaderType</code></a> object.
</ul>

<h2 class="haH2">
  <a name="1004227"> </a>Using the PDI Library <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1004228"> </a>This section describes how to use the functions in the PDI library to read or write PDI content. <a href="PersonalDataInterchange.html#1009801">Figure 3.1</a> shows the typical sequences of calls that you make to read or write vObjects.</p>

<p><a name="1004232"> </a>To read vObjects, you need to:</p>
<ul type="disc">
  <li><a name="1004233"> </a>access the PDI library
  <li><a name="1004234"> </a>create a PDI reader
  <li><a name="1004235"> </a>read each property in the input stream:
  <ul type="disc">
    <li><a name="1004236"> </a>read the property name
    <li><a name="1004237"> </a>read any parameters for the property
    <li><a name="1004238"> </a>read the property value
  </ul>
  <li><a name="1004239"> </a>delete the PDI reader
  <li><a name="1004240"> </a>unload the PDI library
</ul>

<p><a name="1004241"> </a>To write vObjects, you need to:</p>
<ul type="disc">
  <li><a name="1004242"> </a>access the PDI library
  <li><a name="1004243"> </a>create a PDI writer
  <li><a name="1004244"> </a>write each property in the input stream:
  <ul type="disc">
    <li><a name="1004245"> </a>write the property name
    <li><a name="1004246"> </a>write any parameters for the property
    <li><a name="1004247"> </a>write the property value
  </ul>
  <li><a name="1004248"> </a>delete the PDI writer
  <li><a name="1004249"> </a>unload the PDI library
</ul>

<p><a name="1004250"> </a>The remainder of this section describes the following operations:</p>
<ul type="disc">
  <li><a name="1004254"> </a><a href="PersonalDataInterchange.html#1009807">Accessing the PDI Library</a>
  <li><a name="1004258"> </a><a href="PersonalDataInterchange.html#1004411">Unloading the PDI Library</a>
  <li><a name="1004262"> </a><a href="PersonalDataInterchange.html#1004431">Creating a PDI Reader</a>
  <li><a name="1004266"> </a><a href="PersonalDataInterchange.html#1004463">Reading Properties</a>
  <li><a name="1004270"> </a><a href="PersonalDataInterchange.html#1004628">Creating a PDI Writer</a>
  <li><a name="1004274"> </a><a href="PersonalDataInterchange.html#1004686">Writing Property Values</a>
  <li><a name="1004278"> </a><a href="PersonalDataInterchange.html#1004701">Specifying PDI Versions</a>
  <li><a name="1004282"> </a><a href="PersonalDataInterchange.html#1004714">Using UDA for Different Media</a>
</ul>

<p><a name="1004286"> </a>The section <a href="PersonalDataInterchange.html#1004770">"Using a PDI Reader - An Example"</a> provides a detailed example of creating a PDI Reader and using it to import vCard data into a database.</p>

<p><a name="1004290"> </a>The section <a href="PersonalDataInterchange.html#1004949">"Using a PDI Writer - An Example"</a> provides a detailed example of creating a PDI Writer and using it to export data from a database in vCal format.</p>

<p class="FFigureCaption">
  <a name="1009801"> </a><b>Figure 3.1&nbsp;&nbsp;Using the PDI library<div align="left"><img src="images/PDILibrary.gif" border="0" hspace="0" vspace="0">
</div></b>
</p>

<h3 class="hbH3">
  <a name="1009807"> </a>Accessing the PDI Library <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004372"> </a>Before you can use the PDI library, you must load the library and obtain a reference number for it. Each of the functions in the library requires a reference number argument, which is used with the system code to access a shared library.</p>

<p><a name="1004375"> </a>The example function <code>LoadPdiLibrary</code>, which is shown in <a href="PersonalDataInterchange.html#1004378">Listing 3.2</a>, makes sure that the PDI library is loaded and returns a reference number for it.</p>
<p class="CCodeCaption">
  <a name="1004378"> </a><b>Listing 3.2&nbsp;&nbsp;Loading the PDI library</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
Static Err LoadPdiLibrary(UInt16 *libRefNum)<a name="1004379"> </a>
{<a name="1004380"> </a>
   Err   error<a name="1004381"> </a>
 <a name="1004382"> </a>
   error = SysLibFind(kPdiLibName, librefNum);<a name="1004383"> </a>
   if (error != 0)<a name="1004384"> </a>
   {<a name="1004385"> </a>
      error = SysLibLoad(sysResTLibrary,
                               sysFileCPdiLib, libRefNum);<a name="1004386"> </a>
   }<a name="1004387"> </a>
   if (error)<a name="1004388"> </a>
   {<a name="1004389"> </a>
      ErrNonFatalDisplay(kPdiLibName "not found")<a name="1004390"> </a>
      return error;<a name="1004391"> </a>
   }<a name="1004392"> </a>
   error = PdiLibOpen(*libRefNum);<a name="1004393"> </a>
   return error;<a name="1004394"> </a>
}<a name="1004395"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004399"> </a>The <code>LoadPdiLibrary</code> function first calls the <a href="../PalmOSReference/SystemManager.html#1076670"><code>SysLibFind</code></a> function to determine if the library has already been loaded, which might be the case if your code has been called by another application that has already loaded the library. Note that the call to <code>SysLibFind</code> uses the <code>kPdiLibName</code> constant, which is defined as follows in the <code>PdiLib.h</code> file:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define kPdiLibName "Pdi.lib"<a name="1004400"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004401"> </a>If the library has not already been loaded, <code>LoadPdiLibrary</code> calls the <a href="../PalmOSReference/SystemManager.html#1076720"><code>SysLibLoad</code></a> function to load the library and obtain a reference number for it.</p>

<p><a name="1004405"> </a>After obtaining a reference number for the library, <code>LoadPdiLibrary</code> calls the <a href="../PalmOSReference/PDILib.html#1106163"><code>PdiLibOpen</code></a> function to open the loaded library.</p>
<h3 class="hbH3">
  <a name="1004411"> </a>Unloading the PDI Library <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004412"> </a>When you are done with the library, you should unload it. The example function <code>UnloadPdiLibrary</code>, which is shown in <a href="PersonalDataInterchange.html#1004378">Listing 3.2</a>, unloads the PDI library.</p>
<p class="CCodeCaption">
  <a name="1004416"> </a><b>Listing 3.3&nbsp;&nbsp;Unloading the PDI library</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void UnloadPdiLibrary(UInt16 refNum)<a name="1004417"> </a>
{<a name="1004418"> </a>
   if (PdiLibClose(refNum) == 0)<a name="1004419"> </a>
   {<a name="1004420"> </a>
      SysLibRemove(refNum);<a name="1004421"> </a>
   }<a name="1004422"> </a>
}<a name="1004423"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004424"> </a>Note that the library reference number becomes invalid after you call the <a href="../PalmOSReference/SystemManager.html#1076754"><code>SysLibRemove</code></a> function.</p>
<h3 class="hbH3">
  <a name="1004431"> </a>Creating a PDI Reader <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004432"> </a>To create a PDI reader, you need to first access the library, and then call the <a href="../PalmOSReference/PDILib.html#1106259"><code>PdiReaderNew</code></a> function, which is declared as follows:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
PdiReaderType* PdiReaderNew(UInt16 libRefnum,
UDAReader *input, UInt16 optionFlags)<a name="1004437"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004438"> </a>The <code>PdiReaderNew</code> parameters are:</p>
<ul type="disc">
  <li><a name="1004441"> </a>The library reference number, as described in <a href="PersonalDataInterchange.html#1009807">"Accessing the PDI Library."</a>
  <li><a name="1004443"> </a>The Unified Data Access (UDA) input stream to use with the reader. The UDA Manager allows you to read input from various sources, including strings and the Exchange Manager. For more information, see <a href="PersonalDataInterchange.html#1004714">"Using UDA for Different Media."</a>
  <li><a name="1004447"> </a>Option flags that control the parsing behavior of the reader, including its default encoding and compatibility settings. The option flags are described in <a href="../PalmOSReference/PDILib.html#1105732">Reader and Writer Options Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
</ul>

<p><a name="1004457"> </a>Once you have created the reader, you can use it to parse properties from the input stream. The section <a href="PersonalDataInterchange.html#1004770">"Using a PDI Reader - An Example"</a> provides an example of creating and using a PDI reader.</p>
<h3 class="hbH3">
  <a name="1004463"> </a>Reading Properties <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004464"> </a>To read PDI property data with a PDI reader, you need to call the data reading functions:</p>
<ul type="disc">
  <li><a name="1004469"> </a><a href="../PalmOSReference/PDILib.html#1106341"><code>PdiReadProperty</code></a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>reads a property and all of its parameters from the input stream.
  <li><a name="1004474"> </a><a href="../PalmOSReference/PDILib.html#1106479"><code>PdiReadPropertyName</code></a> reads just the name of the next property from the input stream. You can call this function if you want to then handle the reading of the property's parameters individually.
  <li><a name="1004479"> </a><a href="../PalmOSReference/PDILib.html#1106300"><code>PdiReadParameter</code></a> reads a single parameter and its value from the input stream.
  <li><a name="1004484"> </a><a href="../PalmOSReference/PDILib.html#1106405"><code>PdiReadPropertyField</code></a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>reads a property value field. A property value can a simple value, or it can be structured to contain multiple fields that are separated by commas or semicolons, as described in <a href="PersonalDataInterchange.html#1004505">"Reading Property Values."</a>
</ul>

<p><a name="1004488"> </a>The most common way to read input data is to follow these steps:</p>
<ul type="disc">
  <li><a name="1004489"> </a>Call <code>PdiReadProperty</code> to read the vObject Begin property. For example, if you are reading vCards, you can call <code>PdiReadProperty</code> until it reads the <span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPRN_BEGIN_VCARD </span>property from the input stream.
  <li><a name="1004490"> </a>Once you have found the beginning of the object, repeatedly call <code>PdiReadProperty</code> to read the next property and its parameters. 
  <li><a name="1004491"> </a>For each property, call the <code>PdiReadPropertyField</code> function as required to read the fields of the property.
  <li><a name="1004492"> </a>Continue reading properties until you read the vObject End property. For vCards, you process properties until <code>PdiReadProperty</code> reads the <code>kPdiPRN_END_VCARD</code> property from the input stream.
</ul>

<h4 class="hcH4">
  <a name="1004493"> </a>Examining Property Information
</h4>

<p><a name="1004494"> </a>After calling a property-reading function, you can access fields of the <code>PdiReaderType</code> object to determine information about the current property. The current property is the one that is currently being parsed, or which has just been parsed. </p>

<p><a name="1004495"> </a>For example, you can examine the <code>property</code> field of the <a href="../PalmOSReference/PDILib.html#1105033"><code>PdiReaderType</code></a> object to determine which type of property has just been read, or you can call the <a href="../PalmOSReference/PDILib.html#1106190"><code>PdiParameterPairTest</code></a> macro to determine if a certain parameter pair was present in the property definition.</p>
<h3 class="hbH3">
  <a name="1004505"> </a>Reading Property Values <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004506"> </a>Some properties have simple values and others have structured values. A structured property value has multiple fields that are separated by commas or semicolons. </p>

<p><a name="1004507"> </a>For example, the following phone property definition has a simple value:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
TEL;CELL:+1 (408) 555-4321<a name="1004508"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004509"> </a>Note that the phone property contains a semicolon to separate the <code>CELL</code> parameter from the property name. Each property's value follows the colon in the definition.</p>

<p><a name="1004510"> </a>The following name property definition has a structured value that contains four fields separated by semicolons:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
N:Smith; John;M.;Mr.; Esq.<a name="1004511"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004515"> </a>You must pass a parameter to the <a href="../PalmOSReference/PDILib.html#1106405"><code>PdiReadPropertyField</code></a> function to tell it how to process a property value. To specify how the field is formatted, use one of the <a href="../PalmOSReference/PDILib.html#1105654">Property Value Format Constants</a> described in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

<p><a name="1004525"> </a>You can specify <code>kPdiDefaultFields</code> to allow the PDI reader to determine the property value format. The reader looks up the property name in the dictionary to determine its format.</p>
<ul type="disc">
  <li><a name="1004526"> </a>Specify <code>kPdiNoFields</code> to have the reader parse the entire value in one operation.
  <li><a name="1004527"> </a>Specify <code>kPdiCommaFields</code> or <code>kPdiSemicolonFields</code> to have the reader parse a single field from the value.
  <li><a name="1004528"> </a>Specify <code>kPdiConvertComma</code> or <code>kPdiConvertSemicolon</code> to have the reader parse all of the fields in a value into a single value.
</ul>

<p><a name="1004529"> </a>You can usually specify <code>kPdiDefaultFields</code> and allow the PDI Reader to use the information in the dictionary to properly parse the value. However, this might not always meet your needs, especially if your input stream contains custom properties.</p>

<p><a name="1004533"> </a><a href="PersonalDataInterchange.html#1004539">Table 3.1</a> shows the results of using the different format constants to read the same property from the input stream. The example property is a standard address (<code>ADR</code>) property that has a structured value with seven, semicolon-delimited fields:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
ADR:postoffice;extended;street;locale;region;postal_code;country<a name="1004534"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004535"> </a>Note that since the <code>ADR</code> property is defined in the vCard standard as a structured value with seven, semicolon-delimited field, the PDI library dictionary defines its default format as <code>kPdiSemicolon</code>.</p>

<p class="caption"><a name="1004539"> </a><b>Table 3.1&nbsp;&nbsp;Parsing a structured value with different value format types </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1004546"> </a><b>Value format type</b></p>
    </th>
    <th><p class="tt"><a name="1004552"> </a><b>Description of <a href="../PalmOSReference/PDILib.html#1106405"><code>PdiReadPropertyField</code></a> results</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1004554"> </a><code>kPdiNoFields</code></p>
    </td>
    <td><p class="tt"><a name="1004556"> </a>One call returns the entire value as a string:</p>
<p class="tt"><a name="1004557"> </a>"postoffice;extended;street;locale;region;postal_code;country"</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1004559"> </a><code>kPdiSemicolon</code></p>
    </td>
    <td><p class="tt"><a name="1004561"> </a>Each call returns a single, semicolon-delimited field from the value. For example:</p>

  <a name="1004562"> </a><div class="BTBulletTable">&#8226; the first call returns "postoffice"</div>
  <a name="1004563"> </a><div class="BTBulletTable">&#8226; the second call returns "extended"</div>
  <a name="1004564"> </a><div class="BTBulletTable">&#8226; the third call returns "street"</div>    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1004566"> </a><code>kPdiComma</code></p>
    </td>
    <td><p class="tt"><a name="1004568"> </a>Each call returns a single, comma-delimited field from the value. For example, if the input string is "postoffice,extended,street," then:</p>

  <a name="1004569"> </a><div class="BTBulletTable">&#8226; the first call returns "postoffice"</div>
  <a name="1004570"> </a><div class="BTBulletTable">&#8226; the second call returns "extended"</div>
  <a name="1004571"> </a><div class="BTBulletTable">&#8226; the third call returns "street"</div>    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1004573"> </a><code>kPdiConvertSemicolon</code></p>
    </td>
    <td><p class="tt"><a name="1004575"> </a>One call returns the entire value as a string that has newline characters wherever a semicolon appeared in the input:</p>
<p class="tt"><a name="1004576"> </a>"postoffice<br>extended<br>street<br>locale<br>region<br>postal_code<br>country"</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1004578"> </a><code>kPdiConvertComma</code></p>
    </td>
    <td><p class="tt"><a name="1004580"> </a>One call returns the entire value as a string that has newline characters wherever a comma appeared in the input:</p>
<p class="tt"><a name="1004581"> </a>"postoffice<br>extended<br>street<br>locale<br>region<br>postal_code<br>country"</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1004583"> </a><code>kPdiDefaultFields</code></p>
    </td>
    <td><p class="tt"><a name="1004585"> </a>Same as <code>kPdiSemicolon</code>, because the PDI library dictionary defines the property value format of the <code>ADR</code> field as <code>kPdiSemicolon</code>.</p>
    </td>
  </tr>
</table>

</div>


<h4 class="hcH4">
  <a name="1004587"> </a>Reading Value Fields One At a Time
</h4>

<p><a name="1004588"> </a>If you are reading the fields in a structured value one at a time, and you don't know the exact number of fields, you can call <a href="../PalmOSReference/PDILib.html#1106405"><code>PdiReadPropertyField</code></a> repeatedly until it returns a nonzero result. </p>

<p><a name="1004593"> </a>For example, the following code segment from the <code>DateTransfer.c</code> program parses each field of the <code>EXDATE</code> property value fields:</p>
<p class="CCodeCaption">
  <a name="1004594"> </a><b>Listing 3.4&nbsp;&nbsp;Reading an undetermined number of value fields</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
while (PdiReadPropertyField(pdiRefNum, reader, &amp;tempP,
                         kPdiResizableBuffer, kPdiSemicolonFields) == 0)<a name="1004595"> </a>
   {<a name="1004596"> </a>
               // Resize handle to hold exception<a name="1004597"> </a>
      err = MemHandleResize(exceptionListH,
sizeof(ExceptionsListType) + sizeof(DateType) * exceptionCount);<a name="1004598"> </a>
      ErrFatalDisplayIf(err != 0, "Memory full");<a name="1004599"> </a>
              // Lock exception handle<a name="1004600"> </a>
      exceptionListP = MemHandleLock(exceptionListH);<a name="1004601"> </a>
              // Calc exception ptr<a name="1004602"> </a>
      exceptionP = (DateType*)((UInt32)exceptionListP
                         + (UInt32)sizeof(UInt16)<a name="1004603"> </a>
                         + (UInt32)(sizeof(DateType) * exceptionCount));<a name="1004604"> </a>
               // Store exception into exception handle<a name="1004605"> </a>
      MatchDateTimeToken(tempP, exceptionP, NULL);<a name="1004606"> </a>
               // Increase exception count<a name="1004607"> </a>
      exceptionCount++;<a name="1004608"> </a>
               // Unlock exceptions list handle<a name="1004609"> </a>
      MemHandleUnlock(exceptionListH);<a name="1004610"> </a>
   }<a name="1004611"> </a>
</pre><div class="CodeRule"><hr></div>


<div><hr>
  <a name="1004612"> </a> <b>NOTE: </b> If you leave fields in a structured value unread, the next call to <code>PdiReadProperty</code> will skip over them and correctly find the beginning of the next property.
<hr>
</div>

<h4 class="hcH4">
  <a name="1004614"> </a>Adding Custom Extensions
</h4>

<p><a name="1004615"> </a>The vObject standards are extensible, which means that you can add custom properties to vCards and other vObjects. The PDI library handles these custom properties; however, you must either add an entry to the library's dictionary for each custom property, or specify a constant other than <code>kPdiDefaultFields</code> when parsing the property's value.</p>

<p><a name="1004616"> </a>Each PDI reader object and each PDI writer object can have a custom dictionary associated with it. You can configure the custom dictionary to amend or to replace the standard, built-in dictionary.</p>

<p><a name="1004617"> </a>To associate a custom dictionary with a reader or writer, you need to first create the dictionary with the You can then call the <a href="../PalmOSReference/PDILib.html#1106004"><code>PdiDefineReaderDictionary</code></a> function to associate that dictionary with a reader object or call the <a href="../PalmOSReference/PDILib.html#1106068"><code>PdiDefineWriterDictionary</code></a> function to associate the dictionary with a writer object.</p>

<div><hr>
  <a name="1004624"> </a> <b>NOTE: </b> For more information about the dictionary tool at <a href="http://www.palmos.com/dev/tech/kb/">http://www.palmos.com/dev/tech/kb</a>.
<hr>
</div>
<h3 class="hbH3">
  <a name="1004628"> </a>Creating a PDI Writer <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004629"> </a>To create a PDI writer, you need to first access the library, and then call the <a href="../PalmOSReference/PDILib.html#1107130"><code>PdiWriterNew</code></a> function, which is declared as follows:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
PdiWriterType* PdiWriterNew(UInt16 libRefnum,
UDAWriter *output, UInt8 optionFlags)<a name="1004633"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004634"> </a>The <code>PdiWriterNew</code> parameters are:</p>
<ul type="disc">
  <li><a name="1004637"> </a>The library reference number, as described in <a href="PersonalDataInterchange.html#1009807">"Accessing the PDI Library."</a>.
  <li><a name="1004639"> </a>The UDA output stream to use with the writer. For more information, see <a href="PersonalDataInterchange.html#1004714">"Using UDA for Different Media."</a>
  <li><a name="1004643"> </a>Option flags that control the output generation behavior of the writer, including its default encoding and compatibility settings. The option flags are described in <a href="../PalmOSReference/PDILib.html#1105732">Reader and Writer Options Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
</ul>

<p><a name="1004653"> </a>Once you have created the writer, you can use it to generate properties to the output stream. The section <a href="PersonalDataInterchange.html#1004949">"Using a PDI Writer - An Example"</a> provides an example of creating and using a PDI writer.</p>
<h3 class="hbH3">
  <a name="1004658"> </a>Writing Properties <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004659"> </a>To write PDI data with a PDI writer, you need to call the data writing functions. The most commonly used functions are:</p>
<ul type="disc">
  <li><a name="1004664"> </a><a href="../PalmOSReference/PDILib.html#1106601"><code>PdiWriteBeginObject</code></a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a vObject Begin tag to the output stream.
  <li><a name="1004669"> </a><a href="../PalmOSReference/PDILib.html#1106649"><code>PdiWriteEndObject</code></a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a vObject End tag to the output stream.
  <li><a name="1004674"> </a><a href="../PalmOSReference/PDILib.html#1106831"><code>PdiWriteProperty</code></a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a property to the output stream.
  <li><a name="1004679"> </a><a href="../PalmOSReference/PDILib.html#1107050"><code>PdiWritePropertyValue</code></a><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a property value to the output stream.
</ul>

<p><a name="1004680"> </a>The most common way to write output data is to follow these steps:</p>
<ul type="disc">
  <li><a name="1004681"> </a>Call <code>PdiWriteBeginObject</code> to write the vObject Begin property. For example, if you are writing vCards, you call <code>PdiWriteBeginObject</code> to write the <span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPRN_BEGIN_VCARD </span>property to the output stream.
  <li><a name="1004682"> </a>For each property that you want to write, call <code>PdiWriteProperty</code> to write the next property and its parameters, and then call the <code>PdiWritePropertyValue</code> function to write the property's value. 
  <li><a name="1004683"> </a>Call <code>PdiWriteEndObject</code> to write the vObject End property. For example, if you are writing vCards, you call <code>PdiWriteEndObject</code> to write the <span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPRN_END_VCARD </span>property to the output stream.
</ul>
<h3 class="hbH3">
  <a name="1004686"> </a>Writing Property Values <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004690"> </a>In many cases, you can simply call the <a href="../PalmOSReference/PDILib.html#1107050"><code>PdiWritePropertyValue</code></a> function to write a value to the output stream. If a value contains a variable number of fields, you can instead use the <a href="../PalmOSReference/PDILib.html#1106943"><code>PdiWritePropertyFields</code></a> to write the fields from an array. Or you can use the <a href="../PalmOSReference/PDILib.html#1106990"><code>PdiWritePropertyStr</code></a> to write multiple fields separated by commas or semicolons.</p>
<h3 class="hbH3">
  <a name="1004701"> </a>Specifying PDI Versions <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004702"> </a>The PDI library options constants control how the PDI reader and PDI writer operate. These options are described in <a href="../PalmOSReference/PDILib.html#1105732">Reader and Writer Options Constants</a> in <a href="../PalmOSReference/PDILib.html#1104998">Chapter 88, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

<h2 class="haH2">
  <a name="1004714"> </a>Using UDA for Different Media <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1004715"> </a>The PDI reader and writer objects use Unified Data Access (UDA) Manager objects for reading from and writing to a variety of media. The UDA data types, constants, and functions are documented in <a href="../PalmOSReference/UDAMgr.html#1116357">Chapter 89, "Unified Data Access Manager,"</a> in <i>Palm OS Programmer's API Reference</i>. This section provides an overview of using UDA objects with the PDI library.</p>
<h3 class="hbH3">
  <a name="1004722"> </a>About the UDA Library <a href="#1003927"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004723"> </a>The UDA Manager provides an abstract layer for reading, filtering, and writing data to and from different media. The UDA Manager provides three general purpose object types:</p>
<ul type="disc">
  <li><a name="1004727"> </a><a href="../PalmOSReference/UDAMgr.html#1116501"><code>UDAReaderType</code></a> objects (UDA Readers) read data from an input stream. 
  <li><a name="1004731"> </a><a href="../PalmOSReference/UDAMgr.html#1116446"><code>UDAFilterType</code></a> objects (UDA Filters) take input from UDA Readers or UDA Filters, perform some encoding or decoding operations, and output the data to a memory buffer.
  <li><a name="1004735"> </a><a href="../PalmOSReference/UDAMgr.html#1116545"><code>UDAWriterType</code></a> objects (UDA Writers) write data to a filter or an output stream.
</ul>

<p><a name="1004736"> </a>The UDA Manager provides general purpose functions for creating these object types. In addition, the UDA Manager provides built-in object types for working with memory buffers and the Exchange Manager.</p>

<div><hr>
  <a name="1004737"> </a> <b>NOTE: </b> The implementation of the UDA Manager in version 4.0 of the Palm OS does not provide built-in filter objects. These objects are planned for future versions.
<hr>
</div>

<h4 class="hcH4">
  <a name="1004738"> </a>Interfacing with the Exchange Manager
</h4>

<p><a name="1004739"> </a>The UDA Manager provides two functions for interfacing with the Exchange Manager:</p>
<ul type="disc">
  <li><a name="1004743"> </a>The <a href="../PalmOSReference/UDAMgr.html#1117044"><code>UDAExchangeReaderNew</code></a> function creates a UDA Reader object that reads data from an Exchange Manager socket. 
  <li><a name="1004747"> </a>The <a href="../PalmOSReference/UDAMgr.html#1117080"><code>UDAExchangeWriterNew</code></a> function creates a UDA Writer object that writes data to an Exchange Manager socket.
</ul>

<p><a name="1004750"> </a>The Exchange Manager, which is described in <a href="ExchangeManagerConcept.html#995795">Chapter 1, "Object Exchange,"</a> provides a mechanism for reading typed data in a transport-independent manner. </p>

<p><a name="1004752"> </a>When you use the UDA interface to the Exchange Manager, you add the benefits of a simple, uniform way to read and write data in a transport-independent manner. This allows you to create PDI readers and writers that can work on data that is stored on a variety of media types. </p>

<p><a name="1004753"> </a>If you wish to parse PDI objects from memory, you can use an object created by the <a href="../PalmOSReference/UDAMgr.html#1117115"><code>UDAMemoryReaderNew</code></a> function instead of an Exchange Manager reader object.</p>

<p><a name="1004757"> </a>The PDI Reader example in the next section reads its data from an Exchange Manger socket, using the <a href="../PalmOSReference/UDAMgr.html#1117044"><code>UDAExchangeReaderNew</code></a> function to create the reader object.</p>

<p><a name="1004763"> </a>The PDI Writer example in <a href="PersonalDataInterchange.html#1004949">"Using a PDI Writer - An Example"</a> writes its data to an Exchange Manager socket, using the <a href="../PalmOSReference/UDAMgr.html#1117080"><code>UDAExchangeWriterNew</code></a> function to create the writer object.</p>

<h2 class="haH2">
  <a name="1004770"> </a>Using a PDI Reader - An Example <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1004771"> </a>This section provides an example of reading PDI data from an input stream and storing it in a database. This example is from the <code>AddressTransfer.c </code>file, which is located inside of the <code>Examples/Address/Src</code> folder.</p>

<p><a name="1004775"> </a><a href="PersonalDataInterchange.html#1004804">Listing 3.5</a> shows the <code>TransferReceiveData</code> function from the <code>AddressTransfer.c</code> sample program. This function controls the reading of vCard data into the address database by performing the following operations:</p>
<ul type="disc">
  <li><a name="1004779"> </a>Calls the <a href="../PalmOSReference/ExchangeManager.html#1055291"><code>ExgAccept</code></a> function to accept a connection from a remote device.
  <li><a name="1004780"> </a>Calls a local function, <code>PrvTransferPdiLoadLibrary</code>, to load an open the PDI library. The <code>PrvTransferPdiLoadLibrary</code> function is almost exactly the same as the <code>LoadPdiLibrary</code> function shown in <a href="PersonalDataInterchange.html#1004378">Listing 3.2</a>.
  <li><a name="1004787"> </a>Calls the <a href="../PalmOSReference/UDAMgr.html#1117044"><code>UDAExchangeReaderNew</code></a> function to create an input data stream for connection with the Exchange Manager.
  <li><a name="1004792"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106259"><code>PdiReaderNew</code></a> function to create a new PDI reader object that reads from the input stream.
  <li><a name="1004793"> </a>Repeatedly calls the local function <code>TransferImportVCard</code> to read vCard data and store it into the address database. This function is described in the next section, <a href="PersonalDataInterchange.html#1004853">Importing vCard Data Into a Database</a>.
  <li><a name="1004800"> </a>Calls the <a href="../PalmOSReference/ExchangeManager.html#1055705"><code>ExgDisconnect</code></a> function to terminate the transfer and close the connection.
  <li><a name="1004801"> </a>Calls the <code>PrvTransferPdiLibUnload</code> function to unload the PDI library.
  <li><a name="1004802"> </a>Deletes the PDI reader and UDA input stream objects.
</ul>
<p class="CCodeCaption">
  <a name="1004804"> </a><b>Listing 3.5&nbsp;&nbsp;Reading a PDI input stream</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
extern Err TransferReceiveData(DmOpenRef dbP, ExgSocketPtr exgSocketP)<a name="1004805"> </a>
{<a name="1004806"> </a>
   volatile Err err;<a name="1004807"> </a>
   UInt16 pdiRefNum = sysInvalidRefNum;<a name="1004808"> </a>
   PdiReaderType* reader = NULL;<a name="1004809"> </a>
   UDAReader* stream = NULL;<a name="1004810"> </a>
   Boolean loaded;<a name="1004811"> </a>
 <a name="1004812"> </a>
   if ((err = ExgAccept(exgSocketP)) != 0)<a name="1004813"> </a>
      return err;<a name="1004814"> </a>
   if ((err = PrvTransferPdiLibLoad(&amp;pdiRefNum, &amp;loaded)))<a name="1004815"> </a>
   {<a name="1004816"> </a>
      pdiRefNum = sysInvalidRefNum;<a name="1004817"> </a>
      goto errorDisconnect;<a name="1004818"> </a>
   }<a name="1004819"> </a>
   if ((stream = UDAExchangeReaderNew(exgSocketP)) == NULL)<a name="1004820"> </a>
   {<a name="1004821"> </a>
      err = exgMemError;<a name="1004822"> </a>
      goto errorDisconnect;<a name="1004823"> </a>
   }<a name="1004824"> </a>
   if ((reader = PdiReaderNew(pdiRefNum, stream, kPdiOpenParser)) == NULL)<a name="1004825"> </a>
   {<a name="1004826"> </a>
      err = exgMemError;<a name="1004827"> </a>
      goto errorDisconnect;<a name="1004828"> </a>
   }<a name="1004829"> </a>
   reader-&gt;appData = exgSocketP;<a name="1004830"> </a>
   ErrTry<a name="1004831"> </a>
   {<a name="1004832"> </a>
      while(TransferImportVCard(dbP, pdiRefNum, reader, false, false)){};<a name="1004833"> </a>
   }<a name="1004834"> </a>
   ErrCatch(inErr)<a name="1004835"> </a>
   {<a name="1004836"> </a>
      err = inErr;<a name="1004837"> </a>
   } ErrEndCatch<a name="1004838"> </a>
   if (err == errNone &amp;&amp; exgSocketP-&gt;goToParams.uniqueID == 0)<a name="1004839"> </a>
      err = exgErrBadData;<a name="1004840"> </a>
errorDisconnect:<a name="1004841"> </a>
   if (reader)<a name="1004842"> </a>
      PdiReaderDelete(pdiRefNum, &amp;reader);<a name="1004843"> </a>
   if (stream)<a name="1004844"> </a>
      UDADelete(stream);<a name="1004845"> </a>
   if (pdiRefNum != sysInvalidRefNum)<a name="1004846"> </a>
      PrvTransferPdiLibUnload(pdiRefNum, loaded);<a name="1004847"> </a>
   ExgDisconnect(exgSocketP, err); // closes transfer dialog<a name="1004848"> </a>
   err = errNone; // error was reported, so don't return it<a name="1004849"> </a>
   return err;<a name="1004850"> </a>
}<a name="1004851"> </a>
</pre><div class="CodeRule"><hr></div>


<h4 class="hcH4">
  <a name="1004853"> </a>Importing vCard Data Into a Database
</h4>

<p><a name="1004854"> </a>The <code>TransferImportVCard</code> function imports a vCard record from an input stream. <a href="PersonalDataInterchange.html#1004860">Listing 3.6</a> shows the basic outline of the <code>TransferImportVCard</code> function; you can review the entire function by viewing the <code>AddressTransfer.c</code> file, which is located inside of the <code>Examples/Address/Src</code> folder.</p>
<p class="CCodeCaption">
  <a name="1004860"> </a><b>Listing 3.6&nbsp;&nbsp;Importing vCard data into a database</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
Boolean TransferImportVCard(DmOpenRef dbP, UInt16 pdiRefNum,
PdiReaderType* reader, Boolean obeyUniqueIDs, Boolean beginAlreadyRead)<a name="1004861"> </a>
{<a name="1004862"> </a>
 <a name="1004863"> </a>
...    // local declarations and initialization code<a name="1004864"> </a>
 <a name="1004865"> </a>
   ErrTry<a name="1004866"> </a>
   {<a name="1004867"> </a>
      phoneField = firstPhoneField;<a name="1004868"> </a>
      if (!beginAlreadyRead)<a name="1004869"> </a>
      {<a name="1004870"> </a>
         PdiReadProperty(pdiRefNum, reader);<a name="1004871"> </a>
         beginAlreadyRead = reader-&gt;property == kPdiPRN_BEGIN_VCARD;<a name="1004872"> </a>
      }<a name="1004873"> </a>
      if (!beginAlreadyRead)<a name="1004874"> </a>
         ErrThrow(exgErrBadData);<a name="1004875"> </a>
      PdiEnterObject(pdiRefNum, reader);<a name="1004876"> </a>
      PdiDefineResizing(pdiRefNum, reader, 16, tableMaxTextItemSize);<a name="1004877"> </a>
      while (PdiReadProperty(pdiRefNum, reader) == 0 
               &amp;&amp; (property = reader-&gt;property) != kPdiPRN_END_VCARD)<a name="1004878"> </a>
      {<a name="1004879"> </a>
         switch(property)<a name="1004880"> </a>
         {<a name="1004881"> </a>
         case kPdiPRN_N:<a name="1004882"> </a>
         PdiReadPropertyField(pdiRefNum, reader,
                        (Char **) &amp;newRecord.fields[name],
                           kPdiResizableBuffer, kPdiDefaultFields);<a name="1004883"> </a>
         PdiReadPropertyField(pdiRefNum, reader,
                        (Char **) &amp;newRecord.fields[firstName],
                           kPdiResizableBuffer, kPdiDefaultFields);<a name="1004884"> </a>
      break;<a name="1004885"> </a>
         case kPdiPRN_NOTE:<a name="1004886"> </a>
            PdiDefineResizing(pdiRefNum, reader, 16,
                           noteViewMaxLength);<a name="1004887"> </a>
            PdiReadPropertyField(pdiRefNum, reader,
                        Char **) &amp;newRecord.fields[note],
                           kPdiResizableBuffer, kPdiNoFields);<a name="1004888"> </a>
            PdiDefineResizing(pdiRefNum, reader, 16,
                           tableMaxTextItemSize);<a name="1004889"> </a>
             break;<a name="1004890"> </a>
 <a name="1004891"> </a>
,,,  // other cases here for other properties<a name="1004892"> </a>
 <a name="1004893"> </a>
      }<a name="1004894"> </a>
      } // end while<a name="1004895"> </a>
                if (newRecord.fields[name] != NULL<a name="1004896"> </a>
         &amp;&amp; newRecord.fields[company] != NULL<a name="1004897"> </a>
         &amp;&amp; newRecord.fields[firstName] != NULL<a name="1004898"> </a>
         &amp;&amp; StrCompare(newRecord.fields[name],
                              newRecord.fields[company]) == 0)<a name="1004899"> </a>
      {     // if company &amp; name fields are identical, assume company only<a name="1004900"> </a>
         MemPtrFree(newRecord.fields[name]);<a name="1004901"> </a>
         newRecord.fields[name] = NULL;<a name="1004902"> </a>
      }<a name="1004903"> </a>
AddRecord:<a name="1004904"> </a>
         err = AddrDBNewRecord(dbP, (AddrDBRecordType*) &amp;newRecord,
                                 &amp;indexNew);<a name="1004905"> </a>
         if (err)<a name="1004906"> </a>
            ErrThrow(exgMemError);<a name="1004907"> </a>
 <a name="1004908"> </a>
   ...      // handle category assignment here<a name="1004909"> </a>
 <a name="1004910"> </a>
   }   //end of ErrTry<a name="1004911"> </a>
   if (error == exgErrBadData)<a name="1004912"> </a>
      return false;<a name="1004913"> </a>
   if (error != errNone)<a name="1004914"> </a>
      ErrThrow(error);<a name="1004915"> </a>
   return ((reader-&gt;events &amp; kPdiEOFEventMask) == 0);<a name="1004916"> </a>
}<a name="1004917"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004918"> </a>The <code>TransferImportVCard</code> function performs the following operations:</p>
<ul type="disc">
  <li><a name="1004922"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106341"><code>PdiReadProperty</code></a> function to read the <code>BEGIN:VCard</code> property from the input stream.
  <li><a name="1004927"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106097"><code>PdiEnterObject</code></a> function to notify the PDI library that it is reading a new object from the input stream.
  <li><a name="1004931"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106033"><code>PdiDefineResizing</code></a> function to set the maximum buffer size for reading properties for the address card.
  <li><a name="1004935"> </a>Repeatedly calls the <a href="../PalmOSReference/PDILib.html#1106341"><code>PdiReadProperty</code></a> function to read properties of the address card. This repeats until <code>PdiReadProperty</code> reads the <code>END:VCard</code> property, which indicates the end of data for the address card.
  <li><a name="1004936"> </a>For each address card property, calls <a href="../PalmOSReference/PDILib.html#1106405"><code>PdiReadPropertyField</code></a> as required to read the values associated with the property. For example, when it reads the <code>kPdiPRN_N</code> name property, <code>AddrImportVCard</code> calls <code>PdiReadPropertyField</code> twice: once to read the last name, and a second time to read the first name.
  <li><a name="1004941"> </a>Creates a new address record and adds it to the Address Book database.
  <li><a name="1004942"> </a>Deallocates memory that it has allocated and performs other cleanup operations.
</ul>

<p><a name="1004946"> </a>Again, note that <a href="PersonalDataInterchange.html#1004860">Listing 3.6</a> only shows the outline of this function. You can find the entire function in the <code>AddressTransfer.c</code> file.</p>

<h2 class="haH2">
  <a name="1004949"> </a>Using a PDI Writer - An Example <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1004950"> </a>This section provides an example of writing PDI data from a database record to an output stream. This example is from the <code>ToDoTransfer.c</code> file, which is located inside of the <code>Examples/ToDo/Src</code> folder.</p>

<p><a name="1004954"> </a><a href="PersonalDataInterchange.html#1004986">Listing 3.7</a> shows an example of creating and using a PDI writer. The <code>ToDoSendRecordTryCatch</code> function controls the writing of data from the To Do database to vCal objects by performing the following operations:</p>
<ul type="disc">
  <li><a name="1004955"> </a>Calls a local function, <code>LoadPdiLibrary</code>, to load and open the PDI library. The <code>LoadPdiLibrary</code> function is shown in <a href="PersonalDataInterchange.html#1004378">Listing 3.2</a>.
  <li><a name="1004962"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1107130"><code>PdiWriterNew</code></a> function to create a new PDI writer object that writes to the UDA output stream specified by the <code>media</code> parameter.
  <li><a name="1004967"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106601"><code>PdiWriteBeginObject</code></a> function to write the <code>BEGIN:VCAL</code> property to the output stream.
  <li><a name="1004971"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106831"><code>PdiWriteProperty</code></a> function to write the <code>VERSION</code> property, and then calls the <a href="../PalmOSReference/PDILib.html#1107050"><code>PdiWritePropertyValue</code></a> function to write the version value.
  <li><a name="1004975"> </a>Calls the <code>ToDoExportVCal</code> function to write the To Do record, as described in the next section, <a href="PersonalDataInterchange.html#1005016">Exporting vCal Data From a Database</a>.
  <li><a name="1004983"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106649"><code>PdiWriteEndObject</code></a> function to write the <code>END:VCAL</code> property to the output stream.
  <li><a name="1004984"> </a>Deletes the PDI writer object and unloads the PDI library.
</ul>
<p class="CCodeCaption">
  <a name="1004986"> </a><b>Listing 3.7&nbsp;&nbsp;Writing a PDI Output Stream</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static Err ToDoSendRecordTryCatch (DmOpenRef dbP,
        Int16 recordNum, ToDoDBRecordPtr recordP, UDAWriter* media)<a name="1004987"> </a>
{<a name="1004988"> </a>
   volatile Err error = 0;<a name="1004989"> </a>
   UInt16 pdiRefNum;<a name="1004990"> </a>
   PdiWriterType* writer;<a name="1004991"> </a>
 <a name="1004992"> </a>
   if ((error = LoadPdiLibrary(&amp;pdiRefNum)))<a name="1004993"> </a>
       return error;<a name="1004994"> </a>
   writer = PdiWriterNew(pdiRefNum, media, kPdiPalmCompatibility);<a name="1004995"> </a>
   if (writer)<a name="1004996"> </a>
      {<a name="1004997"> </a>
ErrTry<a name="1004998"> </a>
      {<a name="1004999"> </a>
         PdiWriteBeginObject(pdiRefNum, writer,
                                                  kPdiPRN_BEGIN_VCALENDAR);<a name="1005000"> </a>
         PdiWriteProperty(pdiRefNum, writer, kPdiPRN_VERSION);<a name="1005001"> </a>
         PdiWritePropertyValue(pdiRefNum, writer, (Char*)"1.0",
                                         kPdiWriteData);<a name="1005002"> </a>
          ToDoExportVCal(dbP, recordNum, recordP, pdiRefNum,
                                 writer, true);<a name="1005003"> </a>
          PdiWriteEndObject(pdiRefNum, writer,
                                                         kPdiPRN_END_VCALENDAR)
;<a name="1005004"> </a>
          }<a name="1005005"> </a>
ErrCatch(inErr)<a name="1005006"> </a>
        {<a name="1005007"> </a>
           error = inErr;<a name="1005008"> </a>
        } ErrEndCatch<a name="1005009"> </a>
         PdiWriterDelete(pdiRefNum, &amp;writer);<a name="1005010"> </a>
       }<a name="1005011"> </a>
   UnloadPdiLibrary(pdiRefNum);<a name="1005012"> </a>
   return error;<a name="1005013"> </a>
}<a name="1005014"> </a>
</pre><div class="CodeRule"><hr></div>


<h4 class="hcH4">
  <a name="1005016"> </a>Exporting vCal Data From a Database
</h4>

<p><a name="1005017"> </a>The <code>ToDoExportVCal</code> function exports a vCal record from the To Do database to an output stream. <a href="PersonalDataInterchange.html#1005022">Listing 3.8</a> shows the basic outline of the <code>ToDoExportVCal</code> function; you can review the entire function by viewing the <code>ToDoTransfer.c</code> file, which is located inside of the <code>Examples/Address/Src</code> folder.</p>
<p class="CCodeCaption">
  <a name="1005022"> </a><b>Listing 3.8&nbsp;&nbsp;Exporting vCal data from a database</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
extern void ToDoExportVCal(DmOpenRef dbP, Int16 index,
ToDoDBRecordPtr recordP, UInt16 pdiRefNum, PdiWriterType* writer,
Boolean writeUniqueIDs)<a name="1005023"> </a>
{<a name="1005024"> </a>
Char *          note;<a name="1005025"> </a>
      UInt32      uid;<a name="1005026"> </a>
      Char        tempString[tempStringLengthMax];<a name="1005027"> </a>
      UInt16      attr;<a name="1005028"> </a>
...<a name="1005029"> </a>
 <a name="1005030"> </a>
   PdiWriteBeginObject(pdiRefNum, writer, kPdiPRN_BEGIN_VTODO);<a name="1005031"> </a>
      // Emit the Category<a name="1005032"> </a>
   PdiWriteProperty(pdiRefNum, writer, kPdiPRN_CATEGORIES);<a name="1005033"> </a>
      // ...code to create the property string (tempString)<a name="1005034"> </a>
   PdiWritePropertyValue(pdiRefNum, writer, tempString, kPdiWriteText);<a name="1005035"> </a>
 <a name="1005036"> </a>
      // Code to emit the record information, including the:<a name="1005037"> </a>
      //   - due date<a name="1005038"> </a>
      //   - completed flag<a name="1005039"> </a>
      //   - priority value<a name="1005040"> </a>
      //   - description text<a name="1005041"> </a>
...<a name="1005042"> </a>
 <a name="1005043"> </a>
 <a name="1005044"> </a>
      // Emit the note<a name="1005045"> </a>
   if (*note != '\0')<a name="1005046"> </a>
   {<a name="1005047"> </a>
      PdiWriteProperty(pdiRefNum, writer, kPdiPRN_ATTACH);<a name="1005048"> </a>
      PdiWritePropertyValue(pdiRefNum, writer, note, kPdiWriteText);<a name="1005049"> </a>
   }<a name="1005050"> </a>
 <a name="1005051"> </a>
      // Emit an unique id<a name="1005052"> </a>
   if (writeUniqueIDs)<a name="1005053"> </a>
   {<a name="1005054"> </a>
      PdiWriteProperty(pdiRefNum, writer, kPdiPRN_UID);<a name="1005055"> </a>
      // Get the record's unique id and append to the string.<a name="1005056"> </a>
      DmRecordInfo(dbP, index, NULL, &amp;uid, NULL);<a name="1005057"> </a>
      StrIToA(tempString, uid);<a name="1005058"> </a>
      PdiWritePropertyValue(pdiRefNum, writer, tempString, kPdiWriteData);<a name="1005059"> </a>
   }<a name="1005060"> </a>
 <a name="1005061"> </a>
   PdiWriteEndObject(pdiRefNum, writer, kPdiPRN_END_VTODO);<a name="1005062"> </a>
}<a name="1005063"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1005064"> </a>The <code>ToDoExportVCal</code> function performs the following operations:</p>
<ul type="disc">
  <li><a name="1005068"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106601"><code>PdiWriteBeginObject</code></a> function to write the <code>BEGIN:VTODO</code> property to the output stream.
  <li><a name="1005072"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106831"><code>PdiWriteProperty</code></a> function to write the category information for the To Do record.
  <li><a name="1005076"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106831"><code>PdiWriteProperty</code></a> function to write other information for the To Do record, including the due date, completed flag, priority value, and description text.
  <li><a name="1005080"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106831"><code>PdiWriteProperty</code></a> function to write the note and again to write a unique ID for the note.
  <li><a name="1005084"> </a>Calls the <a href="../PalmOSReference/PDILib.html#1106649"><code>PdiWriteEndObject</code></a> function to write the <code>END:VTODO</code> property to the output stream.
</ul>

<p><a name="1005088"> </a>Again, note that <a href="PersonalDataInterchange.html#1005022">Listing 3.8</a> only shows the outline of this function. You can find the entire function in the <code>ToDoTransfer.c</code> file.</p>

<h2 class="haH2">
  <a name="1005091"> </a>Summary of Personal Data Interchange <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1005094"> </a><b>PDI Library Functions</b></p>
    </th>
    <th><p class="tt"><a name="1005096"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1005098"> </a><b>Library Open and Close</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005105"> </a><a href="../PalmOSReference/PDILib.html#1106132"><code>PdiLibClose</code></a></p>
    </td>
    <td><p class="tt"><a name="1005110"> </a><a href="../PalmOSReference/PDILib.html#1106163"><code>PdiLibOpen</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1005112"> </a><b>Object Creation and Deletion</b></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005119"> </a><a href="../PalmOSReference/PDILib.html#1106259"><code>PdiReaderNew</code></a><br><a href="../PalmOSReference/PDILib.html#1106227"><code>PdiReaderDelete</code></a></p>
    </td>
    <td><p class="tt"><a name="1005127"> </a><a href="../PalmOSReference/PDILib.html#1107130"><code>PdiWriterNew</code></a><br><a href="../PalmOSReference/PDILib.html#1107098"><code>PdiWriterDelete</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1005132"> </a>Property Reading</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005139"> </a><a href="../PalmOSReference/PDILib.html#1106033"><code>PdiDefineResizing</code></a><br><a href="../PalmOSReference/PDILib.html#1106097"><code>PdiEnterObject</code></a><br><a href="../PalmOSReference/PDILib.html#1106190"><code>PdiParameterPairTest</code></a><br><a href="../PalmOSReference/PDILib.html#1106300"><code>PdiReadParameter</code></a></p>
    </td>
    <td><p class="tt"><a name="1005153"> </a><a href="../PalmOSReference/PDILib.html#1106341"><code>PdiReadProperty</code></a><br><a href="../PalmOSReference/PDILib.html#1106405"><code>PdiReadPropertyField</code></a><br><a href="../PalmOSReference/PDILib.html#1106479"><code>PdiReadPropertyName</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1005161"> </a>Property Writing</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005168"> </a><a href="../PalmOSReference/PDILib.html#1106521"><code>PdiSetCharset</code></a><br><a href="../PalmOSReference/PDILib.html#1106563"><code>PdiSetEncoding</code></a><br><a href="../PalmOSReference/PDILib.html#1106601"><code>PdiWriteBeginObject</code></a><br><a href="../PalmOSReference/PDILib.html#1106649"><code>PdiWriteEndObject</code></a><br><a href="../PalmOSReference/PDILib.html#1106697"><code>PdiWriteParameter</code></a></p>
    </td>
    <td><p class="tt"><a name="1005185"> </a><a href="../PalmOSReference/PDILib.html#1106779"><code>PdiWriteParameterStr</code></a><br><a href="../PalmOSReference/PDILib.html#1106831"><code>PdiWriteProperty</code></a><br><a href="../PalmOSReference/PDILib.html#1106892"><code>PdiWritePropertyBinaryValue</code></a><br><a href="../PalmOSReference/PDILib.html#1106943"><code>PdiWritePropertyFields</code></a><br><a href="../PalmOSReference/PDILib.html#1106990"><code>PdiWritePropertyStr</code></a><br><a href="../PalmOSReference/PDILib.html#1107050"><code>PdiWritePropertyValue</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><p class="tt"><a name="1005202"> </a>Property Dictionary</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005209"> </a><a href="../PalmOSReference/PDILib.html#1106004"><code>PdiDefineReaderDictionary</code></a></p>
    </td>
    <td><p class="tt"><a name="1005214"> </a><a href="../PalmOSReference/PDILib.html#1106068"><code>PdiDefineWriterDictionary</code></a></p>
    </td>
  </tr>
</table>

</div>


<h2 class="haH2">
  <a name="1005216"> </a>Summary of Unified Data Access Manager <a href="#1003927"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th colspan="2" rowspan="1"><p class="tt"><a name="1005219"> </a><b>UDA Manager Functions</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005226"> </a><a href="../PalmOSReference/UDAMgr.html#1116712"><code>UDAControl</code></a><br><a href="../PalmOSReference/UDAMgr.html#1116793"><code>UDADelete</code></a><br><a href="../PalmOSReference/UDAMgr.html#1116830"><code>UDAEndOfReader</code></a><br><a href="../PalmOSReference/UDAMgr.html#1116855"><code>UDAFilterJoin</code></a><br><a href="../PalmOSReference/UDAMgr.html#1116891"><code>UDAInitiateWrite</code></a></p>
    </td>
    <td><p class="tt"><a name="1005243"> </a><a href="../PalmOSReference/UDAMgr.html#1116922"><code>UDAMoreData</code></a><br><a href="../PalmOSReference/UDAMgr.html#1116950"><code>UDARead</code></a><br><a href="../PalmOSReference/UDAMgr.html#1116984"><code>UDAWriterFlush</code></a><br><a href="../PalmOSReference/UDAMgr.html#1117009"><code>UDAWriterJoin</code></a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005254"> </a><b>Object Creation</b></p>
    </td>
    <td><p class="tt"><a name="1005256"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1005261"> </a><a href="../PalmOSReference/UDAMgr.html#1117044"><code>UDAExchangeReaderNew</code></a><br><a href="../PalmOSReference/UDAMgr.html#1117080"><code>UDAExchangeWriterNew</code></a></p>
    </td>
    <td><p class="tt"><a name="1005269"> </a><a href="../PalmOSReference/UDAMgr.html#1117115"><code>UDAMemoryReaderNew</code></a></p>
    </td>
  </tr>
</table>

</div>


<p><a name="1005271"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996-2004, PalmSource, Inc. and its affiliates.  All rights reserved. <br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="Companion2Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="Companion2TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExchangeLibraries.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Beaming.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Companion2IX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>