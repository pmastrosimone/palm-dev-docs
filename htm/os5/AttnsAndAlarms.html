<HTML>

<HEAD>
<SMALLSCREENIGNORE> 
<LINK HREF="copy_of_palmos.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="document.css" REL="StyleSheet" TYPE="text/css" media="screen">
<!-- SCRIPT_START -->
<!-- SCRIPT_END -->
</SMALLSCREENIGNORE>
<TITLE>Attentions and Alarms</TITLE>

<META NAME="PALMTEMPLATE" CONTENT="1006-002 Palm HTML 20020513">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="TEMPLATEBASE" CONTENT="Palm HTML 20010625">
<META NAME="LASTUPDATED" CONTENT="12/13/02 10:05:54">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1">

</HEAD>

<BODY LEFTMARGIN="0" MARGINWIDTH="0" TOPMARGIN="0" MARGINHEIGHT="0">
<SMALLSCREENIGNORE> 
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td><a name="1009989"></a>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr height="35"> 
          <td height="35" colspan="2" bgcolor="#6699CC">&nbsp;</td>
        </tr>
        <tr valign="top"> 
          <td width="160" align="left"><a href="http://www.palmos.com"><img src="images/bigorb.gif" width="160" height="110" border="0"></a></td>
          <td align="left" width="100%"> 
            </SMALLSCREENIGNORE>
            <!-- CONTENTCELL_START -->
            <img border="0" height="45" src="images/orb_bkgrnd_600.gif" width="600"><br>
            <!--PAGENAV_START-->
            <SPAN CLASS="subnav">&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span><BR>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             <h2 class="HeadDocPage">9  Attentions and Alarms</h2>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             &nbsp;<span class="subnav"><a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Text.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SystemFeatures.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a></span>  
            <!--PAGENAV_END-->
          </td>
        </tr>
      </table>
    </td>
			</tr>
  <tr>
				<td> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
							<td>&nbsp;&nbsp;&nbsp;</td>
						</tr>
        <tr>
		<td valign="top" width="10">&nbsp;&nbsp;&nbsp;</td>
		<td valign="top" width="175">
			<p class="SideTitle">Title - <br><a href="Companion_Front.html">Palm OS® Programmer's Companion</a></p>
			<p class="SideTOC1-PartTab">Volume I </p>
			<p class="SideTOC1"><a href="AttnsAndAlarms.html">9  Attentions and Alarms</a></p>
			
<p class="SideTOC2">
<a href="#1010001">Getting the User's Attention
</a></p>

<p class="SideTOC3">
<a href="#1010004">The Role of the Attention Manager
</a></p>

<p class="SideTOC3">
<a href="#1010024">Attention Manager Operation
</a></p>

<p class="SideTOC3">
<a href="#1010100">Getting the User's Attention
</a></p>

<p class="SideTOC3">
<a href="#1010344">Attentions and Alarms
</a></p>

<p class="SideTOC3">
<a href="#1010377">Detecting and Updating Pending Attentions
</a></p>

<p class="SideTOC3">
<a href="#1010434">Detecting Device Capabilities
</a></p>

<p class="SideTOC3">
<a href="#1010521">Controlling the Attention Indicator
</a></p>

<p class="SideTOC2">
<a href="#1010537">Alarms
</a></p>

<p class="SideTOC3">
<a href="#1010559">Setting an Alarm
</a></p>

<p class="SideTOC3">
<a href="#1010623">Alarm Scenario
</a></p>

<p class="SideTOC3">
<a href="#1010669">Setting a Procedure Alarm
</a></p>

<p class="SideTOC2">
<a href="#1010731">Summary of Attentions and Alarms
</a></p>

		</td>

		<td width="5">&nbsp;&nbsp;</td>
		<td width="1" bgcolor="#6699cc">&nbsp;</td>
		<td width="5">&nbsp;&nbsp;</td>
		<td> 

				<!-- CONTENT_START -->

<p class="Body">
  <a name="1009990"> </a>In this chapter you learn how to get the user's attention and how to set real-time alarms that can be used to either perform some periodic activity or display a reminder to the user.
</p>
<p class="Body">
  <a name="1009991"> </a>This chapter is divided into the following broad topics: 
</p>

  <a name="1009995"> </a><p class="B1Bullet"> &#8226; <a href="AttnsAndAlarms.html#1010001">Getting the User's Attention</a> begins with an introduction to the Attention Manager. This is followed by a detailed description of the Attention Manager from a user's perspective. Finally, it details what developers need to do in order to use the Attention Manager in their applications.</p>

  <a name="1009999"> </a><p class="B1Bullet"> &#8226; <a href="AttnsAndAlarms.html#1010537">Alarms</a> covers the Alarm Manager, which can notify your programs when a specified point in time is reached.</p>

<h2 class="HaHeadA">
  <a name="1010001"> </a>Getting the User's Attention 
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010002"> </a>Palm OS<sup>®</sup> 4.0 introduces a standard mechanism that manages competing demands for the user's attention by both applications and drivers. This mechanism is known as the Attention Manager. 
</p>

<h2 class="HBHeadB">
  <a name="1010004"> </a>The Role of the Attention Manager
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010005"> </a>This section provides a brief introduction to the Attention Manager. It covers the relationship between the Attention, Alarm and Notification Managers, and then discusses when it is appropriate to make use of the Attention Manager.
</p>
<p class="Body">
  <a name="1010006"> </a>The Attention Manager provides a standard mechanism by which applications can tell the user that something of significance has occurred. It is designed to support communications devices which can receive data without explicit user interaction. The Attention Manager is responsible only for interacting with the user; it is not responsible for generating those events. In particular, the Alarm Manager can be used in conjunction with the Attention Manager to inform the user that a particular point in time has been reached.
</p>
<p class="Body">
  <a name="1010008"> </a>By maintaining a single list of all "alarm-like" things, the Attention Manager also improves the user's experience when returning to the handheld after being gone for a while: he no longer has to click through a series of old alarm dialogs. Often the user doesn't care about most of the missed appointments-although he might care about a few of them. Without the Attention Manager, the user cannot selectively dismiss or follow up on dialogs.
</p>
<p class="Body">
  <a name="1010009"> </a>Applications have complete control over the types of attention they can ask for. They can query the handheld for the set of special effects available-possibly including sound, vibration, and an LED-and then act on that set. The default option is to beep. All other options are either on or off; different vibrating patterns or multicolored LEDs are currently not supported. Note that the set of special effects is extensible; manufacturers may choose to add other means to get the user's attention beyond the anticipated LED and vibration.
</p>
<div class="NINoteImportant"><hr>
  <a name="1010010"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> The Attention Manager was introduced in Palm OS 4.0. Applications running on earlier versions of the Palm OS need to use the techniques described under <a href="AttnsAndAlarms.html#1010537">"Alarms"</a>. 
<hr>
</div>
<p class="Body">
  <a name="1010014"> </a>In Palm OS 4.0, the Datebook, SMS, and Clock applications use the Attention Manager. Refer to the Datebook application's source code for real-world examples of how you might use the Attention and Alarm Managers.
</p>

<h4 class="HCHeadC">
  <a name="1010015"> </a>Attentions, Alarms and Notifications
</h4>
<p class="Body">
  <a name="1010016"> </a>The Attention, Alarm, and Notification Managers are distinct subsystems that are often used in combination. 
</p>

  <a name="1010017"> </a><p class="B1Bullet"> &#8226; The Attention Manager is designed solely to interact with the user when an event must be brought to the user's attention. </p>

  <a name="1010018"> </a><p class="B1Bullet"> &#8226; The Alarm Manager simply sends an event to an application when a particular point in time is reached. The application can then use the Attention Manager or some other mechanism to bring the alarm to the user's attention, if appropriate.</p>

  <a name="1010019"> </a><p class="B1Bullet"> &#8226; The Notification Manager informs those applications that have registered their interest whenever certain system-level or application-level events occur. If the user is to be informed of the event, the executable can use the Attention Manager. The Attention Manager itself uses the Notification Manager to broadcast notifications when getting the user's attention or nagging him about an existing attention item. </p>

<h4 class="HCHeadC">
  <a name="1010020"> </a>When the Attention Manager Isn't Appropriate
</h4>
<p class="Body">
  <a name="1010021"> </a>The Attention Manager is only designed for attempts to get attention that can be effectively suspended. It is not suitable for anything requiring an immediate response, such as a request to connect to another user or the "put away" dialog that is used during beaming. The Attention Manager also doesn't attempt to replace error messages. Applications must use modal dialogs and other existing OS facilities to handle these cases.
</p>
<p class="Body">
  <a name="1010022"> </a>The Attention Manager is also not intended to replace the ToDo application, or to act as a universal inbox. Applications must make it clear that an item appearing in the Attention Manager is simply a reminder, and that dismissing it does not delete the item itself. That is, saying "OK" to an alarm does not delete the appointment, and dismissing an SMS reminder does not delete the SMS message from the SMS inbox.
</p>

<h2 class="HBHeadB">
  <a name="1010024"> </a>Attention Manager Operation
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010025"> </a>This section provides a detailed introduction to the Attention Manager from a user's point of view, introducing some of the terminology used throughout the rest of the chapter and pointing out operational subtleties that you should be aware of when developing applications that use the Attention Manager.
</p>
<p class="Body">
  <a name="1010027"> </a>Attention-getting attempts can either be <b>insistent</b> or <b>subtle</b>. They differ only in the lengths to which each goes to get your attention. Insistent attempts get "in your face" by popping up a dialog and triggering other visible and audible special effects in an effort to bring important events to your attention. A meeting reminder or incoming high-priority email message might warrant interrupting your work in this fashion. Subtle attentions substitute a small on-screen <b>attention indicator</b> for the dialog, allowing you to be made aware of less-critical events without interrupting your current work flow. Although they can also trigger various special effects, subtle attentions don't typically do so. Examples of subtle events might include a reminder of an upcoming birthday or holiday, or an incoming SMS message.
</p>

<h4 class="HCHeadC">
  <a name="1010030"> </a>Insistent Attentions
</h4>
<p class="Body">
  <a name="1010031"> </a>When an application makes an insistent attempt to get the user's attention, the <b>detail dialog</b> opens:
</p>

<p class="FFigureCaption">
  <a name="1010034"> </a>Figure 9.1	 Detail Dialog
</p>
<p class="FgFigure">
  <a name="1010038"> </a><div align="left"><img src="images/AttnsAndAlarmsa.gif" height="171" width="360" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1010039"> </a>The Attention Manager draws the title and the buttons. The application is responsible for drawing the rest. Most applications draw text and an appropriate icon, as shown in <a href="AttnsAndAlarms.html#1010034">Figure 9.1</a>.
</p>
<p class="Body">
  <a name="1010043"> </a>When a second application attempts to get attention, or when the first application makes a second attempt, and the first has not yet been dismissed or snoozed, the window changes to the <b>list dialog</b>, presenting a list of things that require the user's attention:
</p>

<p class="FFigureCaption">
  <a name="1010045"> </a>Figure 9.2	 List Dialog
</p>
<p class="FgFigure">
  <a name="1010049"> </a><div align="left"><img src="images/AttnsAndAlarms2.gif" height="175" width="360" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1010050"> </a>In this dialog, the Attention Manager draws the title and the buttons, and manages the list of items including the checkbox in the left-hand column. Items are listed in order of occurrence, with the newest at the top. The application is responsible for drawing some part of each line, giving it some flexibility over what to display. Applications have space to draw an icon and two lines of text in the standard font on the right-hand side of the list area.
</p>
<p class="Body">
  <a name="1010052"> </a>In the detail dialog the OK button dismisses the item. In the list dialog, tapping the checkbox to the left of the item dismisses it. The Clear All button can be used to dismiss all items in the list view. Dismissing an item removes it from the list or closes the detail dialog. Note that although it is gone from the Attention Manager, the item itself remains in the application.
</p>
<p class="Body">
  <a name="1010053"> </a>Unique to the list view is a "Done" button which simply closes the list view. It makes no changes to items in the Attention Manager list, nor to any snooze timer.
</p>
<p class="Body">
  <a name="1010055"> </a>In either dialog, the "Snooze" button temporarily dismisses the Attention Manager dialog. The attention indicator remains visible and the user can redisplay the dialog at any time. After an interval of five minutes, if any attempts to get attention are still pending the Attention Manager redisplays the dialog. Snooze does not remove attempts to get attention.
</p>
<p class="Body">
  <a name="1010057"> </a>There is just one "Snooze" timer, and the snooze operation applies to the Attention Manager as a whole. This can lead to seemingly odd behavior when new attention items are coming in while there is currently a snooze in progress. This situation should be rare, however.
</p>
<p class="Body">
  <a name="1010059"> </a>To "go to" an individual item, tap the text or icon of the item in the list dialog or tap the "Go To" button in the detail dialog. This temporarily dismisses the Attention Manager and launches the appropriate application to display details about the item. For an SMS message, this could take you to the detail dialog showing the message, or, if there are more than one, it could take you to the list of pending SMS messages. For an alarm, this could take you to the Datebook view for the current day, with the current meeting scrolled into view. A successful "go to" also removes the attention item from the list.
</p>
<p class="Body">
  <a name="1010061"> </a>Note that while the Attention Manager dialogs are displayed, hard and soft buttons are ignored. This is to prevent you from missing an attention item when you turn on the handheld by pressing one of the hard keys.
</p>

<h4 class="HCHeadC">
  <a name="1010063"> </a>Subtle Attentions
</h4>
<p class="Body">
  <a name="1010064"> </a>When an application makes a subtle attempt to get the users attention, no dialog appears. Instead, the title bar of all applications that use the standard form title object show a blinking indicator.
</p>

<p class="FFigureCaption">
  <a name="1010066"> </a>Figure 9.3	 Attention indicator
</p>
<p class="FgFigure">
  <a name="1010070"> </a><div align="left"><img src="images/AttentionIndicator.gif" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1010071"> </a>When the list contains one or more items, all of which have been seen by the user, the "star" indicator blinks on and off until the list is empty. When the list contains one or more unseen items, the attention indicator performs an "exploding star" animation.
</p>
<p class="Body">
  <a name="1010072"> </a>Tapping this indicator opens the Attention Manager in the list mode, even if there is only one item. Tapping to the right of the indicator, or tapping in the indicator's area when there are no pending attention attempts opens the menu bar as expected.
</p>
<p class="Body">
  <a name="1010074"> </a>The attention indicator only functions with applications which use a standard form title object. The indicator doesn't appear when:
</p>

  <a name="1010075"> </a><p class="B1Bullet"> &#8226; there are no items in the Attention Manager's queue.</p>

  <a name="1010076"> </a><p class="B1Bullet"> &#8226; the current application uses a custom title.</p>

  <a name="1010077"> </a><p class="B1Bullet"> &#8226; the current application draws in the title area.</p>

  <a name="1010078"> </a><p class="B1Bullet"> &#8226; the current form uses the Dialog title style.</p>

  <a name="1010079"> </a><p class="B1Bullet"> &#8226; the current application's form title is too narrow to include the attention indicator.</p>

<h4 class="HCHeadC">
  <a name="1010080"> </a>Special Effects
</h4>
<p class="Body">
  <a name="1010081"> </a>When a new attention item is added, the Attention Manager performs some combination of special effects, which can include playing sounds, flashing a LED, and triggering vibration. The exact combination of effects depends on user settings and on the application itself.
</p>
<p class="Body">
  <a name="1010083"> </a>The Attention Manager attempts to open the dialog before performing any special effects so you know immediately why it is trying to get your attention. However, it may not be possible to open the Attention Manager dialog. If this is the case, the Attention Manager performs the special effects as soon as possible. It's better for the user to be made aware that something is happening, even if the handheld cannot say exactly what it is.
</p>
<p class="Body">
  <a name="1010084"> </a>System-wide user preferences control the special effects: the volume at which to play alarms, whether or not to flash the LED (if any), whether or not to vibrate (if equipped). Applications can override these system-wide settings in either a positive or a negative way. For instance, an application could always blink the LED, even if the user said not to, or never blink the LED, even if the user desires it in general.
</p>

<h4 class="HCHeadC">
  <a name="1010085"> </a>Nagging
</h4>
<p class="Body">
  <a name="1010086"> </a>As with Datebook alarms in Palm OS 3.5 and earlier, if you don't explicitly dismiss or snooze an attention item it continues to "nag" you at predefined intervals, using the item's specified special effects. Applications control how frequently the user should be reminded, and how many times before the Attention Manager gives up. 
</p>
<p class="Body">
  <a name="1010093"> </a>When there are multiple attention items competing for nagging, the Attention Manager respects the nag settings for the most recent insistent item, or if there are none then for the most recent subtle item. Each special effect is handled separately; if one reminder wants sound but no vibration, and another wants vibration but no sound, the combination results in the sound from the first one and the vibration from the second one.
</p>

<h4 class="HCHeadC">
  <a name="1010095"> </a>Attention Manager and Existing Applications
</h4>
<p class="Body">
  <a name="1010096"> </a>The Attention Manager makes no attempt to override existing application behavior. If an application written for Palm OS 3.5 or earlier puts up a dialog to get the user's attention, the Attention Manager doesn't get involved. Applications must be specifically written to use the Attention Manager in order to take advantage of its features and seamless integration with the Palm<sup>&#8482;</sup> user experience.
</p>
<p class="Body">
  <a name="1010097"> </a>Some existing third-party applications put up modal alarm-like dialogs. These dialogs can potentially interfere with the Attention Manager. However, issuing of the UI launch code by the Alarm Manager is deferred until after the Attention Manager is closed. This prevents existing applications from putting up their dialogs while the Attention Manager is being displayed. If the reverse happens, and the Attention Manager pops up while an existing application is displaying an alarm-like dialog, only a "go to" becomes problematic: the third-party dialog may consume events required to perform the "go to," preventing it from taking place. This is acceptable, however, since the attention item remains in the Attention Manager's queue. Once the third-party dialog has been dismissed, you can then re-open the Attention Manager and re-initiate the "go to."
</p>
<p class="Body">
  <a name="1010098"> </a>Effectively, this means the Attention Manager always shows up on top of any existing application's alarm dialogs that use the Alarm Manager. This ensures that you'll most likely be greeted by the Attention Manager's list after a prolonged period of inactivity.
</p>

<h2 class="HBHeadB">
  <a name="1010100"> </a>Getting the User's Attention
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010101"> </a>This section shows how your applications request the user's attention through the Attention Manager.
</p>
<p class="Body">
  <a name="1010102"> </a>Getting the user's attention is simply a matter of calling <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a> with the appropriate parameters and then handling various callbacks made by the Attention Manager. These callbacks allow your application to control what is displayed in the Attention Manager dialogs, to play sounds or perform other special effects, and to do any necessary processing when the user takes action on an existing attention item.
</p>
<p class="Body">
  <a name="1010107"> </a>The <span style="font-family: monospace">AttnGetAttention</span> prototype looks like this:
</p>
<pre  class="Preformatted">
Err AttnGetAttention (UInt16 cardNo,
LocalID dbID, UInt32 userData,
AttnCallbackProc *callbackFnP,
AttnLevelType level, AttnFlagsType flags,
UInt16 nagRateInSeconds, UInt16 nagRepeatLimit)<a name="1010108"> </a>
</pre>
<p class="Body">
  <a name="1010109"> </a>Specify the application requesting the user's attention in the <span style="font-family: monospace">cardNo</span> and <span style="font-family: monospace">dbID</span> arguments. You can use the <a href="DataAndResourceManager.html#1096175"><span style="font-family: monospace">DmGetNextDatabaseByTypeCreator</span></a> function to obtain these values.
</p>
<p class="Body">
  <a name="1010113"> </a><span style="font-family: monospace">userData</span> is used to distinguish a given attention attempt from others made by the same application; most applications pass the unique ID or other key for the record which caused the attention request. This value is passed to your code through the callback function, and can be an integer, a pointer, or any other 32-bit value as needed by your application. 
</p>
<p class="Body">
  <a name="1010114"> </a>The <span style="font-family: monospace">callbackFnP</span> argument controls whether the Attention Manager invokes a callback function or issues a launch code to request services from your application. Applications typically supply <span style="font-family: monospace">NULL</span> for this parameter, causing launch codes to be sent to the application specified by the <span style="font-family: monospace">cardNo</span> and <span style="font-family: monospace">dbID</span> arguments. See <a href="AttnsAndAlarms.html#1010137">"Callback or Launch Code?"</a> for a discussion of callback functions and launch codes.
</p>
<p class="Body">
  <a name="1010118"> </a>For the <span style="font-family: monospace">level</span> argument, supply <span style="font-family: monospace">kAttnLevelInsistent</span> or <span style="font-family: monospace">kAttnLevelSubtle</span> depending on whether the given attention attempt is to be insistent or subtle.
</p>
<p class="Body">
  <a name="1010119"> </a>Regardless of the level of the attention attempt, set the appropriate bits in the <span style="font-family: monospace">flags</span> argument to cause sounds to play, LEDs to blink, or other physical effects to be performed. Depending on which flags you specify, the effect can always occur or can be suppressed by the user. For instance, to trigger a sound while honoring the user's preferences, you need only supply <span style="font-family: monospace">kAttnFlagsSoundBit</span>. Or, to blink the LED but suppress any sounds, regardless of any preferences the user may have set, supply a value of <span style="font-family: monospace">kAttnFlagsAlwaysLED | kattnFlagsNoSound</span>. Finally, to choose only vibrate, do something like:
</p>
<pre  class="Preformatted">
flags = kAttnFlagsNothing ^ kAttnFlagsNoVibrate
   | kAttnFlagsAlwaysVibrate;<a name="1010120"> </a>
</pre>
<p class="Body">
  <a name="1010121"> </a>While the above is somewhat complex, it does ensure that you override all defaults in the negative except vibration, which is overridden in the positive. See the definition of <a href="AttentionMgr.html#1082774"><span style="font-family: monospace">AttnFlagsType</span></a> in the <i>Palm OS Programmer's API Reference</i> for a complete set of constants that can be used in combination for the <span style="font-family: monospace">flags</span> argument.
</p>
<div class="NINoteImportant"><hr>
  <a name="1010128"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> Applications may want to verify that the handheld is properly equipped to perform the desired effect. See <a href="AttnsAndAlarms.html#1010434">"Detecting Device Capabilities"</a> for information on how to do this. If the handheld isn't properly equipped to handle a given special effect, the effect isn't performed. For example, if you set the <span style="font-family: monospace">kAttnFlagsLEDBit</span> flag and the Palm Powered<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: super">&#8482;</span> handheld doesn't have an LED, the attention attempt is processed as if the <span style="font-family: monospace">kAttnFlagsLEDBit</span> had never been set.
<hr>
</div>
<p class="Body">
  <a name="1010132"> </a>Assuming that the handheld is capable of getting the user's attention using the requested special effect, the <span style="font-family: monospace">nagRateInSeconds</span> and <span style="font-family: monospace">nagRepeatLimit</span> arguments control how often and how many times the special effect is triggered in an attempt to get the user's attention. As the name implies, specify the amount of time, in seconds, the Attention Manager should wait between special effect triggers with <span style="font-family: monospace">nagRateInSeconds</span>. Indicate the desired number of times the effect should be triggered using <span style="font-family: monospace">nagRepeatLimit</span>. Applications typically supply a value of 300 for <span style="font-family: monospace">nagRateInSeconds</span> and a value of 3 for <span style="font-family: monospace">nagRepeatLimit</span>, indicating that the special effect should be triggered three times after the initial attempt, at five minute intervals. 
</p>
<p class="Body">
  <a name="1010134"> </a>The following line of code shows how the SMS application calls the Attention Manager upon receiving a new SMS message. Note that a subtle attention is generated so that the user isn't interrupted every time an SMS message is received. Also note that the application doesn't override the user's settings when getting his attention. Finally, if the user doesn't respond to the first attention-getting attempt, the special effects are repeated three additional times in five-minute intervals.
</p>
<pre  class="Preformatted">
err = AttnGetAttention(cardNo, dbID, NULL,
    NULL, kAttnLevelSubtle,
    kAttnFlagsUseUserSettings, 300, 3);<a name="1010135"> </a>
</pre>

<h4 class="HCHeadC">
  <a name="1010137"> </a>Callback or Launch Code?
</h4>
<p class="Body">
  <a name="1010139"> </a>For a given attention item, the Attention Manager calls back to the code resource that created that item whenever the Attention Manager needs the resource to draw the attention dialog contents or whenever it needs to inform the code resource of activity relating to the attention item. The Attention Manager calls back using one of two mechanisms:
</p>

  <a name="1010140"> </a><p class="B1Bullet"> &#8226; If a callback routine has been specified for a given attention item, the Attention Manager invokes it. This callback routine doesn't have application globals available to it, so it is important that anything necessary to draw or otherwise display be available through <span style="font-family: monospace">commandArgsP</span>. A callback routine is typically used by libraries and system extensions. See the description of the <a href="AttentionMgr.html#1083669"><span style="font-family: monospace">AttnCallbackProc</span></a> in the <i>Palm OS Programmer's API Reference</i> for the specifics of the callback routine.</p>

  <a name="1010147"> </a><p class="B1Bullet"> &#8226; If a callback routine has not been specified for a given attention item, the Attention Manager instead sends a <a href="AppLaunchCodes.html#970327"><span style="font-family: monospace">sysAppLaunchCmdAttention</span></a> launch code to the application that registered the attention item. Accompanying that launch code is an <a href="AttentionMgr.html#1082920"><span style="font-family: monospace">AttnLaunchCodeArgsType</span></a> structure containing the three parameters documented above. Applications typically use the launch-code mechanism due to the restrictions that are placed on callback routines.</p>
<div class="NINoteImportant"><hr>
  <a name="1010155"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> It is your responsibility to ensure that the callback procedure is still in the same place when it gets called, dealing with the possibility that the code resource might be unlocked and moved in memory, and with the possibility that the database containing the code resource might be deleted. For the most part, these problems don't exist when using launch codes.
<hr>
</div>

<h4 class="HCHeadC">
  <a name="1010157"> </a>Attention Manager Commands
</h4>
<p class="Body">
  <a name="1010161"> </a>In addition to calling <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a>, your code must also respond to commands from the Attention Manager. The Attention Manager issues these commands either by invoking a callback function or issuing a launch code, depending on what you supplied for the <span style="font-family: monospace">callbackFnP</span> argument in the <span style="font-family: monospace">AttnGetAttention</span> call. Among the possible commands are requests for your application to draw the contents of the detail and list dialogs, play application-specific sounds or perform other special effects, navigate to the item in your application that caused the attention item to be posted, and so forth.
</p>

<h5 class="HDHeadD">
  <a name="1010163"> </a>Draw Detail and List Dialogs
</h5>
<p class="Body">
  <a name="1010164"> </a>The Attention Manager's detail and list dialogs are drawn as a joint effort between the Attention Manager and applications requesting the user's attention. The shell of each dialog, the title, and the buttons and checkboxes are drawn by the Attention Manager, while the remainder-text specific to each attention attempt, and frequently an accompanying icon-is drawn by the application itself. This gives each application full control over what sort of information to display.
</p>

<p class="FFigureCaption">
  <a name="1010165"> </a>Figure 9.4	 Attention Manager dialogs
</p>
<p class="FgFigure">
  <a name="1010171"> </a><div align="left"><img src="images/AttnsAndAlarms4.gif" height="171" width="360" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1010172"> </a>Although your application has full control over the display of its attention items, it may only draw in the designated area; active UI elements, such as scroll bars, custom buttons, or other widgets cannot be included. Users should be encouraged to launch the application with the "Go To" button and use the richer UI provided there. The clipping region is appropriately set so that your application cannot accidentally draw outside the designated area.
</p>
<p class="Body">
  <a name="1010174"> </a>The <span style="font-family: monospace">kAttnCommandDrawDetail</span> command indicates that your application is to draw the contents of the detail dialog. Along with the command, the Attention Manager passes a structure of type <a href="AttentionMgr.html#1082666"><span style="font-family: monospace">drawDetail</span></a>. This structure contains the window-relative boundaries of the screen rectangle in which your application is to draw, a flag indicating whether this is the first time the user has seen this attention item, and a set of flags indicating which special effects will also be triggered.
</p>
<div class="NINoteImportant"><hr>
  <a name="1010179"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> Unless the <span style="font-family: monospace">firstTime</span> bit is set, the portion of the detail dialog in which your application draws is not guaranteed to be blank. If <span style="font-family: monospace">firstTime</span> is not set, erase the area indicated by the <span style="font-family: monospace">bounds</span> rectangle prior to drawing the contents of the detail dialog.
<hr>
</div>
<p class="Body">
  <a name="1010180"> </a>The following code excerpt shows how a simple application might render the contents of the detail dialog in response to <a href="AppLaunchCodes.html#970327"><span style="font-family: monospace">sysAppLaunchCmdAttention</span></a> launch code accompanied by a <span style="font-family: monospace">kAttnCommandDrawDetail</span> command:
</p>
<p class="CCodeCaption">
  <a name="1010184"> </a>Listing 9.1  Drawing the contents of the detail dialog
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
// Draw the icon<a name="1010185"> </a>
resH = DmGetResource(bitmapRsc, MyIconBitmap);<a name="1010186"> </a>
WinDrawBitmap(MemHandleLock(resH), 
    paramsPtr-&gt;drawDetail.bounds.topLeft.x,
    paramsPtr-&gt;drawDetail.bounds.topLeft.y + 4);<a name="1010187"> </a>
MemHandleUnlock(resH);<a name="1010188"> </a>
DmReleaseResource(resH);<a name="1010189"> </a>
 <a name="1010190"> </a>
// Draw the text. The content of the string depends on the<a name="1010191"> </a>
// uniqueID that accompanies the kAttnCommandDrawDetail<a name="1010192"> </a>
// command<a name="1010193"> </a>
curFont = FntSetFont (largeBoldFont);<a name="1010194"> </a>
x = paramsPtr-&gt;drawDetail.bounds.topLeft.x + 37;<a name="1010195"> </a>
y = paramsPtr-&gt;drawDetail.bounds.topLeft.y + 4;<a name="1010196"> </a>
WinDrawChars(alertString, StrLen(alertString), x, y);<a name="1010197"> </a>
FntSetFont(curFont);<a name="1010198"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1010199"> </a>For a more complex, real-world example, see the <span style="font-family: monospace">DrawDetailAlarm</span> function in the Datebook application. In particular, note how that application adjusts the displayed text so that it all fits in the allocated space.
</p>
<p class="Body">
  <a name="1010200"> </a>Note that because subtle attention items are only shown using the list view, your application doesn't need to respond to <span style="font-family: monospace">kAttnCommandDrawDetail</span> if it doesn't produce insistent attention attempts.
</p>
<p class="Body">
  <a name="1010202"> </a>The <span style="font-family: monospace">kAttnCommandDrawList</span> command is similar; it indicates that your application is to draw a portion of the contents of the list dialog. Along with this command, the Attention Manager passes a structure of type <a href="AttentionMgr.html#1082695"><span style="font-family: monospace">drawList</span></a>, which contains a <span style="font-family: monospace">selected</span> flag in addition to the <span style="font-family: monospace">bounds</span>, <span style="font-family: monospace">firstTime</span>, and <span style="font-family: monospace">flags</span> fields described above. The <span style="font-family: monospace">selected</span> flag indicates whether the item has been selected. Before sending your application the <span style="font-family: monospace">kAttnCommandDrawList</span> command, the Attention Manager sets the background, foreground, and text colors as follows, depending on whether or not the item is selected:
</p>

<h5 class="TgTable">
  <a name="1010233"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1010210"> </a><div class="CellHeading">Affected Color</div></th>
    <th><a name="1010212"> </a><div class="CellHeading">Not Selected</div></th>
    <th><a name="1010214"> </a><div class="CellHeading">Selected</div></th>
  </tr>
  <tr valign="top">
    <td><a name="1010216"> </a><div class="CellBody">Background Color</div></td>
    <td><a name="1010218"> </a><div class="CellBody"><span style="font-family: monospace">UIFieldBackground</span></div></td>
    <td><a name="1010220"> </a><div class="CellBody"><span style="font-family: monospace">UIObjectSelectedFill</span></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1010222"> </a><div class="CellBody">Foreground Color</div></td>
    <td><a name="1010224"> </a><div class="CellBody"><span style="font-family: monospace">UIObjectForeground</span></div></td>
    <td><a name="1010226"> </a><div class="CellBody"><span style="font-family: monospace">UIObjectSelectedForeground</span></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1010228"> </a><div class="CellBody">Text Color</div></td>
    <td><a name="1010230"> </a><div class="CellBody"><span style="font-family: monospace">UIObjectForeground</span></div></td>
    <td><a name="1010232"> </a><div class="CellBody"><span style="font-family: monospace">UIObjectSelectedForeground</span></div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1010234"> </a>Particularly if your attention item icon is in color, you may need to draw the attention item differently when it is selected. The <span style="font-family: monospace">selected</span> flag exists to allow you to do this.
</p>
<p class="Body">
  <a name="1010235"> </a>The code to draw an attention item in the list dialog is very similar to the code you use to draw the same item in the detail dialog. Here is an excerpt:
</p>
<p class="CCodeCaption">
  <a name="1010236"> </a>Listing 9.2  Drawing the contents of the list dialog
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
// Draw the icon. Ignore the 'selected' flag for this example<a name="1010237"> </a>
resH = DmGetResource(bitmapRsc, MySmallIconBitmap);<a name="1010238"> </a>
iconP = (BitmapPtr)(MemHandleLock(resH));<a name="1010239"> </a>
// center it in the space allotted<a name="1010240"> </a>
iconOffset = (kAttnListMaxIconWidth - iconP-&gt;width)/2;<a name="1010241"> </a>
x = paramsPtr-&gt;drawList.bounds.topLeft.x;<a name="1010242"> </a>
y = paramsPtr-&gt;drawList.bounds.topLeft.y;<a name="1010243"> </a>
WinDrawBitmap(iconP, x + iconOffset, y);	<a name="1010244"> </a>
MemHandleUnlock(resH);<a name="1010245"> </a>
DmReleaseResource(resH);<a name="1010246"> </a>
 <a name="1010247"> </a>
// Draw the text<a name="1010248"> </a>
curFont = FntSetFont(stdFont);<a name="1010249"> </a>
WinDrawChars(alertString, StrLen(alertString), 
    x + kAttnListTextOffset, y);<a name="1010250"> </a>
FntSetFont(curFont);<a name="1010251"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1010252"> </a>The primary differences arise from the fact that the list dialog provides a smaller, more structured area in which to draw. Also, the area in which you draw will always have been erased before you are asked to draw in it, so you don't ever have to erase it beforehand.
</p>
<p class="Body">
  <a name="1010253"> </a>The icon should be no wider than <span style="font-family: monospace">kAttnListMaxIconWidth</span> pixels, and should be centered within this width if it is smaller than <span style="font-family: monospace">kAttnListMaxIconWidth</span>. The text should honor a left-hand margin of <span style="font-family: monospace">kAttnListTextOffset</span> pixels. In the above example, the alert string is assumed to fit within the available space; see the <span style="font-family: monospace">DrawListAlarm</span> function in the Datebook application for an example of how that application adjusts the displayed text in the event that it doesn't all fit in the allocated space.
</p>
<div class="NINoteImportant"><hr>
  <a name="1010254"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> Applications may, in certain rare circumstances, receive a <span style="font-family: monospace">kAttnCommandDrawDetail</span> or <span style="font-family: monospace">kAttnCommandDrawList</span> command for an item which is no longer valid. Respond by either calling <a href="AttentionMgr.html#1083290"><span style="font-family: monospace">AttnForgetIt</span></a>, by drawing nothing, or by drawing an error message.
<hr>
</div>

<h5 class="HDHeadD">
  <a name="1010260"> </a>Play Sound or Perform a Custom Effect
</h5>
<p class="Body">
  <a name="1010261"> </a>Most applications play a sound when attempting to get the user's attention. If the <span style="font-family: monospace">kAttnFlagsAlwaysSound</span> is set when your application calls <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a>, the Attention Manager sends a <span style="font-family: monospace">kAttnCommandPlaySound</span> command to your application when attempting to get the user's attention. Your application should simply play the appropriate sound in response to this command. Both the Datebook and SMS applications play sounds based upon the user's preferences when getting the user's attention; see the Datebook application's source code for an example of how to respond to the <span style="font-family: monospace">kAttnCommandPlaySound</span> command.
</p>
<p class="Body">
  <a name="1010267"> </a>Because the Attention Manager can potentially play a sound, blink an LED, and vibrate in addition to displaying a dialog or blinking the attention indicator, most applications don't request that some other application-specific custom effect be performed. If your application needs to do something different, you can specify <span style="font-family: monospace">kAttnFlagsAlwaysCustomEffect</span> when calling <span style="font-family: monospace">AttnGetAttention</span>. This causes a <span style="font-family: monospace">kAttnCommandCustomEffect</span> command to be sent to your application, at which time it should perform the desired effect. If your application is like most, however, it won't ever receive a <span style="font-family: monospace">kAttnCommandCustomEffect</span> command, so you needn't worry about responding to it.
</p>
<p class="Body">
  <a name="1010269"> </a>Neither <span style="font-family: monospace">kAttnCommandPlaySound</span> nor <span style="font-family: monospace">kAttnCommandCustomEffect</span> are accompanied by any kind of data structure indicating the sound or effect to be performed. If your application doesn't hard-wire this information, you may want to store it in the application's preferences database.
</p>

<h5 class="HDHeadD">
  <a name="1010271"> </a>Go There
</h5>
<p class="Body">
  <a name="1010272"> </a>When the user taps on the "Go To" button in the detail view or on the item text or icon (not the checkbox) in the list view, your application receives a <span style="font-family: monospace">kAttnCommandGoThere</span> command. It then needs to switch to your application and display the information relating to the chosen attention item. The <span style="font-family: monospace">kAttnCommandGoThere</span> command is similar to the <a href="AppLaunchCodes.html#970812"><span style="font-family: monospace">sysAppLaunchCmdGoto</span></a> launch code, but you don't have globals when your application receives the <span style="font-family: monospace">kAttnCommandGoThere</span> command and your application is called using <a href="SystemManager.html#1165530"><span style="font-family: monospace">SysAppLaunch</span></a>, rather than <a href="SystemManager.html#1166426"><span style="font-family: monospace">SysUIAppSwitch</span></a>. Because of this, most applications perform a <span style="font-family: monospace">SysUIAppSwitch</span> upon receiving <span style="font-family: monospace">kAttnCommandGoThere</span>.
</p>
<p class="Body">
  <a name="1010286"> </a>Note that your application should verify that the data that triggered the attention attempt is still relevant. In the Datebook, for instance, the user could:
</p>
  <a name="1010287"> </a><p class="N1NumList">1.	  Be alerted to an appointment by the Attention Manager.</p>  <a name="1010288"> </a><p class="N1NumList">2.	  Tap "Snooze."</p>  <a name="1010289"> </a><p class="N1NumList">3.	  Press the Datebook button and delete the appointment that was just brought to the user's attention.</p>  <a name="1010290"> </a><p class="N1NumList">4.	  Tap the blinking attention indicator.</p>  <a name="1010291"> </a><p class="N1NumList">5.	  Tap the attention item corresponding to the now-deleted appointment.</p><p class="Body">
  <a name="1010292"> </a>In this scenario, the Datebook application could theoretically receive a <span style="font-family: monospace">kAttnCommandGoThere</span> command along with a unique ID referencing a Datebook record that has been deleted. Whenever the Datebook application receives <span style="font-family: monospace">kAttnCommandGoThere</span> along with a unique ID for a deleted Datebook database record, it calls <a href="AttentionMgr.html#1083290"><span style="font-family: monospace">AttnForgetIt</span></a> for the now defunct attention item and then returns.
</p>
<p class="Body">
  <a name="1010297"> </a>In reality, the Datebook calls <span style="font-family: monospace">AttnForgetIt</span> whenever the user deletes an alarm, and whenever an alarm is determined to be no longer valid. It can do this without even checking to see if the alarm is among those that the Attention Manager is currently tracking; if you pass a combination of card number, database ID, and unique ID to <span style="font-family: monospace">AttnForgetIt</span> that doesn't correspond to an item in the Attention Manager's queue, <span style="font-family: monospace">AttnForgetIt</span> does nothing and returns a value of <span style="font-family: monospace">false</span>.
</p>
<p class="Body">
  <a name="1010298"> </a>Most applications will choose to call <span style="font-family: monospace">AttnForgetIt</span> once the user has viewed the data corresponding to the attention item. This is how the SMS application operates: incoming messages are brought to the user's attention via the Attention Manager, and are removed from the Attention Manager's queue once they've been read.
</p>

<h5 class="HDHeadD">
  <a name="1010300"> </a>Got It
</h5>
<p class="Body">
  <a name="1010301"> </a>When the user dismisses a particular attention item, a <span style="font-family: monospace">kAttnCommandGotIt</span> command is sent to the application. Along with this command is a boolean that indicates if the item was explicitly dismissed by the user, since <span style="font-family: monospace">kAttnCommandGotIt</span> is also issued as the result of a successful <a href="AttentionMgr.html#1083290"><span style="font-family: monospace">AttnForgetIt</span></a> call. Upon receipt of this command, you may want to clean up memory, delete an alarm, or do other application-specific processing. 
</p>

<h5 class="HDHeadD">
  <a name="1010309"> </a>Iterate
</h5>
<p class="Body">
  <a name="1010310"> </a>When something happens that may potentially cause an application's attention items to become invalid, that application should call <a href="AttentionMgr.html#1083526"><span style="font-family: monospace">AttnIterate</span></a>. <span style="font-family: monospace">AttnIterate</span> generates a series of <span style="font-family: monospace">kAttnCommandIterate</span> commands, one for each of the application's pending attention items. Thus, when your application receives a <span style="font-family: monospace">kAttnCommandIterate</span> command it should validate the indicated attention item and take appropriate action if the item is no longer valid-up to and including calling <a href="AttentionMgr.html#1083290"><span style="font-family: monospace">AttnForgetIt</span></a> for the item.
</p>
<p class="Body">
  <a name="1010320"> </a>The SMS application does not respond to <span style="font-family: monospace">kAttnCommandIterate</span>. The Datebook does; this command is generated whenever the user updates his preferences. Many applications call <span style="font-family: monospace">AttnIterate</span> after receiving a <a href="AppLaunchCodes.html#970999"><span style="font-family: monospace">sysAppLaunchCmdSyncNotify</span></a> launch code so that they can update (with <a href="AttentionMgr.html#1083611"><span style="font-family: monospace">AttnUpdate</span></a>) or remove (with <span style="font-family: monospace">AttnForgetIt</span>) items which were affected by the HotSync<sup>®</sup> operation.
</p>
<p class="Body">
  <a name="1010328"> </a>Note that you can safely call <span style="font-family: monospace">AttnForgetIt</span> from within the iteration since <span style="font-family: monospace">AttnForgetIt</span> only marks the record for deletion and thus doesn't confuse the iteration.
</p>

<h5 class="HDHeadD">
  <a name="1010330"> </a>Snooze
</h5>
<p class="Body">
  <a name="1010331"> </a>Most applications-including the Datebook and SMS applications-ignore <span style="font-family: monospace">kAttnCommandSnooze</span>, which indicates that the user has tapped the Snooze button. Beyond the unique ID that identifies the attention item, nothing accompanies the Snooze command. <span style="font-family: monospace">kAttnCommandSnooze</span> is passed to each and every item currently pending, insistent or subtle. This means that applications with more than one attention item pending receive this command more than once.
</p>

<h4 class="HCHeadC">
  <a name="1010334"> </a>Triggering Special Effects
</h4>
<p class="Body">
  <a name="1010335"> </a>The Attention Manager activates any requested special effects for each attention item, but your application might want to activate those special effects without also posting an attention item to the queue. You can do this through a call to <a href="AttentionMgr.html#1083238"><span style="font-family: monospace">AttnDoSpecialEffects</span></a>. Supply the appropriate combination of flags to trigger the desired effects. See <a href="AttentionMgr.html#1082774"><span style="font-family: monospace">AttnFlagsType</span></a> for a complete list of flags.
</p>

<h2 class="HBHeadB">
  <a name="1010344"> </a>Attentions and Alarms
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010346"> </a>The Attention Manager is often used in conjunction with the Alarm Manager to get the user's attention at a particular time. The basic use of the Alarm Manager is covered in <a href="AttnsAndAlarms.html#1010537">"Alarms"</a>, but because the Attention Manager handles UI synchronization, do the following when using the Alarm Manager with the Attention Manager:
</p>

  <a name="1010355"> </a><p class="B1Bullet"> &#8226; Call <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a> when your application receives the <a href="AppLaunchCodes.html#970299"><span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span></a> launch code.</p>

  <a name="1010360"> </a><p class="B1Bullet"> &#8226; In your <span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span> handling code, set the <span style="font-family: monospace">purgeAlarm</span> field in the launch code's parameter block to <span style="font-family: monospace">true</span> before returning. This removes the alarm from the queue, so your application won't receive the <a href="AppLaunchCodes.html#970515"><span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span></a> launch code.</p>
<p class="Body">
  <a name="1010366"> </a>Don't wait until the <span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span> launch code is received to call <span style="font-family: monospace">AttnGetAttention</span>: <span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span> is not issued while another Alarm Manager dialog is open, so the Attention Manager is prevented from doing anything if a "legacy" application is displaying an Alarm Manager dialog.
</p>
<div class="NINoteImportant"><hr>
  <a name="1010368"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> If you want to use the Alarm Manager to force periodic updates of your application's attention items, don't call <a href="AttentionMgr.html#1083611"><span style="font-family: monospace">AttnUpdate</span></a> after receiving an Alarm Manager launch code since this keeps the handheld from sleeping. Instead, use a procedure alarm a described under <a href="AttnsAndAlarms.html#1010669">"Setting a Procedure Alarm"</a> and call <span style="font-family: monospace">AttnUpdate</span> from within your procedure alarm callback function.
<hr>
</div>

<h2 class="HBHeadB">
  <a name="1010377"> </a>Detecting and Updating Pending Attentions
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010378"> </a>Once your application has requested that the Attention Manager get the user's attention, it may later need to update that attention request. For instance, if your application uses a single attention item to indicate that a number of unread messages have been received, it should update that item as additional items are received and read. The Attention Manager provides a handful of functions that allow applications to examine the Attention Manager's queue and update the items within that queue.
</p>
<p class="Body">
  <a name="1010383"> </a>The <a href="AttentionMgr.html#1083376"><span style="font-family: monospace">AttnGetCounts</span></a> function allows you to determine how many items are currently competing for the user's attention. It always returns the total number of items, but can return the number of subtle and/or insistent items as well. It can also return the counts for all applications. For instance, the following would set <span style="font-family: monospace">numItems</span> to the total number of pending attention items from all sources:
</p>
<pre  class="Preformatted">
numItems = AttnGetCounts(0, 0, NULL, NULL);<a name="1010384"> </a>
</pre>
<p class="Body">
  <a name="1010386"> </a>Or, to get the number of subtle and insistent attention items in addition to the total requested by a single application, use something like:
</p>
<pre  class="Preformatted">
numItems = AttnGetCounts(cardNo, dbID,
    &amp;insistentItems, &amp;subtleItems);<a name="1010387"> </a>
</pre>
<p class="Body">
  <a name="1010388"> </a>To verify each pending attention item for a given application, use the Attention Manager's <a href="AttentionMgr.html#1083526"><span style="font-family: monospace">AttnIterate</span></a> function as described under <a href="AttnsAndAlarms.html#1010309">"Iterate"</a>.
</p>
<p class="Body">
  <a name="1010396"> </a>After a HotSync is a popular time to invoke <span style="font-family: monospace">AttnIterate</span>; the HotSync operation may have altered the application's underlying data in such a way as to render pending attention items obsolete or invalid. 
</p>

<h4 class="HCHeadC">
  <a name="1010398"> </a>Deleting Pending Attention Items
</h4>
<p class="Body">
  <a name="1010399"> </a>In many cases you'll need to delete an attention item. For instance, a HotSync may alter the underlying application data in such a way so as to invalidate the attention attempt. Or, the user might switch to your application and manually update the data in a similar way, for example by deleting an appointment for which there is a pending alarm. The <a href="AttentionMgr.html#1083290"><span style="font-family: monospace">AttnForgetIt</span></a> function exists for this purpose. Simply invoke this function and supply the card number, database ID, and user data that uniquely identify the attention attempt. You don't even have to verify that the attention attempt is still in the Attention Manager's queue: <span style="font-family: monospace">AttnForgetIt</span> doesn't complain if the attention attempt doesn't exist, merely returning a value of <span style="font-family: monospace">false</span> to indicate this condition.
</p>

<h4 class="HCHeadC">
  <a name="1010405"> </a>Updating Pending Attention Items
</h4>
<p class="Body">
  <a name="1010410"> </a>To update an existing attention item, use <a href="AttentionMgr.html#1083611"><span style="font-family: monospace">AttnUpdate</span></a>. This function is very similar to <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a>, though instead of actual values you pass pointers to those values you want to update. Supply <span style="font-family: monospace">NULL</span> pointers for <span style="font-family: monospace">flagsP</span>, <span style="font-family: monospace">nagRateInSecondsP</span>, and/or <span style="font-family: monospace">nagRepeatLimitP</span> to leave them untouched. For instance, to change the flags that control the special effects used to get the user's attention, do the following:
</p>
<p class="CCodeCaption">
  <a name="1010414"> </a>Listing 9.3  Updating an existing attention item
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
// This assumes that cardNo, dbID, and myUserData are<a name="1010415"> </a>
// declared and set elsewhere to values that identify the<a name="1010416"> </a>
// attention item we're trying to update<a name="1010417"> </a>
Boolean updated;<a name="1010418"> </a>
AttnFlagsType newFlags;<a name="1010419"> </a>
 <a name="1010420"> </a>
// set newFlags appropriately<a name="1010421"> </a>
updated = AttnUpdate(cardNo, dbID, myUserData, NULL,
    &amp;newFlags, NULL, NULL);<a name="1010422"> </a>
if (updated){<a name="1010423"> </a>
    // update succeeded<a name="1010424"> </a>
} else {<a name="1010425"> </a>
    // update failed - attention item may no longer exist<a name="1010426"> </a>
}<a name="1010427"> </a>
</pre><div class="CodeRule"><hr></div>
<div class="NINoteImportant"><hr>
  <a name="1013800"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> Although <span style="font-family: monospace">AttnUpdate</span> may cause a given attention item to redraw, it does not rerun the special effects (if any) that occurred when that attention item was added. If you want to trigger Attention Manager effects for a particular item, call <a href="AttentionMgr.html#1083290"><span style="font-family: monospace">AttnForgetIt</span></a> followed by <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a>.
<hr>
</div>
<p class="Body">
  <a name="1013792"> </a>When calling <span style="font-family: monospace">AttnUpdate</span>, note that you must not only supply the card number, database ID, and user data that uniquely identifies the attention attempt; you must also supply a pointer to the callback procedure if one is used.
</p>
<p class="Body">
  <a name="1010430"> </a>While updating the attention item, if the handheld is on and the Attention Manager dialog is currently showing then <span style="font-family: monospace">AttnUpdate</span> forces the item to be redrawn. This in turn calls back to the client application so that it can update its portion of the dialog. <span style="font-family: monospace">AttnUpdate</span> causes the specified item to be redrawn if it is visible, regardless of the <span style="font-family: monospace">flags</span>, <span style="font-family: monospace">nagRateInSeconds</span>, and <span style="font-family: monospace">nagRepeatLimit</span> parameters.Thus, <span style="font-family: monospace">AttnUpdate</span> isn't limited to updating one or more aspects of an attention item; it also allows an application to update the text of an attention attempt without having to destroy and then rebuild the Attention Manager dialog.
</p>
<p class="Body">
  <a name="1010432"> </a>Note that if the handheld is off, the update is delayed until the handheld is next turned on; <span style="font-family: monospace">AttnUpdate</span> doesn't itself turn the screen on.
</p>

<h2 class="HBHeadB">
  <a name="1010434"> </a>Detecting Device Capabilities
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010435"> </a>Although you can blindly request that a given special effect, such as vibration, be used to get the user's attention without checking to see if that special effect is supported on the Palm Powered handheld, you may want your application to behave differently in the absence of a particular device feature. The Attention Manager defines a feature that you use with the <a href="FeatureManager.html#1110037"><span style="font-family: monospace">FtrGet</span></a> function to determine the handheld's physical capabilities. You can also use this feature to determine the user's attention-getting preferences. For example:
</p>
<p class="CCodeCaption">
  <a name="1010439"> </a>Listing 9.4  Checking for vibrate capability
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
// See if the device supports vibration<a name="1010440"> </a>
FtrGet(kAttnFtrCreator, kAttnFtrCapabilities, &amp;capabilities);<a name="1010441"> </a>
if (capabilities &amp; kAttnFlagsHasVibrate){<a name="1010442"> </a>
    // Vibrate-specific processing goes here<a name="1010443"> </a>
    ...<a name="1010444"> </a>
}<a name="1010445"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1010451"> </a>See <a href="AttentionMgr.html#1083076">"Attention Manager Feature Constants"</a> in the <i>Palm OS Programmer's API Reference</i> for descriptions of all of the relevant flags.
</p>

<h2 class="HBHeadB">
  <a name="1010521"> </a>Controlling the Attention Indicator
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010522"> </a>For the most part, applications can ignore the attention indicator, which consumes a small portion of a form's title bar. If the currently-displayed form doesn't have a title bar, or if the form is modal, the attention indicator isn't drawn. However, if an application takes over the entire screen or does something special with the form's title bar, it should explicitly disable the attention indicator while the form is displayed.
</p>
<p class="Body">
  <a name="1010523"> </a>As an example, the Datebook application disables the attention indicator when:
</p>

  <a name="1010524"> </a><p class="B1Bullet"> &#8226; a note associated with a Datebook entry is displayed.</p>

  <a name="1010525"> </a><p class="B1Bullet"> &#8226; an entry's description is being displayed in the week view.</p>

  <a name="1010526"> </a><p class="B1Bullet"> &#8226; the time is being displayed in the title bar in place of the date.</p>
<p class="Body">
  <a name="1010527"> </a>To disable the attention indicator, simply call <a href="AttentionMgr.html#1083451"><span style="font-family: monospace">AttnIndicatorEnable</span></a> and supply a value of <span style="font-family: monospace">false</span> for the <span style="font-family: monospace">enableIt</span> argument. To re-enable it, simply call <span style="font-family: monospace">AttnIndicatorEnable</span> again, this time supplying an argument value of <span style="font-family: monospace">true</span>.
</p>
<p class="Body">
  <a name="1010531"> </a>If your application disables the attention indicator, it may want to provide some means for the user to open the Attention Manager's dialog in list mode. The <a href="AttentionMgr.html#1083565"><span style="font-family: monospace">AttnListOpen</span></a> function can be used to do this.
</p>

<h2 class="HaHeadA">
  <a name="1010537"> </a>Alarms 
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010539"> </a>The Palm OS Alarm Manager provides support for setting real-time alarms, for performing some periodic activity, or for displaying a reminder. The Alarm Manager:
</p>

  <a name="1010540"> </a><p class="B1Bullet"> &#8226; Works closely with the Time Manager to handle real-time alarms.</p>

  <a name="1010541"> </a><p class="B1Bullet"> &#8226; Sends launch codes to applications that set a specific time alarm to inform the application the alarm is due.</p>

  <a name="1010542"> </a><p class="B1Bullet"> &#8226; Allows only one alarm to be set per application.</p>

  <a name="1010543"> </a><p class="B1Bullet"> &#8226; Handles alarms by application in a two cycle operation:</p>
  <a name="1010544"> </a><p class="B2BulletSub"> -	 First, it notifies each application that the alarm has occurred; the application verifies that the alarm is still valid at this point. Applications that don't use the Attention Manager typically play a sound here.</p>  <a name="1010545"> </a><p class="B2BulletSub"> -	 Second, after all pending alarms have received their first notification, it sends another notification to each application, allowing it to display some UI.</p><p class="Body">
  <a name="1010546"> </a>The Alarm Manager doesn't have any UI of its own; applications that need to bring an alarm to the user's attention must do this themselves. It doesn't provide reminder dialog boxes, and it doesn't play the alarm sound. Applications running on Palm OS 4.0 should use the Attention Manager to interact with the user; see <a href="AttnsAndAlarms.html#1010344">"Attentions and Alarms"</a> for tips on doing this. Applications running on earlier versions of the Palm OS need to provide their own UI, as explained in the following sections.
</p>
<div class="NINoteImportant"><hr>
  <a name="1010553"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> When the handheld is in sleep mode, alarms can occur almost a minute late. This is particularly important to note when utilizing procedure alarms (discussed in <a href="AttnsAndAlarms.html#1010669">"Setting a Procedure Alarm"</a>); although procedure alarms will continue to fire when the handheld is in sleep mode, they may fire less frequently.
<hr>
</div>

<h2 class="HBHeadB">
  <a name="1010559"> </a>Setting an Alarm
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010560"> </a>The most common use of the Alarm Manager is to set a real-time alarm within an application. Often, you set this type of alarm because you want to inform the user of an event. For example, the Datebook application sets alarms to inform users of their appointments. 
</p>
<p class="Body">
  <a name="1010561"> </a>Implementing such an alarm is a two step process. First, use the function <a href="AlarmManager.html#1081216"><span style="font-family: monospace">AlmSetAlarm</span></a> to set the alarm. Specify when the alarm should trigger and which application should be informed at that time. 
</p>
<p class="Body">
  <a name="1010569"> </a><a href="AttnsAndAlarms.html#1010571">Listing 9.5</a> shows how the Datebook application sets an alarm. 
</p>
<p class="CCodeCaption">
  <a name="1010571"> </a>Listing 9.5  Setting an alarm
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void SetTimeOfNextAlarm (UInt32 alarmTime, UInt32 ref)<a name="1010572"> </a>
{<a name="1010573"> </a>
    UInt16 cardNo;<a name="1010574"> </a>
    LocalID dbID;<a name="1010575"> </a>
    DmSearchStateType searchInfo;<a name="1010576"> </a>
 <a name="1010577"> </a>
    DmGetNextDatabaseByTypeCreator (true, &amp;searchInfo,
        sysFileTApplication, sysFileCDatebook, true, &amp;cardNo,
        &amp;dbID);<a name="1010578"> </a>
 <a name="1010579"> </a>
    AlmSetAlarm (cardNo, dbID, ref, alarmTime, true);<a name="1010580"> </a>
}<a name="1010581"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1010585"> </a>Second, have your <a href="SystemManager.html#1166472"><span style="font-family: monospace">PilotMain</span></a> function respond to the launch codes <a href="AppLaunchCodes.html#970299"><span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span></a> and <a href="AppLaunchCodes.html#970515"><span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span></a>. 
</p>
<p class="Body">
  <a name="1010594"> </a>When an alarm is triggered, the Alarm Manager notifies each application that set an alarm for that time via the <span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span> launch code. After each application has processed this launch code, the Alarm Manager sends each application <span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span> so that the application can display the alarm. The section <a href="AttnsAndAlarms.html#1010623">"Alarm Scenario"</a> gives more information about when these launch codes are received and what actions your application might take. For a specific example of responding to these launch codes, see the Datebook sample code included with Palm OS 3.5. 
</p>
<p class="Body">
  <a name="1010598"> </a>It's important to note the following:
</p>

  <a name="1010599"> </a><p class="B1Bullet"> &#8226; An application can have only one alarm pending at a time. If you call <span style="font-family: monospace">AlmSetAlarm</span> and then call it again before the first alarm has triggered, the Alarm Manager replaces the first alarm with the second alarm. You can use the <a href="AlarmManager.html#1081168"><span style="font-family: monospace">AlmGetAlarm</span></a> function to find out if the application has any alarms pending. </p>

  <a name="1010604"> </a><p class="B1Bullet"> &#8226; You do not have access to global variables or code outside segment 0 (in a multi-segment application) when you respond to the launch codes. <span style="font-family: monospace">AlmSetAlarm</span> takes a <span style="font-family: monospace">UInt32</span> parameter that you can use to pass a specific value so that you have access to it when the alarm triggers. (This is the <span style="font-family: monospace">ref</span> parameter shown in <a href="AttnsAndAlarms.html#1010571">Listing 9.5</a>.) The parameter blocks for both launch codes provide access to this reference parameter. If the reference parameter isn't sufficient, you can define an application feature. See the <a href="SystemFeatures.html#1013479">"Features"</a> section in the <a href="SystemFeatures.html#1013426">"Palm System Support"</a> chapter. </p>

  <a name="1010615"> </a><p class="B1Bullet"> &#8226; The database ID that you pass to <span style="font-family: monospace">AlmSetAlarm</span> is the local ID of the <b>application</b> (the <span style="font-family: monospace">.prc</span> file), not of the record database that the application accesses. You use record database's local ID more frequently than you do the application's local ID, so this is a common mistake to make. </p>

  <a name="1010616"> </a><p class="B1Bullet"> &#8226; In <span style="font-family: monospace">AlmSetAlarm</span>, the alarm time is given as the number of seconds since 1/1/1904. If you need to convert a conventional date and time value to the number of seconds since 1/1/1904, use <a href="DateAndTimeManager.html#1174674"><span style="font-family: monospace">TimDateTimeToSeconds</span></a>. </p>
<p class="Body">
  <a name="1010621"> </a>If you want to clear a pending alarm, call <span style="font-family: monospace">AlmSetAlarm</span> with 0 specified for the alarm seconds parameter. 
</p>

<h2 class="HBHeadB">
  <a name="1010623"> </a>Alarm Scenario
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010624"> </a>Here's how an application and the Alarm Manager typically interact when processing an alarm:
</p>
  <a name="1010628"> </a><p class="N1NumList">1.	  The application sets an alarm using <a href="AlarmManager.html#1081216"><span style="font-family: monospace">AlmSetAlarm</span></a>. </p><p class="Indented1"> <a name="1010629"> </a>The Alarm Manager adds the new alarm to its alarm queue. The alarm queue contains all alarm requests. Triggered alarms are queued up until the Alarm Manager can send the launch code to the application that created the alarm. However, if the alarm queue becomes full, the oldest entry that has been both triggered and notified is deleted to make room for a new alarm.</p>
  <a name="1010630"> </a><p class="N1NumList">2.	  When the alarm time is reached, the Alarm Manager searches the alarm queue for the first application that set an alarm for this alarm time.</p>  <a name="1010631"> </a><p class="N1NumList">3.	  The Alarm Manager sends this application the <a href="AppLaunchCodes.html#970299"><span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span></a> launch code.</p>  <a name="1010636"> </a><p class="N1NumList">4.	  The application can now:</p>  <a name="1010637"> </a><p class="B2BulletSub"> -	 Set the next alarm.</p>  <a name="1010638"> </a><p class="B2BulletSub"> -	 Play a short sound.</p>  <a name="1010639"> </a><p class="B2BulletSub"> -	 Perform some quick maintenance activity. </p><p class="Indented1"> <a name="1010640"> </a>The application should not perform any lengthy tasks in response to <span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span> because doing so delays other applications from receiving alarms that are set to trigger at the same time. </p>
<p class="Indented1"> <a name="1010641"> </a>If the application is using the Attention Manager to bring this alarm to the user's attention, call <a href="AttentionMgr.html#1083315"><span style="font-family: monospace">AttnGetAttention</span></a> here and set the <span style="font-family: monospace">purgeAlarm</span> field in the launch codes' parameter block to <span style="font-family: monospace">true</span> before returning.</p>
<p class="Indented1"> <a name="1010645"> </a>If this alarm requires no further processing, the application should set the <span style="font-family: monospace">purgeAlarm</span> field in the launch code's parameter block to <span style="font-family: monospace">true</span> before returning. Doing so removes the alarm from the queue, which means it won't receive the <a href="AppLaunchCodes.html#970515"><span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span></a> launch code.</p>
  <a name="1010649"> </a><p class="N1NumList">5.	  The Alarm Manager finds in the alarm queue the next application that set an alarm and repeats steps 2 and 3. </p>  <a name="1010650"> </a><p class="N1NumList">6.	  This process is repeated until no more applications are found with this alarm time.</p>  <a name="1010652"> </a><p class="N1NumList">7.	  The Alarm Manager then finds once again the first application in the alarm queue who set an alarm for this alarm time and sends this application the launch code <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: underline; text-transform: none; vertical-align: baseline">sysAppLaunchCmdDisplayAlarm</span>. Note that alarms that had their <span style="font-family: monospace">purgeAlarm</span> field set to <span style="font-family: monospace">true</span> during the processing of <span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span>-including all alarms that are being brought to the user's attention through the Attention Manager-are no longer in the queue at this point.</p>  <a name="1010654"> </a><p class="N1NumList">8.	  The application can now:</p>  <a name="1010655"> </a><p class="B2BulletSub"> -	 Display a dialog box.</p>  <a name="1010656"> </a><p class="B2BulletSub"> -	 Display some other type of reminder.</p><p class="Indented1"> <a name="1010657"> </a>Applications typically create a nested event loop at this point to handle the dialog's events. This nested event loop ignores virtually all events that would cause the dialog to go away, causing the dialog to be fixed on the screen; it can't be dismissed until one of the embedded buttons is tapped. Note that the currently active application remains active. You may not be able to see it (if the alarm dialog is full screen) and you cannot interact with it because the dialog's nested event loop is processing all events. It is effectively suspended, waiting for an event to occur.</p>
  <a name="1010658"> </a><p class="N1NumList">9.	  The Alarm Manager processes the alarm queue for the next application that set an alarm for the alarm being triggered and steps 7 and 8 are repeated. </p>  <a name="1010659"> </a><p class="N1NumList">10.	  This process is repeated until no more applications are found with this alarm time.</p><p class="Indented1"> <a name="1010660"> </a>If a new alarm time is triggered while an older alarm is still being displayed, all applications with alarms scheduled for this second alarm time are sent the <span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span> launch code, but the display cycle for the second set of alarms is postponed until all earlier alarms have finished displaying.</p>
<p class="Body">
  <a name="1010661"> </a>Note that when a second alarm goes off before the first has been dismissed, the alarm manager sends the <a href="AppLaunchCodes.html#970299"><span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span></a> launch code for the second alarm but waits to send the <a href="AppLaunchCodes.html#970515"><span style="font-family: monospace">sysAppLaunchCmdDisplayAlarm</span></a> launch code until after the first alarm's dialog has been dismissed. For applications that put up dialogs, this typically means that only one dialog at a time will appear on the screen. The Alarm Manager doesn't return to the event loop between the issuing of launch codes, so when the first alarm's dialog has been dismissed, the second alarm's dialog is immediately displayed. The net result for the user is that each alarm dialog in turn must be dismissed before the handheld can be used.
</p>

<h2 class="HBHeadB">
  <a name="1010669"> </a>Setting a Procedure Alarm
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1010671"> </a>Beginning with Palm OS version 3.2, the system supports setting procedure alarms in addition to the application-based alarms described in the previous sections. The differences between a procedure alarm and an application-based alarm are:
</p>

  <a name="1010672"> </a><p class="B1Bullet"> &#8226; When you set a procedure alarm, you specify a pointer to a function that should be called when the alarm triggers instead of an application that should be notified. </p>

  <a name="1010673"> </a><p class="B1Bullet"> &#8226; When the alarm triggers, the Alarm Manager calls the specified procedure directly instead of using launch codes. </p>

  <a name="1010675"> </a><p class="B1Bullet"> &#8226; If the system is in sleep mode, the alarm triggers without causing the LCD display to light up. </p>
<p class="Body">
  <a name="1010676"> </a>You might use procedure alarms if:
</p>

  <a name="1010677"> </a><p class="B1Bullet"> &#8226; You want to perform a background task that is completely hidden from the user. </p>

  <a name="1010678"> </a><p class="B1Bullet"> &#8226; You are writing a shared library and want to implement an alarm within that library. </p>

  <a name="1010683"> </a><p class="B1Bullet"> &#8226; You want to use <a href="AttentionMgr.html#1083611"><span style="font-family: monospace">AttnUpdate</span></a> to update an attention item, but you don't want the display to turn on if the handheld is currently sleeping.</p>
<p class="Body">
  <a name="1010689"> </a>To set a procedure alarm, you call <a href="AlarmManager.html#1081259"><span style="font-family: monospace">AlmSetProcAlarm</span></a> instead of <a href="AlarmManager.html#1081216"><span style="font-family: monospace">AlmSetAlarm</span></a>. (Similarly, you use the <a href="AlarmManager.html#1081189"><span style="font-family: monospace">AlmGetProcAlarm</span></a> function instead of <a href="AlarmManager.html#1081168"><span style="font-family: monospace">AlmGetAlarm</span></a> to see if any alarms are pending for this procedure.) 
</p>
<p class="Body">
  <a name="1010700"> </a><span style="font-family: monospace">AlmSetProcAlarm</span> is currently implemented as a macro that calls <span style="font-family: monospace">AlmSetAlarm</span> using a special value for the card number parameter to notify the Alarm Manager that this is a procedure alarm. Instead of specifying the application's local ID and card number, you specify a function pointer. The other rules for <span style="font-family: monospace">AlmSetAlarm</span> still apply. Notably, a given function can only have one alarm pending at a time, and you can clear any pending alarm by passing 0 for the alarm time. 
</p>
<p class="Body">
  <a name="1010701"> </a>When the alarm triggers, the Alarm Manager calls the function you specified. The function should have the prototype:
</p>
<pre  class="Preformatted">
void <i>myAlarmFunc</i> (UInt16 almProcCmd,
SysAlarmTriggeredParamType *paramP)<a name="1010702"> </a>
</pre>
<div class="NINoteImportant"><hr>
  <a name="1010703"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> The function pointer must remain valid from the time <span style="font-family: monospace">AlmSetProcAlarm</span> is called to the time the alarm is triggered. If the procedure is in a shared library, you must keep the library open. If the procedure is in a separately-loaded code resource, the resource must remain locked until the alarm fires. When you close a library or unlock a resource, you must remove any pending alarms. If you don't, the system crashes when the alarm is triggered. 
<hr>
</div>
<p class="Body">
  <a name="1010704"> </a>The first parameter to your function specifies why the Alarm Manager has called the function. Currently, the Alarm Manager calls the function in two instances:
</p>

  <a name="1010705"> </a><p class="B1Bullet"> &#8226; The alarm has triggered.</p>

  <a name="1010706"> </a><p class="B1Bullet"> &#8226; The user has changed the system time, so the alarm time should be adjusted. </p>
<p class="Body">
  <a name="1010707"> </a>The second parameter is the same structure that is passed with the <a href="AppLaunchCodes.html#970299"><span style="font-family: monospace">sysAppLaunchCmdAlarmTriggered</span></a> launch code. It provides access to the reference parameter specified when the alarm was set, the time specified when the alarm was set, and the <span style="font-family: monospace">purgeAlarm</span> field, which specifies if the alarm should be removed from the queue. In the case of procedure alarms, the alarm should always be removed from the queue. The system sets the <span style="font-family: monospace">purgeAlarm</span> value to <span style="font-family: monospace">true</span> after calling your function. 
</p>
<p class="Body">
  <a name="1010711"> </a>It is important to note that your procedure alarm function should not access global variables if the alarm could be triggered after the application that contains the procedure alarm function has terminated (even if the code remains locked in memory), since the globals no longer exist at this point.
</p>

<h4 class="HCHeadC">
  <a name="1010714"> </a>Procedure Alarms and Menus
</h4>
<p class="Body">
  <a name="1010715"> </a>Procedure alarms are often used to update the handheld's display on a regular basis. Menus aren't automatically informed when an alarm is triggered, so if a menu is open when your procedure alarm code updates the display, your code may overwrite the open menu. To detect an open menu, watch for <a href="EventRef.html#973541"><span style="font-family: monospace">winExitEvent</span></a> and <a href="EventRef.html#973500"><span style="font-family: monospace">winEnterEvent</span></a> as described in <a href="UserInterface.html#981702">"Checking Menu Visibility"</a> of the <i>Palm OS Programmer's Companion</i>, vol. I.
</p>

<h2 class="HaHeadA">
  <a name="1010731"> </a>Summary of Attentions and Alarms 
<a href="#1009989"><img src="images/top.gif" border="0"></a></h2>


<h5 class="TgTable">
  <a name="1010768"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1010734"> </a><div class="CellHeading">Attention Manager Functions</div></th>
    <th><a name="1010736"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td><a name="1010741"> </a><div class="CellBody"><a href="AttentionMgr.html#1083238">AttnDoSpecialEffects</a><br><a href="AttentionMgr.html#1083290">AttnForgetIt</a><br><a href="AttentionMgr.html#1083315">AttnGetAttention</a><br><a href="AttentionMgr.html#1083376">AttnGetCounts</a><br><a href="AttentionMgr.html#1083451">AttnIndicatorEnable</a></div></td>
    <td><a name="1010758"> </a><div class="CellBody"><a href="AttentionMgr.html#1083483">AttnIndicatorEnabled</a><br><a href="AttentionMgr.html#1083526">AttnIterate</a><br><a href="AttentionMgr.html#1083565">AttnListOpen</a><br><a href="AttentionMgr.html#1083611">AttnUpdate</a></div></td>
  </tr>
</table>




</h5>
<h5 class="TgTable">
  <a name="1010791"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1010772"> </a><div class="CellHeading">Alarm Manager Functions</div></th>
    <th><a name="1010774"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td><a name="1010779"> </a><div class="CellBody"><a href="AlarmManager.html#1081216">AlmSetAlarm</a><br><a href="AlarmManager.html#1081259">AlmSetProcAlarm</a></div></td>
    <td><a name="1010787"> </a><div class="CellBody"><a href="AlarmManager.html#1081168">AlmGetAlarm</a><br><a href="AlarmManager.html#1081189">AlmGetProcAlarm</a></div></td>
  </tr>
</table>




</h5>
&nbsp;<br>
				<!-- CONTENT_END -->

		</td>
		<td width="5">&nbsp;&nbsp;</td>
	</tr>
      </table>
    </td>
			</tr>
  <tr>
				<td>
					<table border="0" cellpadding="0" cellspacing="0" width="760">
        <!-- CONTENTCELL_END -->
        <tr valign="top"> 
          <td width="10">&nbsp;<!-- FOOTER_START --></td>
          <td width="72">&nbsp;</td>
          <td width="25" bgcolor="white" background="images/bkgrnd.gif">&nbsp;</td>
          <td width="600"> 
            <table border="0" cellpadding="0" cellspacing="0" width="600">
              <tr> 
                <td><img src="images/rule_10-1-5_ltblue.gif" width="600" height="16" border="0"></td>
              </tr>
              <tr> 
                <td> 
                  <p align="center" class="footer"> ©2002 PalmSource, Inc. and its affiliates.  All rights reserved. 
<a href="http://www.palmos.com/dev/training/">Training</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/">Palm&nbsp;OS&nbsp;Platform</a>&nbsp;|&nbsp;<a href="Companion_Front.html" target="_blank">Legal Notices</a>&nbsp;<br>
												<!-- FOOTER_END --><br>
											</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
				</td>
			</tr>
</table>
</BODY>
</HTML>