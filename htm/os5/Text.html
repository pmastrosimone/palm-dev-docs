<HTML>

<HEAD>
<SMALLSCREENIGNORE> 
<LINK HREF="copy_of_palmos.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="document.css" REL="StyleSheet" TYPE="text/css" media="screen">
<!-- SCRIPT_START -->
<!-- SCRIPT_END -->
</SMALLSCREENIGNORE>
<TITLE>Text</TITLE>

<META NAME="PALMTEMPLATE" CONTENT="1006-002 Palm HTML 20020513">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="TEMPLATEBASE" CONTENT="Palm HTML 20010625">
<META NAME="LASTUPDATED" CONTENT="12/13/02 10:05:50">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1">

</HEAD>

<BODY LEFTMARGIN="0" MARGINWIDTH="0" TOPMARGIN="0" MARGINHEIGHT="0">
<SMALLSCREENIGNORE> 
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td><a name="1006349"></a>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr height="35"> 
          <td height="35" colspan="2" bgcolor="#6699CC">&nbsp;</td>
        </tr>
        <tr valign="top"> 
          <td width="160" align="left"><a href="http://www.palmos.com"><img src="images/bigorb.gif" width="160" height="110" border="0"></a></td>
          <td align="left" width="100%"> 
            </SMALLSCREENIGNORE>
            <!-- CONTENTCELL_START -->
            <img border="0" height="45" src="images/orb_bkgrnd_600.gif" width="600"><br>
            <!--PAGENAV_START-->
            <SPAN CLASS="subnav">&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span><BR>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             <h2 class="HeadDocPage">8  Text</h2>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             &nbsp;<span class="subnav"><a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExpAndVFSConcepts.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AttnsAndAlarms.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a></span>  
            <!--PAGENAV_END-->
          </td>
        </tr>
      </table>
    </td>
			</tr>
  <tr>
				<td> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
							<td>&nbsp;&nbsp;&nbsp;</td>
						</tr>
        <tr>
		<td valign="top" width="10">&nbsp;&nbsp;&nbsp;</td>
		<td valign="top" width="175">
			<p class="SideTitle">Title - <br><a href="Companion_Front.html">Palm OS® Programmer's Companion</a></p>
			<p class="SideTOC1-PartTab">Volume I </p>
			<p class="SideTOC1"><a href="Text.html">8  Text</a></p>
			
<p class="SideTOC2">
<a href="#1006379">Text Manager and International Manager
</a></p>

<p class="SideTOC2">
<a href="#1006387">Characters
</a></p>

<p class="SideTOC3">
<a href="#1006415">Declaring Character Variables
</a></p>

<p class="SideTOC3">
<a href="#1006428">Using Character Constants
</a></p>

<p class="SideTOC3">
<a href="#1006437">Missing and Invalid Characters
</a></p>

<p class="SideTOC3">
<a href="#1006466">Retrieving a Character's Attributes
</a></p>

<p class="SideTOC3">
<a href="#1006471">Virtual Characters
</a></p>

<p class="SideTOC3">
<a href="#1006496">Retrieving the Character Encoding
</a></p>

<p class="SideTOC2">
<a href="#1006519">Strings
</a></p>

<p class="SideTOC3">
<a href="#1006564">Manipulating Strings
</a></p>

<p class="SideTOC3">
<a href="#1006616">Performing String Pointer Manipulation
</a></p>

<p class="SideTOC3">
<a href="#1006629">Truncating Displayed Text
</a></p>

<p class="SideTOC3">
<a href="#1006642">Comparing Strings
</a></p>

<p class="SideTOC3">
<a href="#1006659">Global Find
</a></p>

<p class="SideTOC3">
<a href="#1006766">Dynamically Creating String Content
</a></p>

<p class="SideTOC3">
<a href="#1006823">Using the StrVPrintF Function
</a></p>

<p class="SideTOC2">
<a href="#1006847">Fonts 
</a></p>

<p class="SideTOC3">
<a href="#1010319">Built-in Fonts
</a></p>

<p class="SideTOC3">
<a href="#1010559">Selecting Which Font to Use
</a></p>

<p class="SideTOC3">
<a href="#1019669">Fonts for High-Density Displays
</a></p>

<p class="SideTOC3">
<a href="#1017760">Setting the Font Programmatically
</a></p>

<p class="SideTOC3">
<a href="#1013923">Obtaining Font Information
</a></p>

<p class="SideTOC3">
<a href="#1010404">Creating Custom Fonts
</a></p>

<p class="SideTOC2">
<a href="#1018082">Summary of Text API
</a></p>

		</td>

		<td width="5">&nbsp;&nbsp;</td>
		<td width="1" bgcolor="#6699cc">&nbsp;</td>
		<td width="5">&nbsp;&nbsp;</td>
		<td> 

				<!-- CONTENT_START -->

<p class="Body">
  <a name="1006350"> </a>This chapter describes how to work with text in the user interface-whether it's text the user has entered or text that your application has created to display on the screen. When you work with text, you must take special care to do so in a way that makes your application easily localizable. This chapter describes how to write code that manipulates characters and strings in such a way that it works properly for any language that is supported by Palm OS<sup>®</sup>. It covers: 
</p>

  <a name="1006354"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006379">Text Manager and International Manager</a></p>

  <a name="1006358"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006387">Characters</a></p>

  <a name="1006362"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006519">Strings</a></p>

  <a name="1006366"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006847">Fonts</a></p>
<p class="Body">
  <a name="1006367"> </a>When you work with text, you work mainly with the Text Manager and the String Manager. Text Manager support begins in Palm OS 3.1. If you want to support releases earlier than Palm OS 3.1, use the PalmOSGlue library described in <a href="Nutshell.html#970278">"Backward Compatibility with PalmOSGlue."</a> This chapter notes all functions that have a glue equivalent in parentheses and shows code examples using the PalmOSGlue equivalents. 
</p>
<div class="NINoteImportant"><hr>
  <a name="1006371"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> Palm OS version 3.1 introduced some changes to the Latin character encoding and to some of the String Manager functions. If you are updating a legacy application written before the release of Palm OS 3.1, these changes may affect your application. See <a href="CompatibilityApdx.html#970279">"3.1 New Feature Set"</a> of the <i>Palm OS Programmer's API Reference</i> for details about these changes. 
<hr>
</div>

<h2 class="HaHeadA">
  <a name="1006379"> </a>Text Manager and International Manager 
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006380"> </a>The Palm OS provides two managers that help you work with localizable strings and characters. These managers are called the Text Manager and the International Manager. 
</p>
<p class="Body">
  <a name="1006381"> </a>Computers represent the characters in an alphabet with a numeric code. The set of numeric codes for a given alphabet is called a <b>character encoding</b>. Of course, a character encoding contains more than codes for the letters of an alphabet. It also encodes punctuation, numbers, control characters, and any other characters deemed necessary. The set of characters that a character encoding represents is called, appropriately enough, a <b>character set</b>. 
</p>
<p class="Body">
  <a name="1006382"> </a>Different languages use different alphabets. Most European languages use the Latin alphabet. The Latin alphabet is relatively small, so its characters can be represented using a single-byte encoding ranging from 32 to 255. On the other hand, Asian languages such as Chinese, Korean, and Japanese require their own alphabets, which are much larger. These larger character sets are represented by a combination of single-byte and double-byte numeric codes ranging from 32 to 65,535. 
</p>
<p class="Body">
  <a name="1006383"> </a>A given Palm Powered<sup>&#8482;</sup> handheld supports one character encoding. Although Palm OS supports multiple character encodings, a given handheld uses only one of those encodings. For example, a French handheld uses the Palm<sup>&#8482;</sup> Latin encoding, which is identical to the Microsoft<sup>®</sup> Windows<sup>®</sup> code page 1252 character encoding (an extension of ISO Latin 1) but includes Palm-specific characters in the control range. A Japanese handheld, on the other hand would use the Palm Shift JIS character encoding, which is identical to Microsoft Windows code page 932 (an extension of Shift JIS) but includes Palm-specific characters in the control range. Code page 932 is not supported on the French handheld, and code page 1252 is not supported on the Japanese handheld even though they both use the same version of Palm OS. No matter what the encoding is on a handheld, Palm guarantees that the low ASCII characters (0 to 0x7F) are the same. The exception to this rule is 0x5C, which is a yen symbol on Japanese handhelds and a backslash on all others.
</p>
<p class="Body">
  <a name="1006384"> </a>The Text Manager allows you to work with text, strings, and characters independent of the character encoding. If you use Text Manager routines and don't work directly with string data, your code should work on any system, regardless of which language and character encoding the handheld supports (as long as it supports the Text Manager). 
</p>
<p class="Body">
  <a name="1006385"> </a>The International Manager's job is to detect which character encoding a handheld uses and initialize the corresponding version of the Text Manager. The International Manager also sets system features that identify which encoding and fonts are used. For the most part, you don't work with the International Manager directly. 
</p>

<h2 class="HaHeadA">
  <a name="1006387"> </a>Characters 
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006388"> </a>Depending on the handheld's supported languages, Palm OS may encode characters using either a single-byte encoding or a multi-byte encoding. Because you do not know which character encoding is used until runtime, <b>you should never make an assumption about the size of a character</b>. 
</p>
<p class="Body">
  <a name="1006389"> </a>For the most part, your application does not need to know which character encoding is used, and in fact, it should make no assumptions about the encoding or about the size of characters. Instead, your code should use Text Manager functions to manipulate characters. This section describes how to work with characters correctly. It covers: 
</p>

  <a name="1006393"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006415">Declaring Character Variables</a></p>

  <a name="1006397"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006428">Using Character Constants</a></p>

  <a name="1006401"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006437">Missing and Invalid Characters</a></p>

  <a name="1006405"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006466">Retrieving a Character's Attributes</a></p>

  <a name="1006409"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006471">Virtual Characters</a></p>

  <a name="1006413"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006496">Retrieving the Character Encoding</a></p>

<h2 class="HBHeadB">
  <a name="1006415"> </a>Declaring Character Variables
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006417"> </a>Declare all character variables to be of type <span style="font-family: monospace">WChar</span>. <span style="font-family: monospace">WChar</span> is a 16-bit unsigned type that can accommodate characters of any encoding. Don't use <span style="font-family: monospace">Char</span>. <span style="font-family: monospace">Char</span> is an 8-bit variable that cannot accommodate larger character encodings. The only time you should ever use <span style="font-family: monospace">Char</span> is to pass a parameter to an older Palm OS function. 
</p>
<pre  class="Preformatted">
WChar ch; // Right. 16-bit character. <a name="1006419"> </a>
Char ch; // Wrong. 8-bit character. <a name="1006420"> </a>
</pre>
<p class="Body">
  <a name="1006422"> </a>When you receive input characters through the <span style="font-family: monospace">keyDownEvent</span>, you'll receive a <span style="font-family: monospace">WChar</span> value. (That is, the <span style="font-family: monospace">data.keyDown.chr</span> field is a <span style="font-family: monospace">WChar</span>.)
</p>
<p class="Body">
  <a name="1006423"> </a>Even though character variables are now declared as <span style="font-family: monospace">WChar</span>, string variables are still declared as <span style="font-family: monospace">Char *</span>, even though they may contain multi-byte characters. See the section <a href="Text.html#1006519">"Strings"</a> for more information on strings. 
</p>

<h2 class="HBHeadB">
  <a name="1006428"> </a>Using Character Constants
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006429"> </a>Character constants are defined in several header files. The header file <span style="font-family: monospace">Chars.h</span> contains characters that are guaranteed to be supported on all systems regardless of the encoding. Other header files exist for each supported character encoding and contain characters specific to that encoding. The character encoding-specific header files are not included in the <span style="font-family: monospace">PalmOS.h</span> header by default because they define characters that are not available on every system. 
</p>
<p class="Body">
  <a name="1006431"> </a>To make it easier for the compiler to find character encoding problems with your project, make a practice of using the character constants defined in these header files rather than directly assigning a character variable to a value. For example, suppose your code contained this statement: 
</p>
<pre  class="Preformatted">
WChar ch = 'å'; // WRONG! Don't use. <a name="1006432"> </a>
</pre>
<p class="Body">
  <a name="1006433"> </a>This statement may work on a Latin system, but it would cause problems on an Asian-language system because the å character does not exist. If you instead assign the value this way:
</p>
<pre  class="Preformatted">
WChar ch = chrSmall_A_RingAbove; <a name="1006434"> </a>
</pre>
<p class="Body">
  <a name="1006435"> </a>you'll find the problem at compile time because the <span style="font-family: monospace">chrSmall_A_RingAbove</span> constant is defined in <span style="font-family: monospace">CharLatin.h</span>, which is not included by default. 
</p>

<h2 class="HBHeadB">
  <a name="1006437"> </a>Missing and Invalid Characters
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006438"> </a>If during application testing, you see an open rectangle, a shaded rectangle, or a gray square displayed on the screen, you have a missing character. 
</p>
<p class="Body">
  <a name="1006439"> </a>A <b>missing character</b> is one that is valid within the character encoding but the current font is not able to display it. In this case, nothing is wrong with your code other than you have chosen the wrong font. The system displays an open rectangle in place of a missing single-byte rectangle (see <a href="Text.html#1006444">Figure 8.1</a>). 
</p>

<p class="FFigureCaption">
  <a name="1006444"> </a>Figure 8.1	 Missing characters
</p>
<p class="FgFigure">
  <a name="1006448"> </a><div align="left"><img src="images/Texta.gif" height="40" width="360" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1006449"> </a>In multi-byte character encodings, a character may be missing as described above, or it may be invalid. In single-byte character encodings, there's a one-to-one correspondence between numeric values and characters to represent. This is not the case with multi-byte character encodings. In multi-byte character encodings, there are more possible values than there are characters to represent. Thus, a character variable could end up containing an <b>invalid character</b>-a value that doesn't actually represent a character. 
</p>
<p class="Body">
  <a name="1006450"> </a>If the system is asked to display an invalid character, it prints an open rectangle for the first invalid byte. Then it starts over at the next byte. Thus, the next character displayed and possibly even the remaining text displayed is probably not what you want. Check your code for the following: 
</p>

  <a name="1006451"> </a><p class="B1Bullet"> &#8226; Truncating strings. You might have truncated a string in the middle of a multi-byte character.</p>

  <a name="1006452"> </a><p class="B1Bullet"> &#8226; Appending characters from one encoding set to a string in a different encoding. </p>

  <a name="1006453"> </a><p class="B1Bullet"> &#8226; Arithmetic on character variables that could result in an invalid character value. </p>

  <a name="1006454"> </a><p class="B1Bullet"> &#8226; Arithmetic on a string pointer that could result in pointing to an intra-character boundary. See <a href="Text.html#1006616">"Performing String Pointer Manipulation"</a> for more information. </p>

  <a name="1006458"> </a><p class="B1Bullet"> &#8226; Assumptions that a character is always a single byte long. </p>
<p class="Body">
  <a name="1006463"> </a>Use the Text Manager function <a href="TextMgr.html#1169062"><span style="font-family: monospace">TxtCharIsValid</span></a> (<span style="font-family: monospace">TxtGlueCharIsValid</span>) to determine whether a character is valid or not. 
</p>

<h2 class="HBHeadB">
  <a name="1006466"> </a>Retrieving a Character's Attributes
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006467"> </a>The Text Manager defines certain functions that retrieve a character's attributes, such as whether the character is alphanumeric, and so on. You can use these functions on any character, regardless of its size and encoding. 
</p>
<p class="Body">
  <a name="1006468"> </a>A character also has attributes unique to its encoding. Functions to retrieve those attributes are defined in the header files specific to the encoding. 
</p>
<div class="NWNoteWarning"><hr>
  <a name="1006469"> </a> <span style="color: #FF0000;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">WARNING!  </span> In previous versions of the Palm OS, the header file <span style="font-family: monospace">CharAttr.h</span> defined character attribute macros such as <span style="font-family: monospace">IsAscii</span>. Using these macros on double-byte characters produces incorrect results. Use the Text Manager macros instead of the <span style="font-family: monospace">CharAttr.h</span> macros. 
<hr>
</div>

<h2 class="HBHeadB">
  <a name="1006471"> </a>Virtual Characters
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006472"> </a>Virtual characters are nondisplayable characters that trigger special events in the operating system, such as displaying low battery warnings or displaying the keyboard dialog. Virtual characters should never occur in any data and should never appear on the screen. 
</p>
<p class="Body">
  <a name="1006473"> </a>The Palm OS uses character codes 256 decimal and greater for virtual characters. The range for these characters may actually overlap the range for "real" characters (characters that should appear on the screen). The <span style="font-family: monospace">keyDownEvent</span> distinguishes a virtual character from a displayable character by setting the command bit in the event record. 
</p>
<p class="Body">
  <a name="1006474"> </a>The best way to check for virtual characters, including virtual characters that represent the hard keys, is to use the <a href="PalmOSGlueLib.html#1387032"><span style="font-family: monospace">TxtGlueCharIsVirtual</span></a> function defined in the PalmOSGlue library. See <a href="Text.html#1006483">Listing 8.1</a>. 
</p>
<p class="CCodeCaption">
  <a name="1006483"> </a>Listing 8.1  Checking for virtual characters
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
if (TxtGlueCharIsVirtual (eventP-&gt;data.keyDown.modifiers, <a name="1006484"> </a>
   eventP-&gt;data.keyDown.chr)) {<a name="1006485"> </a>
   if (TxtCharIsHardKey (event-&gt;data.keyDown.modifiers, <a name="1006486"> </a>
      event-&gt;data.keyDown.chr)) {<a name="1006487"> </a>
      // Handle hard key virtual character.<a name="1006488"> </a>
   } else {<a name="1006489"> </a>
      // Handle standard virtual character.<a name="1006490"> </a>
   }<a name="1006491"> </a>
} else {<a name="1006492"> </a>
   // Handle regular character.<a name="1006493"> </a>
}<a name="1006494"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1006496"> </a>Retrieving the Character Encoding
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006497"> </a>Occasionally, you may need to determine which character encoding is being used. For example, your application may need to do some unique text manipulation if it is being run on a European handheld. You can retrieve the character encoding from the system feature set using the <span style="font-family: monospace">FtrGet</span> function as shown in <a href="Text.html#1006503">Listing 8.2</a>. 
</p>
<p class="CCodeCaption">
  <a name="1006503"> </a>Listing 8.2  Retrieving the character encoding
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
UInt32 encoding; <a name="1006504"> </a>
Char* encodingName;<a name="1006505"> </a>
if (FtrGet(sysFtrCreator, sysFtrNumEncoding, &amp;encoding) != 0)
   encoding = charEncodingPalmLatin; <a name="1006506"> </a>
   //default encoding<a name="1006507"> </a>
if (encoding == charEncodingPalmSJIS) {<a name="1006508"> </a>
   // encoding for Palm Shift-JIS<a name="1006509"> </a>
} else if (encoding == charEncodingPalmLatin) {<a name="1006510"> </a>
   // extension of ISO Latin 1<a name="1006511"> </a>
}<a name="1006512"> </a>
 <a name="1006513"> </a>
// The following Text Manager function returns the <a name="1006514"> </a>
// official name of the encoding as required by <a name="1006515"> </a>
// Internet applications. <a name="1006516"> </a>
encodingName = TxtGlueEncodingName(encoding);<a name="1006517"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HaHeadA">
  <a name="1006519"> </a>Strings 
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006520"> </a>When working with text as strings, you use the String Manager and the Text Manager. 
</p>
<p class="Body">
  <a name="1006522"> </a>The String Manager is supported in all releases of Palm OS. It is closely modeled after the standard C string-manipulation functions like <span style="font-family: monospace">strcpy</span>, <span style="font-family: monospace">strcat</span>, and so on. Note that the standard C functions are not built in to Palm OS. Use String Manager calls instead of standard C calls to make your application smaller. 
</p>
<p class="Body">
  <a name="1006523"> </a>The Text Manager was added in Palm OS 3.1 to provide support for multi-byte strings. On systems that support the Text Manager, strings are made up of characters that are either a single-byte long or multiple bytes long, up to four bytes. As stated previously, character variables are always two bytes long. However, when you add a character to a string, the operating system may shrink it down to a single byte if it's a low ASCII character. Thus, any string that you work with may contain a mix of single-byte and multi-byte characters. 
</p>
<p class="Body">
  <a name="1006524"> </a>Applications can use both the Text Manager and the String Manager to work with strings. The String Manager functions in Palm OS 3.1 and later can work with strings containing multi-byte characters. Use the Text Manager functions when:
</p>

  <a name="1006525"> </a><p class="B1Bullet"> &#8226; A String Manager equivalent is not available. </p>

  <a name="1006526"> </a><p class="B1Bullet"> &#8226; The length of the matching strings are important. For example, to compare two strings, you can use either <a href="StringManager.html#1154398"><span style="font-family: monospace">StrCompare</span></a> or <a href="TextMgr.html#1169185"><span style="font-family: monospace">TxtCompare</span></a>. The difference between the two is that <span style="font-family: monospace">StrCompare</span> does not return the length of the characters that matched. <span style="font-family: monospace">TxtCompare</span> does. </p>
<p class="Body">
  <a name="1006533"> </a>This section discusses the following topics:
</p>

  <a name="1006537"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006564">Manipulating Strings</a></p>

  <a name="1006541"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006616">Performing String Pointer Manipulation</a></p>

  <a name="1006545"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006629">Truncating Displayed Text</a></p>

  <a name="1006549"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006642">Comparing Strings</a></p>

  <a name="1006553"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006659">Global Find</a></p>

  <a name="1006557"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006766">Dynamically Creating String Content</a></p>

  <a name="1006561"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1006823">Using the StrVPrintF Function</a></p>
<div class="NINoteImportant"><hr>
  <a name="1006562"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">TIP:  </span> Many of the pre-3.1 Palm OS functions have been modified to work with strings containing multi-byte characters. All Palm OS functions that return the length of a string, such as <span style="font-family: monospace">FldGetTextLength</span> and <span style="font-family: monospace">StrLen</span>, always return the size of the string in bytes, not the number of characters in the string. Similarly, functions that work with string offsets always use the offset in bytes, not characters.
<hr>
</div>

<h2 class="HBHeadB">
  <a name="1006564"> </a>Manipulating Strings
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006565"> </a>Any time that you want to work with character pointers, you need to be careful not to point to an intra-character boundary (a middle or end byte of a multi-byte character). For example, any time that you want to set the insertion point position in a text field or set the text field's selection, you must make sure that you use byte offsets that point to inter-character boundaries. (The <b>inter-character boundary</b> is both the start of one character and the end of the previous character, except when the offset points to the very beginning or very end of a string.) 
</p>
<p class="Body">
  <a name="1006566"> </a>Suppose you want to iterate through a string character by character. Traditionally, C code uses a character pointer or byte counter to iterate through a string a character at a time. Such code will not work properly on systems with multi-byte characters. Instead, if you want to iterate through a string a character at a time, use Text Manager functions: 
</p>

  <a name="1006571"> </a><p class="B1Bullet"> &#8226; <a href="TextMgr.html#1169454"><span style="font-family: monospace">TxtGetNextChar</span></a> (<span style="font-family: monospace">TxtGlueGetNextChar</span>) retrieves the next character in a string. </p>

  <a name="1006576"> </a><p class="B1Bullet"> &#8226; <a href="TextMgr.html#1169495"><span style="font-family: monospace">TxtGetPreviousChar</span></a> (<span style="font-family: monospace">TxtGlueGetPreviousChar) </span>retrieves the previous character in a string. </p>

  <a name="1006581"> </a><p class="B1Bullet"> &#8226; <a href="TextMgr.html#1169830"><span style="font-family: monospace">TxtSetNextChar</span></a> (<span style="font-family: monospace">TxtGlueSetNextChar) </span>changes the next character in a string and can be used to fill a string buffer. </p>
<p class="Body">
  <a name="1006582"> </a>Each of these three functions returns the size of the character in question, so you can use it to determine the offset to use for the next character. For example, <a href="Text.html#1006587">Listing 8.3</a> shows how to iterate through a string character by character until a particular character is found. 
</p>
<p class="CCodeCaption">
  <a name="1006587"> </a>Listing 8.3  Iterating through a string or text
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Char* buffer; // assume this exists<a name="1006588"> </a>
UInt16 bufLen = StrLen(buffer); <a name="1006589"> </a>
// Length of the input text. <a name="1006590"> </a>
WChar ch = 0;<a name="1006591"> </a>
UInt16 i = 0;<a name="1006592"> </a>
while ((i &lt; bufLen) &amp;&amp; (ch != chrAsterisk))<a name="1006593"> </a>
   i+= TxtGlueGetNextChar(buffer, i, &amp;ch));<a name="1006594"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1006595"> </a>The Text Manager also contains functions that let you determine the size of a character in bytes without iterating through the string: 
</p>

  <a name="1006600"> </a><p class="B1Bullet"> &#8226; <a href="TextMgr.html#1169095"><span style="font-family: monospace">TxtCharSize</span></a> (<span style="font-family: monospace">TxtGlueCharSize</span>) returns how much space a given character will take up inside of a string. </p>

  <a name="1006605"> </a><p class="B1Bullet"> &#8226; <a href="TextMgr.html#1168618"><span style="font-family: monospace">TxtCharBounds</span></a> (<span style="font-family: monospace">TxtGlueCharBounds</span>) determines the boundaries of a given character within a given string. </p>
<p class="CCodeCaption">
  <a name="1006607"> </a>Listing 8.4  Working with arbitrary limits
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
UInt32* charStart, charEnd;<a name="1006608"> </a>
Char* fldTextP = FldGetTextPtr(fld);<a name="1006609"> </a>
TxtGlueCharBounds(fldTextP, <a name="1006610"> </a>
   min(kMaxBytesToProcess, FldGetTextLength(fld)), <a name="1006611"> </a>
   &amp;charStart, &amp;charEnd);<a name="1006612"> </a>
// process only the first charStart bytes of text.<a name="1006613"> </a>
 <a name="1006614"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1006616"> </a>Performing String Pointer Manipulation
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006617"> </a>Never perform any pointer manipulation on strings you pass to the Text Manager unless you use Text Manager calls to do the manipulation. For Text Manager functions to work properly, the string pointer must point to the first byte of a character. If you use Text Manager functions when manipulating a string pointer, you can be certain that your pointer always points to the beginning of a character. Otherwise, you run the risk of pointing to an inter-character boundary. 
</p>
<p class="CCodeCaption">
  <a name="1006618"> </a>Listing 8.5  String pointer manipulation
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
// WRONG! buffer + kMaxStrLength is not <a name="1006619"> </a>
// guaranteed to point to start of character.<a name="1006620"> </a>
buffer[kMaxStrLength] = '\0';<a name="1006621"> </a>
 <a name="1006622"> </a>
// Right. Truncate at a character boundary.<a name="1006623"> </a>
UInt32 charStart, charEnd;<a name="1006624"> </a>
TxtCharBounds(buffer, kMaxStrLength, <a name="1006625"> </a>
  &amp;charStart, &amp;charEnd);<a name="1006626"> </a>
TxtGlueSetNextChar(buffer, charStart, chrNull);<a name="1006627"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1006629"> </a>Truncating Displayed Text
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006630"> </a>If you're performing drawing operations, you often have to determine where to truncate a string if it's too long to fit in the available space. Two functions help you perform this task on strings with multi-byte characters:
</p>

  <a name="1006635"> </a><p class="B1Bullet"> &#8226; <a href="Window.html#1196747"><span style="font-family: monospace">WinDrawTruncChars</span></a> (<span style="font-family: monospace">WinGlueDrawTruncChars</span>) - This function draws a string within a specified width, determining automatically where to truncate the string. If it can, it draws the entire string. If the string doesn't fit in the space, it draws one less than the number of characters that fit and then ends the string with an ellipsis (...). </p>

  <a name="1006640"> </a><p class="B1Bullet"> &#8226; <a href="Font.html#1122904"><span style="font-family: monospace">FntWidthToOffset</span></a> (<span style="font-family: monospace">FntGlueWidthToOffset</span>) - This function returns the byte offset of the character displayed at a given pixel position. It can also return the width of the text up to that offset. </p>
<p class="Indented1"> <a name="1016740"> </a><a href="Text.html#1016607">Listing 8.6</a> shows how you can use <span style="font-family: monospace">FntWidthToOffset</span> to determine how many lines are necessary to write a string to the screen. This example passes 160 as the pixel position so that upon return, <span style="font-family: monospace">widthToOffset</span> contains the byte offset of the last character in the string that can be displayed on a single line. The characters up to and including the one at <span style="font-family: monospace">widthToOffset</span> are drawn, then the <span style="font-family: monospace">msg</span> pointer is advanced in the string by <span style="font-family: monospace">widthToOffset</span> characters, and <span style="font-family: monospace">FntWidthToOffset</span> is called again to find out how many characters fit on the next line of text. The process is repeated until all of the characters in the string have been drawn. </p>
<p class="CCodeCaption">
  <a name="1016607"> </a>Listing 8.6  Drawing multiple lines of text
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Coord y;<a name="1016729"> </a>
Char *msg;<a name="1016612"> </a>
Int16 msgWidth;<a name="1016613"> </a>
Int16 widthToOffset = 0;<a name="1016614"> </a>
Int16 pixelWidth = 160;<a name="1016615"> </a>
Int16 msgLength = StrLen(msg);<a name="1016616"> </a>
<a name="1016617"> </a>
while (msg &amp;&amp; *msg) {<a name="1016618"> </a>
   widthToOffset = FntGlueWidthToOffset(msg, msgLength, <a name="1016619"> </a>
      pixelWidth, NULL, &amp;msgWidth);<a name="1016702"> </a>
   WinDrawChars(msg, widthToOffset, 0, y);<a name="1016620"> </a>
   y += FntLineHeight();<a name="1016621"> </a>
   msg += widthToOffset;<a name="1016622"> </a>
   msgLength = StrLen(msg);<a name="1016623"> </a>
}<a name="1016624"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1006642"> </a>Comparing Strings
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006647"> </a>Use the Text Manager functions <a href="TextMgr.html#1169185"><span style="font-family: monospace">TxtCompare</span></a> (<span style="font-family: monospace">TxtGlueCompare</span>) and <a href="TextMgr.html#1168483"><span style="font-family: monospace">TxtCaselessCompare</span></a> (<span style="font-family: monospace">TxtGlueCaselessCompare</span>) to perform comparisons of strings. 
</p>
<p class="Body">
  <a name="1006652"> </a>In character encodings that use multi-byte characters, some characters are accurately represented as either single-byte characters or multi-byte characters. That is, a character might have both a single-byte representation and a double-byte representation. One string might use the single-byte representation and another might use the multi-byte representation. Users expect the characters to match regardless of how many bytes a string uses to store that character. <span style="font-family: monospace">TxtCompare</span> and <span style="font-family: monospace">TxtCaselessCompare</span> can accurately match single-byte characters with their multi-byte equivalents. 
</p>
<p class="Body">
  <a name="1006653"> </a>Because a single-byte character might be matched with a multi-byte character, two strings might be considered equal even though they have different lengths. For this reason, <span style="font-family: monospace">TxtCompare</span> and <span style="font-family: monospace">TxtCaselessCompare</span> take two parameters in which they pass back the length of matching text in each of the two strings. See the function descriptions in the <i>Palm OS Programmer's API Reference</i> for more information. 
</p>
<p class="Body">
  <a name="1006657"> </a>Note that the String Manager functions <span style="font-family: monospace">StrCompare</span> and <span style="font-family: monospace">StrCaselessCompare</span> are equivalent, but they do not pass back the length of the matching text. 
</p>

<h2 class="HBHeadB">
  <a name="1006659"> </a>Global Find
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006660"> </a>A special case of performing string comparison is implementing the global system find facility. To implement this facility, you should call <a href="TextMgr.html#1169371"><span style="font-family: monospace">TxtFindString</span></a> (<span style="font-family: monospace">TxtGlueFindString</span>). As with <span style="font-family: monospace">TxtCompare</span> and <span style="font-family: monospace">TxtCaselessCompare</span>, <span style="font-family: monospace">TxtFindString</span> accurately matches single-byte characters with their corresponding multi-byte characters. Plus, it passes back the length of the matched text. You'll need this value to highlight the matching text when the system requests that you display the matching record. 
</p>
<p class="Body">
  <a name="1006669"> </a>Older versions of Palm OS use the function <a href="Find.html#1019744"><span style="font-family: monospace">FindStrInStr</span></a>. <span style="font-family: monospace">FindStrInStr</span> is not able to return the length of the matching text. Instead, it assumes that characters within the string are always one byte long. 
</p>
<p class="Body">
  <a name="1006670"> </a>When the user taps the Find icon, the system sends the launch code <a href="AppLaunchCodes.html#970719"><span style="font-family: monospace">sysAppLaunchCmdFind</span></a> to each application. <a href="Text.html#1006692">Listing 8.7</a> shows an example of a function that should be called in response to that launch code. This function implements a global find that works on all systems whether the Text Manager exists or not. When the user taps one of the results displayed in the Find Results dialog, the system sends a <a href="AppLaunchCodes.html#970812"><span style="font-family: monospace">sysAppLaunchCmdGoto</span></a> launch code to the application containing the matching record. <a href="Text.html#1006735">Listing 8.8</a> shows how to respond to the <span style="font-family: monospace">sysAppLaunchCmdGoto</span> launch code. 
</p>
<p class="Body">
  <a name="1006685"> </a>These two listings are only code excerpts. For the complete implementation of these two functions, see the example code in the Palm OS SDK. 
</p>
<p class="Body">
  <a name="1006686"> </a>Note that if you want to use <span style="font-family: monospace">TxtFindString</span> to implement a search within your application (as opposed to the global find facility), you need to call <a href="PalmOSGlueLib.html#1387192"><span style="font-family: monospace">TxtGluePrepFindString</span></a> before you call <span style="font-family: monospace">TxtFindString</span> to ensure that the string is in the proper format. (In the global find facility, the system has already prepared the string before your code is executed.) 
</p>
<p class="CCodeCaption">
  <a name="1006692"> </a>Listing 8.7  Implementing global find 
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void Search (FindParamsPtr findParams)<a name="1006693"> </a>
{<a name="1006694"> </a>
   UInt16 recordIndex = 0;<a name="1006695"> </a>
   DmOpenRef dbP;<a name="1006696"> </a>
   UInt16 cardNo = 0;<a name="1006697"> </a>
   LocalID dbID;<a name="1006698"> </a>
   MemoDBRecordPtr memoPadRecP;<a name="1006699"> </a>
 <a name="1006700"> </a>
 <a name="1006701"> </a>
   // Open the database to be searched.<a name="1006702"> </a>
   dbP = DmOpenDatabaseByTypeCreator(memoDBType, <a name="1006703"> </a>
      sysFileCMemo, findParams-&gt;dbAccesMode);<a name="1006704"> </a>
   DmOpenDatabaseInfo(dbP, &amp;dbID, 0, 0, &amp;cardNo, <a name="1006705"> </a>
      0);<a name="1006706"> </a>
 <a name="1006707"> </a>
   // Get first record to search. <a name="1006708"> </a>
   memoRecP = GetRecordPtr(dbP, recordIndex);<a name="1006709"> </a>
   while (memoRecP != NULL) {<a name="1006710"> </a>
      Boolean done;<a name="1006711"> </a>
      Boolean match;<a name="1006712"> </a>
      UInt32 matchPos, matchLength;<a name="1006713"> </a>
 <a name="1006714"> </a>
      // TxtGlueFindString calls TxtFindString if it<a name="1006715"> </a>
      // exists, or else it implements the Latin<a name="1006716"> </a>
      // equivalent of it. <a name="1006717"> </a>
      match = TxtGlueFindString (&amp;(memoRecP-&gt;note), <a name="1006718"> </a>
         findParams-&gt;strToFind, &amp;matchPos, <a name="1006719"> </a>
         &amp;matchLength);<a name="1006720"> </a>
      <a name="1006721"> </a>
      if (match) {<a name="1006722"> </a>
         done = FindSaveMatch (findParams, <a name="1006723"> </a>
            recordIndex, matchPos, 0, matchLength,<a name="1006724"> </a>
            cardNo, dbIDP);<a name="1006725"> </a>
      }<a name="1006726"> </a>
      MemPtrUnlock (memoRecP);<a name="1006727"> </a>
 <a name="1006728"> </a>
      if (done) break;<a name="1006729"> </a>
      recordIndex += 1;<a name="1006730"> </a>
   }<a name="1006731"> </a>
   DmCloseDatabase (dbP);<a name="1006732"> </a>
}<a name="1006733"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="CCodeCaption">
  <a name="1006735"> </a>Listing 8.8  Displaying the matching record
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void GoToRecord (GoToParamsPtr goToParams, Boolean launchingApp)<a name="1006736"> </a>
{<a name="1006737"> </a>
   UInt16 recordNum;<a name="1006738"> </a>
   EventType event;<a name="1006739"> </a>
 <a name="1006740"> </a>
   recordNum = goToParams-&gt;recordNum;<a name="1006741"> </a>
   ...<a name="1006742"> </a>
 <a name="1006743"> </a>
   // Send an event to goto a form and select the <a name="1006744"> </a>
   // matching text.<a name="1006745"> </a>
   MemSet (&amp;event, sizeof(EventType), 0);<a name="1006746"> </a>
 <a name="1006747"> </a>
   event.eType = frmLoadEvent;<a name="1006748"> </a>
   event.data.frmLoad.formID = EditView;<a name="1006749"> </a>
   EvtAddEventToQueue (&amp;event);<a name="1006750"> </a>
 <a name="1006751"> </a>
   MemSet (&amp;event, sizeof(EventType), 0);<a name="1006752"> </a>
   event.eType = frmGotoEvent;<a name="1006753"> </a>
   event.data.frmGoto.recordNum = recordNum;<a name="1006754"> </a>
   event.data.frmGoto.matchPos = <a name="1006755"> </a>
      goToParams-&gt;matchPos;<a name="1006756"> </a>
   event.data.formGoto.matchLen = <a name="1006757"> </a>
      goToParams-&gt;matchCustom;<a name="1006758"> </a>
   event.data.frmGoto.matchFieldNum = <a name="1006759"> </a>
      goToParams-&gt;matchFieldNum;<a name="1006760"> </a>
   event.data.frmGoto.formID = EditView;<a name="1006761"> </a>
   EvtAddEventToQueue (&amp;event);<a name="1006762"> </a>
   ...<a name="1006763"> </a>
}<a name="1006764"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1006766"> </a>Dynamically Creating String Content
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006767"> </a>When working with strings in a localized application, you never hard code them. Instead, you store strings in a resource and use the resource to display the text. If you need to create the contents of the string at runtime, store a template for the string as a resource and then substitute values as needed. 
</p>
<p class="Body">
  <a name="1006768"> </a>For example, consider the Edit view of the Memo application. Its title bar contains a string such as "Memo 3 of 10." The number of the memo being displayed and the total number of memos cannot be determined until runtime. 
</p>
<p class="Body">
  <a name="1006769"> </a>To create such a string, use a template resource and the Text Manager function <a href="TextMgr.html#1169696"><span style="font-family: monospace">TxtParamString</span></a> (<span style="font-family: monospace">TxtGlueParamString</span>). <span style="font-family: monospace">TxtParamString</span> allows you to search for the sequence ^0, ^1, up to ^3 and replace each of these with a different string. If you need more parameters, you can use <a href="TextMgr.html#1169800"><span style="font-family: monospace">TxtReplaceStr</span></a> (<span style="font-family: monospace">TxtGlueReplaceStr</span>), which allows you to replace up to ^9; however, <span style="font-family: monospace">TxtReplaceStr</span> only allows you to replace one of these sequences at a time. 
</p>
<p class="Body">
  <a name="1006778"> </a>In the Memo title bar example, you'd create a string resource that looks like this:
</p>
<pre  class="Preformatted">
Memo ^0 of ^1<a name="1006779"> </a>
</pre>
<p class="Body">
  <a name="1006780"> </a>And your code might look like this: 
</p>
<p class="CCodeCaption">
  <a name="1006781"> </a>Listing 8.9  Using string templates
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void EditViewSetTitle (void)<a name="1006782"> </a>
{<a name="1006783"> </a>
   Char* titleTemplateP;<a name="1006784"> </a>
   FormPtr frm;<a name="1006785"> </a>
   Char posStr [maxStrIToALen];<a name="1006786"> </a>
   Char totalStr [maxStrIToALen];<a name="1006787"> </a>
   UInt16 pos;<a name="1006788"> </a>
   UInt16 length;<a name="1006789"> </a>
 <a name="1006790"> </a>
   // Format as strings, the memo's postion within <a name="1006791"> </a>
   // its category, and the total number of memos <a name="1006792"> </a>
   // in the category.<a name="1006793"> </a>
   pos = DmPositionInCategory (MemoPadDB, <a name="1006794"> </a>
      CurrentRecord, RecordCategory);<a name="1006795"> </a>
   StrIToA (posStr, pos+1);<a name="1006796"> </a>
 <a name="1006797"> </a>
   if (MemosInCategory == memosInCategoryUnknown)<a name="1006798"> </a>
      MemosInCategory = DmNumRecordsInCategory <a name="1006799"> </a>
         (MemoPadDB, RecordCategory);<a name="1006800"> </a>
   StrIToA (totalStr, MemosInCategory);<a name="1006801"> </a>
 <a name="1006802"> </a>
   // Get the title template string.  It contains <a name="1006803"> </a>
   // '^0' and '^1' chars which we replace with the <a name="1006804"> </a>
   // position of CurrentRecord within <a name="1006805"> </a>
   // CurrentCategory and with the total count of <a name="1006806"> </a>
   // records in CurrentCategory ().<a name="1006807"> </a>
   titleTemplateP = MemHandleLock (DmGetResource <a name="1006808"> </a>
      (strRsc, EditViewTitleTemplateStringString));<a name="1006809"> </a>
 <a name="1006810"> </a>
   EditViewTitlePtr = <a name="1006811"> </a>
      TxtGlueParamString(titleTemplateP, posStr, <a name="1006812"> </a>
      totalStr, NULL, NULL);<a name="1006813"> </a>
 <a name="1006814"> </a>
   // Now set the title to use the new title <a name="1006815"> </a>
   // string.<a name="1006816"> </a>
   frm = FrmGetFormPtr (MemoPadEditForm);<a name="1006817"> </a>
   FrmSetTitle (frm, EditViewTitlePtr);<a name="1006818"> </a>
   MemPtrUnlock(titleTemplateP);<a name="1006819"> </a>
}<a name="1006820"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1006823"> </a>Using the StrVPrintF Function
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1006827"> </a>Like the C <span style="font-family: monospace">vsprintf</span> function, the <a href="StringManager.html#1154938"><span style="font-family: monospace">StrVPrintF</span></a> function is designed to be called by your own function that takes a variable number of arguments and passes them to <span style="font-family: monospace">StrVPrintF</span> for formatting. This section gives a brief overview of how to use <span style="font-family: monospace">StrVPrintF</span>. For more details, refer to <span style="font-family: monospace">vsprintf</span> and the use of the <span style="font-family: monospace">stdarg.h</span> macros in a standard C reference book.
</p>
<p class="Body">
  <a name="1006828"> </a>When you call <span style="font-family: monospace">StrVPrintF</span>, you must use the special macros from <span style="font-family: monospace">stdarg.h</span> to access the optional arguments (those specified after the fixed arguments) passed to your function. This is necessary, because when you declare your function that takes an optional number of arguments, you declare it using an ellipsis at the end of the argument list:
</p>
<pre  class="Preformatted">
MyPrintF(CharPtr s, CharPtr formatStr, ...);<a name="1006829"> </a>
</pre>
<p class="Body">
  <a name="1006830"> </a>The ellipsis indicates that zero or more optional arguments may be passed to the function following the <span style="font-family: monospace">formatStr</span> argument. Since these optional arguments don't have names, the <span style="font-family: monospace">stdarg.h</span> macros must be used to access them before they can be passed to <span style="font-family: monospace">StrVPrintF</span>.
</p>
<p class="Body">
  <a name="1006831"> </a>To use these macros in your function, first declare an <span style="font-family: monospace">args</span> variable as type <span style="font-family: monospace">va_list</span>:
</p>
<pre  class="Preformatted">
va_list args;<a name="1006832"> </a>
</pre>
<p class="Body">
  <a name="1006833"> </a>Next, initialize the <span style="font-family: monospace">args</span> variable to point to the optional argument list by using <span style="font-family: monospace">va_start</span>: 
</p>
<pre  class="Preformatted">
va_start(args, formatStr);<a name="1006834"> </a>
</pre>
<p class="Body">
  <a name="1006835"> </a>Note that the second argument to the <span style="font-family: monospace">va_start</span> macro is the last required argument to your function (last before the optional arguments begin). Now you can pass the <span style="font-family: monospace">args</span> variable as the last parameter to the <span style="font-family: monospace">StrVPrintF</span> function:
</p>
<pre  class="Preformatted">
StrVPrintF(text, formatStr, args);<a name="1006836"> </a>
</pre>
<p class="Body">
  <a name="1006837"> </a>When you are finished, invoke the macro <span style="font-family: monospace">va_end</span> before returning from your function:
</p>
<pre  class="Preformatted">
va_end(args);<a name="1006838"> </a>
</pre>
<p class="Body">
  <a name="1006842"> </a>Note that the <a href="StringManager.html#1154866"><span style="font-family: monospace">StrPrintF</span></a> and <span style="font-family: monospace">StrVPrintF</span> functions implement only a subset of the conversion specifications allowed by the ANSI C function <span style="font-family: monospace">vsprintf</span>. See the <a href="StringManager.html#1154938"><span style="font-family: monospace">StrVPrintF</span></a> function reference for details.
</p>

<h2 class="HaHeadA">
  <a name="1006847"> </a>Fonts  
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1012182"> </a>All fonts in Palm OS are bitmapped fonts. A <b>bitmapped font</b> is one that provides a separate bitmap for each glyph in each size and style. Scalable fonts such as TrueType or PostScript fonts are not supported.
</p>
<p class="Body">
  <a name="1013980"> </a>Each font is associated with a particular character encoding. The font contains <b>glyphs</b> that define how to draw each character in the encoding. 
</p>
<p class="Body">
  <a name="1010761"> </a>Palm OS provides built-in fonts, and in Palm OS 3.0 and later, allows you to create your own fonts. If the <a href="CompatibilityApdx.html#976512">High-Density Display Feature Set</a> is present, high-density fonts are supported and used on high-density displays. This section describes the font support in Palm OS 3.0 and later. It covers: 
</p>

  <a name="1017614"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1010319">Built-in Fonts</a></p>

  <a name="1017683"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1010559">Selecting Which Font to Use</a></p>

  <a name="1017771"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1019669">Fonts for High-Density Displays</a></p>

  <a name="1017720"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1017760">Setting the Font Programmatically</a></p>

  <a name="1017740"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1013923">Obtaining Font Information</a></p>

  <a name="1017745"> </a><p class="B1Bullet"> &#8226; <a href="Text.html#1010404">Creating Custom Fonts</a></p>

<h2 class="HBHeadB">
  <a name="1010319"> </a>Built-in Fonts
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1011420"> </a>There are several fonts built into Palm OS. The <span style="font-family: monospace">Font.h</span> file defines constants that can be used to access the built-in fonts programmatically. These constants are defined on all versions of Palm OS no matter what language or character code; however, they may point to different fonts. For example, <span style="font-family: monospace">stdFont</span> on a Japanese system may be quite different from <span style="font-family: monospace">stdFont</span> on a Latin system. 
</p>
<p class="Body">
  <a name="1010764"> </a><a href="Text.html#1010771">Table 8.1</a> lists and describes the built-in fonts that may be used to display text. 
</p>

<h5 class="TgTable">
  <a name="1010768"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="1010771"> </a><div class="TableTitle">Table 8.1  Built-in text fonts </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1010775"> </a><div class="CellHeading">Constant</div></th>
    <th><a name="1010777"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr valign="top">
    <td><a name="1010779"> </a><div class="CellBody"><span style="font-family: monospace">stdFont</span> </div></td>
    <td><a name="1016166"> </a><div class="CellBody">A small standard font used to display user input. This font is small to display as much text as possible. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011227"> </a><div class="CellBody"><span style="font-family: monospace">largeFont</span> </div></td>
    <td><a name="1016188"> </a><div class="CellBody">A larger font provided as an alternative for users who find the standard font too small to read. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1010783"> </a><div class="CellBody"><span style="font-family: monospace">boldFont</span> </div></td>
    <td><a name="1016216"> </a><div class="CellBody">Same size as <span style="font-family: monospace">stdFont</span> but bold for easier reading. Used for text labels in the user interface. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1010791"> </a><div class="CellBody"><span style="font-family: monospace">largeBoldFont</span> </div></td>
    <td><a name="1016238"> </a><div class="CellBody">In Palm OS 3.0 and later only. Same size as <span style="font-family: monospace">largeFont</span> but bold. </div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1020331"> </a><a href="Text.html#1011379">Figure 8.2</a> shows what each of the fonts in <a href="Text.html#1010771">Table 8.1</a> looks like. 
</p>

<p class="FFigureCaption">
  <a name="1011379"> </a>Figure 8.2	 Built-in text fonts 
</p>
<p class="FgFigure">
  <a name="1011383"> </a><div align="left"><img src="images/Fonts.gif" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1011304"> </a>Palm OS also defines the fonts listed in <a href="Text.html#1011244">Table 8.2</a>. These fonts do not contain most letters of the alphabet. They are used only for special purposes. 
</p>

<h5 class="TgTable">
  <a name="1011283"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="1011244"> </a><div class="TableTitle">Table 8.2  Built-in symbol fonts</div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1011248"> </a><div class="CellHeading">Constant</div></th>
    <th><a name="1011250"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr valign="top">
    <td><a name="1011268"> </a><div class="CellBody"><span style="font-family: monospace">symbolFont</span> </div></td>
    <td><a name="1016210"> </a><div class="CellBody">Contains many special characters such as arrows, shift indicators, and so on. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011272"> </a><div class="CellBody"><span style="font-family: monospace">symbol11Font</span> </div></td>
    <td><a name="1011274"> </a><div class="CellBody">Contains the check boxes, the large left arrow, and the large right arrow. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011276"> </a><div class="CellBody"><span style="font-family: monospace">symbol7Font</span> </div></td>
    <td><a name="1011278"> </a><div class="CellBody">Contains the up and down arrows used for the repeating button scroll arrows and the dimmed version of the same arrows. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011280"> </a><div class="CellBody"><span style="font-family: monospace">ledFont</span> </div></td>
    <td><a name="1011282"> </a><div class="CellBody">Contains the numbers 0 through 9, -, ., and the comma (,). Used by the Calculator application for its numeric display. </div></td>
  </tr>
</table>




</h5>
<h2 class="HBHeadB">
  <a name="1010559"> </a>Selecting Which Font to Use
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1011610"> </a>The default fonts used to display normal text and bold text vary based on the handheld's character encoding. Handhelds with the Palm Latin encoding typically use <span style="font-family: monospace">stdFont</span> and <span style="font-family: monospace">boldFont</span>, while Japanese handhelds use <span style="font-family: monospace">largeFont</span> and <span style="font-family: monospace">largeBoldFont</span> as the default. When your application starts up for the first time, it should respect the system defaults. Use the <a href="PalmOSGlueLib.html#1386901"><span style="font-family: monospace">FntGlueGetDefaultFontID</span></a> function to determine what the default fonts are (see <a href="Text.html#1011667">Listing 8.10</a>). 
</p>
<p class="CCodeCaption">
  <a name="1011667"> </a>Listing 8.10  Determining the default system fonts
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
FontID textFont = FntGlueGetDefaultFontID(defaultSystemFont);<a name="1011674"> </a>
FontID labelFont = FntGlueGetDefaultFontID(defaultBoldFont);<a name="1011677"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1011688"> </a>In general, where users can enter text, you should allow them to select the font through the Select Font dialog (see <a href="Text.html#1011693">Figure 8.3</a>). 
</p>

<p class="FFigureCaption">
  <a name="1011693"> </a>Figure 8.3	 Select Font dialog
</p>
<p class="FgFigure">
  <a name="1011698"> </a><div align="left"><img src="images/FontSelect.gif" height="74" width="360" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1011741"> </a>The <a href="Font.html#1122968"><span style="font-family: monospace">FontSelect</span></a> function displays the Select Font dialog. This function takes as an argument a <span style="font-family: monospace">FontID</span>, which specifies the value that is initially selected in the dialog. It returns the <span style="font-family: monospace">FontID</span> that the user selected. 
</p>
<pre  class="Preformatted">
newFontID = FontSelect(textFont);<a name="1011586"> </a>
</pre>
<p class="Body">
  <a name="1016390"> </a>Because the default fonts vary based on the character encoding, the font size choices displayed in the Font Select dialog also vary based on character encoding. For this reason, you must call <span style="font-family: monospace">FntGlueGetDefaultFontID</span> to obtain the default system font and pass the returned value to <span style="font-family: monospace">FontSelect</span> when you call it for the first time. On subsequent calls to <span style="font-family: monospace">FontSelect</span>, you can pass the user's current font choice. 
</p>

<h2 class="HBHeadB">
  <a name="1019669"> </a>Fonts for High-Density Displays
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1019673"> </a>If the <a href="CompatibilityApdx.html#976512">High-Density Display Feature Set</a> is defined, Palm OS supports both low-density (160 X 160) and double-density (320 X 320) displays. Double-density displays pack more pixels into the same space to create a finer resolution. 
</p>
<p class="Body">
  <a name="1017980"> </a>To support multiple display densities, Palm OS uses an <b>extended font resource</b>. An extended font resource contains a separate set of glyphs for each supported density. At runtime, Palm OS determines the current display density and then draws text using the glyphs that match the display density. On a double-density display, text is drawn using the double-density glyphs. On a low-density display, text is drawn using the low-density glyphs. 
</p>
<p class="Body">
  <a name="1018279"> </a>Palm OS includes extended font resources for each of the built-in fonts when the high-density display feature set is defined. If your application uses only these fonts, your text is drawn using double-density glyphs on double-density displays. You do not have to make any changes to your code for this to occur. 
</p>

<p class="FFigureCaption">
  <a name="1019717"> </a>Figure 8.4	 Low-density and high-density fonts
</p>
<p class="FgFigure">
  <a name="1019730"> </a><div align="left"><img src="images/Text3.gif" height="171" width="360" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="1018338"> </a>You only need to be concerned about the font density if you use custom fonts. 
</p>

  <a name="1018345"> </a><p class="B1Bullet"> &#8226; When creating a custom font, you'll want to create an extended font resource. See <a href="Text.html#1010404">"Creating Custom Fonts."</a> If an extended font resource is not available or does not contain a double-density glyphs, Palm OS pixel doubles the low-density glyphs when drawing to a double-density display. </p>

  <a name="1018361"> </a><p class="B1Bullet"> &#8226; When drawing text in a custom font to an off-screen window, you must take care. Off-screen windows also have a display density. If you create a low-density off-screen window and draw text to it, you <i>must</i> use a low-density font. If you use an extended font, it must contain low-density glyphs. If the resource contains only double-density glyphs, Palm OS does not scale the glyphs. The result is undefined and may cause a system crash. </p>
<p class="Indented1"> <a name="1018570"> </a>Because Palm OS includes low-density and double-density glyphs for each of the built-in fonts, this is only a potential problem if you are using a custom font. </p>

<h2 class="HBHeadB">
  <a name="1017760"> </a>Setting the Font Programmatically
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1011804"> </a>To set the font that a user interface element uses for its label or for its textual contents, you use different functions depending on the element. <a href="Text.html#1011835">Table 8.3</a> shows which functions set fonts for which user interface elements. 
</p>

<h5 class="TgTable">
  <a name="1011830"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="1011835"> </a><div class="TableTitle">Table 8.3  Setting the font </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1011839"> </a><div class="CellHeading">UI object</div></th>
    <th><a name="1011841"> </a><div class="CellHeading">Function</div></th>
  </tr>
  <tr valign="top">
    <td><a name="1011843"> </a><div class="CellBody">Field </div></td>
    <td><a name="1011845"> </a><div class="CellBody"><a href="Field.html#999543"><span style="font-family: monospace">FldSetFont</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011847"> </a><div class="CellBody">Field within a table </div></td>
    <td><a name="1011849"> </a><div class="CellBody"><a href="Table.html#1062783"><span style="font-family: monospace">TblSetItemFont</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011851"> </a><div class="CellBody">Command button, push button, pop-up trigger, selector trigger, or check box </div></td>
    <td><a name="1011853"> </a><div class="CellBody"><a href="PalmOSGlueLib.html#1392605"><span style="font-family: monospace">CtlGlueSetFont</span></a> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011855"> </a><div class="CellBody">Label resource</div></td>
    <td><a name="1011857"> </a><div class="CellBody"><a href="PalmOSGlueLib.html#1393132"><span style="font-family: monospace">FrmGlueSetLabelFont</span></a> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011859"> </a><div class="CellBody">List items </div></td>
    <td><a name="1011861"> </a><div class="CellBody"><a href="PalmOSGlueLib.html#1393319"><span style="font-family: monospace">LstGlueSetFont</span></a> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1011863"> </a><div class="CellBody">All other text (text drawn directly on the screen)</div></td>
    <td><a name="1011865"> </a><div class="CellBody"><a href="Font.html#1122865"><span style="font-family: monospace">FntSetFont</span></a> </div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1010563"> </a>The <a href="Font.html#1122865"><span style="font-family: monospace">FntSetFont</span></a> function changes the font that the system uses by default. It returns the previously used font. You should save the font returned by <span style="font-family: monospace">FntSetFont</span> and restore it once you are done. <a href="Text.html#1010575">Listing 8.11</a> shows an example of setting the font to draw items in the custom list drawing function. 
</p>
<p class="CCodeCaption">
  <a name="1010575"> </a>Listing 8.11  Setting the font programmatically
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
void DrawOneRowInList(Int16 itemNum, RectangleType *bounds, <a name="1010582"> </a>
   Char **itemsText)<a name="1012059"> </a>
{<a name="1010599"> </a>
   Boolean didSetFont = false;<a name="1010600"> </a>
   FontID oldFont;<a name="1010601"> </a>
<a name="1010602"> </a>
   if ((itemNum % 5) == 0) {<a name="1010606"> </a>
      oldFont = FntSetFont(boldFont);<a name="1010608"> </a>
      didSetFont = true;<a name="1010609"> </a>
   }<a name="1010607"> </a>
   WinDrawChars(itemsText[itemNum],<a name="1010610"> </a>
     StrLen(itemsText[itemNum]), bounds.topLeft.x,<a name="1022616"> </a>
        bounds.topLeft.y);<a name="1022621"> </a>
   if (didSetFont)<a name="1010611"> </a>
      FntSetFont(oldFont);<a name="1010612"> </a>
}<a name="1010613"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1013923"> </a>Obtaining Font Information
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1014452"> </a>Use functions in the Font Manager to obtain information about a font and how it is drawn to the screen. <a href="Text.html#1014577">Figure 8.5</a> shows graphically the characteristics of a font. <a href="Text.html#1014645">Table 8.4</a> describes the types of information that can be retrieved with the Font Manager.
</p>

<p class="FFigureCaption">
  <a name="1014577"> </a>Figure 8.5	 Font characteristics
</p>
<p class="FgFigure">
  <a name="1014578"> </a><div align="left"><img src="images/FontCharacteristics.gif" height="287" width="480" border="0" hspace="20" vspace="0">
</div>
</p>

<h5 class="TgTable">
  <a name="1014579"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="1014645"> </a><div class="TableTitle">Table 8.4  Obtaining font information</div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1014649"> </a><div class="CellHeading">Characteristic</div></th>
    <th><a name="1014651"> </a><div class="CellHeading">Function</div></th>
  </tr>
  <tr valign="top">
    <td><a name="1014653"> </a><div class="CellBody">Font height</div></td>
    <td><a name="1014655"> </a><div class="CellBody"><a href="Font.html#1122658"><span style="font-family: monospace">FntCharHeight</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1014661"> </a><div class="CellBody">Ascent</div></td>
    <td><a name="1014663"> </a><div class="CellBody"><a href="Font.html#1122645"><span style="font-family: monospace">FntBaseLine</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1014665"> </a><div class="CellBody">Descent</div></td>
    <td><a name="1014667"> </a><div class="CellBody"><a href="Font.html#1122761"><span style="font-family: monospace">FntDescenderHeight</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1014669"> </a><div class="CellBody">Leading + font height</div></td>
    <td><a name="1014671"> </a><div class="CellBody"><a href="Font.html#1122827"><span style="font-family: monospace">FntLineHeight</span></a> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1014740"> </a><div class="CellBody">Maximum width of a character in the font</div></td>
    <td><a name="1014745"> </a><div class="CellBody"><a href="Font.html#1122632"><span style="font-family: monospace">FntAverageCharWidth</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1014673"> </a><div class="CellBody">Width of a specific character</div></td>
    <td><a name="1014675"> </a><div class="CellBody"><a href="Font.html#1122878"><span style="font-family: monospace">FntWCharWidth</span></a> (<span style="font-family: monospace">FntGlueWCharWidth</span>)</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1014792"> </a><div class="CellBody">Character displayed at particular location</div></td>
    <td><a name="1014794"> </a><div class="CellBody"><a href="Font.html#1122904"><span style="font-family: monospace">FntWidthToOffset</span></a> (<span style="font-family: monospace">FntGlueWidthToOffset</span>)</div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1017079"> </a>The functions listed in <a href="Text.html#1014645">Table 8.4</a> all work on the current font, that is, the font listed in the draw state. To change the current font, use <a href="Font.html#1122865"><span style="font-family: monospace">FntSetFont</span></a>. For example, to determine the line height of the font used for text in a field, do the following:
</p>
<p class="CCodeCaption">
  <a name="1017083"> </a>Listing 8.12  Obtaining characteristics of a field font
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
FieldType *fieldP;<a name="1017112"> </a>
FontID oldFont;<a name="1017130"> </a>
Int16 lineHeight;<a name="1017139"> </a>
<a name="1017178"> </a>
oldFont = FntSetFont(FldGetFont(fieldP));<a name="1017148"> </a>
lineHeight = FntLineHeight();<a name="1017169"> </a>
FntSetFont(oldFont);<a name="1017189"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="1010404"> </a>Creating Custom Fonts
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1020682"> </a>Palm OS 3.0 and later supports the use of custom fonts. You can create your own font resource (<span style="font-family: monospace">'NFNT'</span>) and use it within your application. 
</p>
<p class="Body">
  <a name="1013217"> </a>If the <a href="CompatibilityApdx.html#976512">High-Density Display Feature Set</a> is present, you can use an extended font resource (<span style="font-family: monospace">'nfnt'</span>) instead. The extended font resource contains a separate set of glyphs for each of the supported display densities. 
</p>
<p class="Body">
  <a name="1017265"> </a>Both the font and extended font resources are only large enough to support a font for the Palm Latin character encoding (256 characters). Defining a custom font for larger character sets is not supported. 
</p>

<h4 class="HCHeadC">
  <a name="1012299"> </a>Creating a Font Resource
</h4>
<p class="Body">
  <a name="1012301"> </a>The Palm OS SDK does not provide tools to create a custom font; however, several third party applications, such as xFont and PilRC, are available that support the creation of custom fonts. 
</p>
<div class="NINoteImportant"><hr>
  <a name="1019984"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">TIP:  </span> Leave a vertical column of blank space on the right side of each glyph in a font. Palm OS draws characters side by side, in contrast to the Mac OS, which draws a character, clears the pixels to its right and then draws the next character. If your font requires leading, you should leave blank space at the bottom of each glyph as well because Palm OS does not support leading. 
<hr>
</div>
<p class="Body">
  <a name="1014223"> </a>To create an extended font resource, you use Constructor for Palm OS: 
</p>
  <a name="1015151"> </a><p class="N1NumList">1.	  Create two font resources using a third party tool (such as xFont). Every aspect of the second font must be exactly double that of the first font. That is, the second font must be twice as many pixels high, twice as many pixels wide, and so on. </p>  <a name="1015154"> </a><p class="N1NumList">2.	  Create a font family using Constructor for Palm OS as described in the book <i>Constructor for Palm OS</i>. </p>  <a name="1015166"> </a><p class="N1NumList">3.	  Use the first <span style="font-family: monospace">'NFNT'</span> resource as the Normal density font. Use the second <span style="font-family: monospace">'NFNT'</span> resource as the Double density font. </p><p class="Body">
  <a name="1013607"> </a>The PalmRez post linker uses the font family resource to create the extended font resource that you use on the device. 
</p>

<h4 class="HCHeadC">
  <a name="1012302"> </a>Using a Custom Font in Your Application 
</h4>
<p class="Body">
  <a name="1013639"> </a>Once you have defined a custom font in a resource file, you must assign it a font ID before you can use the font in your application. The font ID is different from the font's resource ID. It's a number between 0 and 255. The font ID you use must be greater than or equal to <span style="font-family: monospace">fntAppFontCustomBase</span>. All IDs less than that are reserved for system use. The function <a href="Font.html#1122731"><span style="font-family: monospace">FntDefineFont</span></a> assigns a font ID to a font resource. The font resource must be locked for the entire time that the font is in use. It's a good idea to load the font resource, lock it, and assign a font ID in your application's <span style="font-family: monospace">AppStart</span> function. Unlock and release the font resource in the <span style="font-family: monospace">AppStop</span> function. 
</p>
<p class="Body">
  <a name="1014239"> </a><a href="Text.html#1013655">Listing 8.13</a> shows code that loads a font resource, assigns a font ID to that resource, and then draws characters to the screen using the new font. 
</p>
<p class="CCodeCaption">
  <a name="1013655"> </a>Listing 8.13  Loading and using a custom font
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define customFontID ((FontID) fntAppFontCustomBase)<a name="1013659"> </a>
<a name="1017413"> </a>
MemHandle customFontH;<a name="1017386"> </a>
FontType *customFontP;<a name="1013660"> </a>
<a name="1013665"> </a>
Err AppStart(void)<a name="1013666"> </a>
{<a name="1014294"> </a>
   ...<a name="1014304"> </a>
   // Load the font resource and assign it a font ID. <a name="1014343"> </a>
   customFontH = DmGetResource(fontRscType, MyCoolFontRscID);<a name="1014344"> </a>
   customFontP = (FontType *)MemHandleLock(customFontH);<a name="1014345"> </a>
   FntDefineFont(customFontID, customFontP);<a name="1013674"> </a>
   ...<a name="1014309"> </a>
}<a name="1014314"> </a>
<a name="1013706"> </a>
void AppStop(void)<a name="1013711"> </a>
{<a name="1014327"> </a>
   ...<a name="1014357"> </a>
   //Release the font resource when app quits. <a name="1014332"> </a>
   MemHandleUnlock(customFontH);<a name="1013675"> </a>
   DmReleaseResource(customFontH);<a name="1013686"> </a>
   ...<a name="1014362"> </a>
}<a name="1014352"> </a>
<a name="1013716"> </a>
void DrawCharsInNewFont(void) <a name="1014367"> </a>
{<a name="1014372"> </a>
   FontID oldFont = FntSetFont(customFontID);<a name="1014389"> </a>
   Char *msg = "Look, Mom. It's a new font!");<a name="1014420"> </a>
   WinDrawChars(msg, StrLen(msg), 28, 0);<a name="1014412"> </a>
   FntSetFont(oldFont);<a name="1013697"> </a>
}<a name="1014402"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1012226"> </a>To use a extended font, you use essentially the same code as above, except that you must change the resource type used in the <span style="font-family: monospace">DmGetResource</span> call to <span style="font-family: monospace">fontExtRscType</span>:
</p>
<pre  class="Preformatted">
customFontH = DmGetResource(fontExtRscType, <a name="1013956"> </a>
   MyCoolExtFontRscID);<a name="1017566"> </a>
// rest as shown above. <a name="1013957"> </a>
</pre>
<p class="Body">
  <a name="1020783"> </a>Note that you still use a pointer to a <span style="font-family: monospace">FontType</span> structure to access the extended font. 
</p>
<p class="Body">
  <a name="1021743"> </a>The <span style="font-family: monospace">'NFNT'</span> resources you created to build the extended font are discarded after the extended font is created. For a backward compatible application, you need to define a separate <span style="font-family: monospace">'NFNT'</span> resource containing the low-density glyphs in your font. 
</p>
<p class="Body">
  <a name="1018080"> </a>It's possible to create an extended font resource that contains only double-density glyphs and not low-density glyphs. You could define an <span style="font-family: monospace">'NFNT'</span> resource for the low-density glyphs and an extended font resource with just the double-density glyphs. Then you could load and use the <span style="font-family: monospace">'NFNT'</span> resource on all handhelds with low-density screens (including those that don't support the high-density feature set) and load and use the extended font resource when the display is not low-density. If you do this, you must carefully check the display density before deciding which resource to load (see <a href="Text.html#1018630">Listing 8.14</a>).
</p>
<div class="NWNoteWarning"><hr>
  <a name="1020097"> </a> <span style="color: #FF0000;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">WARNING!  </span> If you write text to a low-density off-screen window using a double-density glyphs, the result is undefined and may cause Palm OS to crash. If you load your fonts as shown in <a href="Text.html#1018630">Listing 8.14</a>, load and use the old font resource when drawing text to a low-density off-screen window. See <a href="Text.html#1019669">"Fonts for High-Density Displays"</a> for more information. 
<hr>
</div>
<p class="CCodeCaption">
  <a name="1018630"> </a>Listing 8.14  Conditionally loading a font resource
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define customFontID ((FontID) fntAppFontCustomBase)<a name="1018770"> </a>
MemHandle fontH = NULL;<a name="1018637"> </a>
FontType *fontP;<a name="1018723"> </a>
UInt16 winVersion;<a name="1018704"> </a>
Err error;<a name="1018648"> </a>
<a name="1018657"> </a>
error = FtrGet(sysFtrCreator, sysFtrNumWinVersion, <a name="1018666"> </a>
   &amp;winVersion);<a name="1018673"> </a>
// If winVersion is &gt;= 4, the high-density feature set<a name="1018675"> </a>
// is present. Check what type of display we are on<a name="1018676"> </a>
// and load the appropriate font resource. <a name="1018677"> </a>
if (!error &amp;&amp; (winVersion &gt;= 4)) {<a name="1018674"> </a>
   UInt32 density;<a name="1018678"> </a>
   error = WinScreenGetAttribute(winScreenDensity, &amp;density);<a name="1018680"> </a>
   if (!error &amp;&amp; (density != kDensityLow)) {<a name="1018685"> </a>
         // load and use the extended font <a name="1018703"> </a>
         // resource.<a name="1018870"> </a>
         fontH = DmGetResource(fontExtRscType,             MyNewFontRscID);<a name="1018871"> </a>
         fontP = MemHandleLock(fontH);<a name="1018694"> </a>
   }<a name="1018767"> </a>
}<a name="1018872"> </a>
<a name="1018874"> </a>
if (!fontH) {<a name="1018933"> </a>
  // Either the feature set is not present or we're on a <a name="1018884"> </a>
  // low-density screen. Load and use the 'NFNT' resource.<a name="1018889"> </a>
  fontH = DmGetResource(fontRscType, MyOldFontRscID);<a name="1018902"> </a>
  fontP = (FontType *)MemHandleLock(fontH);<a name="1018903"> </a>
}<a name="1018879"> </a>
<a name="1018768"> </a>
FntDefineFont(customFontID, fontP);<a name="1018928"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HaHeadA">
  <a name="1018082"> </a>Summary of Text API 
<a href="#1006349"><img src="images/top.gif" border="0"></a></h2>


<h5 class="TgTable">
  <a name="1018250"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1018085"> </a><div class="CellHeading">Text Manager</div></th>
    <th><a name="1018087"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td><a name="1020860"> </a><div class="CellHeading">Accessing Text</div></td>
    <td><a name="1020862"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1020867"> </a><div class="CellBody"><a href="TextMgr.html#1168618">TxtCharBounds</a><br><a href="TextMgr.html#1169765">TxtPreviousCharSize</a><br><a href="TextMgr.html#1169454">TxtGetNextChar</a><br><a href="TextMgr.html#1169420">TxtGetChar</a></div></td>
    <td><a name="1020885"> </a><div class="CellBody"><a href="TextMgr.html#1169495">TxtGetPreviousChar</a><br><a href="TextMgr.html#1169095">TxtCharSize</a><br><a href="TextMgr.html#1169665">TxtNextCharSize</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1018112"> </a><div class="CellHeading">Changing Text </div></td>
    <td><a name="1018114"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1018119"> </a><div class="CellBody"><a href="TextMgr.html#1169800">TxtReplaceStr</a><br><a href="TextMgr.html#1169250">TxtConvertEncoding</a></div></td>
    <td><a name="1018127"> </a><div class="CellBody"><a href="TextMgr.html#1169830">TxtSetNextChar</a><br><a href="TextMgr.html#1169907">TxtTransliterate</a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="1020914"> </a><div class="CellHeading">Segmenting Text</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1020918"> </a><div class="CellHeading"><a href="TextMgr.html#1169535">TxtGetTruncationOffset</a><br><a href="TextMgr.html#1169560">TxtGetWordWrapOffset</a></div></td>
    <td><a name="1020920"> </a><div class="CellBody"><a href="TextMgr.html#1169960">TxtWordBounds</a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="1018156"> </a><div class="CellHeading">Searching/Comparing Text</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1018163"> </a><div class="CellBody"><a href="TextMgr.html#1168483">TxtCaselessCompare</a><br><a href="TextMgr.html#1169371">TxtFindString</a></div></td>
    <td><a name="1018171"> </a><div class="CellBody"><a href="TextMgr.html#1169185">TxtCompare</a><br><a href="PalmOSGlueLib.html#1387192">TxtGluePrepFindString</a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="1018173"> </a><div class="CellHeading">Obtaining a Character's Attributes</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1018180"> </a><div class="CellBody"><a href="TextMgr.html#1168693">TxtCharIsAlNum</a><br><a href="TextMgr.html#1168804">TxtCharIsDigit</a><br><a href="TextMgr.html#1168920">TxtCharIsLower</a><br><a href="TextMgr.html#1169008">TxtCharIsSpace</a><br><a href="TextMgr.html#1169062">TxtCharIsValid</a><br><a href="TextMgr.html#1168758">TxtCharIsCntrl</a><br><a href="TextMgr.html#1168985">TxtCharIsPunct</a></div></td>
    <td><a name="1018203"> </a><div class="CellBody"><a href="TextMgr.html#1168724">TxtCharIsAlpha</a><br><a href="TextMgr.html#1168835">TxtCharIsGraph</a><br><a href="TextMgr.html#1168951">TxtCharIsPrint</a><br><a href="TextMgr.html#1169031">TxtCharIsUpper</a><br><a href="TextMgr.html#1169148">TxtCharXAttr</a><br><a href="TextMgr.html#1168892">TxtCharIsHex</a><br><a href="TextMgr.html#1168540">TxtCharAttr</a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="1018223"> </a><div class="CellHeading">Obtaining Character Encoding information</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1018230"> </a><div class="CellBody"><a href="TextMgr.html#1169866">TxtStrEncoding</a><br><a href="TextMgr.html#1169593">TxtMaxEncoding</a></div><a name="1018237"> </a><div class="CellBody"><a href="TextMgr.html#1169630">TxtNameToEncoding</a></div></td>
    <td><a name="1018242"> </a><div class="CellBody"><a href="TextMgr.html#1169308">TxtEncodingName</a><br><a href="TextMgr.html#1168648">TxtCharEncoding</a></div><a name="1018249"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="1020958"> </a><div class="CellHeading">Working With Multi-Byte Characters</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1020954"> </a><div class="CellBody"><a href="TextMgr.html#1168435">TxtByteAttr</a></div></td>
    <td><a name="1020956"> </a><div class="CellBody"><br></div></td>
  </tr>
</table>




</h5>
<h5 class="TgTable">
  <a name="1007056"> </a>
</h5>
<h5 class="TgTable">
  <a name="1007057"> </a>
</h5>
<h5 class="TgTable">
  <a name="1007168"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1007060"> </a><div class="CellHeading">String Manager Functions</div></th>
    <th><a name="1007062"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td><a name="1007064"> </a><div class="CellHeading">Length of a String</div></td>
    <td><a name="1007066"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007071"> </a><div class="CellBody"><a href="StringManager.html#1154605">StrLen</a></div></td>
    <td><a name="1007073"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007075"> </a><div class="CellHeading">Comparing Strings</div></td>
    <td><a name="1007077"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007082"> </a><div class="CellBody"><a href="StringManager.html#1154398">StrCompare</a><br><a href="StringManager.html#1154315">StrCaselessCompare</a></div></td>
    <td><a name="1007090"> </a><div class="CellBody"><a href="StringManager.html#1154741">StrNCompare</a><br><a href="StringManager.html#1154668">StrNCaselessCompare</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007095"> </a><div class="CellHeading">Changing Strings</div></td>
    <td><a name="1007097"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007102"> </a><div class="CellBody"><a href="StringManager.html#1154866">StrPrintF</a><br><a href="StringManager.html#1154356">StrCat</a><br><a href="StringManager.html#1154497">StrCopy</a><br><a href="StringManager.html#1154921">StrToLower</a></div></td>
    <td><a name="1007116"> </a><div class="CellBody"><a href="StringManager.html#1154938">StrVPrintF</a><br><a href="StringManager.html#1154713">StrNCat</a><br><a href="StringManager.html#1154834">StrNCopy</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007124"> </a><div class="CellHeading">Searching Strings</div></td>
    <td><a name="1007126"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007131"> </a><div class="CellBody"><a href="StringManager.html#1154897">StrStr</a></div></td>
    <td><a name="1007136"> </a><div class="CellBody"><a href="StringManager.html#1154373">StrChr</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007138"> </a><div class="CellHeading">Converting </div></td>
    <td><a name="1007140"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007145"> </a><div class="CellBody"><a href="StringManager.html#1154299">StrAToI</a><br><a href="StringManager.html#1154586">StrIToH</a></div></td>
    <td><a name="1007153"> </a><div class="CellBody"><a href="StringManager.html#1154563">StrIToA</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007155"> </a><div class="CellHeading">Localized Numbers</div></td>
    <td><a name="1007157"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007162"> </a><div class="CellBody"><a href="StringManager.html#1154515">StrDelocalizeNumber</a></div></td>
    <td><a name="1007167"> </a><div class="CellBody"><a href="StringManager.html#1154622">StrLocalizeNumber</a></div></td>
  </tr>
</table>




</h5>
<h5 class="TgTable">
  <a name="1007292"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1007171"> </a><div class="CellHeading">Font Functions</div></th>
    <th><a name="1007173"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td><a name="1007175"> </a><div class="CellHeading">Changing the Font</div></td>
    <td><a name="1007177"> </a><div class="CellBody"> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007182"> </a><div class="CellBody"><a href="Font.html#1122968">FontSelect</a><br><a href="Field.html#999543">FldSetFont</a><br><a href="PalmOSGlueLib.html#1392605">CtlGlueSetFont</a><br><a href="PalmOSGlueLib.html#1393319">LstGlueSetFont</a></div></td>
    <td><a name="1007187"> </a><div class="CellBody"><a href="Font.html#1122865">FntSetFont</a> <br><a href="Table.html#1062783">TblSetItemFont</a><br><a href="PalmOSGlueLib.html#1393132">FrmGlueSetLabelFont</a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="1007189"> </a><div class="CellHeading">Accessing the Font Programmatically</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007196"> </a><div class="CellBody"><a href="Font.html#1122774">FntGetFont</a></div></td>
    <td><a name="1007201"> </a><div class="CellBody"><a href="Font.html#1129538">FntGetFontPtr</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007203"> </a><div class="CellHeading">Wrapping Text</div></td>
    <td><a name="1007205"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007210"> </a><div class="CellBody"><a href="Font.html#1122926">FntWordWrap</a></div></td>
    <td><a name="1007215"> </a><div class="CellBody"><a href="Font.html#1122946">FntWordWrapReverseNLines</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007217"> </a><div class="CellHeading">String Width</div></td>
    <td><a name="1007219"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007224"> </a><div class="CellBody"><a href="Font.html#1122671">FntCharsInWidth</a><br><a href="Font.html#1122840">FntLineWidth</a></div></td>
    <td><a name="1007232"> </a><div class="CellBody"><a href="Font.html#1122694">FntCharsWidth</a><br><a href="Font.html#1122904">FntWidthToOffset</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007237"> </a><div class="CellHeading">Character Width</div></td>
    <td><a name="1007239"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007244"> </a><div class="CellBody"><a href="Font.html#1122632">FntAverageCharWidth</a></div><a name="1020968"> </a><div class="CellBody"><a href="Font.html#1122878">FntWCharWidth</a></div></td>
    <td><a name="1007249"> </a><div class="CellBody"><a href="Font.html#1122709">FntCharWidth</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007251"> </a><div class="CellHeading">Height</div></td>
    <td><a name="1007253"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007258"> </a><div class="CellBody"><a href="Font.html#1122658">FntCharHeight</a><br><a href="Font.html#1122645">FntBaseLine</a></div></td>
    <td><a name="1007266"> </a><div class="CellBody"><a href="Font.html#1122827">FntLineHeight</a><br><a href="Font.html#1122761">FntDescenderHeight</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007271"> </a><div class="CellHeading">Scrolling</div></td>
    <td><a name="1007273"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007278"> </a><div class="CellBody"><a href="Font.html#1122800">FntGetScrollValues</a></div></td>
    <td><a name="1007280"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007282"> </a><div class="CellHeading">Creating a Font</div></td>
    <td><a name="1007284"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1007289"> </a><div class="CellBody"><a href="Font.html#1122731">FntDefineFont</a></div></td>
    <td><a name="1007291"> </a><div class="CellBody"><a href="Font.html#1128079">FntIsAppDefined</a></div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1007293"> </a>
</p>
&nbsp;<br>
				<!-- CONTENT_END -->

		</td>
		<td width="5">&nbsp;&nbsp;</td>
	</tr>
      </table>
    </td>
			</tr>
  <tr>
				<td>
					<table border="0" cellpadding="0" cellspacing="0" width="760">
        <!-- CONTENTCELL_END -->
        <tr valign="top"> 
          <td width="10">&nbsp;<!-- FOOTER_START --></td>
          <td width="72">&nbsp;</td>
          <td width="25" bgcolor="white" background="images/bkgrnd.gif">&nbsp;</td>
          <td width="600"> 
            <table border="0" cellpadding="0" cellspacing="0" width="600">
              <tr> 
                <td><img src="images/rule_10-1-5_ltblue.gif" width="600" height="16" border="0"></td>
              </tr>
              <tr> 
                <td> 
                  <p align="center" class="footer"> ©2002 PalmSource, Inc. and its affiliates.  All rights reserved. 
<a href="http://www.palmos.com/dev/training/">Training</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/">Palm&nbsp;OS&nbsp;Platform</a>&nbsp;|&nbsp;<a href="Companion_Front.html" target="_blank">Legal Notices</a>&nbsp;<br>
												<!-- FOOTER_END --><br>
											</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
				</td>
			</tr>
</table>
</BODY>
</HTML>