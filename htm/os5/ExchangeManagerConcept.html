<HTML>

<HEAD>
<SMALLSCREENIGNORE> 
<LINK HREF="copy_of_palmos.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="document.css" REL="StyleSheet" TYPE="text/css" media="screen">
<!-- SCRIPT_START -->
<!-- SCRIPT_END -->
</SMALLSCREENIGNORE>
<TITLE>Object Exchange</TITLE>

<META NAME="PALMTEMPLATE" CONTENT="1006-002 Palm HTML 20020513">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="TEMPLATEBASE" CONTENT="Palm HTML 20010625">
<META NAME="LASTUPDATED" CONTENT="12/13/02 10:04:13">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1">

</HEAD>

<BODY LEFTMARGIN="0" MARGINWIDTH="0" TOPMARGIN="0" MARGINHEIGHT="0">
<SMALLSCREENIGNORE> 
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td><a name="969979"></a>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr height="35"> 
          <td height="35" colspan="2" bgcolor="#6699CC">&nbsp;</td>
        </tr>
        <tr valign="top"> 
          <td width="160" align="left"><a href="http://www.palmos.com"><img src="images/bigorb.gif" width="160" height="110" border="0"></a></td>
          <td align="left" width="100%"> 
            </SMALLSCREENIGNORE>
            <!-- CONTENTCELL_START -->
            <img border="0" height="45" src="images/orb_bkgrnd_600.gif" width="600"><br>
            <!--PAGENAV_START-->
            <SPAN CLASS="subnav">&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span><BR>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             <h2 class="HeadDocPage">1  Object Exchange</h2>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             &nbsp;<span class="subnav"><a href="Companion2TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Companion2About.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExchangeLibraries.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Companion2IX.html">Index</a></span>  
            <!--PAGENAV_END-->
          </td>
        </tr>
      </table>
    </td>
			</tr>
  <tr>
				<td> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
							<td>&nbsp;&nbsp;&nbsp;</td>
						</tr>
        <tr>
		<td valign="top" width="10">&nbsp;&nbsp;&nbsp;</td>
		<td valign="top" width="175">
			<p class="SideTitle">Title - <br><a href="Companion2Front.html">Palm OS® Programmer's Companion</a></p>
			<p class="SideTOC1-PartTab">Volume II Communications </p>
			<p class="SideTOC1"><a href="ExchangeManagerConcept.html">1  Object Exchange</a></p>
			
<p class="SideTOC2">
<a href="#970026">About the Exchange Manager 
</a></p>

<p class="SideTOC3">
<a href="#970037">Exchange Libraries
</a></p>

<p class="SideTOC3">
<a href="#970092">Typed Data Objects
</a></p>

<p class="SideTOC2">
<a href="#970152">Initializing the Exchange Socket Structure
</a></p>

<p class="SideTOC3">
<a href="#970176">Identifying the Exchange Library
</a></p>

<p class="SideTOC3">
<a href="#970250">Identifying the Type of Data 
</a></p>

<p class="SideTOC2">
<a href="#970267">Registering for Data
</a></p>

<p class="SideTOC3">
<a href="#970296">General Registration Guidelines
</a></p>

<p class="SideTOC3">
<a href="#970325">Setting the Default Application
</a></p>

<p class="SideTOC3">
<a href="#970453">Registering to Receive Unwrapped Data
</a></p>

<p class="SideTOC2">
<a href="#970478">Sending Data
</a></p>

<p class="SideTOC3">
<a href="#970493">Sending a Single Object
</a></p>

<p class="SideTOC3">
<a href="#970558">Sending Multiple Objects
</a></p>

<p class="SideTOC3">
<a href="#970615">Implementing the Send Command 
</a></p>

<p class="SideTOC2">
<a href="#970628">Receiving Data
</a></p>

<p class="SideTOC3">
<a href="#970664">Controlling the Exchange Dialog
</a></p>

<p class="SideTOC3">
<a href="#970723">Displaying a Preview
</a></p>

<p class="SideTOC3">
<a href="#970774">Receiving the Data
</a></p>

<p class="SideTOC2">
<a href="#970881">Sending and Receiving Databases
</a></p>

<p class="SideTOC3">
<a href="#970886">Sending a Database
</a></p>

<p class="SideTOC3">
<a href="#970968">Receiving a Database
</a></p>

<p class="SideTOC2">
<a href="#970998">Requesting Data
</a></p>

<p class="SideTOC3">
<a href="#971026">Sending a Get Request for a Single Object
</a></p>

<p class="SideTOC3">
<a href="#971056">Responding to a Get Request 
</a></p>

<p class="SideTOC3">
<a href="#971077">Two-Way Communications
</a></p>

<p class="SideTOC3">
<a href="#971097">Requesting a URL 
</a></p>

<p class="SideTOC2">
<a href="#971117">Sending and Receiving Locally
</a></p>

<p class="SideTOC2">
<a href="#971183">Interacting with the Launcher
</a></p>

<p class="SideTOC2">
<a href="#971198">Summary of Exchange Manager
</a></p>

		</td>

		<td width="5">&nbsp;&nbsp;</td>
		<td width="1" bgcolor="#6699cc">&nbsp;</td>
		<td width="5">&nbsp;&nbsp;</td>
		<td> 

				<!-- CONTENT_START -->

<p class="Body">
  <a name="969980"> </a>The simplest form of communication for a Palm OS<sup>®</sup> application to implement is the sending and receiving of typed data objects, such as MIME data, databases, or database records. 
</p>
<p class="Body">
  <a name="969982"> </a>You use the Exchange Manager to send and receive typed data objects. The Exchange Manager interface is independent of the transport mechanism. You can use IR, SMS, or any other protocol that has an Exchange Manager plug-in called an <b>exchange library</b>. 
</p>
<p class="Body">
  <a name="969985"> </a>The Exchange Manager is supported in Palm OS 3.0 and higher. In Palm OS 4.0, significant updates were made. 
</p>
<p class="Body">
  <a name="969986"> </a>This chapter describes how applications use the Exchange Manager to send and receive typed data objects. It covers the following topics: 
</p>

  <a name="969990"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970026">About the Exchange Manager</a></p>

  <a name="969994"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970152">Initializing the Exchange Socket Structure</a></p>

  <a name="969998"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970267">Registering for Data</a></p>

  <a name="970002"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970453">Registering to Receive Unwrapped Data</a></p>

  <a name="970006"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970628">Receiving Data</a></p>

  <a name="970010"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970881">Sending and Receiving Databases</a></p>

  <a name="970014"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970998">Requesting Data</a></p>

  <a name="970018"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#971117">Sending and Receiving Locally</a></p>

  <a name="970022"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#971183">Interacting with the Launcher</a></p>
<p class="Body">
  <a name="970023"> </a>This chapter does not describe how to implement an exchange library. 
</p>

<h2 class="HaHeadA">
  <a name="970026"> </a>About the Exchange Manager  
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970027"> </a>This section explains concepts you need to know before you can begin using the Exchange Manager. It discusses the following topics: 
</p>

  <a name="970031"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970037">Exchange Libraries</a></p>

  <a name="970035"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970092">Typed Data Objects</a></p>

<h2 class="HBHeadB">
  <a name="970037"> </a>Exchange Libraries
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970038"> </a>The Exchange Manager works in conjunction with an exchange library. Each <b>exchange library</b> is transport-dependent and performs the actual communication with the remote device. When an application makes an Exchange Manager call, the Exchange Manager forwards the request to the appropriate exchange library. The Exchange Manager's main duty is to maintain a registry of which libraries implement each protocol and which applications receive each type of data. See <a href="ExchangeManagerConcept.html#970044">Figure 1.1</a>.
</p>

<p class="FFigureCaption">
  <a name="970044"> </a>Figure 1.1	 Object exchange using Exchange Manager
</p>
<p class="FgFigure">
  <a name="970050"> </a><div align="left"><img src="images/ExchangeManagerConcepta.gif" height="219" width="624" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="970051"> </a>The list of supported exchange libraries depends on the version of Palm OS. See <a href="ExchangeManagerConcept.html#970059">Table 1.1</a>. 
</p>

<h5 class="TgTable">
  <a name="970088"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="970059"> </a><div class="TableTitle">Table 1.1  Supported exchange libraries </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="970063"> </a><div class="CellHeading">Exchange Library </div></th>
    <th><a name="970065"> </a><div class="CellHeading">Minimum Palm OS Version </div></th>
  </tr>
  <tr valign="top">
    <td><a name="970068"> </a><div class="CellBody">IR Library (IrDA) </div></td>
    <td><a name="970070"> </a><div class="CellBody">Palm OS 3.0 </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970072"> </a><div class="CellBody">Local Exchange Library </div></td>
    <td><a name="970074"> </a><div class="CellBody">Palm OS 4.0 </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970077"> </a><div class="CellBody">SMS Library (Short Messaging System)</div></td>
    <td><a name="970079"> </a><div class="CellBody">Palm OS 4.0 </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970085"> </a><div class="CellBody">Bluetooth Library<a href="#970084"><span class="Footnote">1</span></a> </div></td>
    <td><a name="970087"> </a><div class="CellBody">Palm OS 4.0</div></td>
  </tr>
</table>

<table>
  <tr>
    <td><a name="970084"> </a><div class="FNTFootnoteTable"><a href="#970085"><span class="FootnoteNumber">1. </span></a><a name="970084"> </a><div class="FNTFootnoteTable">The Bluetooth Library is not present in Palm OS 4.0, but is planned to be provided shortly after Palm OS 4.0 ships. </div></div></td>
  </tr>
</table>



</h5><p class="Body">
  <a name="970089"> </a>As other exchange libraries become available, users can install them on their Palm Powered<sup>&#8482;</sup> handhelds and use the communications functionality they provide.
</p>
<p class="Body">
  <a name="970090"> </a>Note that on Palm OS 3.X the only exchange library available is the IR Library, and it is not extensible. The IR Library cannot, for example, be replaced with a different exchange library. 
</p>

<h2 class="HBHeadB">
  <a name="970092"> </a>Typed Data Objects
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970093"> </a>The Exchange Manager sends and receives typed data objects. A <b>typed data object</b> (or <b>object</b>) is a stream of bytes plus some information about its contents. The content information includes any of: a creator ID, a MIME data type, or a filename. 
</p>
<p class="Body">
  <a name="970096"> </a>The object itself can be in any format, but it's best to use a standardized data format rather than a proprietary one if you have a choice. <a href="ExchangeManagerConcept.html#970106">Table 1.2</a> lists the standardized data formats that the built-in Palm OS applications can receive. 
</p>

<h5 class="TgTable">
  <a name="970135"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="970106"> </a><div class="TableTitle">Table 1.2  Built-in applications and standard data types </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="970110"> </a><div class="CellHeading">Application</div></th>
    <th><a name="970112"> </a><div class="CellHeading">Data Type</div></th>
  </tr>
  <tr valign="top">
    <td><a name="970114"> </a><div class="CellBody">Address Book</div></td>
    <td><a name="970117"> </a><div class="CellBody">vCards (vcf file extension, text/x-vCard MIME type)</div></td>
  </tr>
  <tr valign="top">
    <td><a name="970119"> </a><div class="CellBody">Datebook</div></td>
    <td><a name="970122"> </a><div class="CellBody">vCalendars (vcs file extension, text/x-vCalendar MIME type)</div></td>
  </tr>
  <tr valign="top">
    <td><a name="970124"> </a><div class="CellBody">Launcher</div></td>
    <td><a name="970126"> </a><div class="CellBody">Palm OS databases (prc, pdb, oprc, and pqa file extensions, application/x-pilot and application/vnd.palm MIME types)</div></td>
  </tr>
  <tr valign="top">
    <td><a name="970128"> </a><div class="CellBody">Memo</div></td>
    <td><a name="970130"> </a><div class="CellBody">Plain text (txt file extension, text/plain MIME type)</div></td>
  </tr>
  <tr valign="top">
    <td><a name="970132"> </a><div class="CellBody">ToDo</div></td>
    <td><a name="970134"> </a><div class="CellBody">Not explicitly registered, but receives vCalendar objects from Datebook as appropriate </div></td>
  </tr>
</table>




</h5><div class="NINoteImportant"><hr>
  <a name="970136"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> The MIME type application/vnd.palm has been registered with the IANA and is preferred over the application/x-pilot MIME type. 
<hr>
</div>
<p class="Body">
  <a name="970137"> </a>If you want your application to receive objects, you must first register with the Exchange Manager for the type of data you want to receive. See <a href="ExchangeManagerConcept.html#970267">"Registering for Data"</a> for instructions on how to do so. You can override the built-in applications by registering for any data type listed in <a href="ExchangeManagerConcept.html#970106">Table 1.2</a> and becoming the default application for that type. See <a href="ExchangeManagerConcept.html#970325">"Setting the Default Application"</a> for more information. 
</p>
<p class="Body">
  <a name="970147"> </a>If you only want to send data, you do not have to register. Your application can send data of the types listed in <a href="ExchangeManagerConcept.html#970106">Table 1.2</a>, and the Exchange Manager ensures that the appropriate application receives it. 
</p>

<h2 class="HaHeadA">
  <a name="970152"> </a>Initializing the Exchange Socket Structure 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970153"> </a>The Exchange Manager, exchange library, and application use an exchange socket structure (<a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a>) to communicate with each other. This structure is passed from the application to the Exchange Manager to the exchange library and vice versa. (The use of the term "socket" in the Exchange Manager API is not related to the term "socket" as used in sockets communication programming.) When your application sends data, you must create this structure and initialize it with the appropriate information. When you receive data, this structure provides information about the connection and the incoming data. 
</p>
<p class="Body">
  <a name="970158"> </a>The <span style="font-family: monospace">ExgSocketType</span> structure you use must identify two important pieces of information: 
</p>

  <a name="970159"> </a><p class="B1Bullet"> &#8226; the exchange library that should do the sending (see <a href="ExchangeManagerConcept.html#970176">"Identifying the Exchange Library"</a>) </p>

  <a name="970165"> </a><p class="B1Bullet"> &#8226; the type of data being sent (see <a href="ExchangeManagerConcept.html#970250">"Identifying the Type of Data"</a>) </p>
<p class="Body">
  <a name="970167"> </a>The socket structure defines other fields that you may use to provide other information if you want. See the description of the <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> structure in the <i>Palm OS Programmer's API Reference</i> for complete details. 
</p>
<div class="NINoteImportant"><hr>
  <a name="970174"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> When initializing the <span style="font-family: monospace">ExgSocketType</span> structure, set all unused fields to 0. 
<hr>
</div>

<h2 class="HBHeadB">
  <a name="970176"> </a>Identifying the Exchange Library
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970181"> </a>The <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> structure identifies the library to be used in one of the following ways: 
</p>

  <a name="970182"> </a><p class="B1Bullet"> &#8226; a library reference number in the <span style="font-family: monospace">libraryRef</span> field </p>

  <a name="970184"> </a><p class="B1Bullet"> &#8226; a Uniform Resource Locator (URL) in the <span style="font-family: monospace">name</span> field </p>
<p class="Body">
  <a name="970185"> </a>The Exchange Manager checks for a library reference number first. If it is 0, it checks for a URL. 
</p>
<p class="Body">
  <a name="970186"> </a>When your application sends data, it must identify which exchange library to use. You only need to identify the exchange library in Palm OS 4.0 and higher. Earlier releases contain only one exchange library (for IR), so all sending is automatically done by that library. If you do not specify an exchange library on Palm OS 4.0 and higher, the IR Library is used to maintain backward compatibility. 
</p>
<p class="Body">
  <a name="970187"> </a>It's more common to identify the library using a URL instead of a library reference number. The URL scheme<b> </b>specifies which exchange library to use. The <b>scheme</b> is the part of the URL that appears before the colon (:). For example, the scheme in the following URL is "http" 
</p>
<pre  class="Preformatted">
http://www.palmos.com <a name="970189"> </a>
</pre>
<p class="Body">
  <a name="970190"> </a>When you pass the preceding URL to a web browser, the scheme tells the browser to connect to the server using the HTTP protocol. Similarly, when you pass the Exchange Manager a URL, the scheme tells the Exchange Manager which exchange library to use. For example, the following URL tells the Exchange Manager to connect to a remote Palm Powered handheld using the IR Library: 
</p>
<pre  class="Preformatted">
_beam:BusinessCard.vcf<a name="970191"> </a>
</pre>
<p class="Body">
  <a name="970192"> </a>On Palm OS, a URL has the following format: 
</p>
<pre  class="Preformatted">
<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">[</span>?<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">]</span><i>scheme1</i><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">[</span>;<i>scheme2</i><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">]...</span>:<i>filename</i> <a name="970193"> </a>
</pre>
<p class="Body">
  <a name="970194"> </a>where: 
</p>
<h5 class="P1"><a name="970195"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="font-family: monospace">?</span> </td><td valign="top">If more than one exchange library is registered for the provided schemes, the Exchange Manager has the user select the exchange library by displaying the Send With dialog. </td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="970196"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><i>scheme1</i><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">[</span><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">;</span><i>scheme2</i><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">]...</span></td><td valign="top">The URL schemes that identify which exchange library should be used. If more than one exchange library is registered for the scheme, the default exchange library is selected unless the URL begins with a question mark. </td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="970197"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"></td><td valign="top">As shown, multiple schemes may be provided, separated by semicolons. Multiple schemes are only supported in conjunction with the question mark. For example, the string "?_send;_beam" has the Exchange Manager display a Send With dialog that lists all exchange libraries that support either the _send scheme or the _beam scheme. </td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="970198"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><i>filename</i></td><td valign="top">The name of the file to send. Typically, this file also has an extension that is used, if necessary, to determine which application should receive the data. See <a href="ExchangeManagerConcept.html#970250">"Identifying the Type of Data"</a> for more information about the file extension. </td>
  </tr>
</table>
</div></h5>
<p class="Body">
  <a name="970202"> </a>Palm OS defines some URL prefixes that any application can use to connect with the installed exchange libraries. A URL prefix is everything up to and including the colon character. <a href="ExchangeManagerConcept.html#970212">Table 1.3</a> describes the prefixes. 
</p>

<h5 class="TgTable">
  <a name="970244"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="970212"> </a><div class="TableTitle">Table 1.3  Exchange Library URL Prefixes </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="970216"> </a><div class="CellHeading">Exchange Library</div></th>
    <th><a name="970218"> </a><div class="CellHeading">URL Prefix </div></th>
  </tr>
  <tr valign="top">
    <td><a name="970220"> </a><div class="CellBody">IR Library</div></td>
    <td><a name="970223"> </a><div class="CellBody"><span style="font-family: monospace">exgBeamPrefix</span> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970225"> </a><div class="CellBody">Local Exchange Library </div></td>
    <td><a name="970228"> </a><div class="CellBody"><span style="font-family: monospace">exgLocalPrefix</span> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970230"> </a><div class="CellBody">SMS Library </div></td>
    <td><a name="970233"> </a><div class="CellBody"><span style="font-family: monospace">kSmsScheme</span> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970235"> </a><div class="CellBody">Any library that supports the _send scheme (user's choice)</div></td>
    <td><a name="970238"> </a><div class="CellBody"><span style="font-family: monospace">exgSendPrefix</span> </div></td>
  </tr>
  <tr valign="top">
    <td><a name="970240"> </a><div class="CellBody">Any library that supports the _send or _beam scheme (user's choice)</div></td>
    <td><a name="970243"> </a><div class="CellBody"><span style="font-family: monospace">exgSendBeamPrefix</span> </div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="970248"> </a>The section <a href="ExchangeManagerConcept.html#970615">"Implementing the Send Command"</a> provides more information on using <span style="font-family: monospace">exgSendPrefix</span> or <span style="font-family: monospace">exgSendBeamPrefix</span>. 
</p>

<h2 class="HBHeadB">
  <a name="970250"> </a>Identifying the Type of Data 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970251"> </a>When your application sends data, the exchange socket structure (<a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a>) identifies the type of data being sent. It can do so with one of the following values: 
</p>

  <a name="970255"> </a><p class="B1Bullet"> &#8226; A MIME type in the <span style="font-family: monospace">type</span> field. This field is only used on Palm OS 4.0 and higher. </p>

  <a name="970256"> </a><p class="B1Bullet"> &#8226; A file extension for the file in the <span style="font-family: monospace">name</span> field. That is, you might supply <span style="font-family: monospace">MyDB.pdb</span> as the value of the <span style="font-family: monospace">name</span> field. The part after the last period (.) is the extension. </p>
<p class="Body">
  <a name="970257"> </a>In most cases, the data type determines which application receives the data on the remote side. (If the <span style="font-family: monospace">target</span> field is specified, it determines which application receives the data instead of the data type as described below.) The Exchange Manager maintains a registry of applications and the types of data each application can receive. When the Exchange Manager receives an object, it checks the exchange socket for the data type. It checks the <span style="font-family: monospace">type</span> field first, and if it is not defined or if no application is registered to receive that MIME type, it checks the <span style="font-family: monospace">name</span> field for a file extension. This is discussed in more detail in the <a href="ExchangeManagerConcept.html#970267">"Registering for Data"</a> section. 
</p>
<p class="Body">
  <a name="970261"> </a>Note that you may also directly specify which application should receive the data. To do so, place the creator ID in the <span style="font-family: monospace">target</span> field. You do not have to specify a MIME type or file extension in this instance. When the <span style="font-family: monospace">target</span> field is nonzero, the Exchange Manager checks for the existence of that application on the receiving device. If it exists, that application receives the data regardless of whether it is registered. If the target application does not exist, the Exchange Manager searches the registry as usual. Use the <span style="font-family: monospace">target</span> field only if you know that you are communicating with a Palm Powered handheld and want to explicitly specify which application should receive the data. 
</p>
<p class="Body">
  <a name="970262"> </a>On Palm OS 4.0 and higher, an application can register for another application's creator ID and receive all objects targeted to that creator ID. See <a href="ExchangeManagerConcept.html#970325">"Setting the Default Application"</a> for more details. 
</p>

<h2 class="HaHeadA">
  <a name="970267"> </a>Registering for Data 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970268"> </a>In most cases, applications that want to receive data from the Exchange Manager must register for the MIME type and/or file extension that they want to receive. The function that you use to do so differs depending on which operating system versions you want to support. 
</p>
<p class="Body">
  <a name="970273"> </a>On Palm OS 3.X, you call <a href="ExchangeManager.html#1234639"><span style="font-family: monospace">ExgRegisterData</span></a> and pass it three parameters: your application's creator ID, a constant that identifies the type of data you want to register to receive (<span style="font-family: monospace">exgRegExtensionID</span> for file extensions or <span style="font-family: monospace">exgRegTypeID</span> for MIME types), and a string that lists the MIME types or file extensions. For example, on Palm OS 3.X the Beamer sample application distributed with the Palm OS SDK makes this call: 
</p>
<pre  class="Preformatted">
ExgRegisterData(beamerCreator,<a name="970274"> </a>
  exgRegExtensionID, BitmapExt);<a name="970275"> </a>
</pre>
<p class="Body">
  <a name="970276"> </a>On Palm OS 4.0 and higher, <span style="font-family: monospace">ExgRegisterData</span> is deprecated and replaced with <a href="ExchangeManager.html#1234538"><span style="font-family: monospace">ExgRegisterDatatype</span></a>. <span style="font-family: monospace">ExgRegisterDatatype</span> supports more types of data and takes more parameters. You still pass the creator ID, the type of data you want to register for, and the string that describes the specifics of what you are registering for. Palm OS 4.0 and higher supports registering for creator IDs (<span style="font-family: monospace">exgRegCreatorID</span>) or URL schemes (<span style="font-family: monospace">exgRegSchemeID</span>) in addition to MIME types and file extensions; however, registering for these new data types is not as common. See <a href="ExchangeManagerConcept.html#970325">"Setting the Default Application"</a> for a case where you would register for a creator ID, and see <a href="ExchangeManagerConcept.html#971097">"Requesting a URL"</a> for a case where you would register for a URL. 
</p>
<p class="Body">
  <a name="970289"> </a>In addition, you must pass two more parameters to <span style="font-family: monospace">ExgRegisterDatatype</span>: a string containing descriptions of the data you are registering to receive and a flag indicating whether you want to receive the data directly if it is sent as part of another object. The descriptions that you pass in are displayed to preview the data in the exchange dialog under certain circumstances. The flag parameter is described in the <a href="ExchangeManagerConcept.html#970453">"Registering to Receive Unwrapped Data"</a> section. 
</p>
<p class="Body">
  <a name="970293"> </a>For example, on Palm OS 4.0 the Beamer sample application distributed with the Palm OS SDK makes this call: 
</p>
<pre  class="Preformatted">
<span style="font-family: monospace">ExgRegisterDatatype</span>(beamerCreator,<a name="970294"> </a>
  exgRegExtensionID, BitmapExt, "bitmap", 0);<a name="970295"> </a>
</pre>

<h2 class="HBHeadB">
  <a name="970296"> </a>General Registration Guidelines
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970297"> </a>Follow these guidelines when registering for data: 
</p>

  <a name="970298"> </a><p class="B1Bullet"> &#8226; Register as early as possible. </p>
<p class="Indented1"> <a name="970299"> </a>To ensure that your application can receive data at any time after it is installed, call <a href="ExchangeManager.html#1234639"><span style="font-family: monospace">ExgRegisterData</span></a> or <a href="ExchangeManager.html#1234538"><span style="font-family: monospace">ExgRegisterDatatype</span></a> in response to the <a href="AppLaunchCodes.html#970999"><span style="font-family: monospace">sysAppLaunchCmdSyncNotify</span></a> launch code. This launch code is sent to your application upon its first installation and any time the HotSync<sup>®</sup> operation modifies the application's database. </p>

  <a name="970311"> </a><p class="B1Bullet"> &#8226; It's best to use a standardized data format rather than a proprietary one if you have a choice. </p>

  <a name="970312"> </a><p class="B1Bullet"> &#8226; On Palm OS 4.0 and higher, multiple applications can register to receive the same data type. The section <a href="ExchangeManagerConcept.html#970325">"Setting the Default Application"</a> describes this further. </p>

  <a name="970316"> </a><p class="B1Bullet"> &#8226; When registering for file extensions, do not include the period (.) as part of the extension. Register for "TXT", for example, not ".TXT". </p>

  <a name="970317"> </a><p class="B1Bullet"> &#8226; Do <b>not</b> make multiple calls if you want to register for more than one MIME type or more than one file extension. </p>
<p class="Indented1"> <a name="970318"> </a>Instead, make one call for all file extensions and one call for all MIME types. Pass a single string containing file extensions or MIME types separated by a tab (\t) character. For example, the following call registers the application for two file extensions, TXT and DOC: </p>
<pre  class="Preformatted">
<span style="font-family: monospace">ExgRegisterData(myCreator, exgRegExtensionID,
"TXT\tDOC", "plain text", 0);</span><a name="970319"> </a>
</pre>

  <a name="970320"> </a><p class="B1Bullet"> &#8226; The description parameter is optional. If you implement the preview mode as described in <a href="ExchangeManagerConcept.html#970723">"Displaying a Preview"</a> later in this chapter, you do not need to provide a description. It is, however, strongly recommended that you provide one. </p>

<h2 class="HBHeadB">
  <a name="970325"> </a>Setting the Default Application
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970326"> </a>Because multiple applications can register for the same data type on Palm OS 4.0 and higher, the Exchange Manager supports the concept of a default application that receives all objects of a particular data type. To set the default application, call the function <a href="ExchangeManager.html#1234775"><span style="font-family: monospace">ExgSetDefaultApplication</span></a>. There is one default application per data type in the registry. Palm OS 3.X does not support having multiple applications registered for the same data types. 
</p>
<p class="Body">
  <a name="970331"> </a>Suppose a device running Palm OS 4.0 receives a vCard object, and it has three applications registered to receive vCards. The Exchange Manager checks the registry to see if any of these applications is assigned as the default. If so, the default application receives all vCards (unless the exchange socket structure's <span style="font-family: monospace">target</span> field is set). If none of the three applications is the default, the Exchange Manager chooses one, and that application receives all vCards. 
</p>
<p class="Body">
  <a name="970332"> </a>PalmSource, Inc. strongly recommends that you allow users to choose which application is the default. To do so, you could display a panel that shows users the applications that can receive the same type of data as your application, show them which is the default, and allow them to select a different default. Use <a href="ExchangeManager.html#1234003"><span style="font-family: monospace">ExgGetRegisteredApplications</span></a> to get a list of all applications registered to receive the same data type as yours, and use <a href="ExchangeManager.html#1233946"><span style="font-family: monospace">ExgGetDefaultApplication</span></a> to retrieve the current default, if any. See <a href="ExchangeManagerConcept.html#970405">Listing 1.2</a> to see how the iMessenger example application performs this task for the <span style="font-family: monospace">mailto</span> URL scheme. The full source code is distributed with the SDK. 
</p>
<p class="CCodeCaption">
  <a name="970345"> </a>Listing 1.1  Initializing a List of Registered Applications
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
void PrvSetMailAppsList(Int32 listSelection)<a name="970346"> </a>
{<a name="970347"> </a>
   ControlPtr ctl;<a name="970348"> </a>
   ListPtr lst;<a name="970349"> </a>
   UInt32 defaultID;<a name="970350"> </a>
 <a name="970351"> </a>
   ctl = GetObjectPtr(PrefDefaultMailTrigger);<a name="970352"> </a>
   lst = GetObjectPtr(PrefDefaultMailList);<a name="970353"> </a>
 <a name="970354"> </a>
   // crIDs, appCnt, appNames are all global variables. <a name="970355"> </a>
   // Get the list of creator IDs if we don't have it already. <a name="970356"> </a>
   if(!crIDs) {<a name="970357"> </a>
      ExgGetRegisteredApplications(&amp;crIDs, &amp;appCnt, &amp;appNames, NULL, <a name="970358"> </a>
         exgRegSchemeID, "mailto");<a name="970359"> </a>
      if(appCnt) {<a name="970360"> </a>
         MemHandle tmpH = SysFormPointerArrayToStrings(appNames, appCnt);<a name="970361"> </a>
         if(tmpH)<a name="970362"> </a>
            appNamesArray = MemHandleLock(tmpH);<a name="970363"> </a>
         else<a name="970364"> </a>
            return;<a name="970365"> </a>
      }<a name="970366"> </a>
      else<a name="970367"> </a>
         return;<a name="970368"> </a>
   }<a name="970369"> </a>
 <a name="970370"> </a>
   if(appNamesArray)<a name="970371"> </a>
      LstSetListChoices(lst, appNamesArray, appCnt);<a name="970372"> </a>
   LstSetHeight(lst, appCnt &lt; 6 ? appCnt : 6);<a name="970373"> </a>
 <a name="970374"> </a>
   if(listSelection == -1)<a name="970375"> </a>
   {<a name="970376"> </a>
      UInt16 i;<a name="970377"> </a>
      ExgGetDefaultApplication(&amp;defaultID, exgRegSchemeID, "mailto");<a name="970378"> </a>
 <a name="970379"> </a>
      for(i=0;i&lt;appCnt;i++) {<a name="970380"> </a>
         if(crIDs[i] == defaultID)<a name="970381"> </a>
            LstSetSelection(lst, i);<a name="970382"> </a>
      }<a name="970383"> </a>
   }<a name="970384"> </a>
   else<a name="970385"> </a>
      LstSetSelection(lst, listSelection);<a name="970386"> </a>
 <a name="970387"> </a>
   CtlSetLabel(ctl, appNamesArray[LstGetSelection(lst)]);<a name="970388"> </a>
}<a name="970389"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="970390"> </a>To become the default application for a data type that a built-in Palm OS application is registered to receive (see <a href="ExchangeManagerConcept.html#970106">Table 1.2</a>), you must perform some extra steps to ensure that you can receive that type of object when it is beamed from a device running Palm OS 3.X. You must register for the built-in application's creator ID and become the default application for that creator ID. 
</p>
<p class="Body">
  <a name="970394"> </a>On Palm OS 3.X, the built-in applications always set their creator IDs in the <span style="font-family: monospace">target</span> field when sending data, causing the data to always be sent to that application. On Palm OS 4.0 and higher, the built-in applications still register to receive the same type of data, but they do not set the <span style="font-family: monospace">target</span> field when sending. This means that if your application is registered for the same data type and is the default application, it receives the data from Palm OS 4.0 and higher as expected, but if the data is sent from a device running Palm OS 3.X, you still won't receive that data because it is specifically targeted for the built-in application. 
</p>
<p class="Body">
  <a name="970396"> </a>To solve this problem, the <span style="font-family: monospace">ExgRegisterData</span> function in Palm OS 4.0 and higher supports registering for another application's creator ID. <a href="ExchangeManagerConcept.html#970405">Listing 1.2</a> shows how an application that receives vCards might set the default application after allowing the user to select the default from a list, assuming the list is initialized with code similar to that in <a href="ExchangeManagerConcept.html#970345">Listing 1.1</a>.
</p>
<p class="Body">
  <a name="970403"> </a>Note that, as with all data types, your application won't receive the data targeted for the other application unless yours is the default application for that creator ID. 
</p>
<p class="CCodeCaption">
  <a name="970405"> </a>Listing 1.2  Setting the default application for vCards
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
UInt32 PilotMain (UInt16 cmd, void *cmdPBP, UInt16 launchFlags)<a name="970406"> </a>
{<a name="970407"> </a>
   ...<a name="970408"> </a>
   // Register for vCard MIME type, extension, and Address Book's creator ID. <a name="970409"> </a>
   // At this point, we are not the default application so we do not receive<a name="970410"> </a>
   // vCards. We still must register upon install so that our application <a name="970411"> </a>
   // appears in the preferences list when the user chooses the default <a name="970412"> </a>
   // application for vCards. <a name="970413"> </a>
   case sysAppLaunchCmdSyncNotify:<a name="970414"> </a>
      Char addressCreatorStr[5];<a name="970415"> </a>
      <a name="970416"> </a>
      // Create a string from Address Book's creator ID. <a name="970417"> </a>
      <span style="font-family: monospace">MemMove(addressCreatorStr, </span>sysFileCAddress<span style="font-family: monospace">, 4);</span><a name="970418"> </a>
      <span style="font-family: monospace">address</span>CreatorStr[4] = chrNull;<a name="970419"> </a>
 <a name="970420"> </a>
      ExgRegisterDatatype(crID, exgRegTypeID, "text/x-vCard", "vCard", 0);<a name="970421"> </a>
      ExgRegisterDatatype(crID, exgRegExtensionID, "vcf", "vCard", 0);<a name="970422"> </a>
      ExgRegisterDatatype(crID, exgRegCreatorID, addressCreatorStr, NULL, 0);<a name="970423"> </a>
      ...<a name="970424"> </a>
}<a name="970425"> </a>
 <a name="970426"> </a>
static void PrefApply (void)<a name="970427"> </a>
{<a name="970428"> </a>
   MemHandle h;<a name="970429"> </a>
   FieldType *fld;<a name="970430"> </a>
   ControlType *ctl;<a name="970431"> </a>
   UInt16 listItem;<a name="970432"> </a>
 <a name="970433"> </a>
   // Set the default vCard app<a name="970434"> </a>
vif(appCnt &amp;&amp; crIDs)<a name="970435"> </a>
   {<a name="970436"> </a>
      UInt32 crID;<a name="970437"> </a>
      Char addressCreatorStr[5];<a name="970438"> </a>
      <a name="970439"> </a>
      // Create a string from Address Book's creator ID. <a name="970440"> </a>
      <span style="font-family: monospace">MemMove(addressCreatorStr, </span>sysFileCAddress<span style="font-family: monospace">, 4);</span><a name="970441"> </a>
      <span style="font-family: monospace">address</span>CreatorStr[4] = chrNull;<a name="970442"> </a>
      <a name="970443"> </a>
      listItem = LstGetSelection(GetObjectPtr(PrefDefaultAppList));<a name="970444"> </a>
      crID = crIDs[listItem];<a name="970445"> </a>
      ExgSetDefaultApplication(crID, exgRegTypeID, "text/x-vCard");<a name="970446"> </a>
      ExgSetDefaultApplication(crID, exgRegExtensionID, "vcf");<a name="970447"> </a>
      ExgSetDefaultApplication(crID, exgRegCreatorID, <span style="font-family: monospace">addressCreatorStr</span>);<a name="970448"> </a>
   }<a name="970449"> </a>
}<a name="970450"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="970453"> </a>Registering to Receive Unwrapped Data
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970454"> </a>On Palm OS 4.0 or higher, in rare circumstances, you can register to receive data that is sent enclosed in another object. 
</p>
<p class="Body">
  <a name="970455"> </a>For example, suppose you have a stock quote application that wants to receive vStock objects. If the device is sent an e-mail message that has the vStock object attached, your application may want to register to receive the vStock object directly rather than having the e-mail application receive it. To do so, call <a href="ExchangeManager.html#1234538"><span style="font-family: monospace">ExgRegisterDatatype</span></a> and pass the constant <span style="font-family: monospace">exgUnwrap</span> as the last parameter. The flag is named <span style="font-family: monospace">exgUnwrap</span> because the exchange library unwraps the received object (the e-mail message in this example) so that it can send the contained objects (the vStock object) directly. 
</p>
<p class="Body">
  <a name="970460"> </a>If you want to register to receive an object when it is sent as part of another object, you probably also want to receive it when it is sent by itself. This requires two calls to <span style="font-family: monospace">ExgRegisterDatatype</span>: one with the <span style="font-family: monospace">exgUnwrap</span> flag set, and one without. 
</p>
<pre  class="Preformatted">
<span style="font-family: monospace">ExgRegisterDatatype(myCreator, </span><a name="970462"> </a>
<span style="font-family: monospace">  exgRegExtensionID, "TXT\tDOC", "plain text", </span><a name="970463"> </a>
<span style="font-family: monospace">  0);</span><a name="970464"> </a>
<span style="font-family: monospace">ExgRegisterDatatype(myCreator, </span><a name="970465"> </a>
<span style="font-family: monospace">  exgRegExtensionID, "TXT\tDOC", "plain text", </span><a name="970466"> </a>
<span style="font-family: monospace">  exgUnwrap);</span><a name="970467"> </a>
</pre>
<p class="Body">
  <a name="970468"> </a>Thus, you might make four calls to <span style="font-family: monospace">ExgRegisterDatatype</span>: 
</p>

  <a name="970469"> </a><p class="B1Bullet"> &#8226; one call to register for the file extensions </p>

  <a name="970470"> </a><p class="B1Bullet"> &#8226; one call to register for file extensions that are sent as part of another object</p>

  <a name="970471"> </a><p class="B1Bullet"> &#8226; one call to register for MIME types</p>

  <a name="970472"> </a><p class="B1Bullet"> &#8226; one call to register for MIME types that are sent as part of another object</p>
<p class="Body">
  <a name="970473"> </a>As mentioned previously, it's rare for an application to register to receive unwrapped data directly. It's more common for one application (such as an e-mail application) to receive the entire compound object and then unwrap and disperse the enclosed objects using the Local Exchange Library. See <a href="ExchangeManagerConcept.html#971117">"Sending and Receiving Locally"</a> for more information. 
</p>

<h2 class="HaHeadA">
  <a name="970478"> </a>Sending Data 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970479"> </a>This section describes how to send data using the Exchange Manager. It discusses the following topics: 
</p>

  <a name="970483"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970493">Sending a Single Object</a></p>

  <a name="970487"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970558">Sending Multiple Objects</a></p>

  <a name="970491"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#970615">Implementing the Send Command</a></p>

<h2 class="HBHeadB">
  <a name="970493"> </a>Sending a Single Object
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970494"> </a>The most common use of the Exchange Manager is to send or receive a single object. To send an object, do the following: 
</p>
  <a name="970499"> </a><p class="N1NumList">1.	  Create and initialize an <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> data structure with information about which library to use and the data to be sent. See <a href="ExchangeManagerConcept.html#970152">"Initializing the Exchange Socket Structure"</a> for more information. </p>  <a name="970507"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1234399"><span style="font-family: monospace">ExgPut</span></a> to establish the connection with the exchange library. </p>  <a name="970512"> </a><p class="N1NumList">3.	  Call <a href="ExchangeManager.html#1234730"><span style="font-family: monospace">ExgSend</span></a> one or more times to send the data. </p><p class="Indented1"> <a name="970513"> </a>In this function, you specify the number of bytes to send, and <span style="font-family: monospace">ExgSend</span> returns the number of bytes that were sent. You may need to call it multiple times if data is remaining to be sent after the first and subsequent calls. </p>
  <a name="970518"> </a><p class="N1NumList">4.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p><p class="Indented1"> <a name="970519"> </a>A zero (0) return value indicates a successful transmission. However, this doesn't necessarily mean that the receiver kept the data. If the target application for an object doesn't exist on the receiving device, the data is discarded; or the user can decide to discard any received objects.</p>
<p class="Body">
  <a name="970520"> </a>Note that the <span style="font-family: monospace">ExgSend</span> function blocks until it returns. However, most libraries provide a user interface dialog that keeps the user informed of transmission progress and allows them to cancel the operation. 
</p>
<p class="Body">
  <a name="970521"> </a>The Exchange Manager automatically displays error dialogs as well, if errors occur. You must check for error codes from Exchange Manager routines, but you don't need to display an error dialog if you get one because the Exchange Manager handles this for you.
</p>
<p class="Body">
  <a name="970525"> </a>For example, <a href="ExchangeManagerConcept.html#970527">Listing 1.3</a> shows how to send the current draw window from one Palm Powered handheld to another Palm Powered handheld. It is modified from the Beamer example application that is included in the Palm OS SDK. 
</p>
<p class="CCodeCaption">
  <a name="970527"> </a>Listing 1.3  Sending data using Exchange Manager
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Err SendData(void)<a name="970528"> </a>
{<a name="970529"> </a>
   ExgSocketType exgSocket;<a name="970530"> </a>
   UInt32 size = 0;<a name="970531"> </a>
   UInt32 sizeSent = 0;<a name="970532"> </a>
   Err err = 0;<a name="970533"> </a>
   BitmapType *bmpP;<a name="970534"> </a>
 <a name="970535"> </a>
   // copy draw area into the bitmap<a name="970536"> </a>
   SaveWindow();<a name="970537"> </a>
   bmpP = PrvGetBitmap(canvasWinH, &amp;size, &amp;err);<a name="970538"> </a>
   // Is there data in the field?<a name="970539"> </a>
   if (!err &amp;&amp; size) {<a name="970540"> </a>
      // important to init structure to zeros...<a name="970541"> </a>
      MemSet(&amp;exgSocket,sizeof(exgSocket),0);<a name="970542"> </a>
      exgSocket.description = "Beamer picture";<a name="970543"> </a>
      exgSocket.name = "Beamer.pbm";<a name="970544"> </a>
      exgSocket.length = size;<a name="970545"> </a>
      err = ExgPut(&amp;exgSocket); <a name="970546"> </a>
      if (!err) {<a name="970547"> </a>
         while (!err &amp;&amp; sizeSent &lt; size) {<a name="970548"> </a>
            sizeSent += ExgSend(&amp;exgSocket,bmpP,size,&amp;err);<a name="970549"> </a>
        }<a name="970550"> </a>
         ExgDisconnect(&amp;exgSocket,err);<a name="970551"> </a>
      }<a name="970552"> </a>
   }<a name="970553"> </a>
   if (bmpP) MemPtrFree(bmpP);	<a name="970554"> </a>
   return err;<a name="970555"> </a>
}<a name="970556"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="970558"> </a>Sending Multiple Objects
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970559"> </a>On Palm OS 4.0 and higher, if the exchange library supports it, you can send multiple objects in a single connection. To send multiple objects, do the following: 
</p>
  <a name="970564"> </a><p class="N1NumList">1.	  Create and initialize an <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> data structure with information about which library to use and the data to be sent. See <a href="ExchangeManagerConcept.html#970152">"Initializing the Exchange Socket Structure"</a> for more information. You might also supply a value for the <span style="font-family: monospace">count</span> field to specify how many objects are to be sent. </p>  <a name="970572"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1233358"><span style="font-family: monospace">ExgConnect</span></a> to establish the connection with the exchange library. </p>  <a name="970573"> </a><p class="N1NumList">3.	  For each object, do the following: </p>  <a name="970578"> </a><p class="N2NumListSub">a.	  Call <a href="ExchangeManager.html#1234399"><span style="font-family: monospace">ExgPut</span></a> to signal the start of a new object. </p>  <a name="970583"> </a><p class="N2NumListSub">b.	  Call <a href="ExchangeManager.html#1234730"><span style="font-family: monospace">ExgSend</span></a> multiple times to send the data. </p><p class="Indented2"> <a name="970584"> </a>In this function you specify the number of bytes to send, and <span style="font-family: monospace">ExgSend</span> returns the number of bytes that were sent. You may need to call it multiple times if data is remaining to be sent after the first and subsequent calls. </p>
  <a name="970589"> </a><p class="N1NumList">4.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p><p class="Indented1"> <a name="970590"> </a>A zero (0) return value indicates a successful transmission. However, this doesn't necessarily mean that the receiver kept the data. If the target application for an object doesn't exist on the receiving device, the data is discarded; or the user can decide to discard any beamed objects.</p>
<p class="Body">
  <a name="970591"> </a>The <span style="font-family: monospace">ExgConnect</span> call is optional. Some exchange libraries, such as the IR Library, support the sending of multiple objects but do not support <span style="font-family: monospace">ExgConnect</span>. If <span style="font-family: monospace">ExgConnect</span> returns an error, the first call to <span style="font-family: monospace">ExgPut</span> initiates the connection. You should only continue to send objects if the first <span style="font-family: monospace">ExgPut</span> call succeeds. See <a href="ExchangeManagerConcept.html#970596">Listing 1.4</a>. Libraries that support the <span style="font-family: monospace">ExgConnect</span> call also support sending multiple objects without using <span style="font-family: monospace">ExgConnect</span>. 
</p>
<p class="CCodeCaption">
  <a name="970596"> </a>Listing 1.4  Sending multiple objects
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Boolean isConnected = false;<a name="970597"> </a>
err = ExgConnect(&amp;exgSocket);      //optional<a name="970598"> </a>
if (!err)<a name="970599"> </a>
   isConnected = true;<a name="970600"> </a>
if (!err || err == exgErrNotSupported) {<a name="970601"> </a>
   while (/* we have objects to send */) {<a name="970602"> </a>
      err = ExgPut(&amp;exgSocket);<a name="970603"> </a>
      if (!isConnected &amp;&amp; !err)<a name="970604"> </a>
         isConnected = true; //auto-connected on first put.<a name="970605"> </a>
      while (!err &amp;&amp; (sizeSent &lt; size)) <a name="970606"> </a>
         sizeSent += ExgSend(&amp;exgSocket,dataP,size,&amp;err);<a name="970607"> </a>
      if (err)<a name="970608"> </a>
         break;<a name="970609"> </a>
   }<a name="970610"> </a>
}<a name="970611"> </a>
if (isConnected) <a name="970612"> </a>
   ExgDisconnect(&amp;exgSocket, err);<a name="970613"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="970615"> </a>Implementing the Send Command 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970617"> </a>Starting in Palm OS 4.0, the built-in applications support a Send menu command. The purpose of this command is to allow the user to send data using any available transport mechanism. 
</p>
<p class="Body">
  <a name="970619"> </a>The Exchange Manager defines a _send URL scheme. The intent is that any exchange library that supports sending is registered for the _send scheme. Currently, only the SMS Library is registered for this scheme on release ROMs. When Bluetooth support becomes available, the Bluetooth Library will be registered for this scheme. The IR Library is <b>not</b> registered for the _send scheme. 
</p>
<p class="Body">
  <a name="970620"> </a>To implement the Send command in your application, construct a URL that has the prefix <span style="font-family: monospace">exgSendPrefix</span>, and send the data in the normal manner. You can also use the <span style="font-family: monospace">exgSendBeamPrefix</span> instead so that the user can select from all exchange libraries registered for either sending or beaming (which includes the IR Library). Both of these prefixes begin with a question mark, causing the Exchange Manager to display a dialog if it finds more than one exchange library registered for the specified schemes. 
</p>
<p class="Body">
  <a name="970623"> </a>Currently on a Palm OS 4.0 release ROM, only the SMS Exchange Library supports the _send scheme, so using <span style="font-family: monospace">exgSendPrefix</span> would not cause the dialog to be displayed. If the user later adds Bluetooth support, the prefix would cause the dialog to be displayed. 
</p>
<div class="NINoteImportant"><hr>
  <a name="970624"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> On debug ROMs, the Local Exchange Library is listed as one of the possible transport mechanisms. This allows you to debug your Send command. The Local Exchange Library is not listed in the Send With dialog on release ROMs. 
<hr>
</div>
<p class="Body">
  <a name="970626"> </a>For an example of how to implement the Send command, see the Memo application example code distributed with the Palm OS SDK.
</p>

<h2 class="HaHeadA">
  <a name="970628"> </a>Receiving Data 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970629"> </a>To have your application receive data from the Exchange Manager, do the following:
</p>
  <a name="970630"> </a><p class="N1NumList">1.	  Register for the type of data you want to receive. See <a href="ExchangeManagerConcept.html#970267">"Registering for Data"</a> for more information. </p>  <a name="970638"> </a><p class="N1NumList">2.	  Handle the launch code <a href="AppLaunchCodes.html#970542"><span style="font-family: monospace">sysAppLaunchCmdExgAskUser</span></a> if you want to control the user confirmation dialog that is displayed. See <a href="ExchangeManagerConcept.html#970664">"Controlling the Exchange Dialog"</a> for more information. </p>  <a name="970646"> </a><p class="N1NumList">3.	  Handle the launch code <a href="AppLaunchCodes.html#970614"><span style="font-family: monospace">sysAppLaunchCmdExgPreview</span></a> if you want to display a preview of the data to be received. See <a href="ExchangeManagerConcept.html#970723">"Displaying a Preview"</a> for more information. </p>  <a name="970650"> </a><p class="N1NumList">4.	  Handle the launch code <a href="AppLaunchCodes.html#970682"><span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span></a> to receive the data. See <a href="ExchangeManagerConcept.html#970774">"Receiving the Data"</a> for more information. </p>  <a name="970662"> </a><p class="N1NumList">5.	  If you want, handle <a href="AppLaunchCodes.html#970812"><span style="font-family: monospace">sysAppLaunchCmdGoto</span></a> to display the record. </p>
<h2 class="HBHeadB">
  <a name="970664"> </a>Controlling the Exchange Dialog
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970665"> </a>When the Exchange Manager receives an object and decides that your application is the target for that object, it sends your application a series of launch codes. The first launch code your application receives, in most cases, is <a href="AppLaunchCodes.html#970542"><span style="font-family: monospace">sysAppLaunchCmdExgAskUser</span></a>. 
</p>
<div class="NINoteImportant"><hr>
  <a name="970670"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> In Palm OS 4.0 and higher, the Exchange Manager allows the exchange library to turn off the user confirmation dialog. In this case, your application does not receive the <span style="font-family: monospace">sysAppLaunchCmdExgAskUser</span> launch code. 
<hr>
</div>
<p class="Body">
  <a name="970672"> </a>The Exchange Manger sends this launch code because it is about to display the exchange dialog, which asks the user to confirm the receipt of data. The launch code is your opportunity to accept the data without confirmation, reject the data without confirmation, or replace the exchange dialog. 
</p>
<p class="Body">
  <a name="970673"> </a>Responding to this launch code is optional. If you don't respond, the Exchange Manager calls <a href="ExchangeManager.html#1233779"><span style="font-family: monospace">ExgDoDialog</span></a> to display the exchange dialog. 
</p>
<p class="Body">
  <a name="970678"> </a>On Palm OS 3.5 and higher, the <span style="font-family: monospace">ExgDoDialog</span> function allows you to specify that the dialog display a category pop-up list. This pop-up list allows the user to receive the data into a certain category in the database, but the pop-up list is not shown by default. If you want the exchange dialog to display the pop-up list, you must respond to <span style="font-family: monospace">sysAppLaunchCmdExgAskUser</span> and call <span style="font-family: monospace">ExgDoDialog</span> yourself. Pass a pointer to an <span style="font-family: monospace">ExgDialogInfoType</span> structure. The <span style="font-family: monospace">ExgDialogInfoType</span> structure is defined as follows: 
</p>
<pre  class="Preformatted">
typedef struct {<a name="970679"> </a>
  UInt16     version;<a name="970680"> </a>
  DmOpenRef  db;<a name="970681"> </a>
  UInt16     categoryIndex;<a name="970682"> </a>
} ExgDialogInfoType;<a name="970684"> </a>
<a name="977221"> </a>
</pre>
<h5 class="P1"><a name="970685"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top">-&gt; <span style="font-family: monospace">version</span></td><td valign="top">Set this field to 0 to specify version 0 of this structure. </td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="970686"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top">-&gt; <span style="font-family: monospace">db</span></td><td valign="top">A pointer to an open database that defines the categories the dialog should display. </td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="970687"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top">&lt;- <span style="font-family: monospace">categoryIndex</span></td><td valign="top">The index of the category in which the user wants to file the incoming data. </td>
  </tr>
</table>
</div></h5>
<p class="Body">
  <a name="970688"> </a>If <span style="font-family: monospace">db</span> is valid, the function extracts the category information from the specified database and displays it in a pop-up list. Upon return, the <span style="font-family: monospace">categoryIndex</span> field contains the index of the category the user selected, or <span style="font-family: monospace">dmUnfiledCategory</span> if the user did not select a category. 
</p>
<p class="Body">
  <a name="970690"> </a>If the call to <span style="font-family: monospace">ExgDoDialog</span> is successful, your application is responsible for retaining the value returned in <span style="font-family: monospace">categoryIndex</span> and using it to file the incoming data as a record in that category. One way to do this is to store the <span style="font-family: monospace">categoryIndex</span> in the socket's <span style="font-family: monospace">appData</span> field (see <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a>) and then extract it from the socket in your response to the launch code <a href="AppLaunchCodes.html#970682"><span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span></a>. See <a href="ExchangeManagerConcept.html#970702">Listing 1.5</a> for an example. 
</p>
<p class="CCodeCaption">
  <a name="970702"> </a>Listing 1.5  Extracting the category from the exchange socket
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
UInt16 categoryID = (ExgSocketType *)cmdPBP-&gt;appData;<a name="970703"> </a>
 <a name="970704"> </a>
/* Receive the data, and create a new record using the<a name="970705"> </a>
   received data. indexNew is the index of this record. */<a name="970706"> </a>
if (category != dmUnfiledCategory){<a name="970707"> </a>
   UInt16 attr;<a name="970708"> </a>
   Err err;<a name="970709"> </a>
   err = DmRecordInfo(dbP, indexNew, &amp;attr, NULL, NULL);<a name="970710"> </a>
 <a name="970711"> </a>
   // Set the category to the one the user specified, and <a name="970712"> </a>
   // mark the record dirty. <a name="970713"> </a>
   if ((attr &amp; dmRecAttrCategoryMask) != category) {<a name="970714"> </a>
     attr &amp;= ~dmRecAttrCategoryMask;<a name="970715"> </a>
     attr |= category | dmRecAttrDirty;<a name="970716"> </a>
     err = DmSetRecordInfo(dbP, indexNew, &amp;attr, NULL);<a name="970717"> </a>
   }<a name="970718"> </a>
}<a name="970719"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="970720"> </a>Some of the Palm OS built-in applications (Address Book, Memo, and ToDo) use this method of setting the category on data received through beaming. Refer to the example code provided in the Palm OS SDK for these applications for a more complete example of how to use <span style="font-family: monospace">ExgDoDialog</span>.
</p>
<p class="Body">
  <a name="970721"> </a>When you explicitly call <span style="font-family: monospace">ExgDoDialog</span>, you must set the <span style="font-family: monospace">result</span> field of the <span style="font-family: monospace">sysAppLaunchCmdExgAskUser</span> launch code's parameter block to either <span style="font-family: monospace">exgAskOk</span> (upon success) or <span style="font-family: monospace">exgAskCancel</span> (upon failure) to prevent the system from displaying the dialog a second time. 
</p>

<h2 class="HBHeadB">
  <a name="970723"> </a>Displaying a Preview
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970724"> </a>On Palm OS 4.0 and higher, the exchange dialog contains a preview of the data to be received. The preview allows the user to see what the data is. The reason for the preview is that Palm OS 4.0 and higher supports exchange libraries other than the IR Library. When you use the IR Library to beam data to another Palm Powered handheld, the sender and the receiver must be in close contact with one another. Other transport mechanisms do not require the devices to be within close proximity, so the user might not know that the data is being received or why. In this case, the user might need more information about the object being received, so the Exchange Manager displays information about the object in the exchange dialog. Also, some exchange libraries do not transmit information for the exchange socket's <span style="font-family: monospace">description</span> field, so the Exchange Manager must provide another means of supplying the user with information about the data being received. 
</p>
<p class="Body">
  <a name="970726"> </a>To display the preview, the Exchange Manager launches the receiving application with the launch code <a href="AppLaunchCodes.html#970614"><span style="font-family: monospace">sysAppLaunchCmdExgPreview</span></a>. Your application does not have to respond to this launch code. If it doesn't, the Exchange Manager displays the first item that it locates in the following list: 
</p>

  <a name="970731"> </a><p class="B1Bullet"> &#8226; The data's description from the exchange socket's <span style="font-family: monospace">description</span> field</p>

  <a name="970732"> </a><p class="B1Bullet"> &#8226; The filename in the socket's <span style="font-family: monospace">name</span> field</p>

  <a name="970733"> </a><p class="B1Bullet"> &#8226; The receiving application's description as stored in the exchange registry (you pass this description to <a href="ExchangeManager.html#1234538"><span style="font-family: monospace">ExgRegisterDatatype</span></a> when registering) </p>

  <a name="970738"> </a><p class="B1Bullet"> &#8226; The MIME type in the socket's <span style="font-family: monospace">type</span> field</p>

  <a name="970739"> </a><p class="B1Bullet"> &#8226; The file extension in the socket's <span style="font-family: monospace">name</span> field</p>
<p class="Body">
  <a name="970740"> </a>If you want to support a preview that is more elaborate than those in the previous list, handle the <span style="font-family: monospace">sysAppLaunchCmdExgPreview</span> launch code. 
</p>
<p class="Body">
  <a name="970745"> </a>The launch code's parameter block is an <a href="ExchangeManager.html#1232903"><span style="font-family: monospace">ExgPreviewInfoType</span></a> structure. This structure contains the <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> structure, an <span style="font-family: monospace">op</span> field that describes what type of preview data the Exchange Manager expects, and fields in which to return the data. 
</p>
<p class="Body">
  <a name="970750"> </a>To respond to the launch code, do the following: 
</p>
  <a name="970751"> </a><p class="N1NumList">1.	  Check the <span style="font-family: monospace">op</span> field in the parameter block to see what type of preview data is expected. In most cases, the preview data is a string, but a graphical display might also be requested. </p>  <a name="970755"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1233284"><span style="font-family: monospace">ExgAccept</span></a> to establish a connection with the exchange library. </p>  <a name="970759"> </a><p class="N1NumList">3.	  Call <a href="ExchangeManager.html#1234473"><span style="font-family: monospace">ExgReceive</span></a> one or more times to receive the data. </p><p class="Indented1"> <a name="970760"> </a>In this function, you specify the number of bytes to receive and it returns the number of bytes that were received. You may need to call it multiple times if data is remaining to be received after the first and subsequent calls. </p>
  <a name="970761"> </a><p class="N1NumList">4.	  Place the data in the parameter block's <span style="font-family: monospace">string</span> field if the <span style="font-family: monospace">op</span> field specifies a string preview. If the <span style="font-family: monospace">op</span> field specifies a graphical preview, draw the data into the rectangle identified by the parameter block's <span style="font-family: monospace">bounds</span> field. </p>  <a name="970765"> </a><p class="N1NumList">5.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p><p class="Indented1"> <a name="970766"> </a>A zero (0) return value indicates a successful transmission. </p>
<p class="Body">
  <a name="970767"> </a>Note that you perform essentially the same steps to preview the data as you do to receive it. The only difference is what you do with the data after you receive it. In response to <span style="font-family: monospace">sysAppLaunchCmdExgPreview</span>, you pass the data back to the Exchange Manager and discard it in case the user rejects the data. In response to <a href="AppLaunchCodes.html#970682"><span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span></a>, you store the data. 
</p>
<p class="Body">
  <a name="970772"> </a>For an example of handling the <span style="font-family: monospace">sysAppLaunchCmdExgPreview</span> launch code, see the Address Book example application that is distributed with the Palm OS SDK. The <span style="font-family: monospace">TransferPreview</span> function handles the launch code. 
</p>

<h2 class="HBHeadB">
  <a name="970774"> </a>Receiving the Data
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970776"> </a>If the Exchange Manager receives <span style="font-family: monospace">exgAskOk</span> in response to the exchange dialog or the <a href="AppLaunchCodes.html#970542"><span style="font-family: monospace">sysAppLaunchCmdExgAskUser</span></a> launch code, the next step is to launch the application with <a href="AppLaunchCodes.html#970682"><span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span></a>. This launch code tells the application to actually receive the data. 
</p>
<p class="Body">
  <a name="970785"> </a>To respond to this launch code, do the following: 
</p>
  <a name="970790"> </a><p class="N1NumList">1.	  Call <a href="ExchangeManager.html#1233284"><span style="font-family: monospace">ExgAccept</span></a> to accept the connection<span style="font-family: monospace">.</span></p>  <a name="970794"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1234473"><span style="font-family: monospace">ExgReceive</span></a> one or more times to receive the data.</p><p class="Indented1"> <a name="970795"> </a>In this function you specify the number of bytes to receive, and <span style="font-family: monospace">ExgReceive</span> returns the number of bytes that were received. You may need to call it multiple times if data is remaining to be received after the first and subsequent calls. </p>
<p class="Indented1"> <a name="970796"> </a>Note that in the socket structure, the <span style="font-family: monospace">length</span> field may not be accurate, so in your receive loop you should be flexible in handling more or less data than <span style="font-family: monospace">length</span> specifies.</p>
  <a name="970797"> </a><p class="N1NumList">3.	  If you want your application launched again with the <a href="AppLaunchCodes.html#970812"><span style="font-family: monospace">sysAppLaunchCmdGoto</span></a> launch code, place your application's creator ID in the <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a>'s <span style="font-family: monospace">goToCreator</span> field and supply the information that should be passed to the launch code in the <span style="font-family: monospace">gotoParams</span> field. (The <span style="font-family: monospace">ExgSocketType</span> structure is the <span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span>'s parameter block.) </p>  <a name="970808"> </a><p class="N1NumList">4.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p><p class="Indented1"> <a name="970809"> </a>A zero (0) return value indicates a successful transmission. </p>
<p class="Body">
  <a name="970810"> </a>After your application returns from <span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span>, if the <span style="font-family: monospace">goToCreator</span> specifies your application's creator ID and if the exchange library supports it, your application is launched with <span style="font-family: monospace">sysAppLaunchCmdGoto</span>. In response to this launch code, your application should launch, open its database, and display the record identified by the <span style="font-family: monospace">recordNum</span> field (or <span style="font-family: monospace">matchCustom</span> field) in the parameter block. The Exchange Manager always does a full application launch with <span style="font-family: monospace">sysAppLaunchCmdGoto</span>, so your application has access to global variables; however, if you also use this launch code to implement the global find facility, you may not have access to global variables in that instance. The example code in <a href="ExchangeManagerConcept.html#970815">Listing 1.6</a> checks to see if globals are available, and if so, calls <span style="font-family: monospace">StartApplication</span> to initialize them. 
</p>
<p class="CCodeCaption">
  <a name="970815"> </a>Listing 1.6  Responding to sysAppLaunchCmdGoto
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
case sysAppLaunchCmdGoto:<a name="970816"> </a>
  if (launchFlags &amp; sysAppLaunchFlagNewGlobals) {
     err = StartApplication();<a name="970817"> </a>
     if (err) return err;<a name="970818"> </a>
     GoTo(cmdPBP, true);<a name="970819"> </a>
     EventLoop();<a name="970820"> </a>
     StopApplication();<a name="970821"> </a>
  } else {<a name="970822"> </a>
     GoTo(cmdPBP, false);<a name="970823"> </a>
}<a name="970824"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="970825"> </a>On Palm OS 4.0 and higher, not all exchange libraries support using the <span style="font-family: monospace">sysAppLaunchCmdGoto</span> launch code after the receipt of data. 
</p>
<p class="Body">
  <a name="970826"> </a>Also note that because Palm OS 4.0 and higher supports multiple object exchange, there is no guarantee that your application is the one that is launched at the end of a receipt of data. If multiple objects are being received, it is possible for another application to receive data after yours and to set the <span style="font-family: monospace">goToCreator</span> field to its own creator ID. In this case, the last application to set the field is the one that is launched. 
</p>
<p class="Body">
  <a name="970830"> </a><a href="ExchangeManagerConcept.html#970832">Listing 1.7</a> shows a function that receives a data object and sets the <span style="font-family: monospace">goToCreator</span> and <span style="font-family: monospace">goToParams</span>. This code is taken from the Beamer example application that is distributed with the Palm OS SDK. 
</p>
<p class="CCodeCaption">
  <a name="970832"> </a>Listing 1.7  Receiving a data object
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static Err ReceiveData(ExgSocketPtr exgSocketP)<a name="970833"> </a>
{<a name="970834"> </a>
   Err err;<a name="970835"> </a>
   MemHandle dataH;<a name="970836"> </a>
   UInt16 size;<a name="970837"> </a>
   UInt8 *dataP;<a name="970838"> </a>
   Int16 len;<a name="970839"> </a>
   UInt16 dataLen = 0;<a name="970840"> </a>
   <a name="970841"> </a>
   if (exgSocketP-&gt;length)<a name="970842"> </a>
      size = exgSocketP-&gt;length;<a name="970843"> </a>
   else<a name="970844"> </a>
      size = ChunkSize; <a name="970845"> </a>
   dataH = MemHandleNew(size);  <a name="970846"> </a>
   if (!dataH) return -1;  // <a name="970847"> </a>
   // accept will open a progress dialog and wait for your receive commands<a name="970848"> </a>
   err = ExgAccept(exgSocketP);<a name="970849"> </a>
   if (!err){<a name="970850"> </a>
      dataP = MemHandleLock(dataH);<a name="970851"> </a>
      do {<a name="970852"> </a>
         len = ExgReceive(exgSocketP,&amp;dataP[dataLen], size-dataLen,&amp;err);<a name="970853"> </a>
         if (len &amp;&amp; !err) {<a name="970854"> </a>
            dataLen+=len;<a name="970855"> </a>
            // resize block when we reach the limit of this one...<a name="970856"> </a>
            if (dataLen &gt;= size) {<a name="970857"> </a>
               MemHandleUnlock(dataH);<a name="970858"> </a>
               err = MemHandleResize(dataH,size+ChunkSize);<a name="970859"> </a>
               dataP = MemHandleLock(dataH);<a name="970860"> </a>
               if (!err) size += ChunkSize;<a name="970861"> </a>
            }<a name="970862"> </a>
         }<a name="970863"> </a>
      }<a name="970864"> </a>
      while (len &amp;&amp; !err);<a name="970865"> </a>
 <a name="970866"> </a>
      MemHandleUnlock(dataH);<a name="970867"> </a>
      <a name="970868"> </a>
      ExgDisconnect(exgSocketP,err); // closes transfer dialog<a name="970869"> </a>
      <a name="970870"> </a>
      if (!err) {<a name="970871"> </a>
         exgSocketP-&gt;goToCreator = beamerCreator;<a name="970872"> </a>
         exgSocketP-&gt;goToParams.matchCustom = (UInt32)dataH;<a name="970873"> </a>
      }<a name="970874"> </a>
   }<a name="970875"> </a>
   // release memory if an error occured<a name="970876"> </a>
   if (err) MemHandleFree(dataH);<a name="970877"> </a>
   return err;<a name="970878"> </a>
}<a name="970879"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HaHeadA">
  <a name="970881"> </a>Sending and Receiving Databases 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970883"> </a>It's common to want to send and receive an entire database using the Exchange Manager. For example, you might want to allow your application's users to share their versions of the PDB file associated with your application by beaming that file to each other. 
</p>
<p class="Body">
  <a name="970884"> </a>Sending and receiving a database involves the extra steps of flattening the database into a byte stream when sending and un-flattening it upon return. 
</p>

<h2 class="HBHeadB">
  <a name="970886"> </a>Sending a Database
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970887"> </a>To send a database, do the following: 
</p>
  <a name="970892"> </a><p class="N1NumList">1.	  Create and initialize an <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> data structure with information about which library to use and the data to be sent. See <a href="ExchangeManagerConcept.html#970152">"Initializing the Exchange Socket Structure"</a> for more information. </p>  <a name="970900"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1234399"><span style="font-family: monospace">ExgPut</span></a> to establish the connection with the exchange library. </p>  <a name="970905"> </a><p class="N1NumList">3.	  Call <a href="ExchangeManager.html#1233629"><span style="font-family: monospace">ExgDBWrite</span></a> and pass it a pointer to a callback function in your application that it can use to send the database. You make the call to <a href="ExchangeManager.html#1234730"><span style="font-family: monospace">ExgSend</span></a> in that function.</p>  <a name="970914"> </a><p class="N1NumList">4.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p><p class="Body">
  <a name="970915"> </a>The <span style="font-family: monospace">ExgDBWrite</span> function takes as parameters the local ID and card number of the database to be sent and a pointer to a callback function. You may also pass in the name of the database as it should appear in a file list and any application-specific data you want passed to the callback function. In this case, you would pass the pointer to the exchange socket structure as the application-specific data. If you need any other data, create a structure that contains the exchange socket and pass a pointer to that structure instead. 
</p>
<p class="Body">
  <a name="970916"> </a>The write callback function is called as many times as is necessary to send the data. It takes three arguments: a pointer to the data to be sent, the size of the data, and the application-specific data passed as the second argument to <span style="font-family: monospace">ExgDBWrite</span>. 
</p>
<p class="Body">
  <a name="970920"> </a><a href="ExchangeManagerConcept.html#970922">Listing 1.8</a> shows an example of how to send a database. The <span style="font-family: monospace">SendMe</span> function looks up the database creator ID and card number and passes it to the <span style="font-family: monospace">SendDatabase</span> function. The <span style="font-family: monospace">SendDatabase</span> function creates and initializes the exchange socket structure and then passes all that information along to the <span style="font-family: monospace">ExgDBWrite</span> function. The <span style="font-family: monospace">ExgDBWrite</span> function locates the database in the storage heap, translates it into a stream of bytes and passes that byte stream as the first argument to the write callback function <span style="font-family: monospace">WriteDBData</span>. <span style="font-family: monospace">WriteDBData</span> forwards the exchange socket and the data stream to the <span style="font-family: monospace">ExgSend</span> call, sets its size parameter to the number of bytes sent (the return value of <span style="font-family: monospace">ExgSend</span>), and returns any error returned by <span style="font-family: monospace">ExgSend</span>. 
</p>
<p class="CCodeCaption">
  <a name="970922"> </a>Listing 1.8  Sending a database
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
 <a name="970923"> </a>
// Callback for ExgDBWrite to send data with Exchange Manager <a name="970924"> </a>
Err WriteDBData(const void* dataP, ULong* sizeP, void* userDataP) <a name="970925"> </a>
{<a name="970926"> </a>
   Err err;<a name="970927"> </a>
 <a name="970928"> </a>
   *sizeP = ExgSend((ExgSocketPtr)userDataP, (void*)dataP, *sizeP, &amp;err);<a name="970929"> </a>
   return err;<a name="970930"> </a>
}<a name="970931"> </a>
 <a name="970932"> </a>
Err SendDatabase (Word cardNo, LocalID dbID, CharPtr nameP, <a name="970933"> </a>
CharPtr descriptionP) <a name="970934"> </a>
{<a name="970935"> </a>
   ExgSocketType exgSocket;<a name="970936"> </a>
   Err err;<a name="970937"> </a>
 <a name="970938"> </a>
   // Create exgSocket structure<a name="970939"> </a>
   MemSet(&amp;exgSocket, sizeof(exgSocket), 0);<a name="970940"> </a>
   exgSocket.description = descriptionP;<a name="970941"> </a>
   exgSocket.name = nameP;<a name="970942"> </a>
 <a name="970943"> </a>
   // Start an exchange put operation<a name="970944"> </a>
   err = ExgPut(&amp;exgSocket);<a name="970945"> </a>
   if (!err) {<a name="970946"> </a>
      err = ExgDBWrite(WriteDBData, &amp;exgSocket, NULL, dbID, cardNo);<a name="970947"> </a>
      err = ExgDisconnect(&amp;exgSocket, err);<a name="970948"> </a>
   }<a name="970949"> </a>
   return err;<a name="970950"> </a>
}<a name="970951"> </a>
 <a name="970952"> </a>
// Sends this application<a name="970953"> </a>
Err SendMe(void)<a name="970954"> </a>
{<a name="970955"> </a>
   Err err;<a name="970956"> </a>
 <a name="970957"> </a>
   // Find our app using its internal name<a name="970958"> </a>
   LocalID dbID = DmFindDatabase(0, "Beamer");<a name="970959"> </a>
 <a name="970960"> </a>
   if (dbID)<a name="970961"> </a>
      err = SendDatabase(0, dbID, "Beamer.prc", "Beamer application");<a name="970962"> </a>
   else<a name="970963"> </a>
      err = DmGetLastErr();<a name="970964"> </a>
   return err;<a name="970965"> </a>
}<a name="970966"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="970967"> </a>Note that there is nothing about <span style="font-family: monospace">ExgDBWrite</span> that is tied to the Exchange Manager, so it may be used to send a database using other transport mechanisms as well. For example, if you wanted to transfer a database from your Palm Powered handheld to your desktop PC using the serial port, you could use <span style="font-family: monospace">ExgDBWrite</span> to do so. 
</p>

<h2 class="HBHeadB">
  <a name="970968"> </a>Receiving a Database
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970969"> </a>The Launcher application receives databases with the <span style="font-family: monospace">.prc</span> or <span style="font-family: monospace">.pdb</span> file extension. If you want your application to be launched when the database is received, you can use a different extension and handle receiving the database within your application. For example, a book reader application might want to be launched when the user is beamed a book. In this case, the book reader application might use an extension such as <span style="font-family: monospace">.bk</span> for the book databases. 
</p>
<p class="Body">
  <a name="970970"> </a>You receive a database by responding to the same launch codes that you do for receiving any other data object (see <a href="ExchangeManagerConcept.html#970628">"Receiving Data"</a>); however, your response to the <a href="AppLaunchCodes.html#970682"><span style="font-family: monospace">sysAppLaunchCmdExgReceiveData</span></a> launch code is a little different: 
</p>
  <a name="970981"> </a><p class="N1NumList">1.	  Call <a href="ExchangeManager.html#1233284"><span style="font-family: monospace">ExgAccept</span></a> to accept the connection.</p>  <a name="970986"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1233561"><span style="font-family: monospace">ExgDBRead</span></a> and pass it a pointer to a callback function in your application that it can use to read the database. You make the call to <a href="ExchangeManager.html#1234473"><span style="font-family: monospace">ExgReceive</span></a> in that function.</p>  <a name="970995"> </a><p class="N1NumList">3.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p><p class="Body">
  <a name="970996"> </a>The <span style="font-family: monospace">ExgDBRead</span> function takes as parameters two pointers to callback functions. The first callback function is a function that is called multiple times to read the data. The second function is used if the database to be received already exists on the device. 
</p>

<h2 class="HaHeadA">
  <a name="970998"> </a>Requesting Data 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="970999"> </a>On Palm OS 4.0 and higher, some exchange libraries allow you to request data from a remote device through a call to <a href="ExchangeManager.html#1233876"><span style="font-family: monospace">ExgGet</span></a>. You can use <a href="ExchangeManager.html#1233876"><span style="font-family: monospace">ExgGet</span></a> to implement two-way communications between two Palm<sup>&#8482;</sup> devices. 
</p>
<p class="Body">
  <a name="971008"> </a>This section describes how to use the Exchange Manager to request data. It covers: 
</p>

  <a name="971012"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#971026">Sending a Get Request for a Single Object</a></p>

  <a name="971016"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#971056">Responding to a Get Request</a></p>

  <a name="971020"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#971077">Two-Way Communications</a></p>

  <a name="971024"> </a><p class="B1Bullet"> &#8226; <a href="ExchangeManagerConcept.html#971097">Requesting a URL</a></p>

<h2 class="HBHeadB">
  <a name="971026"> </a>Sending a Get Request for a Single Object
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="971027"> </a>To request data from a remote device, do the following: 
</p>
  <a name="971028"> </a><p class="N1NumList">1.	  Create and initialize an exchange socket structure (<a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a>) as described in <a href="ExchangeManagerConcept.html#970152">"Initializing the Exchange Socket Structure"</a>section. The data structure should identify the exchange library and the type of data that your application wants to receive. </p>  <a name="971040"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1233876"><span style="font-family: monospace">ExgGet</span></a> to establish the connection and request the data. </p><p class="Indented1"> <a name="971041"> </a>In response, the exchange library establishes a connection with the remote device, and upon return has data that your application should receive. If the remote device is a Palm Powered handheld, the exchange library obtains this data from an application on the remote side using the process described in the <a href="ExchangeManagerConcept.html#971056">"Responding to a Get Request"</a> section. </p>
  <a name="971049"> </a><p class="N1NumList">3.	  Call <a href="ExchangeManager.html#1234473"><span style="font-family: monospace">ExgReceive</span></a> one or more times to receive the data.</p>  <a name="971054"> </a><p class="N1NumList">4.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> to end the connection. </p>
<h2 class="HBHeadB">
  <a name="971056"> </a>Responding to a Get Request 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="971057"> </a>When the Exchange Manager on the remote device receives the get request, it launches the appropriate application with the launch code <a href="AppLaunchCodes.html#970581"><span style="font-family: monospace">sysAppLaunchCmdExgGetData</span></a>. 
</p>
<p class="Body">
  <a name="971063"> </a>Your response to the <span style="font-family: monospace">sysAppLaunchCmdExgGetData</span> launch code should be to send the requested data: 
</p>
  <a name="971067"> </a><p class="N1NumList">1.	  Call <a href="ExchangeManager.html#1234730"><span style="font-family: monospace">ExgSend</span></a> one or more times. </p>  <a name="971071"> </a><p class="N1NumList">2.	  Call <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> when finished. </p><p class="Body">
  <a name="971075"> </a>See the <a href="ExchangeManagerConcept.html#970493">"Sending a Single Object"</a> section for more information. 
</p>

<h2 class="HBHeadB">
  <a name="971077"> </a>Two-Way Communications
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="971085"> </a>You can use <a href="ExchangeManager.html#1233876"><span style="font-family: monospace">ExgGet</span></a> and <a href="ExchangeManager.html#1234399"><span style="font-family: monospace">ExgPut</span></a> in combination with the <a href="ExchangeManager.html#1233358"><span style="font-family: monospace">ExgConnect</span></a> call to have your application perform two-way communication. For example, you may want to implement two-way communication in a multiuser game. 
</p>
<p class="Body">
  <a name="971090"> </a>In such a situation, one device acts as a client and the other acts as a server. The client calls <span style="font-family: monospace">ExgConnect</span>, which tells the exchange library that a connection is established to perform multiple operations, such as the sending of multiple objects. The client then calls <span style="font-family: monospace">ExgGet</span> or <span style="font-family: monospace">ExgPut</span> repeatedly and calls <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> when finished. On the server device, the appropriate application is launched for each of these requests. The server also calls <span style="font-family: monospace">ExgDisconnect</span> when it is done sending or receiving each object. The swapping of client and server roles is not supported. 
</p>
<p class="Body">
  <a name="971095"> </a>Remember that not all exchange libraries support <span style="font-family: monospace">ExgConnect</span> and <span style="font-family: monospace">ExgGet</span>. If either one of these returns an error, your application should assume that this feature is not available. 
</p>

<h2 class="HBHeadB">
  <a name="971097"> </a>Requesting a URL 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="971103"> </a>In addition to requesting data with an <a href="ExchangeManager.html#1233876"><span style="font-family: monospace">ExgGet</span></a> call, you can request a URL with a <a href="ExchangeManager.html#1234667"><span style="font-family: monospace">ExgRequest</span></a> call on Palm OS 4.0 and higher. The idea behind the <span style="font-family: monospace">ExgRequest</span> call is to follow the model of pull technology. You could, for example, implement a web browser if you had an exchange library that supported the HTTP protocol. You could then send an <span style="font-family: monospace">ExgRequest</span> call with an exchange socket containing a URL such as <span style="font-family: monospace">http://www.palmos.com</span> and receive the web page in response. 
</p>
<p class="Body">
  <a name="971108"> </a>The fundamental differences between <span style="font-family: monospace">ExgRequest</span> and <span style="font-family: monospace">ExgGet</span> are: 
</p>

  <a name="971109"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">ExgRequest</span> does not automatically send the data back to the application that requested it. With <span style="font-family: monospace">ExgRequest</span>, when the exchange library receives the requested data, it has the Exchange Manager send it to the default application for that data type. </p>

  <a name="971110"> </a><p class="B1Bullet"> &#8226; Applications can register for URLs sent using <span style="font-family: monospace">ExgRequest</span>. <span style="font-family: monospace">ExgRequest</span> first looks for an exchange library that handles the URL scheme. If it cannot find one, it looks for an application instead. If it finds an application, it launches it with the <a href="AppLaunchCodes.html#970856"><span style="font-family: monospace">sysAppLaunchCmdGoToURL</span></a> launch code. </p>
<p class="Indented1"> <a name="971115"> </a>For example, the iMessenger application distributed with the Palm OS SDK registers for the <span style="font-family: monospace">mailto</span> URL scheme. If another application wants to implement an e-mail command, it could do so by calling <span style="font-family: monospace">ExgRequest</span> and passing an exchange socket with a URL that begins with <span style="font-family: monospace">mailto</span>. In response to this command, the Exchange Manager launches the iMessenger application, allowing the user to compose the email. </p>

<h2 class="HaHeadA">
  <a name="971117"> </a>Sending and Receiving Locally 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="971119"> </a>Most of this chapter has described how to use the Exchange Manager to send data to a remote device and receive data from a remote device. 
</p>
<p class="Body">
  <a name="971120"> </a>You may also use the Exchange Manager to exchange data with other applications on the local device. To do so, use the Local Exchange Library. You might want to do so in the following circumstances: 
</p>

  <a name="971121"> </a><p class="B1Bullet"> &#8226; You might have an application that creates some sort of event in the Datebook application. Your users might have an application that they use in place of the built-in Datebook. To ensure that the appointment is sent to the user's chosen application, you can send that data as a vCalendar object using the Local Exchange Manager. This way, whichever application is the default in the Exchange Manager registry is the one that receives your vCalendar. </p>

  <a name="971122"> </a><p class="B1Bullet"> &#8226; You could use the preview feature of the Exchange Manager to have another application display data for you. As described in the <a href="ExchangeManagerConcept.html#970723">"Displaying a Preview"</a> section, an application can be launched with the <a href="AppLaunchCodes.html#970614"><span style="font-family: monospace">sysAppLaunchCmdExgPreview</span></a> launch code to display a preview of the data it is registered to receive. You could use this feature in your own application to display data your application does not recognize. Suppose your application has a GIF and wants to display it in a dialog. It could use the Local Exchange Library to send that GIF to a graphics application on the local device, which in response draws the preview into the bounds of a rectangle you provide. </p>

  <a name="971129"> </a><p class="B1Bullet"> &#8226; Your application receives compound data objects, such as e-mail messages that contain attachments intended for other applications. As described in the <a href="ExchangeManagerConcept.html#970453">"Registering to Receive Unwrapped Data"</a> section, exchange libraries can "unwrap" a compound object and deliver the objects it contains directly; however, doing so is the exception the rule. </p>
<p class="Indented1"> <a name="971133"> </a>It's much more common for the e-mail message to be sent to the e-mail application and have the attachments delivered to the appropriate applications only when the user requests it. In response to a user request, the e-mail application extracts the attached object and uses the Local Exchange Library to send it to the application that should receive it. </p>

  <a name="971134"> </a><p class="B1Bullet"> &#8226; Your application exchanges data with a remote device, and you want to debug the code that interacts with the Exchange Manager. In this case, using the Local Exchange Library causes your application to send data in loopback mode, where it is also the recipient of the data. </p>
<p class="Body">
  <a name="971135"> </a>To use the Local Exchange Library, do the following: 
</p>
  <a name="971140"> </a><p class="N1NumList">1.	  Use a URL in the <span style="font-family: monospace">name</span> field of the <a href="ExchangeManager.html#1232995"><span style="font-family: monospace">ExgSocketType</span></a> structure to identify the Local Exchange Library. Begin the URL with the constant string <span style="font-family: monospace">exgLocalPrefix</span>. </p><p class="Indented1"> <a name="971141"> </a>The Exchange Manager only supports URLs on Palm OS 4.0 and higher. On Palm OS 3.X devices, set the <span style="font-family: monospace">localMode</span> flag to 1 to interact with the Local Exchange Library instead of the IR Library. </p>
  <a name="971142"> </a><p class="N1NumList">2.	  If you want to suppress the exchange dialog or if you want to perform a preview operation, create and initialize an <a href="ExchangeManager.html#1232839"><span style="font-family: monospace">ExgLocalSocketInfoType</span></a> structure and assign it to the socket's <span style="font-family: monospace">socketRef</span> field. </p><pre  class="Preformatted">
typedef struct {<a name="971147"> </a>
  Boolean freeOnDisconnect;<a name="971148"> </a>
  Boolean noAsk;<a name="971149"> </a>
  ExgPreviewInfoType *previewInfoP;<a name="971150"> </a>
  ExgLocalOpType op;<a name="971151"> </a>
  FileHand tempFileH;<a name="971152"> </a>
} ExgLocalSocketInfoType;<a name="971153"> </a>
</pre>
<p class="Indented1"> <a name="971154"> </a>where the following are parameters you might want to set:</p>

<h5 class="TgTable">
  <a name="971172"> </a>

<table width="450" border="0" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr valign="top">
    <td><a name="971157"> </a><div class="CellBody"><span style="font-family: monospace">freeOnDisconnect </span></div></td>
    <td><a name="971159"> </a><div class="CellBody">Whether the structure is freed when the <span style="font-family: monospace">ExgDisconnect</span> call is made. The default is <span style="font-family: monospace">true</span>. In general, code that allocates a structure should be responsible for freeing that structure. Therefore, if you have allocated <span style="font-family: monospace">ExgLocalSocketInfoType</span>, you should set this field to <span style="font-family: monospace">false</span> and explicitly free the structure when you are finished with it. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="971161"> </a><div class="CellBody"><span style="font-family: monospace">noAsk </span></div></td>
    <td><a name="971163"> </a><div class="CellBody">Set to <span style="font-family: monospace">true</span> to disable the display of the exchange dialog. If you want to, for example, create a vCalendar object and send it to the datebook application in response to a user command, you probably want to set <span style="font-family: monospace">noAsk</span> to <span style="font-family: monospace">true</span> so that the user does not have to confirm the receipt of the data they just requested you to send. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="971165"> </a><div class="CellBody"><span style="font-family: monospace">previewInfoP </span></div></td>
    <td><a name="971171"> </a><div class="CellBody">A pointer to an <a href="ExchangeManager.html#1232903"><span style="font-family: monospace">ExgPreviewInfoType</span></a> structure, used to display a preview of the data. If you wanted to simply use another application to help display data, you would create and initialize this structure. </div></td>
  </tr>
</table>




</h5><p class="Indented1"> <a name="971173"> </a>All other fields are set by the Local Exchange Library. If you don't create this structure, the library does it for you; therefore, you only need to create this structure if you want to supply non-default values for the <span style="font-family: monospace">noAsk</span> or <span style="font-family: monospace">previewInfoP</span> fields. </p>
  <a name="971174"> </a><p class="N1NumList">3.	  You can suppress the display of the progress dialogs that the exchange libraries typically display by setting the <span style="font-family: monospace">noStatus</span> field of the <span style="font-family: monospace">ExgSocketType</span> structure to <span style="font-family: monospace">true</span>. </p>  <a name="971177"> </a><p class="N1NumList">4.	  Send and receive data in the normal manner. See <a href="ExchangeManagerConcept.html#970478">"Sending Data"</a> and <a href="ExchangeManagerConcept.html#970628">"Receiving Data"</a> for details. </p>
<h2 class="HaHeadA">
  <a name="971183"> </a>Interacting with the Launcher 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="971185"> </a>On Palm OS 4.0 and higher, when you beam an application from the Launcher, other databases can be automatically beamed with it. If the application has an associated overlay database, the overlay is beamed along with the application. You do not have to perform any extra work to allow this to happen. 
</p>
<p class="Body">
  <a name="971187"> </a>Overlay database support begins in Palm OS 3.5; however, if you beam an application from the Palm OS 3.5 Launcher application, it does not beam the overlay. 
</p>
<p class="Body">
  <a name="971188"> </a>In addition to beaming overlays, you can set up a record database so that the Launcher beams it along with the application database and the overlay. For example, a dictionary application might have its dictionary data in an associated database. When a user beams the dictionary application to another user, the dictionary data should be beamed along with the application itself. To allow this to happen, you set the bit <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">dmHdrAttrBundle</span> in the database's attributes, as shown here: 
</p>
<pre  class="Preformatted">
DmDatabaseInfo(cardNo, dbID, NULL, &amp;attributes, <a name="971190"> </a>
  NULL, NULL, NULL, NULL, NULL, NULL, NULL, <a name="971191"> </a>
  NULL, NULL);<a name="971192"> </a>
attributes |= dmHdrAttrBundle;<a name="971193"> </a>
DmSetDatabaseInfo(cardNo, dbID, NULL, <a name="971194"> </a>
  &amp;attributes, NULL, NULL, NULL, NULL, NULL, <a name="971195"> </a>
  NULL, NULL, NULL, NULL);<a name="971196"> </a>
</pre>
<p class="Body">
  <a name="971197"> </a>If you beam an application plus databases to a device running Palm OS 4.0 or higher, the user sees a single confirmation message. If you beam the application to a device running Palm OS 3.X, the device receives only the application database and displays an alert saying that it cannot receive the other databases. 
</p>

<h2 class="HaHeadA">
  <a name="971198"> </a>Summary of Exchange Manager 
<a href="#969979"><img src="images/top.gif" border="0"></a></h2>


<h5 class="TgTable">
  <a name="971350"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th colspan="2" rowspan="1"><a name="971201"> </a><div class="CellHeading">Exchange Manager Functions</div></th>
  </tr>
  <tr valign="top">
    <td><a name="971205"> </a><div class="CellHeading">Sending Data </div></td>
    <td><a name="971207"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971212"> </a><div class="CellBody"><a href="ExchangeManager.html#1234730"><span style="font-family: monospace">ExgSend</span></a></div><a name="971216"> </a><div class="CellBody"><a href="ExchangeManager.html#1234399"><span style="font-family: monospace">ExgPut</span></a></div></td>
    <td><a name="971221"> </a><div class="CellBody"><a href="ExchangeManager.html#1233629"><span style="font-family: monospace">ExgDBWrite</span></a><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971223"> </a><div class="CellHeading">Receiving Data </div></td>
    <td><a name="971225"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971230"> </a><div class="CellBody"><a href="ExchangeManager.html#1234473"><span style="font-family: monospace">ExgReceive</span></a></div><a name="971234"> </a><div class="CellBody"><a href="ExchangeManager.html#1233284"><span style="font-family: monospace">ExgAccept</span></a></div></td>
    <td><a name="971239"> </a><div class="CellBody"><a href="ExchangeManager.html#1233561"><span style="font-family: monospace">ExgDBRead</span></a></div><a name="971240"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971242"> </a><div class="CellHeading">Registering for Data </div></td>
    <td><a name="971244"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971249"> </a><div class="CellBody"><a href="ExchangeManager.html#1234538"><span style="font-family: monospace">ExgRegisterDatatype</span></a></div><a name="971253"> </a><div class="CellBody"><a href="ExchangeManager.html#1234775"><span style="font-family: monospace">ExgSetDefaultApplication</span></a></div></td>
    <td><a name="971258"> </a><div class="CellBody"><a href="ExchangeManager.html#1234639"><span style="font-family: monospace">ExgRegisterData</span></a></div><a name="971259"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971261"> </a><div class="CellHeading">Requesting Data </div></td>
    <td><a name="971263"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971268"> </a><div class="CellBody"><a href="ExchangeManager.html#1233876"><span style="font-family: monospace">ExgGet</span></a></div></td>
    <td><a name="971273"> </a><div class="CellBody"><a href="ExchangeManager.html#1234667"><span style="font-family: monospace">ExgRequest</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971275"> </a><div class="CellHeading">Connecting and Disconnecting </div></td>
    <td><a name="971277"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971282"> </a><div class="CellBody"><a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a></div></td>
    <td><a name="971287"> </a><div class="CellBody"><a href="ExchangeManager.html#1233358"><span style="font-family: monospace">ExgConnect</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971289"> </a><div class="CellHeading">Displaying the Exchange Dialog</div></td>
    <td><a name="971291"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971296"> </a><div class="CellBody"><a href="ExchangeManager.html#1233779"><span style="font-family: monospace">ExgDoDialog</span></a></div></td>
    <td><a name="971298"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971300"> </a><div class="CellHeading">Obtaining Registry Information</div></td>
    <td><a name="971302"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971307"> </a><div class="CellBody"><a href="ExchangeManager.html#1234097"><span style="font-family: monospace">ExgGetTargetApplication</span></a></div><a name="971311"> </a><div class="CellBody"><a href="ExchangeManager.html#1234003"><span style="font-family: monospace">ExgGetRegisteredApplications</span></a></div></td>
    <td><a name="971316"> </a><div class="CellBody"><a href="ExchangeManager.html#1234054"><span style="font-family: monospace">ExgGetRegisteredTypes</span></a></div><a name="971320"> </a><div class="CellBody"><a href="ExchangeManager.html#1233946"><span style="font-family: monospace">ExgGetDefaultApplication</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971322"> </a><div class="CellHeading">Querying the Exchange Library</div></td>
    <td><a name="971324"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971329"> </a><div class="CellBody"><a href="ExchangeManager.html#1233463"><span style="font-family: monospace">ExgControl</span></a></div></td>
    <td><a name="971331"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971333"> </a><div class="CellHeading">For Exchange Library Use Only</div></td>
    <td><a name="971335"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="971340"> </a><div class="CellBody"><a href="ExchangeManager.html#1234294"><span style="font-family: monospace">ExgNotifyReceive</span></a></div><a name="971344"> </a><div class="CellBody"><a href="ExchangeManager.html#1234222"><span style="font-family: monospace">ExgNotifyPreview</span></a></div></td>
    <td><a name="971349"> </a><div class="CellBody"><a href="ExchangeManager.html#1234166"><span style="font-family: monospace">ExgNotifyGoto</span></a><br></div></td>
  </tr>
</table>




</h5>
&nbsp;<br>
				<!-- CONTENT_END -->

		</td>
		<td width="5">&nbsp;&nbsp;</td>
	</tr>
      </table>
    </td>
			</tr>
  <tr>
				<td>
					<table border="0" cellpadding="0" cellspacing="0" width="760">
        <!-- CONTENTCELL_END -->
        <tr valign="top"> 
          <td width="10">&nbsp;<!-- FOOTER_START --></td>
          <td width="72">&nbsp;</td>
          <td width="25" bgcolor="white" background="images/bkgrnd.gif">&nbsp;</td>
          <td width="600"> 
            <table border="0" cellpadding="0" cellspacing="0" width="600">
              <tr> 
                <td><img src="images/rule_10-1-5_ltblue.gif" width="600" height="16" border="0"></td>
              </tr>
              <tr> 
                <td> 
                  <p align="center" class="footer"> ©2002 PalmSource, Inc. and its affiliates.  All rights reserved. 
<a href="http://www.palmos.com/dev/training/">Training</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/">Palm&nbsp;OS&nbsp;Platform</a>&nbsp;|&nbsp;<a href="Companion2Front.html" target="_blank">Legal Notices</a>&nbsp;<br>
												<!-- FOOTER_END --><br>
											</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
				</td>
			</tr>
</table>
</BODY>
</HTML>