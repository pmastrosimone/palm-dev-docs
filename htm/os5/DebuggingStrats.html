<HTML>

<HEAD>
<SMALLSCREENIGNORE> 
<LINK HREF="copy_of_palmos.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="document.css" REL="StyleSheet" TYPE="text/css" media="screen">
<!-- SCRIPT_START -->
<!-- SCRIPT_END -->
</SMALLSCREENIGNORE>
<TITLE>Debugging Strategies</TITLE>

<META NAME="PALMTEMPLATE" CONTENT="1006-002 Palm HTML 20020513">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="TEMPLATEBASE" CONTENT="Palm HTML 20010625">
<META NAME="LASTUPDATED" CONTENT="12/13/02 10:05:59">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1">

</HEAD>

<BODY LEFTMARGIN="0" MARGINWIDTH="0" TOPMARGIN="0" MARGINHEIGHT="0">
<SMALLSCREENIGNORE> 
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td><a name="1023402"></a>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr height="35"> 
          <td height="35" colspan="2" bgcolor="#6699CC">&nbsp;</td>
        </tr>
        <tr valign="top"> 
          <td width="160" align="left"><a href="http://www.palmos.com"><img src="images/bigorb.gif" width="160" height="110" border="0"></a></td>
          <td align="left" width="100%"> 
            </SMALLSCREENIGNORE>
            <!-- CONTENTCELL_START -->
            <img border="0" height="45" src="images/orb_bkgrnd_600.gif" width="600"><br>
            <!--PAGENAV_START-->
            <SPAN CLASS="subnav">&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span><BR>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             <h2 class="HeadDocPage">12  Debugging Strategies</h2>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             &nbsp;<span class="subnav"><a href="CompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Localization.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="StandardIOApp.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CompanionIX.html">Index</a></span>  
            <!--PAGENAV_END-->
          </td>
        </tr>
      </table>
    </td>
			</tr>
  <tr>
				<td> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
							<td>&nbsp;&nbsp;&nbsp;</td>
						</tr>
        <tr>
		<td valign="top" width="10">&nbsp;&nbsp;&nbsp;</td>
		<td valign="top" width="175">
			<p class="SideTitle">Title - <br><a href="Companion_Front.html">Palm OS® Programmer's Companion</a></p>
			<p class="SideTOC1-PartTab">Volume I </p>
			<p class="SideTOC1"><a href="DebuggingStrats.html">12  Debugging Strategies</a></p>
			
<p class="SideTOC2">
<a href="#1023430">Displaying Development Errors
</a></p>

<p class="SideTOC2">
<a href="#1023467">Using the Error Manager Macros
</a></p>

<p class="SideTOC2">
<a href="#1023494">The Try-and-Catch Mechanism
</a></p>

<p class="SideTOC3">
<a href="#1023504">Using the Try and Catch Mechanism
</a></p>

<p class="SideTOC2">
<a href="#1023559">Summary of Debugging API
</a></p>

		</td>

		<td width="5">&nbsp;&nbsp;</td>
		<td width="1" bgcolor="#6699cc">&nbsp;</td>
		<td width="5">&nbsp;&nbsp;</td>
		<td> 

				<!-- CONTENT_START -->

<p class="Body">
  <a name="1023405"> </a>You can use a Palm OS<sup>®</sup> system manager called the error manager to display unexpected runtime errors such as those that typically show up during program development. Final versions of applications or system software won't use the error manager. 
</p>
<p class="Body">
  <a name="1023406"> </a>The error manager API consists of a set of functions for displaying an alert with an error message, file name, and the line number where the error occurred. If a debugger is connected, it is entered when the error occurs.
</p>
<p class="Body">
  <a name="1023407"> </a>The error manager also provides a "try and catch" mechanism that applications can use for handling such runtime errors as out of memory conditions, user input errors, etc. 
</p>
<p class="Body">
  <a name="1023408"> </a>This section helps you understand and use the error manager, discussing the following topics:
</p>

  <a name="1023412"> </a><p class="B1Bullet"> &#8226; <a href="DebuggingStrats.html#1023430">Displaying Development Errors</a></p>

  <a name="1023416"> </a><p class="B1Bullet"> &#8226; <a href="DebuggingStrats.html#1023467">Using the Error Manager Macros</a></p>

  <a name="1023420"> </a><p class="B1Bullet"> &#8226; <a href="DebuggingStrats.html#1023494">The Try-and-Catch Mechanism</a></p>

  <a name="1023424"> </a><p class="B1Bullet"> &#8226; <a href="DebuggingStrats.html#1023559">Summary of Debugging API</a></p>
<p class="Body">
  <a name="1023425"> </a>This chapter only describes programmatic debugging strategies; to learn how to use the available tools to debug your application, see the book <i>Palm OS Programming Development Tools Guide</i>. 
</p>

<h2 class="HaHeadA">
  <a name="1023430"> </a>Displaying Development Errors 
<a href="#1023402"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1023431"> </a>The error manager provides some compiler macros that can be used in source code. These macros display a fatal alert dialog on the screen and provide buttons to reset the handheld or enter the debugger after the error is displayed. There are three macros: <a href="ErrorManager.html#1103582"><span style="font-family: monospace">ErrDisplay</span></a>, <a href="ErrorManager.html#1103684"><span style="font-family: monospace">ErrFatalDisplayIf</span></a>, and <a href="ErrorManager.html#1103711"><span style="font-family: monospace">ErrNonFatalDisplayIf</span></a>. 
</p>

  <a name="1023442"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">ErrDisplay</span> always displays the error message on the screen.</p>

  <a name="1023444"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">ErrFatalDisplayIf</span> and <span style="font-family: monospace">ErrNonFatalDisplayIf</span> display the error message only if their first argument is <span style="font-family: monospace">TRUE.</span></p>
<p class="Body">
  <a name="1023446"> </a>The error manager uses the compiler define <span style="font-family: monospace">ERROR_CHECK_LEVEL</span> to control the level of error messages displayed. You can set the value of the compiler define to control which level of error checking and display is compiled into the application. Three levels of error checking are supported: none, partial, and full.
</p>

<h5 class="TgTable">
  <a name="1023464"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1023449"> </a><div class="CellHeading">If you set ERR_CHECK_LEVEL to...</div></th>
    <th><a name="1023451"> </a><div class="CellHeading">The compiler...</div></th>
  </tr>
  <tr valign="top">
    <td><a name="1023453"> </a><div class="CellBody"><span style="font-family: monospace">ERROR_CHECK_NONE (0)</span></div></td>
    <td><a name="1023455"> </a><div class="CellBody">Doesn't compile in any error calls.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1023457"> </a><div class="CellBody"><span style="font-family: monospace">ERROR_CHECK_PARTIAL</span> <span style="font-family: monospace">(1)</span></div></td>
    <td><a name="1023459"> </a><div class="CellBody">Compiles in only <span style="font-family: monospace">ErrDisplay</span> and <span style="font-family: monospace">ErrFatalDisplayIf</span> calls.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="1023461"> </a><div class="CellBody"><span style="font-family: monospace">ERROR_CHECK_FULL</span> <span style="font-family: monospace">(2)</span></div></td>
    <td><a name="1023463"> </a><div class="CellBody">Compiles in all three calls.</div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1023465"> </a>During development, it makes sense to set full error checking for early development, partial error checking during alpha and beta test periods, and no error checking for the final product. At partial error checking, only fatal errors are displayed; error conditions that are only possible are ignored under the assumption that the application developer is already aware of the condition and designed the software to operate that way. 
</p>

<h2 class="HaHeadA">
  <a name="1023467"> </a>Using the Error Manager Macros 
<a href="#1023402"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1023468"> </a>Calls to the error manager to display errors are actually compiler macros that are conditionally compiled into your program. Most of the calls take a boolean parameter, which should be set to <span style="font-family: monospace">true</span> to display the error, and a pointer to a text message to display if the condition is true. 
</p>
<p class="Body">
  <a name="1023469"> </a>Typically, the boolean parameter is an in-line expression that evaluates to <span style="font-family: monospace">true</span> if there is an error condition. As a result, both the expression that evaluates the error condition and the message text are left out of the compiled code when error checking is turned off. You can call <a href="ErrorManager.html#1103684"><span style="font-family: monospace">ErrFatalDisplayIf</span></a>, or <a href="ErrorManager.html#1103582"><span style="font-family: monospace">ErrDisplay</span></a>, but using <span style="font-family: monospace">ErrFatalDisplayIf</span> makes your source code look neater. 
</p>
<p class="Body">
  <a name="1023476"> </a>For example, assume your source code looks like this:
</p>
<pre  class="Preformatted">
result = DoSomething();<a name="1023477"> </a>
ErrFatalDisplayIf (result &lt; 0, 
  "unexpected result from DoSomething");<a name="1023479"> </a>
</pre>
<p class="Body">
  <a name="1023480"> </a>With error checking turned on, this code displays an error alert dialog if the result from <span style="font-family: monospace">DoSomething()</span> is less than 0. Besides the error message itself, this alert also shows the file name and line number of the source code that called the error manager. With error checking turned off, both the expression evaluation <span style="font-family: monospace">err &lt; 0</span> and the error message text are left out of the compiled code. 
</p>
<p class="Body">
  <a name="1023481"> </a>The same net result can be achieved by the following code:
</p>
<pre  class="Preformatted">
result = DoSomething();<a name="1023482"> </a>
#if ERROR_CHECK_LEVEL != ERROR_CHECK_NONE<a name="1023484"> </a>
if (result &lt; 0) <a name="1023485"> </a>
  ErrDisplay ("unexpected result from
DoSomething");<a name="1023487"> </a>
#endif<a name="1023488"> </a>
</pre>
<p class="Body">
  <a name="1023489"> </a>However, this solution is longer and requires more work than simply calling <a href="ErrorManager.html#1103684"><span style="font-family: monospace">ErrFatalDisplayIf</span></a>. It also makes the source code harder to follow.
</p>

<h2 class="HaHeadA">
  <a name="1023494"> </a>The Try-and-Catch Mechanism 
<a href="#1023402"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1023496"> </a>The error manager is aware of the machine state of the Palm Powered<sup>&#8482;</sup> handheld and can therefore correctly save and restore this state. The built-in try and catch of the compiler can't be used because it's machine dependent.
</p>
<p class="Body">
  <a name="1023497"> </a>Try and catch is basically a neater way of implementing a <span style="font-family: monospace">goto</span> if an error occurs. A typical way of handling errors in the middle of a routine is to go to the end of the routine as soon as an error occurs and have some general-purpose cleanup code at the end of every routine. Errors in nested routines are even trickier because the result code from every subroutine call must be checked before continuing. 
</p>
<p class="Body">
  <a name="1023498"> </a>When you set up a try/catch, you are providing the compiler with a place to jump to when an error occurs. You can go to that error handling routine at any time by calling <a href="ErrorManager.html#1103736"><span style="font-family: monospace">ErrThrow</span></a>. When the compiler sees the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrThrow</span> call, it performs a <span style="font-family: monospace">goto</span> to your error handling code. The greatest advantage to calling <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrThrow</span>, however, is for handling errors in nested subroutine calls. 
</p>
<p class="Body">
  <a name="1023503"> </a>Even if <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrThrow</span><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>is called from a nested subroutine, execution immediately goes to the same error handling code in the higher-level call. The compiler and runtime environment automatically strip off the stack frames that were pushed onto the stack during the nesting process and go to the error handling section of the higher-level call. You no longer have to check for result codes after calling every subroutine; this greatly simplifies your source code and reduces its size. 
</p>

<h2 class="HBHeadB">
  <a name="1023504"> </a>Using the Try and Catch Mechanism
<a href="#1023402"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="1023506"> </a>The following example illustrates the possible layout for a typical routine using the error manager's try and catch mechanism.
</p>
<p class="CCodeCaption">
  <a name="1023507"> </a>Listing 12.1  Try and Catch Mechanism Example
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
      ErrTry {<a name="1023508"> </a>
        p = MemPtrNew(1000);<a name="1023509"> </a>
        if (!p) ErrThrow(errNoMemory);<a name="1023510"> </a>
        MemSet(p, 1000, 0);<a name="1023511"> </a>
        CreateTable(p);<a name="1023512"> </a>
        PrintTable(p);<a name="1023513"> </a>
        }<a name="1023514"> </a>
 <a name="1023515"> </a>
      ErrCatch(err) {<a name="1023516"> </a>
        // Recover or clean<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>up after<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>a failure in the <a name="1023517"> </a>
        // above Try block."err" is an int <a name="1023518"> </a>
        // identifying the reason for the failure.<a name="1023519"> </a>
        <a name="1023520"> </a>
        // You may call ErrThrow() if you want to <a name="1023521"> </a>
        // jump out to the next Catch block.<a name="1023522"> </a>
        <a name="1023523"> </a>
        // The code in this Catch block doesn't <a name="1023524"> </a>
        // execute if the above Try block completes<a name="1023525"> </a>
        // without a Throw.<a name="1023526"> </a>
        <a name="1023527"> </a>
        if (err == errNoMemory)<a name="1023528"> </a>
           ErrDisplay("Out of Memory");<a name="1023529"> </a>
        else<a name="1023530"> </a>
           ErrDisplay("Some other error");<a name="1023531"> </a>
        } ErrEndCatch<a name="1023532"> </a>
        // You must structure your code exactly as <a name="1023533"> </a>
        // above. You can't have an ErrTry without an <a name="1023534"> </a>
        //ErrCatch { } ErrEndCatch, or vice versa.<a name="1023535"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="1023542"> </a>Any call to <a href="ErrorManager.html#1103736"><span style="font-family: monospace">ErrThrow</span></a> within the <a href="ErrorManager.html#1103767"><span style="font-family: monospace">ErrTry</span></a> block results in control passing immediately to the <a href="ErrorManager.html#1103545"><span style="font-family: monospace">ErrCatch</span></a> block. Even if the subroutine <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">CreateTable</span> called <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrThrow</span>, control would pass directly to the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrCatch</span> block. If the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrTry</span> block completes without calling <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrThrow</span>, the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrCatch</span> block is not executed.
</p>
<p class="Body">
  <a name="1023546"> </a>You can nest multiple <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrTry</span> blocks. For example, if you wanted to perform some cleanup at the end of <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">CreateTable</span> in case of error, 
</p>

  <a name="1023547"> </a><p class="B1Bullet"> &#8226; Put <span style="font-family: monospace">ErrTry</span>/<span style="font-family: monospace">ErrCatch</span> blocks in <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">CreateTable</span> </p>

  <a name="1023548"> </a><p class="B1Bullet"> &#8226; Clean up in the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrCatch</span> block first</p>

  <a name="1023552"> </a><p class="B1Bullet"> &#8226; Call <a href="ErrorManager.html#1103736"><span style="font-family: monospace">ErrThrow</span></a> to jump to the top-level <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ErrCatch</span></p>

<h2 class="HaHeadA">
  <a name="1023559"> </a>Summary of Debugging API 
<a href="#1023402"><img src="images/top.gif" border="0"></a></h2>


<h5 class="TgTable">
  <a name="1023611"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="1023562"> </a><div class="CellHeading">Error Manager Functions</div></th>
    <th><a name="1023564"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td><a name="1023566"> </a><div class="CellHeading">Displaying Errors</div></td>
    <td><a name="1023568"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1023573"> </a><div class="CellBody"><a href="ErrorManager.html#1103455">ErrAlert</a><br><a href="ErrorManager.html#1103605">ErrDisplayFileLineMsg</a><br><a href="ErrorManager.html#1103711">ErrNonFatalDisplayIf</a></div></td>
    <td><a name="1023584"> </a><div class="CellBody"><a href="ErrorManager.html#1103582">ErrDisplay</a><br><a href="ErrorManager.html#1103684">ErrFatalDisplayIf</a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1023589"> </a><div class="CellHeading">Catching Exceptions</div></td>
    <td><a name="1023591"> </a><div class="CellHeading"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="1023596"> </a><div class="CellBody"><a href="ErrorManager.html#1103545">ErrCatch</a><br><a href="ErrorManager.html#1103662">ErrExceptionList</a><br><a href="ErrorManager.html#1103767">ErrTry</a></div></td>
    <td><a name="1023607"> </a><div class="CellBody"><a href="ErrorManager.html#1103641">ErrEndCatch</a><br><a href="ErrorManager.html#1103736">ErrThrow</a></div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="1023613"> </a>
</p>
&nbsp;<br>
				<!-- CONTENT_END -->

		</td>
		<td width="5">&nbsp;&nbsp;</td>
	</tr>
      </table>
    </td>
			</tr>
  <tr>
				<td>
					<table border="0" cellpadding="0" cellspacing="0" width="760">
        <!-- CONTENTCELL_END -->
        <tr valign="top"> 
          <td width="10">&nbsp;<!-- FOOTER_START --></td>
          <td width="72">&nbsp;</td>
          <td width="25" bgcolor="white" background="images/bkgrnd.gif">&nbsp;</td>
          <td width="600"> 
            <table border="0" cellpadding="0" cellspacing="0" width="600">
              <tr> 
                <td><img src="images/rule_10-1-5_ltblue.gif" width="600" height="16" border="0"></td>
              </tr>
              <tr> 
                <td> 
                  <p align="center" class="footer"> ©2002 PalmSource, Inc. and its affiliates.  All rights reserved. 
<a href="http://www.palmos.com/dev/training/">Training</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/">Palm&nbsp;OS&nbsp;Platform</a>&nbsp;|&nbsp;<a href="Companion_Front.html" target="_blank">Legal Notices</a>&nbsp;<br>
												<!-- FOOTER_END --><br>
											</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
				</td>
			</tr>
</table>
</BODY>
</HTML>