<HTML>

<HEAD>
<SMALLSCREENIGNORE> 
<LINK HREF="copy_of_palmos.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="document.css" REL="StyleSheet" TYPE="text/css" media="screen">
<!-- SCRIPT_START -->
<!-- SCRIPT_END -->
</SMALLSCREENIGNORE>
<TITLE>Bluetooth</TITLE>

<META NAME="PALMTEMPLATE" CONTENT="1006-002 Palm HTML 20020513">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="TEMPLATEBASE" CONTENT="Palm HTML 20010625">
<META NAME="LASTUPDATED" CONTENT="12/13/02 10:04:19">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1">

</HEAD>

<BODY LEFTMARGIN="0" MARGINWIDTH="0" TOPMARGIN="0" MARGINHEIGHT="0">
<SMALLSCREENIGNORE> 
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td><a name="948688"></a>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr height="35"> 
          <td height="35" colspan="2" bgcolor="#6699CC">&nbsp;</td>
        </tr>
        <tr valign="top"> 
          <td width="160" align="left"><a href="http://www.palmos.com"><img src="images/bigorb.gif" width="160" height="110" border="0"></a></td>
          <td align="left" width="100%"> 
            </SMALLSCREENIGNORE>
            <!-- CONTENTCELL_START -->
            <img border="0" height="45" src="images/orb_bkgrnd_600.gif" width="600"><br>
            <!--PAGENAV_START-->
            <SPAN CLASS="subnav">&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span><BR>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             <h2 class="HeadDocPage">6  Bluetooth</h2>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             &nbsp;<span class="subnav"><a href="Companion2TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SerialCommunication.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="NetworkCommunication.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Companion2IX.html">Index</a></span>  
            <!--PAGENAV_END-->
          </td>
        </tr>
      </table>
    </td>
			</tr>
  <tr>
				<td> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
							<td>&nbsp;&nbsp;&nbsp;</td>
						</tr>
        <tr>
		<td valign="top" width="10">&nbsp;&nbsp;&nbsp;</td>
		<td valign="top" width="175">
			<p class="SideTitle">Title - <br><a href="Companion2Front.html">Palm OS® Programmer's Companion</a></p>
			<p class="SideTOC1-PartTab">Volume II Communications </p>
			<p class="SideTOC1"><a href="BTCompanion.html">6  Bluetooth</a></p>
			
<p class="SideTOC2">
<a href="#939315">Palm OS Bluetooth System
</a></p>

<p class="SideTOC3">
<a href="#947304">Bluetooth System Components
</a></p>

<p class="SideTOC3">
<a href="#942694">Implementation Overview
</a></p>

<p class="SideTOC3">
<a href="#939349">Profiles
</a></p>

<p class="SideTOC3">
<a href="#942067">Usage Scenarios
</a></p>

<p class="SideTOC3">
<a href="#939463">Authentication and Encryption
</a></p>

<p class="SideTOC3">
<a href="#939490">Device Discovery
</a></p>

<p class="SideTOC3">
<a href="#939500">Piconet Support
</a></p>

<p class="SideTOC3">
<a href="#944811">Radio Power Management
</a></p>

<p class="SideTOC2">
<a href="#948373">Developing Bluetooth-Enabled Applications
</a></p>

<p class="SideTOC3">
<a href="#948382">Overview of the Bluetooth Library
</a></p>

<p class="SideTOC3">
<a href="#948387">Management
</a></p>

<p class="SideTOC3">
<a href="#948512">Sockets
</a></p>

<p class="SideTOC2">
<a href="#939516">Bluetooth Virtual Serial Driver
</a></p>

<p class="SideTOC3">
<a href="#949700">Opening the Serial Port
</a></p>

<p class="SideTOC3">
<a href="#939577">Palm-to-Palm Communication
</a></p>

<p class="SideTOC3">
<a href="#947099">How Palm OS Uses the Bluetooth Virtual Serial Driver
</a></p>

<p class="SideTOC2">
<a href="#939604">Bluetooth Exchange Library Support
</a></p>

<p class="SideTOC3">
<a href="#944527">Detecting the Bluetooth Exchange Library
</a></p>

<p class="SideTOC3">
<a href="#944831">Using the Exchange Manager With Bluetooth
</a></p>

<p class="SideTOC3">
<a href="#945304">ExgGet and ExgRequest
</a></p>

		</td>

		<td width="5">&nbsp;&nbsp;</td>
		<td width="1" bgcolor="#6699cc">&nbsp;</td>
		<td width="5">&nbsp;&nbsp;</td>
		<td> 

				<!-- CONTENT_START -->

<p class="Body">
  <a name="939283"> </a>The Bluetooth APIs provide developers a way to access the Palm OS Bluetooth system and write Bluetooth-enabled applications. In addition to enabling Bluetooth development, the Palm OS Bluetooth system also provides:
</p>

  <a name="939310"> </a><p class="B1Bullet"> &#8226; a user interface for device discovery and connection</p>

  <a name="939311"> </a><p class="B1Bullet"> &#8226; a user interface for passkey entry</p>

  <a name="939312"> </a><p class="B1Bullet"> &#8226; a modified Palm Connection Panel to support Bluetooth</p>

  <a name="939313"> </a><p class="B1Bullet"> &#8226; serial port emulation using the Bluetooth Virtual Serial Driver</p>

  <a name="949324"> </a><p class="B1Bullet"> &#8226; object exchange support using the Bluetooth Exchange Library</p>
<p class="Body">
  <a name="945331"> </a>This documentation covers how to use the Palm OS Bluetooth APIs but does not provide the basic understanding of Bluetooth concepts and protocols that you need to write Bluetooth code. For more information about Bluetooth, refer to the <i>Specification of the Bluetooth System</i>, available at the Bluetooth Special Interest Group website at <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">www.bluetooth.com</span>. There are also several third-party books that you may wish to consult for helpful Bluetooth information.
</p>

<h2 class="HaHeadA">
  <a name="939315"> </a>Palm OS Bluetooth System 
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="947311"> </a>The Palm OS Bluetooth system enables a Palm Powered handheld to:
</p>

  <a name="948194"> </a><p class="B1Bullet"> &#8226; access the internet through LAN access points and cell phones</p>

  <a name="948198"> </a><p class="B1Bullet"> &#8226; exchange objects such as business cards and appointments over Bluetooth</p>

  <a name="948206"> </a><p class="B1Bullet"> &#8226; perform HotSync operations over Bluetooth</p>

  <a name="948217"> </a><p class="B1Bullet"> &#8226; communicate with other handhelds for multi-user applications like games and various collaborative applications</p>

  <a name="947312"> </a><p class="B1Bullet"> &#8226; send SMS messages and manage your phone's internal phone book.</p>
<p class="Body">
  <a name="948263"> </a>The Palm OS Bluetooth system designers focused their efforts on the user, recognizing that on the Palm OS technical interoperability is simply not enough. The user cares about the overall experience. The user's "Bluetooth learning curve" should be short. And, as always, simplicity is key.
</p>

<h2 class="HBHeadB">
  <a name="947304"> </a>Bluetooth System Components
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="946635"> </a>The Palm OS Bluetooth system contains the following components:
</p>

  <a name="948046"> </a><p class="B1Bullet"> &#8226; <a href="BTCompanion.html#946680">Bluetooth Library</a></p>

  <a name="948062"> </a><p class="B1Bullet"> &#8226; <a href="BTCompanion.html#945758">Bluetooth Virtual Serial Driver</a></p>

  <a name="948074"> </a><p class="B1Bullet"> &#8226; <a href="BTCompanion.html#945764">Bluetooth Exchange Library</a></p>

  <a name="948086"> </a><p class="B1Bullet"> &#8226; <a href="BTCompanion.html#946478">Bluetooth Stack</a></p>

  <a name="948098"> </a><p class="B1Bullet"> &#8226; <a href="BTCompanion.html#946481">Bluetooth Transports</a></p>

  <a name="948110"> </a><p class="B1Bullet"> &#8226; <a href="BTCompanion.html#945770">Bluetooth Extension</a></p>
<p class="Body">
  <a name="948041"> </a><a href="BTCompanion.html#946674">Figure 6.1</a> shows these components and their relationship with each other.
</p>

<p class="FFigureCaption">
  <a name="946674"> </a>Figure 6.1	 Overall Palm OS Bluetooth architecture
</p>
<p class="FgFigure">
  <a name="950751"> </a><div align="left"><img src="images/BTCompaniona.gif" height="454" width="360" border="0" hspace="20" vspace="0">
</div>
</p>

<h4 class="HCHeadC">
  <a name="946680"> </a>Bluetooth Library
</h4>
<p class="Body">
  <a name="945737"> </a>The Bluetooth Library is a shared library that provides an API for developers to develop Bluetooth applications. The API provides functions in the following areas:
</p>

  <a name="945738"> </a><p class="B1Bullet"> &#8226; Managing remote devices, piconets, and ACL links</p>

  <a name="945739"> </a><p class="B1Bullet"> &#8226; Communicating using the L2CAP and RFCOMM protocols</p>

  <a name="945740"> </a><p class="B1Bullet"> &#8226; Advertising services and querying for remote services using SDP</p>

  <a name="945741"> </a><p class="B1Bullet"> &#8226; Maintaining a list of trusted devices</p>

<h4 class="HCHeadC">
  <a name="945758"> </a>Bluetooth Virtual Serial Driver
</h4>
<p class="Body">
  <a name="945759"> </a>The Bluetooth Virtual Serial Driver allows applications to use the Palm OS New Serial Manager with Bluetooth's RFCOMM protocol as the serial link. As shown in <a href="BTCompanion.html#946674">Figure 6.1</a>, the Bluetooth Serial Driver communicates with the rest of the Bluetooth system through the Bluetooth Library. The Bluetooth Virtual Serial Driver is used by PPP, HotSync, and Telephony.
</p>

<h4 class="HCHeadC">
  <a name="945764"> </a>Bluetooth Exchange Library
</h4>
<p class="Body">
  <a name="945765"> </a>The Bluetooth Exchange Library allows applications to use the Palm OS Exchange Manager with Bluetooth as the link. As shown in <a href="BTCompanion.html#946674">Figure 6.1</a>, the Bluetooth Exchange Library communicates with the rest of the Bluetooth system through the Bluetooth Library. RFCOMM is used as the sole transport mechanism for the Exchange Manager.
</p>

<h4 class="HCHeadC">
  <a name="946478"> </a>Bluetooth Stack
</h4>
<p class="Body">
  <a name="946479"> </a>The Bluetooth Stack is a shared library that implements the various protocols of the Bluetooth specification. Palm OS developers don't need to access the Bluetooth Stack directly.
</p>

<h4 class="HCHeadC">
  <a name="946481"> </a>Bluetooth Transports
</h4>
<p class="Body">
  <a name="946482"> </a>Bluetooth Transports are shared libraries that act as device drivers for different radios. Palm OS developers cannot access the Bluetooth Transports.
</p>

<h4 class="HCHeadC">
  <a name="945770"> </a>Bluetooth Extension
</h4>
<p class="Body">
  <a name="945771"> </a>The Bluetooth extension oversees and coordinates the multiple libraries of the Bluetooth system. Palm OS developers cannot access the Bluetooth extension.
</p>

<h2 class="HBHeadB">
  <a name="942694"> </a>Implementation Overview
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="942695"> </a>The Bluetooth system is a collection of PRCs that can reside in either RAM or ROM. A minimum of 4Mb of RAM is required (256k heap). Incorporation into actual devices is up to the handheld manufacturers.
</p>
<p class="Body">
  <a name="942696"> </a>The Bluetooth system runs in the UI thread, except when it is used by the virtual serial driver.
</p>

<h2 class="HBHeadB">
  <a name="939349"> </a>Profiles
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939450"> </a><a href="BTCompanion.html#939355">Table 6.1</a> lists the profiles supported by the Palm OS Bluetooth system.
</p>

<h5 class="TgTable">
  <a name="939352"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="939355"> </a><div class="TableTitle">Table 6.1  Supported Bluetooth profiles </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="939359"> </a><div class="CellHeading">Profile</div></th>
    <th><a name="939361"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr valign="top">
    <td><a name="939363"> </a><div class="CellBody">Generic Access</div></td>
    <td><a name="939365"> </a><div class="CellBody">Describes the use of the lower layers of the Bluetooth protocol stack (LC and LMP), security-related alternatives, and the higher layers: L2CAP, RFCOMM, and OBEX.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="939367"> </a><div class="CellBody">Service Discovery Application</div></td>
    <td><a name="939369"> </a><div class="CellBody">Defines the protocols and procedures used by a service discovery application on a device to locate services in other Bluetooth-enabled devices using the Service Discovery Protocol (SDP).</div></td>
  </tr>
  <tr valign="top">
    <td><a name="939371"> </a><div class="CellBody">Serial Port</div></td>
    <td><a name="939373"> </a><div class="CellBody">Defines the protocols and procedures used by devices using Bluetooth for RS-232 (or similar) serial cable emulation. The scenario covered by this profile deals with legacy applications using Bluetooth as a cable replacement through a virtual serial port abstraction (which in itself is operating system-dependent).</div></td>
  </tr>
  <tr valign="top">
    <td><a name="939375"> </a><div class="CellBody">Dial-up Networking</div></td>
    <td><a name="939377"> </a><div class="CellBody">Defines the protocols and procedures used by devices implementing the "Internet Bridge" usage model. This profile covers the usage of a cellular phone or modem both to receive data calls and to connect to a dial-up Internet access server or other dial-up service.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="939379"> </a><div class="CellBody">LAN Access Point</div></td>
    <td><a name="939381"> </a><div class="CellBody">Defines LAN access using PPP over RFCOMM.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="939383"> </a><div class="CellBody">Generic Object Exchange</div></td>
    <td><a name="939385"> </a><div class="CellBody">Defines the protocols and procedures used by the applications providing the usage models that need object exchange capabilities. </div></td>
  </tr>
  <tr valign="top">
    <td><a name="939387"> </a><div class="CellBody">Object Push</div></td>
    <td><a name="939389"> </a><div class="CellBody">Defines the requirements for the protocols and procedures used by applications providing the object push usage model. This profile makes use of the generic object exchange profile to define the interoperability requirements for the protocols needed by applications.</div></td>
  </tr>
</table>




</h5><p class="Body">
  <a name="939455"> </a>The following profiles are <b>not</b> supported by the Palm OS Bluetooth system:
</p>

  <a name="939457"> </a><p class="B1Bullet"> &#8226; Cordless Telephony</p>

  <a name="939458"> </a><p class="B1Bullet"> &#8226; Intercom</p>

  <a name="939459"> </a><p class="B1Bullet"> &#8226; Headset</p>

  <a name="939460"> </a><p class="B1Bullet"> &#8226; Fax</p>

  <a name="939461"> </a><p class="B1Bullet"> &#8226; File Transfer</p>

  <a name="939462"> </a><p class="B1Bullet"> &#8226; Synchronization</p>
<p class="Body">
  <a name="939467"> </a>Note that although the Bluetooth system does not support the Bluetooth Synchronization profile, it implements HotSync operations over Bluetooth using the Serial Port profile. Also note that network HotSync operations use PPP.
</p>
<p class="Body">
  <a name="939581"> </a>The Bluetooth system can dial and control voice calls on a Bluetooth-enabled phone as if it were connected through a serial cable. It does this using AT modem commands and not the Cordless Telephony profile.
</p>

<h2 class="HBHeadB">
  <a name="942067"> </a>Usage Scenarios
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="942068"> </a>Bluetooth-enabled Palm Powered handhelds are able to communicate with a variety of remote Bluetooth devices. The Bluetooth system uses the profiles defined by the Bluetooth specification in order to support the following usage scenarios:
</p>

<h5 class="TgTable">
  <a name="942329"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="942074"> </a><div class="TableTitle">Table 6.2  Profiles required by various usage scenarios </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="942090"> </a><div class="CellHeading"><br></div></th>
    <th><a name="942092"> </a><div class="CellHeading"><br></div></th>
    <th colspan="7" rowspan="1"><a name="942094"> </a><div class="CellHeading">Required Profiles</div></th>
  </tr>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="942106"> </a><div class="CellHeading">Feature</div></th>
    <th><a name="942108"> </a><div class="CellHeading">Handheld Connects With</div></th>
    <th><a name="942110"> </a><div class="CellHeading">Generic Access</div></th>
    <th><a name="942112"> </a><div class="CellHeading">Service Discovery</div></th>
    <th><a name="942114"> </a><div class="CellHeading">Serial Port</div></th>
    <th><a name="942116"> </a><div class="CellHeading">Dial-up Networking</div></th>
    <th><a name="942118"> </a><div class="CellHeading">LAN Access</div></th>
    <th><a name="942120"> </a><div class="CellHeading">Generic Obj. Exchange</div></th>
    <th><a name="949378"> </a><div class="CellHeading">Object Push</div></th>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="3"><a name="942122"> </a><div class="CellBody">Email and Web Clipping</div></td>
    <td><a name="942124"> </a><div class="CellBody">Cell phone</div></td>
    <td><a name="942126"> </a><div class="CellBody">X</div></td>
    <td><a name="942128"> </a><div class="CellBody">X</div></td>
    <td><a name="942130"> </a><div class="CellBody">X</div></td>
    <td><a name="942132"> </a><div class="CellBody">X</div></td>
    <td><a name="942134"> </a><div class="CellBody"><br></div></td>
    <td><a name="942136"> </a><div class="CellBody"><br></div></td>
    <td><a name="949380"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="942140"> </a><div class="CellBody">Access point</div></td>
    <td><a name="942142"> </a><div class="CellBody">X</div></td>
    <td><a name="942144"> </a><div class="CellBody">X</div></td>
    <td><a name="942146"> </a><div class="CellBody">X</div></td>
    <td><a name="942148"> </a><div class="CellBody"><br></div></td>
    <td><a name="942150"> </a><div class="CellBody">X</div></td>
    <td><a name="942152"> </a><div class="CellBody"><br></div></td>
    <td><a name="949382"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="942156"> </a><div class="CellBody">Desktop computer</div></td>
    <td><a name="942158"> </a><div class="CellBody">X</div></td>
    <td><a name="942160"> </a><div class="CellBody">X</div></td>
    <td><a name="942162"> </a><div class="CellBody">X</div></td>
    <td><a name="942164"> </a><div class="CellBody"><br></div></td>
    <td><a name="942166"> </a><div class="CellBody">X</div></td>
    <td><a name="942168"> </a><div class="CellBody"><br></div></td>
    <td><a name="949384"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="3"><a name="949615"> </a><div class="CellBody">HotSync</div></td>
    <td><a name="949617"> </a><div class="CellBody">Cell phone</div></td>
    <td><a name="949619"> </a><div class="CellBody">X</div></td>
    <td><a name="949621"> </a><div class="CellBody">X</div></td>
    <td><a name="949623"> </a><div class="CellBody">X</div></td>
    <td><a name="949625"> </a><div class="CellBody">X</div></td>
    <td><a name="949627"> </a><div class="CellBody"><br></div></td>
    <td><a name="949629"> </a><div class="CellBody"><br></div></td>
    <td><a name="949631"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="949635"> </a><div class="CellBody">Access point</div></td>
    <td><a name="949637"> </a><div class="CellBody">X</div></td>
    <td><a name="949639"> </a><div class="CellBody">X</div></td>
    <td><a name="949641"> </a><div class="CellBody">X</div></td>
    <td><a name="949643"> </a><div class="CellBody"><br></div></td>
    <td><a name="949645"> </a><div class="CellBody">X</div></td>
    <td><a name="949647"> </a><div class="CellBody"><br></div></td>
    <td><a name="949649"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="949653"> </a><div class="CellBody">Desktop computer</div></td>
    <td><a name="949655"> </a><div class="CellBody">X</div></td>
    <td><a name="949657"> </a><div class="CellBody">X</div></td>
    <td><a name="949659"> </a><div class="CellBody">X</div></td>
    <td><a name="949661"> </a><div class="CellBody"><br></div></td>
    <td><a name="949663"> </a><div class="CellBody"><br></div></td>
    <td><a name="949665"> </a><div class="CellBody"><br></div></td>
    <td><a name="949667"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="942234"> </a><div class="CellBody">SMS and Mobile Handset Management</div></td>
    <td><a name="942236"> </a><div class="CellBody">Cell phone</div></td>
    <td><a name="942238"> </a><div class="CellBody">X</div></td>
    <td><a name="942240"> </a><div class="CellBody">X</div></td>
    <td><a name="942242"> </a><div class="CellBody">X</div></td>
    <td><a name="942244"> </a><div class="CellBody"><br></div></td>
    <td><a name="942246"> </a><div class="CellBody"><br></div></td>
    <td><a name="942248"> </a><div class="CellBody"><br></div></td>
    <td><a name="949388"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="942250"> </a><div class="CellBody">Beaming</div></td>
    <td><a name="942252"> </a><div class="CellBody">Many devices</div></td>
    <td><a name="942254"> </a><div class="CellBody">X</div></td>
    <td><a name="942256"> </a><div class="CellBody">X</div></td>
    <td><a name="942258"> </a><div class="CellBody">X</div></td>
    <td><a name="942260"> </a><div class="CellBody"><br></div></td>
    <td><a name="942262"> </a><div class="CellBody"><br></div></td>
    <td><a name="942264"> </a><div class="CellBody">X</div></td>
    <td><a name="949390"> </a><div class="CellBody">X</div></td>
  </tr>
</table>




</h5>
<h2 class="HBHeadB">
  <a name="939463"> </a>Authentication and Encryption
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939479"> </a>The Bluetooth system handles the generation, utilization, and storage of authentication and encryption keys at the OS level.
</p>
<p class="Body">
  <a name="939484"> </a>The Bluetooth system doesn't support Authorization. Access concerns beyond authentication are left up to the individual application, as in a standard networking environment.
</p>
<p class="Body">
  <a name="939489"> </a>The Bluetooth system supports security modes 1 and 2: the "non-secure" and "service-level enforced security" modes. Security mode 3-"link-level enforced security"-isn't supported by the Bluetooth system.
</p>

<h2 class="HBHeadB">
  <a name="939490"> </a>Device Discovery
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939492"> </a>In a system of Bluetooth devices, ad-hoc networks are established between the devices. The "inquiry" procedure is used to discover Bluetooth devices within range. The specification defines two inquiry modes, "General" and "Limited." The General mode, which is supported by the Bluetooth system, is used by devices that need to discover devices that are made discoverable continuously or for no specific condition. Limited mode, on the other hand, is used to devices that need to discover devices that are made discoverable for only a limited period of time, during temporary conditions, or for a specific event. The Bluetooth system doesn't support the Limited inquiry mode.
</p>

<h2 class="HBHeadB">
  <a name="939500"> </a>Piconet Support
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939503"> </a>There are two main scenarios in which a piconet can be created, and the Bluetooth system supports both:
</p>

  <a name="939504"> </a><p class="B1Bullet"> &#8226; Master performs inquiry, sees a number of devices, and proceeds to contact each of them. A variant is that the master later performs inquiry to find additional slaves. This should be useful for a game server where the master establishes the connection to each Palm device that wants to participate in a game.</p>

  <a name="939505"> </a><p class="B1Bullet"> &#8226; Master sits in page scan mode, and when a device connects to it, a master/slave switch is performed. The LAN access profile uses this approach for multi-point LAN access devices. The Bluetooth system handles the master/slave negotiation automatically.</p>
<p class="Body">
  <a name="939494"> </a>The Bluetooth system places existing connections in hold mode while new links are established. In the first scenario outlined above, hold times for each connection are determined based upon a list of the devices that the user has selected to participate in the piconet. The Bluetooth system performs the following for each device on the list:
</p>
  <a name="939512"> </a><p class="N1NumList">1.	  Establish an ACL connection to the device.</p>  <a name="939513"> </a><p class="N1NumList">2.	  Place the device in hold mode for a period of time that is a function of the total number of devices that are to participate in the piconet.</p>  <a name="939514"> </a><p class="N1NumList">3.	  Delay for a set period of time to allow the slave to enter hold mode.</p><p class="Body">
  <a name="939515"> </a>After all connections have been established, each of the slave hold timers should expire, and the piconet should be operational.
</p>

<h2 class="HBHeadB">
  <a name="944811"> </a>Radio Power Management
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="944812"> </a>The extended battery life of Palm Powered handhelds is considered to be a key competitive advantage by many Palm Powered handheld manufacturers. The Bluetooth system helps preserve battery life by taking advantage of the Bluetooth power efficiency modes (hold, park, and sniff) and the internal power management functionality built into the Bluetooth radio chipset.
</p>
<p class="Body">
  <a name="944813"> </a>Applications don't explicitly put the radio into the sniff, park, or standby modes. Instead, power management is under the control of the Bluetooth system. When participating in a piconet, the Bluetooth system honors requests from the other members of the piconet to enter any of the defined power-saving modes.
</p>

<h2 class="HaHeadA">
  <a name="948373"> </a>Developing Bluetooth-Enabled Applications 
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="948374"> </a>The Palm OS exposes Bluetooth through multiple interfaces, allowing you to choose the interface that is best suited for the task at hand. Bluetooth development is supported through the Serial Manager using the Virtual Serial Driver, which is discussed in <a href="BTCompanion.html#939516">"Bluetooth Virtual Serial Driver."</a> Object transfer is supported through the Exchange Manager using the Bluetooth Exchange Library, which is discussed in <a href="BTCompanion.html#939604">"Bluetooth Exchange Library Support."</a> Finally, you can program directly with the Bluetooth Library APIs, which is the subject of this section.
</p>
<p class="Body">
  <a name="948891"> </a>Regardless of which approach you take, your applications should check if the Bluetooth system is running on the handheld before using any Bluetooth APIs. To do so, use the following code:
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
	UInt32 btVersion;<a name="948892"> </a>
<a name="948893"> </a>
	// Make sure Bluetooth components are installed<a name="948894"> </a>
	// This check also ensures Palm OS 4.0 or greater<a name="948895"> </a>
	if (FtrGet(btLibFeatureCreator, btLibFeatureVersion,<a name="948896"> </a>
		&amp;btVersion) != errNone)<a name="948897"> </a>
	{<a name="948898"> </a>
		// Alert the user if it's the active application<a name="948899"> </a>
		if ((launchFlags &amp; sysAppLaunchFlagNewGlobals) &amp;&amp;<a name="948900"> </a>
			(launchFlags &amp; sysAppLaunchFlagUIApp))<a name="948901"> </a>
			FrmAlert (MissingBtComponentsAlert);<a name="948902"> </a>
		return sysErrRomIncompatible;<a name="948903"> </a>
	}<a name="948904"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="948382"> </a>Overview of the Bluetooth Library
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="948383"> </a>From a programmer's perspective, the functions of the Bluetooth library fall into four areas: management, sockets, security, and utility.
</p>

  <a name="948384"> </a><p class="B1Bullet"> &#8226; The management functions deal with the radio and baseband parts of the Bluetooth specification. You use them to find nearby devices and establish ACL links.</p>

  <a name="948385"> </a><p class="B1Bullet"> &#8226; The socket functions enable communication with L2CAP, RFCOMM, and SDP.</p>

  <a name="948386"> </a><p class="B1Bullet"> &#8226; The security functions manage a set of trusted devices-devices that do not have to authenticate when they create a secure connection with the handheld.</p>

  <a name="949125"> </a><p class="B1Bullet"> &#8226; The utility functions perform useful data conversions.</p>

<h2 class="HBHeadB">
  <a name="948387"> </a>Management
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="948388"> </a>Three basic management tasks common among Bluetooth applications are finding the Bluetooth devices in range, establishing ACL links, and working with piconets. However, in order for your code to use any of the functions that do these operations, you need to create a management callback function.
</p>

<h4 class="HCHeadC">
  <a name="948389"> </a>Management Callback Function
</h4>
<p class="Body">
  <a name="948390"> </a>Most management calls are asynchronous. In other words, they start an operation and return before the operation actually completes. When the operation completes, the Bluetooth Library notifies the application by way of a callback function. Such a notification is called a <i>management event</i>.
</p>
<p class="Body">
  <a name="949020"> </a>In some cases, a management function fails before starting the asynchronous operation. In this case, the callback function does not get called. You can tell whether the callback function will be called or not by looking at the management function's return code:
</p>
<h5 class="P1"><a name="949021"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibErrNoError</td><td valign="top"></span>The operation has completed and the callback function will not be called.</td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="949022"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibErrPending</td><td valign="top"></span>The operation has started successfully and the callback function will be called,</td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="949023"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top">any other error code</td><td valign="top">The operation failed and the callback function will not be called.</td>
  </tr>
</table>
</div></h5>
<p class="Body">
  <a name="948391"> </a>The management callback function has two parameters: a management event structure, which contains all the information about the event that has occurred, and a reference context, an optional <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UInt32</span> you can use to establish the context of the event. The callback function needs to provide the code that handles the events generated as a result of the operations you perform.
</p>
<p class="Body">
  <a name="949128"> </a>The callback function should not perform any heavyweight processing; doing so prevents the Bluetooth stack from running. You can defer processing by generating a custom system event in the callback function and responding to the event with your event handling code. For some operations, you must defer the processing. For example, the callback function cannot close the Bluetooth library in response to a <a href="BtLibRef_Mgt.html#1566398"><span style="font-family: monospace">btLibManagementEventAclDisconnect</span></a> event.
</p>
<p class="Body">
  <a name="950093"> </a>As a simple example, consider the task of finding nearby devices, discussed in the next section. The callback function must respond to four events: <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibManagementEventInquiryResult</span>, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibManagementEventInquiryComplete</span>, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibManagementEventInquiryCanceled</span>, and <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibManagementEventRadioState</span>. The following code is a skeleton of the callback function you need:
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
void MyManagementCallback (BtLibManagementEventType *eventP,<a name="948405"> </a>
	UInt32 refcon) {<a name="948406"> </a>
	switch (eventP-&gt;event) {<a name="948407"> </a>
		case btLibManagementEventInquiryResult :<a name="948408"> </a>
			// A device has been found. Save it in a list<a name="948409"> </a>
			break;<a name="948410"> </a>
		case btLibManagementEventInquiryComplete :<a name="948411"> </a>
			// The inquiry has finished<a name="948412"> </a>
			break;<a name="948413"> </a>
		case btLibManagementEventInquiryCanceled :<a name="948414"> </a>
			// The inquiry has been canceled<a name="948415"> </a>
			break;<a name="948416"> </a>
		case btLibManagementEventRadioState :<a name="949147"> </a>
			// The radio state has changed<a name="949149"> </a>
			break;<a name="949150"> </a>
		default :<a name="948417"> </a>
			// Unknown event<a name="948418"> </a>
			break;<a name="948419"> </a>
	}<a name="948420"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="948421"> </a>To tell the Bluetooth Library to use your callback function, call <a href="BtLibRef_Mgt.html#1593603"><span style="font-family: monospace">BtLibRegisterManagementNotification</span></a>. You should always unregister your callback before closing the Bluetooth Library.
</p>
<p class="Body">
  <a name="948427"> </a>For a list of management events, see <a href="BtLibRef_Mgt.html#1079511">"Management Callback Events"</a> in <a href="BtLibRef_Mgt.html#939281">Chapter 77, "Bluetooth Library: Management."</a>
</p>

<h4 class="HCHeadC">
  <a name="948432"> </a>Opening the Library
</h4>
<p class="Body">
  <a name="949206"> </a>To open the Bluetooth library, use the <a href="BtLibRef_Mgt.html#1871240"><span style="font-family: monospace">BtLibOpen</span></a> function. At this time, the Bluetooth library starts the radio initialization process. When initialization successfully finishes, the Bluetooth library generates a <a href="BtLibRef_Mgt.html#1588514"><span style="font-family: monospace">btLibManagementEventRadioState</span></a> event with a status of <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btLibErrRadioInitialized</span>. You must wait for the initialization to complete successfully before calling any Bluetooth library function involving the radio.
</p>
<p class="Body">
  <a name="949271"> </a>The exceptions to this rule are the discovery functions, <a href="BtLibRef_Mgt.html#943436"><span style="font-family: monospace">BtLibDiscoverMultipleDevices</span></a> and <a href="BtLibRef_Mgt.html#1134359"><span style="font-family: monospace">BtLibDiscoverSingleDevice</span></a>, which handle the radio initialization events automatically and can be called directly after the Bluetooth library is opened.
</p>

<h4 class="HCHeadC">
  <a name="949204"> </a>Finding Nearby Devices
</h4>
<p class="Body">
  <a name="948433"> </a>There are two ways to find Bluetooth devices that are within range:
</p>

  <a name="948437"> </a><p class="B1Bullet"> &#8226; Use the <a href="BtLibRef_Mgt.html#943436"><span style="font-family: monospace">BtLibDiscoverMultipleDevices</span></a> and <a href="BtLibRef_Mgt.html#1134359"><span style="font-family: monospace">BtLibDiscoverSingleDevice</span></a> functions to find nearby devices. These functions bring up a user interface that allows the user to choose one or more devices.</p>

  <a name="948444"> </a><p class="B1Bullet"> &#8226; Perform a device inquiry using <a href="BtLibRef_Mgt.html#1124100"><span style="font-family: monospace">BtLibStartInquiry</span></a>. This is more difficult to do than using one of the discovery functions, but provides more flexibility.</p>
<p class="Body">
  <a name="948448"> </a>When you call <a href="BtLibRef_Mgt.html#1124100"><span style="font-family: monospace">BtLibStartInquiry</span></a>, the Bluetooth Library searches for all devices in range. Whenever it finds a device, it generates a <a href="BtLibRef_Mgt.html#1571544"><span style="font-family: monospace">btLibManagementEventInquiryResult</span></a> event. When the inquiry has completed, a <a href="BtLibRef_Mgt.html#1575780"><span style="font-family: monospace">btLibManagementEventInquiryComplete</span></a> event is generated. To cancel the inquiry, call <a href="BtLibRef_Mgt.html#943215"><span style="font-family: monospace">BtLibCancelInquiry</span></a>. The <a href="BtLibRef_Mgt.html#1572443"><span style="font-family: monospace">btLibManagementEventInquiryCanceled</span></a> event is generated when the cancellation succeeds.
</p>

<h4 class="HCHeadC">
  <a name="948461"> </a>Creating ACL Links
</h4>
<p class="Body">
  <a name="948462"> </a>Once you have the device address of a remote device, you can attempt to create an ACL link to it using the <a href="BtLibRef_Mgt.html#946728"><span style="font-family: monospace">BtLibLinkConnect</span></a> function. This causes the <a href="BtLibRef_Mgt.html#1566219"><span style="font-family: monospace">btLibManagementEventAclConnectOutbound</span></a> event to be generated, and the status code within that event indicates whether or not the link was successfully established.
</p>
<p class="Body">
  <a name="948475"> </a>To disconnect a link, use the <a href="BtLibRef_Mgt.html#946862"><span style="font-family: monospace">BtLibLinkDisconnect</span></a> function. This causes the <a href="BtLibRef_Mgt.html#1566398"><span style="font-family: monospace">btLibManagementEventAclDisconnect</span></a> event to be generated. Note that the same event is generated when the remote device initiates the disconnection.
</p>
<p class="Body">
  <a name="948479"> </a>Your program must also respond to <a href="BtLibRef_Mgt.html#1566210"><span style="font-family: monospace">btLibManagementEventAclConnectInbound</span></a> events that indicate that a remote device has established a link with the handheld. You can disconnect an inbound link with the <a href="BtLibRef_Mgt.html#946862"><span style="font-family: monospace">BtLibLinkDisconnect</span></a> function.
</p>

<h4 class="HCHeadC">
  <a name="948486"> </a>Working With Piconets
</h4>
<p class="Body">
  <a name="948487"> </a>Bluetooth supports up to seven slaves in a piconet. The Bluetooth Library provides simplified APIs to create and destroy piconets.
</p>
<p class="Body">
  <a name="948488"> </a>Note that the Bluetooth 1.1 specification suggests that the upper software layers place slaves in hold or park mode while new connections are established. This isn't well-defined in the specification, and is difficult to do because of timing. The Bluetooth Library expects the radio baseband to handle piconet timing.
</p>
<p class="Body">
  <a name="948492"> </a>To create a piconet, the "master" calls <a href="BtLibRef_Mgt.html#1124054"><span style="font-family: monospace">BtLibPiconetCreate</span></a>. Slaves can then discover the master and join the piconet, or the master can discover and connect to the slaves. The master stops advertising once the limit of seven slaves has been reached. Note that any device should be capable of acting as a slave.
</p>
<p class="Body">
  <a name="948493"> </a>The piconet can be locked to prevent additional slaves from joining. The master can still discover and add slaves, however. With the piconet locked, there is a bandwidth improvement of approximately 10%.
</p>
<p class="Body">
  <a name="948494"> </a>In the Bluetooth Library, the following functions support the management of piconets:
</p>

  <a name="948498"> </a><p class="B1Bullet"> &#8226; <a href="BtLibRef_Mgt.html#1124054"><span style="font-family: monospace">BtLibPiconetCreate</span></a>: create a piconet or reconfigure an existing piconet so the local device is the master.</p>

  <a name="948502"> </a><p class="B1Bullet"> &#8226; <a href="BtLibRef_Mgt.html#1599288"><span style="font-family: monospace">BtLibPiconetDestroy</span></a>: destroy the piconet by disconnecting links to all devices and removing all restrictions on whether the local device is a master or a slave.</p>

  <a name="948506"> </a><p class="B1Bullet"> &#8226; <a href="BtLibRef_Mgt.html#1615152"><span style="font-family: monospace">BtLibPiconetLockInbound</span></a>: prevent remote devices from creating ACL links into the piconet.</p>

  <a name="948510"> </a><p class="B1Bullet"> &#8226; <a href="BtLibRef_Mgt.html#1609186"><span style="font-family: monospace">BtLibPiconetUnlockInbound</span></a>: allow additional slaves to create ACL links into the piconet.</p>
<p class="Body">
  <a name="948511"> </a>Remember the following limitations of piconets: Slave-to-slave communication is not permitted. The master cannot "broadcast" to slaves.
</p>

<h2 class="HBHeadB">
  <a name="948512"> </a>Sockets
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="948513"> </a>The Bluetooth Library uses the concept of sockets to manage communication between Bluetooth devices. A socket represents a bidirectional packet-based link to a remote device. Sockets run over ACL connections. The Bluetooth library can accommodate up to 16 simultaneous sockets.
</p>
<p class="Body">
  <a name="949788"> </a>Three types of sockets are supported by the Bluetooth Library. L2CAP and RFCOMM sockets establish data channels and send and receive arbitrary data over those channels. SDP sockets allow you to query remote devices about the services those devices provide.
</p>
<p class="Body">
  <a name="949837"> </a>To send a packet of data over an L2CAP or RFCOMM socket, use the <a href="BtLibRef_Sockets.html#948555"><span style="font-family: monospace">BtLibSocketSend</span></a> function. The send buffer must not change until the send completes. In other words, you must not modify the buffer, free the buffer, or use a local variable for the buffer. The Bluetooth Library notifies you when the send completes by generating a <a href="BtLibRef_Sockets.html#1621508"><span style="font-family: monospace">btLibSocketEventSendComplete</span></a> event. You can only have one outstanding packet on each socket.
</p>
<p class="Body">
  <a name="948528"> </a>The <a href="BtLibRef_Sockets.html#1619896"><span style="font-family: monospace">btLibSocketEventData</span></a> event indicates data has been received.
</p>

<h4 class="HCHeadC">
  <a name="948529"> </a>L2CAP
</h4>
<p class="Body">
  <a name="948530"> </a>L2CAP sockets don't allow for flow control.
</p>

<h5 class="HDHeadD">
  <a name="948531"> </a>Establishing Inbound L2CAP Connections
</h5>
<p class="Body">
  <a name="950110"> </a>To set up for inbound L2CAP connections, you call the following:
</p>
  <a name="950114"> </a><p class="N1NumList">1.	  <a href="BtLibRef_Sockets.html#1547240"><span style="font-family: monospace">BtLibSocketCreate</span></a>: create an L2CAP socket.</p>  <a name="950118"> </a><p class="N1NumList">2.	  <a href="BtLibRef_Sockets.html#948168"><span style="font-family: monospace">BtLibSocketListen</span></a>: set up an L2CAP socket as a listener.</p>  <a name="948544"> </a><p class="N1NumList">3.	  <a href="BtLibRef_Sockets.html#1517241"><span style="font-family: monospace">BtLibSdpServiceRecordCreate</span></a>: allocate a memory chunk that represents an SDP service record.</p>  <a name="948548"> </a><p class="N1NumList">4.	  <a href="BtLibRef_Sockets.html#949530"><span style="font-family: monospace">BtLibSdpServiceRecordSetAttributesForSocket</span></a>: initialize an SDP memory record so it can represent the newly-created L2CAP listener socket as a service</p>  <a name="948552"> </a><p class="N1NumList">5.	  <a href="BtLibRef_Sockets.html#1528085"><span style="font-family: monospace">BtLibSdpServiceRecordStartAdvertising</span></a>: make an SDP memory record representing a local SDP service record visible to remote devices.</p><p class="Body">
  <a name="948556"> </a>When you get a <a href="BtLibRef_Sockets.html#1060883"><span style="font-family: monospace">btLibSocketEventConnectRequest</span></a> event, you need to respond with a call to <a href="BtLibRef_Sockets.html#948423"><span style="font-family: monospace">BtLibSocketRespondToConnection</span></a>. You then receive a <a href="BtLibRef_Sockets.html#1618336"><span style="font-family: monospace">btLibSocketEventConnectedInbound</span></a> event with an inbound socket with which you can send and receive data.
</p>
<p class="Body">
  <a name="948563"> </a>The listening socket remains open and will notify you of further connection attempts. In other words, you can use a single L2CAP listening socket to spawn several inbound sockets. You cannot close the listening socket until after you close its inbound sockets.
</p>

<h5 class="HDHeadD">
  <a name="948564"> </a>Establishing Outbound L2CAP Connections
</h5>
<p class="Body">
  <a name="948565"> </a>To establish an outbound L2CAP connection, you first establish an ACL link to the remote device. Then you call:
</p>
  <a name="948569"> </a><p class="N1NumList">1.	  <a href="BtLibRef_Sockets.html#1547240"><span style="font-family: monospace">BtLibSocketCreate</span></a>: create an SDP socket.</p>  <a name="948573"> </a><p class="N1NumList">2.	  <a href="BtLibRef_Sockets.html#1652223"><span style="font-family: monospace">BtLibSdpGetPSMByUuid</span></a>: get an available L2CAP PSM using SDP.</p>  <a name="948577"> </a><p class="N1NumList">3.	  <a href="BtLibRef_Sockets.html#1101466"><span style="font-family: monospace">BtLibSocketClose</span></a>: close the SDP socket.</p>  <a name="948581"> </a><p class="N1NumList">4.	  <a href="BtLibRef_Sockets.html#1547240"><span style="font-family: monospace">BtLibSocketCreate</span></a>: create an L2CAP socket.</p>  <a name="948585"> </a><p class="N1NumList">5.	  <a href="BtLibRef_Sockets.html#1538203"><span style="font-family: monospace">BtLibSocketConnect</span></a>: create an outbound L2CAP connection.</p>
<h4 class="HCHeadC">
  <a name="948586"> </a>RFCOMM
</h4>
<p class="Body">
  <a name="948587"> </a>RFCOMM emulates a serial connection. It is used by the Bluetooth Virtual Serial Driver and the Bluetooth Exchange Library.
</p>
<p class="Body">
  <a name="948588"> </a>When using RFCOMM, you can only have one inbound connection per listener socket. Flow control uses a "credit" system: you need to advance a credit to the far end before you can receive a data packet.
</p>
<p class="Body">
  <a name="948589"> </a>RFCOMM defines the notions of <i>server</i> and <i>client</i>. A server uses SDP to advertise its existence and listens for inbound connections. A client creates an outbound RFCOMM connection to a server.
</p>

<h5 class="HDHeadD">
  <a name="948590"> </a>Establishing Inbound RFCOMM Connections
</h5>
<p class="Body">
  <a name="948591"> </a>To set up for inbound RFCOMM connections, call the following:
</p>
  <a name="948595"> </a><p class="N1NumList">1.	  <a href="BtLibRef_Sockets.html#1547240"><span style="font-family: monospace">BtLibSocketCreate</span></a>: create an RFCOMM socket.</p>  <a name="948599"> </a><p class="N1NumList">2.	  <a href="BtLibRef_Sockets.html#948168"><span style="font-family: monospace">BtLibSocketListen</span></a>: set up the RFCOMM socket as a listener.</p>  <a name="948603"> </a><p class="N1NumList">3.	  <a href="BtLibRef_Sockets.html#1517241"><span style="font-family: monospace">BtLibSdpServiceRecordCreate</span></a>: allocate a memory chunk that represents an SDP service record.</p>  <a name="948607"> </a><p class="N1NumList">4.	  <a href="BtLibRef_Sockets.html#949530"><span style="font-family: monospace">BtLibSdpServiceRecordSetAttributesForSocket</span></a>: initialize an SDP memory record so it can represent the newly-created RFCOMM listener socket as a service</p>  <a name="948611"> </a><p class="N1NumList">5.	  <a href="BtLibRef_Sockets.html#1528085"><span style="font-family: monospace">BtLibSdpServiceRecordStartAdvertising</span></a>: make the SDP memory record representing your local SDP service record visible to remote devices.</p><p class="Body">
  <a name="948615"> </a>When you get a <a href="BtLibRef_Sockets.html#1060883"><span style="font-family: monospace">btLibSocketEventConnectRequest</span></a> event, you need to respond with a call to <a href="BtLibRef_Sockets.html#948423"><span style="font-family: monospace">BtLibSocketRespondToConnection</span></a>. You then receive a <a href="BtLibRef_Sockets.html#1618336"><span style="font-family: monospace">btLibSocketEventConnectedInbound</span></a> event with an inbound socket with which you can send and receive data. To send data, use the <a href="BtLibRef_Sockets.html#948555"><span style="font-family: monospace">BtLibSocketSend</span></a> function. The <a href="BtLibRef_Sockets.html#1619896"><span style="font-family: monospace">btLibSocketEventData</span></a> event indicates data has been received.
</p>
<p class="Body">
  <a name="948628"> </a>The listening socket will not notify you of further connection attempts. In other words, a single RFCOMM listening socket can only spawn a single inbound RFCOMM socket. You cannot close the listening socket until after you close its inbound socket.
</p>

<h5 class="HDHeadD">
  <a name="948629"> </a>Establishing Outbound RFCOMM Connections
</h5>
<p class="Body">
  <a name="948630"> </a>To establish an outbound RFCOMM connection, you first establish an ACL link to the remote device. Then you call:
</p>
  <a name="948634"> </a><p class="N1NumList">1.	  <a href="BtLibRef_Sockets.html#1547240"><span style="font-family: monospace">BtLibSocketCreate</span></a>: create an SDP socket.</p>  <a name="948638"> </a><p class="N1NumList">2.	  <a href="BtLibRef_Sockets.html#1504778"><span style="font-family: monospace">BtLibSdpGetServerChannelByUuid</span></a>: get an available RFCOMM server channel using SDP.</p>  <a name="948642"> </a><p class="N1NumList">3.	  <a href="BtLibRef_Sockets.html#1547240"><span style="font-family: monospace">BtLibSocketCreate</span></a>: create an RFCOMM socket.</p>  <a name="948646"> </a><p class="N1NumList">4.	  <a href="BtLibRef_Sockets.html#1538203"><span style="font-family: monospace">BtLibSocketConnect</span></a>: Create an outbound RFCOMM connection.</p>
<h2 class="HaHeadA">
  <a name="939516"> </a>Bluetooth Virtual Serial Driver 
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939518"> </a>The Bluetooth system implements the serial port profile with a Virtual Serial Driver. This driver has the following characteristics:
</p>

  <a name="939520"> </a><p class="B1Bullet"> &#8226; Opens a background thread for the Bluetooth stack.</p>

  <a name="939521"> </a><p class="B1Bullet"> &#8226; Supports only one current active serial channel (point-to-point connection) at a time.</p>

  <a name="939523"> </a><p class="B1Bullet"> &#8226; Is opened explicitly as either a client or a server.</p>

  <a name="939524"> </a><p class="B1Bullet"> &#8226; Is utilized, as a client, by the following Palm OS components:</p>
  <a name="939525"> </a><p class="B2BulletSub"> -	 PPP</p>  <a name="939526"> </a><p class="B2BulletSub"> -	 HotSync</p>  <a name="939527"> </a><p class="B2BulletSub"> -	 Telephony</p>
  <a name="939528"> </a><p class="B1Bullet"> &#8226; If opened as a server, advertises a list of services (UUIDs) for remote clients to query.</p>

  <a name="939529"> </a><p class="B1Bullet"> &#8226; If opened as a client, creates the necessary baseband and RFCOMM connections, based upon information passed in by the opener.</p>
<p class="Body">
  <a name="939530"> </a>An RFCOMM-based virtual serial port is far less symmetrical than a physical serial port. In a traditional serial port, there is no need to establish the underlying transport. When establishing a Bluetooth serial port, however, there are roles for a client and a server device on three different stack levels-ACL, L2CAP, and RFCOMM-as well as responsibilities for registering with and querying SDP.
</p>

<h2 class="HBHeadB">
  <a name="949700"> </a>Opening the Serial Port
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="949768"> </a>You can use the new <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmExtOpen</span> function to open a Bluetooth serial port, passing Bluetooth-specific parameters in a custom info block. You should first verify that the port being opened is in fact a Bluetooth serial port, since other types of ports may use the block for other purposes.
</p>
<p class="Body">
  <a name="949769"> </a>For the benefit of certain legacy applications, the driver also supports being opened by the old <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmOpen</span> function. In that case, the driver presumes the role of client, performs device discovery with user interaction, and looks for remote channel advertising the Serial Port Service Class.
</p>
<p class="Body">
  <a name="941458"> </a>To open an RFCOMM virtual serial port with <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmExtOpen</span>, you need to create a <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">BtVdOpenParams</span> structure. This structure is declared as follows:
</p>
<pre  class="Preformatted">
typedef struct {<a name="943270"> </a>
    BtVdRole role;<a name="943271"> </a>
    union {<a name="943272"> </a>
        BtVdOpenParamsClient client;<a name="943273"> </a>
        BtVdOpenParamsServer server;<a name="943274"> </a>
    } u;<a name="943275"> </a>
    Boolean authenticate;<a name="943276"> </a>
    Boolean encrypt;<a name="943277"> </a>
} BtVdOpenParams;<a name="943278"> </a>
</pre>
<p class="Body">
  <a name="943248"> </a>How you populate this structure depends on whether you are opening the serial port as a client or as a server. A client initiates baseband and RFCOMM connections, while a server waits for incoming baseband and RFCOMM connections.
</p>
<p class="Body">
  <a name="943215"> </a>If you are acting as a client, set the structure's <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">role</span> member to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btVdClient</span> and fill in the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">client</span> member of the union as described in <a href="BTCompanion.html#941468">"Opening the Port as a Client."</a> If you are acting as a server, set the structure's <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">role</span> member to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btVdServer</span> and fill in the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">server</span> member of the union as described in <a href="BTCompanion.html#941501">"Opening the Port as a Server."</a>
</p>
<p class="Body">
  <a name="943313"> </a>Irrespective of whether you are acting as a client or as a server, set <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">authenticate</span> to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">true</span> if you require link authentication. Similarly, set <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">encrypt</span> to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">true</span> if you require link encryption. Link encryption requires link authentication.
</p>

<h4 class="HCHeadC">
  <a name="941468"> </a>Opening the Port as a Client
</h4>
<p class="Body">
  <a name="941471"> </a>When playing the client role you must specify the address of the remote Bluetooth device and the service to connect to on the remote device. You do this by filling out the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">client</span> member of the union in the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">BtVdOpenParams</span> structure. This member is declared to be a <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">BtVdOpenParamsClient</span> structure, which looks like this:
</p>
<pre  class="Preformatted">
typedef struct {<a name="943455"> </a>
    BtLibDeviceAddressType remoteDevAddr;<a name="943456"> </a>
    BtVdClientMethod method;<a name="943458"> </a>
    union {<a name="943459"> </a>
        BtLibRfCommServerIdType channelId;<a name="943460"> </a>
        BtVdUuidList uuidList;<a name="943461"> </a>
    } u;<a name="943463"> </a>
} BtVdOpenParamsClient;<a name="943464"> </a>
</pre>
<p class="Body">
  <a name="943600"> </a>If you know the address of the Bluetooth device to which you want to connect, supply the address in <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">remoteDevAddr</span>. Otherwise, supply an address value of all zeros; this will cause a Bluetooth device discovery operation to be initiated, allowing the handheld user to choose the device to connect to.
</p>
<p class="Body">
  <a name="943618"> </a>When connecting to a remote service using RFCOMM, you have two basic options: 
</p>

  <a name="943833"> </a><p class="B1Bullet"> &#8226; use SDP to look for one or more UUIDs</p>

  <a name="943928"> </a><p class="B1Bullet"> &#8226; connect to a specific RFCOMM channel ID</p>
<p class="Body">
  <a name="943930"> </a>You normally specify the service to which to connect by providing a list of one or more service class UUIDs. Simply set the structure's <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">method</span> member to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btVdUseUuidList </span>and supply a list of UUIDs using the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">uuidList</span> member of the structure's union. This will trigger a series of SDP queries, searching for each of the specified service classes. The first service class that is found on the remote device will be used. If it suits your application, specify an empty list of service class UUIDs (set the list count of zero); this causes an SDP query to be made for a default Palm-specific service class UUID (953D4FBC-8DA3-11D5-AA62-0030657C543C).
</p>
<p class="Body">
  <a name="941487"> </a>The result of a successful SDP query is the RFCOMM server channel to which to connect on the remote device. To facilitate testing, you can bypass SDP querying and directly specify the remote RFCOMM server channel ID. Simply set the structure's <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">method</span> member to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btVdUseChannelId</span> and set the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">channelId</span> member of the structure's union to the server channel ID.
</p>
<p class="Body">
  <a name="941492"> </a>The call to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmExtOpen</span> blocks until the RFCOMM connection is established or it is determined that the connection cannot be established. The driver displays a progress dialog, giving the user the opportunity to cancel the connection attempt.
</p>
<p class="Body">
  <a name="941498"> </a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmExtOpen</span> returns zero if and only if the RFCOMM connection was successfully established.
</p>

<h4 class="HCHeadC">
  <a name="941501"> </a>Opening the Port as a Server
</h4>
<p class="Body">
  <a name="941503"> </a>Relative to the process of opening the serial port as a client, opening the port as a server is pretty simple. When playing the server role, you need only specify the UUID of the service you wish to advertise. Optionally, you can also specify a user-readable name for that service.
</p>
<p class="Body">
  <a name="944090"> </a>Specify the service UUID and user-readable name by filling out the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">server</span> member of the union in the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">BtVdOpenParams</span> structure. This member is a <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">BtVdOpenParamsServer</span> structure, which is declared as follows:
</p>
<pre  class="Preformatted">
typedef struct {<a name="944059"> </a>
    BtLibSdpUuidType uuid;<a name="944060"> </a>
    const Char *name;<a name="944062"> </a>
} BtVdOpenParamsServer;<a name="944063"> </a>
</pre>
<p class="Body">
  <a name="941507"> </a>As a convenience, you can specify a null UUID (all binary zeros), in which case the default Palm-specific service class UUID will be advertised. (953D4FBC-8DA3-11D5-AA62-0030657C543C).
</p>
<p class="Body">
  <a name="941511"> </a>The call to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmExtOpen</span> returns immediately, without waiting for an incoming RFCOMM connection. To wait for incoming data, periodically call either <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmReceive</span>, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmReceiveWait</span>, or <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmReceiveCheck</span>.
</p>

<h4 class="HCHeadC">
  <a name="941516"> </a>Example
</h4>
<p class="Body">
  <a name="941518"> </a>The following code excerpt illustrates a call to <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">SrmExtOpen</span> that, acting as a client, creates an RFCOMM virtual serial port and connects to a known RFCOMM channel on a remote device:
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Err err;<a name="941522"> </a>
SrmOpenConfigType config;<a name="941523"> </a>
BtVdOpenParams btParams;<a name="941524"> </a>
UInt16 btPortId;<a name="941525"> </a>
<a name="941526"> </a>
config.function = 0;                              // must be zero<a name="941527"> </a>
config.drvrDataP = (MemPtr)&amp;btParams;<a name="941528"> </a>
config.drvrDataSize = sizeof(BtVdOpenParams);<a name="941529"> </a>
<a name="944301"> </a>
btParams.role = btVdClient;                       // we are the client side<a name="941530"> </a>
btParams.u.client.remoteDevAddr.address[0] = ...; // remote device addr byte 1<a name="941531"> </a>
    ...<a name="941532"> </a>
btParams.u.client.remoteDevAddr.address[5] = ...; // remote device addr byte 6<a name="941533"> </a>
btParams.u.client.method = btVdUseChannelId;<a name="941534"> </a>
btParams.u.client.u.channelId = 0x53;<a name="941535"> </a>
<a name="941536"> </a>
err = SrmExtOpen(<a name="941537"> </a>
    sysFileCVirtRfComm, // type of port == RFCOMM<a name="941538"> </a>
    &amp;config,            // port configuration params<a name="941539"> </a>
    sizeof(config),     // size of port config params<a name="941540"> </a>
    &amp;btPortId           // receives the id of this virtual serial port instance<a name="941541"> </a>
);<a name="941542"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="941543"> </a>Note that this code excerpt will not compile as-is; the remote Bluetooth device address has not been properly specified.
</p>

<h2 class="HBHeadB">
  <a name="939577"> </a>Palm-to-Palm Communication
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939571"> </a>Most applications act as clients only. However, in the case of Palm-to-Palm applications, they may need to act as both clients and servers. In this case, the virtual serial driver should initially be configured as a server to advertise its services to the other remote device. At this point, both devices are acting as servers, advertising their services. When a user-initiated action causes one of the devices to reopen the virtual serial driver as a client, it can then discover the remote device and its advertised service-advertised through a predefined, agreed-upon UUID-so that a channel can be opened between the two devices.
</p>

<h2 class="HBHeadB">
  <a name="947099"> </a>How Palm OS Uses the Bluetooth Virtual Serial Driver
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="947076"> </a>Within the Palm OS, HotSync, PPP, and the Telephony Manager can all use Bluetooth, although they can only act as clients.
</p>
<p class="Body">
  <a name="947138"> </a>For these clients, the user performs device discovery and device pairing, if appropriate, from within the Connection Panel. These clients can then consult the Connection Panel to determine the address of the remote device, the link key, and the service class to look for on the remote device. For example, if PPP is using the connection profile that indicates that the remote device is a phone or a modem, it looks for the Dialup Networking Service Class UUID. But if the profile indicates that the remote device is a PC or a LAN access point, it looks for the LAN Access Using PPP Service Class UUID.
</p>

<h2 class="HaHeadA">
  <a name="939604"> </a>Bluetooth Exchange Library Support 
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="939605"> </a>Accompanying the Bluetooth Library is the Bluetooth Exchange Library, a shared library that allows applications to support Bluetooth using the standard Exchange Manager APIs. The Bluetooth Exchange Library conforms to the Object Push and Generic Object Exchange profiles.
</p>
<p class="Body">
  <a name="944909"> </a>For more information about the Exchange Manager, see the "Object Exchange" chapter of the <i>Palm OS Programmer's Companion</i>.
</p>

<h2 class="HBHeadB">
  <a name="944527"> </a>Detecting the Bluetooth Exchange Library
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="944562"> </a>To check for the presence of the Bluetooth Exchange Library, you use <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">FtrGet</span>:
</p>
<pre  class="Preformatted">
err = FtrGet(btexgFtrCreator,
btexgFtrNumVersion, &amp;btExgLibVersion);<a name="944539"> </a>
</pre>
<p class="Body">
  <a name="944541"> </a>If the Bluetooth Exchange Library is present, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">FtrGet</span> returns <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">errNone</span>. In this case, the value pointed to by <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">btExgLibVersion</span> contains the version number of the Bluetooth Exchange Library. The format of the version number is <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">0xMMmfsbbb</span>, where <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">MM</span> is the major version, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">m</span> is the minor version, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">f</span> is the bug fix level, <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">s</span> is the stage, and <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">bbb</span> is the build number. Stage 3 indicates a release version of the library. Stage 2 indicates a beta release, stage 1 indicates an alpha release, and stage 0 indicates a development release. So, for example, a value of <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">0x01013000</span> would correspond to the released version 1.01 of the Bluetooth Exchange Library.
</p>

<h2 class="HBHeadB">
  <a name="944831"> </a>Using the Exchange Manager With Bluetooth
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="944832"> </a>Using the Exchange Manager with Bluetooth is almost exactly like using it with IRDA and SMS. The differences are as follows:
</p>

  <a name="944844"> </a><p class="B1Bullet"> &#8226; The URL you use when you send an object has some special fields specific to Bluetooth.</p>

  <a name="945289"> </a><p class="B1Bullet"> &#8226; Your application may want to know the URL of the device or devices with which it is communicating. The Exchange Manager provides a way to get this information.</p>

  <a name="944860"> </a><p class="B1Bullet"> &#8226; The <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ExgGet</span> and <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ExgRequest</span> functions are not supported with Bluetooth.</p>
<p class="Body">
  <a name="944874"> </a>These differences are discussed further in the following sections.
</p>

<h4 class="HCHeadC">
  <a name="944875"> </a>Bluetooth Exchange URLs
</h4>
<p class="Body">
  <a name="944935"> </a>If you send objects using the Bluetooth Exchange Library and use a URL, you can send the objects to single or multiple devices at the same time depending on the way the URL is formed. A Bluetooth Exchange Library URL can have one of the following forms:
</p>
<h5 class="P1"><a name="944936"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">_btobex:</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">filename</span></td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="944953"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">_btobex://</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">filename</span></td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="944954"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">_btobex://?_multi/</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">filename</td><td valign="top"></span>Performs a device inquiry, presents the available devices to the user, and allows the user to choose one or more devices. Sends the object to all selected devices.</td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="945020"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">_btobex://?_single/</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">filename</td><td valign="top"></span>Performs a device inquiry, presents the available devices to the user, and allows the user to choose only one device. Sends the object to that device.</td>
  </tr>
</table>
</div></h5>
<h5 class="P1"><a name="945027"> </a><div class="P1Parameter"><table border="0" cellpadding="5" cellspacing="0">
  <tr>
    <td width="180" valign="top"><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">_btobex://</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">address1</span><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">[,</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">address2</span><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> ...<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">]/</span><span style="color: #333;;  font-style: italic; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">filename</td><td valign="top"></span>Sends the object to the device(s) with the specified Bluetooth device address(es). The addresses are in the form "<span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">xx:xx:xx:xx:xx:xx</span>".</td>
  </tr>
</table>
</div></h5>
<p class="Body">
  <a name="945031"> </a>Do not combine these URL forms. Doing so may give unintended results.
</p>

<h4 class="HCHeadC">
  <a name="941715"> </a>Obtaining the URL of a Remote Device
</h4>
<p class="Body">
  <a name="945067"> </a>For some applications you need to know the URL that addresses the remote device from which you receive data. This is especially useful for games. You can get the URL after calling <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ExgAccept</span> using a <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ExgControl</span> function code as shown in the following code:
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
ExgCtlGetURLType getUrl;<a name="945088"> </a>
UInt16 getUrlLen;<a name="945089"> </a>
<a name="945090"> </a>
// First get the size of the URL<a name="945091"> </a>
getUrl.socketP = exgSocketP;<a name="945092"> </a>
getUrl.URLP = NULL;<a name="945093"> </a>
getUrl.URLSize = 0;<a name="945094"> </a>
getUrlLen =  sizeof(getUrl);<a name="945095"> </a>
ExgControl(exgSocketP, exgLibCtlGetURL, &amp;getUrl, &amp;getUrlLen);<a name="945096"> </a>
<a name="945157"> </a>
// Now get the URL<a name="945158"> </a>
getUrl.URLP = MemPtrNew(getUrl.URLSize);<a name="945099"> </a>
ExgControl(exgSocketP, exgLibCtlGetURL, &amp;getUrl, &amp;getUrlLen);<a name="945100"> </a>
<a name="945101"> </a>
// getUrl.URLP points to a null-terminated URL string<a name="945197"> </a>
// describing the remote device, for example,<a name="945198"> </a>
// "_btobex://01:23:45:67:89:ab/"<a name="945203"> </a>
...<a name="945199"> </a>
// Free the URL after you're done with it<a name="945227"> </a>
MemPtrFree(getUrl.URLP);<a name="945078"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="945304"> </a>ExgGet and ExgRequest
<a href="#948688"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="945309"> </a>The Bluetooth Exchange Library does not support the pull functions provided by <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ExgGet</span> and <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">ExgRequest</span>. If you want to perform these functions, you must use the general Bluetooth Library APIs. See <a href="BTCompanion.html#948373">"Developing Bluetooth-Enabled Applications"</a>.
</p>
&nbsp;<br>
				<!-- CONTENT_END -->

		</td>
		<td width="5">&nbsp;&nbsp;</td>
	</tr>
      </table>
    </td>
			</tr>
  <tr>
				<td>
					<table border="0" cellpadding="0" cellspacing="0" width="760">
        <!-- CONTENTCELL_END -->
        <tr valign="top"> 
          <td width="10">&nbsp;<!-- FOOTER_START --></td>
          <td width="72">&nbsp;</td>
          <td width="25" bgcolor="white" background="images/bkgrnd.gif">&nbsp;</td>
          <td width="600"> 
            <table border="0" cellpadding="0" cellspacing="0" width="600">
              <tr> 
                <td><img src="images/rule_10-1-5_ltblue.gif" width="600" height="16" border="0"></td>
              </tr>
              <tr> 
                <td> 
                  <p align="center" class="footer"> ©2002 PalmSource, Inc. and its affiliates.  All rights reserved. 
<a href="http://www.palmos.com/dev/training/">Training</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/">Palm&nbsp;OS&nbsp;Platform</a>&nbsp;|&nbsp;<a href="Companion2Front.html" target="_blank">Legal Notices</a>&nbsp;<br>
												<!-- FOOTER_END --><br>
											</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
				</td>
			</tr>
</table>
</BODY>
</HTML>