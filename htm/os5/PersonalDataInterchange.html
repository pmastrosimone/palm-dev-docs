<HTML>

<HEAD>
<SMALLSCREENIGNORE> 
<LINK HREF="copy_of_palmos.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="document.css" REL="StyleSheet" TYPE="text/css" media="screen">
<!-- SCRIPT_START -->
<!-- SCRIPT_END -->
</SMALLSCREENIGNORE>
<TITLE>Personal Data Interchange</TITLE>

<META NAME="PALMTEMPLATE" CONTENT="1006-002 Palm HTML 20020513">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="TEMPLATEBASE" CONTENT="Palm HTML 20010625">
<META NAME="LASTUPDATED" CONTENT="12/13/02 10:04:15">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=ISO-8859-1">

</HEAD>

<BODY LEFTMARGIN="0" MARGINWIDTH="0" TOPMARGIN="0" MARGINHEIGHT="0">
<SMALLSCREENIGNORE> 
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td><a name="978818"></a>
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr height="35"> 
          <td height="35" colspan="2" bgcolor="#6699CC">&nbsp;</td>
        </tr>
        <tr valign="top"> 
          <td width="160" align="left"><a href="http://www.palmos.com"><img src="images/bigorb.gif" width="160" height="110" border="0"></a></td>
          <td align="left" width="100%"> 
            </SMALLSCREENIGNORE>
            <!-- CONTENTCELL_START -->
            <img border="0" height="45" src="images/orb_bkgrnd_600.gif" width="600"><br>
            <!--PAGENAV_START-->
            <SPAN CLASS="subnav">&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
              &nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span><BR>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             <h2 class="HeadDocPage">3  Personal Data Interchange</h2>
             <img src="images/pixel_ltblue.gif" width="600" height="1" border="0" vspace="2"><br>
             &nbsp;<span class="subnav"><a href="Companion2TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="ExchangeLibraries.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Beaming.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Companion2IX.html">Index</a></span>  
            <!--PAGENAV_END-->
          </td>
        </tr>
      </table>
    </td>
			</tr>
  <tr>
				<td> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
							<td>&nbsp;&nbsp;&nbsp;</td>
						</tr>
        <tr>
		<td valign="top" width="10">&nbsp;&nbsp;&nbsp;</td>
		<td valign="top" width="175">
			<p class="SideTitle">Title - <br><a href="Companion2Front.html">Palm OS® Programmer's Companion</a></p>
			<p class="SideTOC1-PartTab">Volume II Communications </p>
			<p class="SideTOC1"><a href="PersonalDataInterchange.html">3  Personal Data Interchange</a></p>
			
<p class="SideTOC2">
<a href="#978860">About Personal Data Interchange
</a></p>

<p class="SideTOC3">
<a href="#978868">About vObjects
</a></p>

<p class="SideTOC3">
<a href="#978879">Overview of vObject Structure
</a></p>

<p class="SideTOC2">
<a href="#978935">About the PDI Library
</a></p>

<p class="SideTOC3">
<a href="#978956">PDI Property and Parameter Types
</a></p>

<p class="SideTOC3">
<a href="#979005">The PDI Library Properties Dictionary
</a></p>

<p class="SideTOC3">
<a href="#979023">PDI Readers
</a></p>

<p class="SideTOC3">
<a href="#979053">PDI Writers
</a></p>

<p class="SideTOC3">
<a href="#979064">Format Compatibility
</a></p>

<p class="SideTOC3">
<a href="#979087">International Considerations
</a></p>

<p class="SideTOC3">
<a href="#979095">Features Not Yet Supported
</a></p>

<p class="SideTOC2">
<a href="#979106">Using the PDI Library
</a></p>

<p class="SideTOC3">
<a href="#979250">Accessing the PDI Library
</a></p>

<p class="SideTOC3">
<a href="#979290">Unloading the PDI Library
</a></p>

<p class="SideTOC3">
<a href="#979310">Creating a PDI Reader
</a></p>

<p class="SideTOC3">
<a href="#979342">Reading Properties
</a></p>

<p class="SideTOC3">
<a href="#979384">Reading Property Values
</a></p>

<p class="SideTOC3">
<a href="#979507">Creating a PDI Writer
</a></p>

<p class="SideTOC3">
<a href="#979537">Writing Properties
</a></p>

<p class="SideTOC3">
<a href="#979565">Writing Property Values
</a></p>

<p class="SideTOC3">
<a href="#979580">Specifying PDI Versions
</a></p>

<p class="SideTOC2">
<a href="#979593">Using UDA for Different Media
</a></p>

<p class="SideTOC3">
<a href="#979601">About the UDA Library
</a></p>

<p class="SideTOC2">
<a href="#979649">Using a PDI Reader - An Example
</a></p>

<p class="SideTOC2">
<a href="#979828">Using a PDI Writer - An Example
</a></p>

<p class="SideTOC2">
<a href="#979970">Summary of Personal Data Interchange
</a></p>

<p class="SideTOC2">
<a href="#980095">Summary of Unified Data Access Manager
</a></p>

		</td>

		<td width="5">&nbsp;&nbsp;</td>
		<td width="1" bgcolor="#6699cc">&nbsp;</td>
		<td width="5">&nbsp;&nbsp;</td>
		<td> 

				<!-- CONTENT_START -->

<p class="Body">
  <a name="978820"> </a>The Palm OS<sup>®</sup> provides the PDI library API for exchanging Personal Data Interchange (PDI) information with other devices and media. This chapter contains the following sections that describe how to use the Palm OS PDI library:
</p>

  <a name="978824"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#978860">About Personal Data Interchange</a> briefly introduces the PDI standard and provides links to sources of more complete information.</p>

  <a name="978828"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#978935">About the PDI Library</a> describes how the Palm OS PDI library implements PDI reader and writer objects for exchanging information.</p>

  <a name="978832"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979106">Using the PDI Library</a> describes how to use the functions in the PDI library.</p>

  <a name="978836"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979593">Using UDA for Different Media</a> describes how you can use the Unified Data Access (UDA) Manager to access data from different media in your PDI reader or writer.</p>

  <a name="978840"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979649">Using a PDI Reader - An Example</a> provides a detailed walk-through of a code segment that creates a PDI reader and then uses it to parse vCard information.</p>

  <a name="978844"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979828">Using a PDI Writer - An Example</a> provides a detailed walk-through of a code segment that creates a PDI writer and then uses it to generate vCal information.</p>
<p class="Body">
  <a name="978845"> </a>For detailed information about the PDI library data types, constants, and functions, see <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
</p>
<p class="Body">
  <a name="978849"> </a>The PDI reader and writer objects make use of the United Data Access (UDA) Manager to manage input and output data streams. <a href="PersonalDataInterchange.html#979593">"Using UDA for Different Media"</a> provides an overview of using the UDA Manager. The reference information for UDA functions is in <a href="UDAMgr.html#1400298">Chapter 86, "Unified Data Access Manager,"</a> in <i>Palm OS Programmer's API Reference</i>.
</p>

<h2 class="HaHeadA">
  <a name="978860"> </a>About Personal Data Interchange 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="978861"> </a>Personal data interchange involves the exchange of information using a communications medium. The Palm OS PDI Library facilitates the exchange of information using standard <b>vObjects</b>, including data formatted according to <b>vCard</b> and <b>vCal</b> standards.
</p>
<p class="Body">
  <a name="978862"> </a>The vObject standards are maintained by a group known as the versit consortium, which consists of individuals from a number of companies and institutions. The best information about the PDI standards can be found at the consortium's web site:
</p>
<pre  class="Preformatted">
<a href="http://www.imc.org/pdi/">http://www.imc.org/pdi/</a><a name="978864"> </a>
</pre>
<p class="Body">
  <a name="978865"> </a>These standards are finding increased use in a number of computers and hand-held devices that wish to exchange personal data such as business card and calendar information.
</p>
<p class="Body">
  <a name="978866"> </a>The PDI Library provides a <span style="font-family: monospace">PdiReaderType</span> object for reading vObjects from an input stream, and a <span style="font-family: monospace">PdiWriterType</span> object for writing vObjects to an output stream. The input streams and output streams can be connected to various data sources.
</p>

<h2 class="HBHeadB">
  <a name="978868"> </a>About vObjects
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="978869"> </a>This section provides a brief overview of vObject standards. Two common vObject types are vCards and vCals:
</p>

  <a name="978871"> </a><p class="B1Bullet"> &#8226; vCards are used to exchange virtual business card information electronically. Each vCard can include a large variety of personal and business information about an individual, including name, address, and telecommunications numbers.</p>

  <a name="978873"> </a><p class="B1Bullet"> &#8226; vCals are used to exchange virtual calendaring and scheduling information electronically. Each vCal can include:</p>
  <a name="978875"> </a><p class="B2BulletSub"> -	 vEvent objects, each of which represents a scheduled amount of time on a calendar</p>  <a name="978877"> </a><p class="B2BulletSub"> -	 vTodo objects, each of which defines an action item or assignment</p>
<h2 class="HBHeadB">
  <a name="978879"> </a>Overview of vObject Structure
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="978880"> </a>This section provides a brief overview of vObject standards, including the vCard and vCal standards. Each vObject standard provides the same, basic organizational structure:
</p>

  <a name="978881"> </a><p class="B1Bullet"> &#8226; Each vObject is a collection of one or more property definitions. </p>

  <a name="978882"> </a><p class="B1Bullet"> &#8226; Each property definition contains a name, a value, and an optional collection of property parameter definitions.</p>

  <a name="978883"> </a><p class="B1Bullet"> &#8226; Each property parameter definition contains a name and a value. Each parameter value qualifies the property definition with additional information.</p>

  <a name="978884"> </a><p class="B1Bullet"> &#8226; A property value can be structured to contain multiple values. The values are typically separated with commas or semicolons.</p>
<p class="Body">
  <a name="978885"> </a>The vObject standards also allow developers to add custom extensions. All vObject readers that conform to the standard, including the <span style="font-family: monospace">PdiReaderType</span> object, can read these extensions, though not all readers will act upon the information contained in them. 
</p>
<p class="Body">
  <a name="978886"> </a>Each property has the following syntax:
</p>
<pre  class="Preformatted">
PropertyName [';' Parameters] ':' PropertyValue<a name="978887"> </a>
</pre>
<p class="Body">
  <a name="978888"> </a>Note that property and parameter names are case insensitive.
</p>
<p class="Body">
  <a name="978892"> </a><a href="PersonalDataInterchange.html#978894">Listing 3.1</a> shows a typical vCard definition.
</p>
<p class="CCodeCaption">
  <a name="978894"> </a>Listing 3.1  Example of a vCard definition
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
BEGIN:VCARD<a name="978895"> </a>
VERSION:2.1<a name="978896"> </a>
N:Smith, John;M.;Mr.; Esq.<a name="978897"> </a>
TEL;WORK;VOICE; MSG:+1 (408) 555-1234<a name="978898"> </a>
TEL;CELL:+1 (408) 555-4321<a name="978899"> </a>
TEL;WORK;FAX:+1 (408) 555-9876<a name="978900"> </a>
ADR;WORK;PARCEL;POSTAL;DOM:Suite 101;1 Central  St.;Any Town;NC;28654<a name="978901"> </a>
END:VCARD<a name="978902"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="978906"> </a>Each line in <a href="PersonalDataInterchange.html#978894">Listing 3.1</a> is a property definition, with the exception of the next to last line, which is a continuation of the <span style="font-family: monospace">ADR</span> property definition, and begins with white space. Each property definition is delimited by a CR/LF sequence.
</p>
<p class="Body">
  <a name="978907"> </a>The <span style="font-family: monospace">BEGIN</span>, <span style="font-family: monospace">VERSION</span>, and <span style="font-family: monospace">END</span> lines are examples of simple property definitions. 
</p>
<p class="Body">
  <a name="978908"> </a>The <span style="font-family: monospace">N</span> (Name) property has a structured value. The components of the name are separated by semicolons.
</p>
<p class="Body">
  <a name="978909"> </a>Each <span style="font-family: monospace">TEL</span> (Telephone) property has parameters that qualify the kind of telephone number that is being specified.
</p>
<p class="Body">
  <a name="978910"> </a>The <span style="font-family: monospace">ADR</span> (Address) property has parameters and a structured value.
</p>
<div class="NINoteImportant"><hr>
  <a name="978911"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> The vObject specifications also allow long lines of text to be <b>folded</b>. This means that wherever you can have white space in a property definition, you can insert a CR/LF followed by white space, as shown in the next to last line in <a href="PersonalDataInterchange.html#978894">Listing 3.1</a> When the vObject reader finds a CR/LF followed by white space, it <b>unfolds</b> the text back into one long line.
<hr>
</div>

<h4 class="HCHeadC">
  <a name="978915"> </a>Grouping vObjects
</h4>
<p class="Body">
  <a name="978916"> </a>You can specify multiple vObjects in a single vObject data stream. You can also specify a vObject as the value of a property; for example, you can include a vCard as the value of the <span style="font-family: monospace">ADR</span> property of another vCard. 
</p>

<h4 class="HCHeadC">
  <a name="978918"> </a>Grouping Properties
</h4>
<p class="Body">
  <a name="978919"> </a>You can specify a name for a group of related properties within a vObject. The name is a single character that you use as a prefix to each property in the group.
</p>
<p class="Body">
  <a name="978920"> </a>One use of this facility is to group a comment that describes a property with the property to keep the two together. For example, the following creates a group named <span style="font-family: monospace">G</span> that includes a vCard home telephone property with a comment property:
</p>
<pre  class="Preformatted">
G.TEL;HOME:+1 (831) 555-1234<a name="978921"> </a>
G.Note: This is my home office number.<a name="978922"> </a>
</pre>

<h4 class="HCHeadC">
  <a name="978924"> </a>Encodings
</h4>
<p class="Body">
  <a name="978925"> </a>The default encoding for vObject properties is 7-bit. You can override this encoding for individual property values by using the <span style="font-family: monospace">ENCODING</span> parameter. You can specify various encoding values, including <span style="font-family: monospace">BASE64</span>, <span style="font-family: monospace">QUOTED-PRINTABLE</span>, and <span style="font-family: monospace">8-BIT</span>.
</p>

<h4 class="HCHeadC">
  <a name="978927"> </a>Character Sets
</h4>
<p class="Body">
  <a name="978928"> </a>The default character set for vObject properties is ASCII. You can override the character set for individual property values by using the <span style="font-family: monospace">CHARSET</span> parameter. You can specify any character set that has been registered with the Internet Assigned Numbers Authority (IANA). For example, to specify the Latin/Hebrew encoding, you would use the value <span style="font-family: monospace">ISO-8859-8</span>.
</p>

<h4 class="HCHeadC">
  <a name="978929"> </a>Finding More Information
</h4>
<p class="Body">
  <a name="978930"> </a>For a complete description of the vObject specifications, visit the versit consortium's web site:
</p>
<pre  class="Preformatted">
<a href="http://www.imc.org/pdi/">http://www.imc.org/pdi/</a><a name="978932"> </a>
</pre>

<h2 class="HaHeadA">
  <a name="978935"> </a>About the PDI Library 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="978936"> </a>The Palm OS PDI library is a shared library that provides objects and functions for:
</p>

  <a name="978937"> </a><p class="B1Bullet"> &#8226; Reading vCard objects from an input data stream. The section <a href="PersonalDataInterchange.html#979310">Creating a PDI Reader</a> describes how to create and use a PDI reader, and the section <a href="PersonalDataInterchange.html#979649">Using a PDI Reader - An Example</a> provides an example of reading vCard data from an input stream.</p>

  <a name="978944"> </a><p class="B1Bullet"> &#8226; Writing vCard objects to an output data stream. The section <a href="PersonalDataInterchange.html#979507">Creating a PDI Writer</a> describes how to create and use a PDI reader, and the section <a href="PersonalDataInterchange.html#979828">Using a PDI Writer - An Example</a> provides an example of reading vCard data from an input stream.</p>
<p class="Body">
  <a name="978951"> </a>The PDI library handles reading and writing objects in a number of different formats, and from or to a variety of media. For more information about specifying the media, see <a href="PersonalDataInterchange.html#979593">"Using UDA for Different Media."</a>
</p>

<h2 class="HBHeadB">
  <a name="978956"> </a>PDI Property and Parameter Types
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="978957"> </a>The PDI library provides constants that you can use with the reader and writer objects to specify property information. These include the following types of constants that specify vObject standard entities:
</p>

  <a name="978958"> </a><p class="B1Bullet"> &#8226; The <b>Property Name</b> constants represent the PDI property names. Each of the property name constants starts with the <span style="font-family: monospace">kPdiPRN_</span> prefix. For example, the <span style="font-family: monospace">kPdiPRN_ADR</span> constant represents the <span style="font-family: monospace">ADR</span> property name. For more information, see the section <a href="PDILib.html#1395752">Property Name Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

  <a name="978969"> </a><p class="B1Bullet"> &#8226; The <b>Property Value Field</b> constants represent the position of property value fields for properties with structured field values. Each of the property value field constants starts with the <span style="font-family: monospace">kPdiPVF_</span> prefix. For example, the <span style="font-family: monospace">kPdiPVF_ADR_COUNTRY</span> constant represents the <span style="font-family: monospace">COUNTRY</span> field of an <span style="font-family: monospace">ADR</span> property value. For more information, see the section <a href="PDILib.html#1395869">Property Value Field Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

  <a name="978980"> </a><p class="B1Bullet"> &#8226; The <b>Parameter Name</b> constants represent the names of vObject property parameters. Each of the parameter name constants starts with the <span style="font-family: monospace">kPdiPAN_</span> prefix. For example, the <span style="font-family: monospace">kPdiPAN_Type</span> constant represents the <span style="font-family: monospace">TYPE</span> parameter, and the <span style="font-family: monospace">kPdiPAN_Encoding</span> constant represents the <span style="font-family: monospace">ENCODING</span> parameter. For more information, see the section <a href="PDILib.html#1395700">Parameter Name Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>

  <a name="978991"> </a><p class="B1Bullet"> &#8226; The <b>Parameter Value</b> constants represent the combined name and value of parameters. Each of the parameter value constants starts with the <span style="font-family: monospace">kPdiPAV_</span> prefix. For example, <span style="font-family: monospace">kPdiPAV_ENCODING_BASE64</span> constant represents the <span style="font-family: monospace">Base64</span> encoding. For more information, see the section <a href="PDILib.html#1395724">Parameter Value Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>
<p class="Body">
  <a name="979002"> </a>For a complete list of all of these constants, see the <span style="font-family: monospace">PdiConst.h</span> file.
</p>

<h2 class="HBHeadB">
  <a name="979005"> </a>The PDI Library Properties Dictionary
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979006"> </a>The PDI library features a dictionary that stores information about the properties that are considered "well-known." A well-known property is one that is defined in one of the vObject standard specifications, including the vCard and vCal standards. Both of these standards can be found online at the PDI developer's web page:
</p>
<pre  class="Preformatted">
<a href="http://www.imc.org/pdi/pdiproddev.html">http://www.imc.org/pdi/pdiproddev.html</a><a name="979008"> </a>
</pre>
<p class="Body">
  <a name="979009"> </a>PDI readers and writers use information in the properties dictionary to determine how to read or write a certain property. Specifically, the dictionary stores information about the format of each property value; the reader uses this information to correctly parse the property value, and the writer uses this information to correctly format the written value. This information is important because some property values are structured with multiple fields, while others contain a single value field.
</p>
<p class="Body">
  <a name="979010"> </a>For example, the standard address (<span style="font-family: monospace">ADR</span>) property has a structured value with seven required fields, and the fields are separated by semicolons. The dictionary stores this information, and the PDI reader then knows to read seven, semicolon-separated fields when parsing an ADR property.
</p>
<p class="Body">
  <a name="979011"> </a>By default, each PDI reader and writer uses a standard dictionary when parsing input and generating output. You can, however, override this behavior to parse or generate the value for a property in some other way. For more information, see <a href="PersonalDataInterchange.html#979384">"Reading Property Values"</a> and <a href="PersonalDataInterchange.html#979565">"Writing Property Values."</a>
</p>
<p class="Body">
  <a name="979018"> </a>You can also amend or replace the dictionary to add parsing and/or generation of customized PDI properties for your application. For more information, see <a href="PersonalDataInterchange.html#979493">"Adding Custom Extensions."</a>
</p>

<h2 class="HBHeadB">
  <a name="979023"> </a>PDI Readers
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979024"> </a>The PDI library provides the PDI reader object for reading and parsing vObject input. A PDI reader object is a structure that stores the current state of parsing through a PDI input stream. 
</p>
<p class="Body">
  <a name="979025"> </a>The PDI reader parses the input stream one property at a time, starting with the Begin Object property and finishing with the End Object property. 
</p>
<p class="Body">
  <a name="979029"> </a>The <a href="PDILib.html#1395278"><span style="font-family: monospace">PdiReaderType</span></a> structure stores a variety of information about the current state of parsing the input stream, including the following information about the current property:
</p>

  <a name="979030"> </a><p class="B1Bullet"> &#8226; the encoding and character set</p>

  <a name="979031"> </a><p class="B1Bullet"> &#8226; the type of the current property, parameter, and property value</p>

  <a name="979032"> </a><p class="B1Bullet"> &#8226; the name of the current property and parameter</p>

  <a name="979033"> </a><p class="B1Bullet"> &#8226; the current property's value string</p>

  <a name="979034"> </a><p class="B1Bullet"> &#8226; a mask of the parsing events encountered for the current property</p>

<h4 class="HCHeadC">
  <a name="979035"> </a>About Parsing Events
</h4>
<p class="Body">
  <a name="979036"> </a>The PDI reader records each parsing event that it encounters while processing a property. For example, when it parses a <span style="font-family: monospace">BEGIN:VCARD</span> property, the PDI reader records the <span style="font-family: monospace">kPdiBeginObjectEventMask</span>, and when it parses a property name, the PDI reader records the <span style="font-family: monospace">kPdiPropertyNameEventMask</span>.
</p>
<p class="Body">
  <a name="979040"> </a>Each event is represented by one of the <a href="PDILib.html#1396040">Reader Event Constants</a>, which are described in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>. The PDI reader records the event by adding (<span style="font-family: monospace">OR'</span>ing) the event constant into the <span style="font-family: monospace">events</span> field of the <a href="PDILib.html#1395278"><span style="font-family: monospace">PdiReaderType</span></a> structure.
</p>
<p class="Body">
  <a name="979050"> </a>You can determine if a specific event has occurred while parsing the current property by testing that event's constant against the <span style="font-family: monospace">events</span> field in the reader structure. For example, the following statement returns <span style="font-family: monospace">false</span> if the end of the input stream was reached.
</p>
<pre  class="Preformatted">
return((reader-&gt;events &amp; kPdiEOFEventMask)==0);<a name="979051"> </a>
</pre>

<h2 class="HBHeadB">
  <a name="979053"> </a>PDI Writers
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979054"> </a>The PDI library provides the PDI writer object for writing vObject output. A PDI writer object is a structure that stores the current state of and manages the generation of PDI data.
</p>
<p class="Body">
  <a name="979055"> </a>The PDI writer sends data to the output stream one property at a time, starting with the Begin Object property and finishing with the End Object property. 
</p>
<p class="Body">
  <a name="979059"> </a>The <a href="PDILib.html#1395394"><span style="font-family: monospace">PdiWriterType</span></a> structure stores information about the current state of writing the output stream, including the following:
</p>

  <a name="979060"> </a><p class="B1Bullet"> &#8226; the encoding and character set of the current property</p>

  <a name="979061"> </a><p class="B1Bullet"> &#8226; the mode used to write the current property value, which specifies how the property value is structured</p>

  <a name="979062"> </a><p class="B1Bullet"> &#8226; the number of required fields for the current property value</p>

<h2 class="HBHeadB">
  <a name="979064"> </a>Format Compatibility
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979065"> </a>The PDI library can read and write data streams in the following formats:
</p>

  <a name="979066"> </a><p class="B1Bullet"> &#8226; vCard 3.0</p>

  <a name="979067"> </a><p class="B1Bullet"> &#8226; vCard 2.1</p>

  <a name="979068"> </a><p class="B1Bullet"> &#8226; vCal 1.0</p>

  <a name="979069"> </a><p class="B1Bullet"> &#8226; iCalendar</p>

  <a name="979070"> </a><p class="B1Bullet"> &#8226; Palm format</p>
<p class="Body">
  <a name="979071"> </a>You can use the PDI library to convert an input data stream that uses one format into an output data stream in another format. For more information, see <a href="PersonalDataInterchange.html#979580">"Specifying PDI Versions."</a>
</p>

<h4 class="HCHeadC">
  <a name="979075"> </a>Compatibility with Earlier Versions of the Palm OS
</h4>
<p class="Body">
  <a name="979076"> </a>The PDI library has been designed to maintain compatibility with earlier versions of the Palm OS, which means that you can use the library functions to receive vObjects from or send vObjects to devices that use those earlier versions. 
</p>
<p class="Body">
  <a name="979077"> </a>To take advantage of this compatibility, the PDI library has been built to send or receive data in different formats, one of which is the format supported by earlier versions of the Palm OS that included the <span style="font-family: monospace">ImcUtils</span> implementation.
</p>
<p class="Body">
  <a name="979078"> </a>To include support for this compatibility in a PDI Reader, specify the <span style="font-family: monospace">kPdiOpenParser</span> constant in your call to the <a href="PDILib.html#1396664"><span style="font-family: monospace">PdiReaderNew</span></a> function.
</p>
<p class="Body">
  <a name="979082"> </a>To include support for this compatibility in a PDI Writer, specify the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPalmCompatibility</span> option when calling the <a href="PDILib.html#1397464"><span style="font-family: monospace">PdiWriterNew</span></a> function. 
</p>

<h2 class="HBHeadB">
  <a name="979087"> </a>International Considerations
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979088"> </a>The PDI library handles various character sets, including Katakana. If you specify the <span style="font-family: monospace">CHARSET</span> parameter in the input stream, the PDI reader will correctly read the property value.
</p>
<p class="Body">
  <a name="979089"> </a>The PDI library included with version 4.0 of the Palm OS understands the following character sets:
</p>

  <a name="979090"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">charEncodingAscii</span></p>

  <a name="979091"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">charEncodingISO8859_1</span></p>

  <a name="979092"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">charEncodingShiftJIS</span></p>

  <a name="979093"> </a><p class="B1Bullet"> &#8226; <span style="font-family: monospace">charEncodingISO2022Jp</span></p>
<p class="Body">
  <a name="979094"> </a>If you specify an unknown character set, the current character set becomes unknown, as represented by the <span style="font-family: monospace">charEncodingUnknown</span> constant.
</p>

<h2 class="HBHeadB">
  <a name="979095"> </a>Features Not Yet Supported
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979096"> </a>The PDI library included with version 4.0 of the Palm OS does not handle the following features:
</p>

  <a name="979097"> </a><p class="B1Bullet"> &#8226; Multi-part MIME messages are not handled.</p>

  <a name="979098"> </a><p class="B1Bullet"> &#8226; The XML version of vObjects is not supported.</p>

  <a name="979099"> </a><p class="B1Bullet"> &#8226; Applications ignore grouping. The PDI reader parses group identifiers, but ignores them. However, the name of the group most recently parsed is stored in the <span style="font-family: monospace">groupName</span> field of the <a href="PDILib.html#1395278"><span style="font-family: monospace">PdiReaderType</span></a> object.</p>

<h2 class="HaHeadA">
  <a name="979106"> </a>Using the PDI Library 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979107"> </a>This section describes how to use the functions in the PDI library to read or write PDI content. <a href="PersonalDataInterchange.html#979171">Figure 3.1</a> shows the typical sequences of calls that you make to read or write vObjects.
</p>
<p class="Body">
  <a name="979111"> </a>To read vObjects, you need to:
</p>

  <a name="979112"> </a><p class="B1Bullet"> &#8226; access the PDI library</p>

  <a name="979113"> </a><p class="B1Bullet"> &#8226; create a PDI reader</p>

  <a name="979114"> </a><p class="B1Bullet"> &#8226; read each property in the input stream:</p>
  <a name="979115"> </a><p class="B2BulletSub"> -	 read the property name</p>  <a name="979116"> </a><p class="B2BulletSub"> -	 read any parameters for the property</p>  <a name="979117"> </a><p class="B2BulletSub"> -	 read the property value</p>
  <a name="979118"> </a><p class="B1Bullet"> &#8226; delete the PDI reader</p>

  <a name="979119"> </a><p class="B1Bullet"> &#8226; unload the PDI library</p>
<p class="Body">
  <a name="979120"> </a>To write vObjects, you need to:
</p>

  <a name="979121"> </a><p class="B1Bullet"> &#8226; access the PDI library</p>

  <a name="979122"> </a><p class="B1Bullet"> &#8226; create a PDI writer</p>

  <a name="979123"> </a><p class="B1Bullet"> &#8226; write each property in the input stream:</p>
  <a name="979124"> </a><p class="B2BulletSub"> -	 write the property name</p>  <a name="979125"> </a><p class="B2BulletSub"> -	 write any parameters for the property</p>  <a name="979126"> </a><p class="B2BulletSub"> -	 write the property value</p>
  <a name="979127"> </a><p class="B1Bullet"> &#8226; delete the PDI writer</p>

  <a name="979128"> </a><p class="B1Bullet"> &#8226; unload the PDI library</p>
<p class="Body">
  <a name="979129"> </a>The remainder of this section describes the following operations:
</p>

  <a name="979133"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979250">Accessing the PDI Library</a></p>

  <a name="979137"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979290">Unloading the PDI Library</a></p>

  <a name="979141"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979310">Creating a PDI Reader</a></p>

  <a name="979145"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979342">Reading Properties</a></p>

  <a name="979149"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979507">Creating a PDI Writer</a></p>

  <a name="979153"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979565">Writing Property Values</a></p>

  <a name="979157"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979580">Specifying PDI Versions</a></p>

  <a name="979161"> </a><p class="B1Bullet"> &#8226; <a href="PersonalDataInterchange.html#979593">Using UDA for Different Media</a></p>
<p class="Body">
  <a name="979165"> </a>The section <a href="PersonalDataInterchange.html#979649">"Using a PDI Reader - An Example"</a> provides a detailed example of creating a PDI Reader and using it to import vCard data into a database.
</p>
<p class="Body">
  <a name="979169"> </a>The section <a href="PersonalDataInterchange.html#979828">"Using a PDI Writer - An Example"</a> provides a detailed example of creating a PDI Writer and using it to export data from a database in vCal format.
</p>

<p class="FFigureCaption">
  <a name="979171"> </a>Figure 3.1	 Using the PDI library
</p>
<p class="FgFigure">
  <a name="979247"> </a><div align="left"><img src="images/PersonalDataInterchangea.gif" height="536" width="468" border="0" hspace="20" vspace="0">
</div>
</p>

<h2 class="HBHeadB">
  <a name="979250"> </a>Accessing the PDI Library
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979251"> </a>Before you can use the PDI library, you must load the library and obtain a reference number for it. Each of the functions in the library requires a reference number argument, which is used with the system code to access a shared library.
</p>
<p class="Body">
  <a name="979254"> </a>The example function <span style="font-family: monospace">LoadPdiLibrary</span>, which is shown in <a href="PersonalDataInterchange.html#979257">Listing 3.2</a>, makes sure that the PDI library is loaded and returns a reference number for it.
</p>
<p class="CCodeCaption">
  <a name="979257"> </a>Listing 3.2  Loading the PDI library
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Static Err LoadPdiLibrary(UInt16 *libRefNum)<a name="979258"> </a>
{<a name="979259"> </a>
   Err   error<a name="979260"> </a>
 <a name="979261"> </a>
   error = SysLibFind(kPdiLibName, librefNum);<a name="979262"> </a>
   if (error != 0)<a name="979263"> </a>
   {<a name="979264"> </a>
      error = SysLibLoad(sysResTLibrary,
                               sysFileCPdiLib, libRefNum);<a name="979265"> </a>
   }<a name="979266"> </a>
   if (error)<a name="979267"> </a>
   {<a name="979268"> </a>
      ErrNonFatalDisplay(kPdiLibName "not found")<a name="979269"> </a>
      return error;<a name="979270"> </a>
   }<a name="979271"> </a>
   error = PdiLibOpen(*libRefNum);<a name="979272"> </a>
   return error;<a name="979273"> </a>
}<a name="979274"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="979278"> </a>The <span style="font-family: monospace">LoadPdiLibrary</span> function first calls the <a href="SystemManager.html#1166164"><span style="font-family: monospace">SysLibFind</span></a> function to determine if the library has already been loaded, which might be the case if your code has been called by another application that has already loaded the library. Note that the call to <span style="font-family: monospace">SysLibFind</span> uses the <span style="font-family: monospace">kPdiLibName</span> constant, which is defined as follows in the <span style="font-family: monospace">PdiLib.h</span> file:
</p>
<pre  class="Preformatted">
#define kPdiLibName "Pdi.lib"<a name="979279"> </a>
</pre>
<p class="Body">
  <a name="979280"> </a>If the library has not already been loaded, <span style="font-family: monospace">LoadPdiLibrary</span> calls the <a href="SystemManager.html#1166207"><span style="font-family: monospace">SysLibLoad</span></a> function to load the library and obtain a reference number for it.
</p>
<p class="Body">
  <a name="979284"> </a>After obtaining a reference number for the library, <span style="font-family: monospace">LoadPdiLibrary</span> calls the <a href="PDILib.html#1396463"><span style="font-family: monospace">PdiLibOpen</span></a> function to open the loaded library.
</p>

<h2 class="HBHeadB">
  <a name="979290"> </a>Unloading the PDI Library
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979291"> </a>When you are done with the library, you should unload it. The example function <span style="font-family: monospace">UnloadPdiLibrary</span>, which is shown in <a href="PersonalDataInterchange.html#979257">Listing 3.2</a>, unloads the PDI library.
</p>
<p class="CCodeCaption">
  <a name="979295"> </a>Listing 3.3  Unloading the PDI library
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void UnloadPdiLibrary(UInt16 refNum)<a name="979296"> </a>
{<a name="979297"> </a>
   if (PdiLibClose(refNum) == 0)<a name="979298"> </a>
   {<a name="979299"> </a>
      SysLibRemove(refNum);<a name="979300"> </a>
   }<a name="979301"> </a>
}<a name="979302"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="979303"> </a>Note that the library reference number becomes invalid after you call the <a href="SystemManager.html#1166237"><span style="font-family: monospace">SysLibRemove</span></a> function.
</p>

<h2 class="HBHeadB">
  <a name="979310"> </a>Creating a PDI Reader
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979311"> </a>To create a PDI reader, you need to first access the library, and then call the <a href="PDILib.html#1396664"><span style="font-family: monospace">PdiReaderNew</span></a> function, which is declared as follows:
</p>
<pre  class="Preformatted">
PdiReaderType* PdiReaderNew(UInt16 libRefnum,
UDAReader *input, UInt16 optionFlags)<a name="979316"> </a>
</pre>
<p class="Body">
  <a name="979317"> </a>The <span style="font-family: monospace">PdiReaderNew</span> parameters are:
</p>

  <a name="979320"> </a><p class="B1Bullet"> &#8226; The library reference number, as described in <a href="PersonalDataInterchange.html#979250">"Accessing the PDI Library."</a></p>

  <a name="979322"> </a><p class="B1Bullet"> &#8226; The Unified Data Access (UDA) input stream to use with the reader. The UDA Manager allows you to read input from various sources, including strings and the Exchange Manager. For more information, see <a href="PersonalDataInterchange.html#979593">"Using UDA for Different Media."</a></p>

  <a name="979326"> </a><p class="B1Bullet"> &#8226; Option flags that control the parsing behavior of the reader, including its default encoding and compatibility settings. The option flags are described in <a href="PDILib.html#1395971">Reader and Writer Options Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>
<p class="Body">
  <a name="979336"> </a>Once you have created the reader, you can use it to parse properties from the input stream. The section <a href="PersonalDataInterchange.html#979649">"Using a PDI Reader - An Example"</a> provides an example of creating and using a PDI reader.
</p>

<h2 class="HBHeadB">
  <a name="979342"> </a>Reading Properties
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979343"> </a>To read PDI property data with a PDI reader, you need to call the data reading functions:
</p>

  <a name="979348"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1396737"><span style="font-family: monospace">PdiReadProperty</span></a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>reads a property and all of its parameters from the input stream.</p>

  <a name="979353"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1396854"><span style="font-family: monospace">PdiReadPropertyName</span></a> reads just the name of the next property from the input stream. You can call this function if you want to then handle the reading of the property's parameters individually.</p>

  <a name="979358"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1396701"><span style="font-family: monospace">PdiReadParameter</span></a> reads a single parameter and its value from the input stream.</p>

  <a name="979363"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1396792"><span style="font-family: monospace">PdiReadPropertyField</span></a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span>reads a property value field. A property value can a simple value, or it can be structured to contain multiple fields that are separated by commas or semicolons, as described in <a href="PersonalDataInterchange.html#979384">"Reading Property Values."</a></p>
<p class="Body">
  <a name="979367"> </a>The most common way to read input data is to follow these steps:
</p>

  <a name="979368"> </a><p class="B1Bullet"> &#8226; Call <span style="font-family: monospace">PdiReadProperty</span> to read the vObject Begin property. For example, if you are reading vCards, you can call <span style="font-family: monospace">PdiReadProperty</span> until it reads the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPRN_BEGIN_VCARD </span>property from the input stream.</p>

  <a name="979369"> </a><p class="B1Bullet"> &#8226; Once you have found the beginning of the object, repeatedly call <span style="font-family: monospace">PdiReadProperty</span> to read the next property and its parameters. </p>

  <a name="979370"> </a><p class="B1Bullet"> &#8226; For each property, call the <span style="font-family: monospace">PdiReadPropertyField</span> function as required to read the fields of the property.</p>

  <a name="979371"> </a><p class="B1Bullet"> &#8226; Continue reading properties until you read the vObject End property. For vCards, you process properties until <span style="font-family: monospace">PdiReadProperty</span> reads the <span style="font-family: monospace">kPdiPRN_END_VCARD</span> property from the input stream.</p>

<h4 class="HCHeadC">
  <a name="979372"> </a>Examining Property Information
</h4>
<p class="Body">
  <a name="979373"> </a>After calling a property-reading function, you can access fields of the <span style="font-family: monospace">PdiReaderType</span> object to determine information about the current property. The current property is the one that is currently being parsed, or which has just been parsed. 
</p>
<p class="Body">
  <a name="979374"> </a>For example, you can examine the <span style="font-family: monospace">property</span> field of the <a href="PDILib.html#1395278"><span style="font-family: monospace">PdiReaderType</span></a> object to determine which type of property has just been read, or you can call the <a href="PDILib.html#1396601"><span style="font-family: monospace">PdiParameterPairTest</span></a> macro to determine if a certain parameter pair was present in the property definition.
</p>

<h2 class="HBHeadB">
  <a name="979384"> </a>Reading Property Values
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979385"> </a>Some properties have simple values and others have structured values. A structured property value has multiple fields that are separated by commas or semicolons. 
</p>
<p class="Body">
  <a name="979386"> </a>For example, the following phone property definition has a simple value:
</p>
<pre  class="Preformatted">
TEL;CELL:+1 (408) 555-4321<a name="979387"> </a>
</pre>
<p class="Body">
  <a name="979388"> </a>Note that the phone property contains a semicolon to separate the <span style="font-family: monospace">CELL</span> parameter from the property name. Each property's value follows the colon in the definition.
</p>
<p class="Body">
  <a name="979389"> </a>The following name property definition has a structured value that contains four fields separated by semicolons:
</p>
<pre  class="Preformatted">
N:Smith; John;M.;Mr.; Esq.<a name="979390"> </a>
</pre>
<p class="Body">
  <a name="979394"> </a>You must pass a parameter to the <a href="PDILib.html#1396792"><span style="font-family: monospace">PdiReadPropertyField</span></a> function to tell it how to process a property value. To specify how the field is formatted, use one of the <a href="PDILib.html#1395893">Property Value Format Constants</a> described in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
</p>
<p class="Body">
  <a name="979404"> </a>You can specify <span style="font-family: monospace">kPdiDefaultFields</span> to allow the PDI reader to determine the property value format. The reader looks up the property name in the dictionary to determine its format.
</p>

  <a name="979405"> </a><p class="B1Bullet"> &#8226; Specify <span style="font-family: monospace">kPdiNoFields</span> to have the reader parse the entire value in one operation.</p>

  <a name="979406"> </a><p class="B1Bullet"> &#8226; Specify <span style="font-family: monospace">kPdiCommaFields</span> or <span style="font-family: monospace">kPdiSemicolonFields</span> to have the reader parse a single field from the value.</p>

  <a name="979407"> </a><p class="B1Bullet"> &#8226; Specify <span style="font-family: monospace">kPdiConvertComma</span> or <span style="font-family: monospace">kPdiConvertSemicolon</span> to have the reader parse all of the fields in a value into a single value.</p>
<p class="Body">
  <a name="979408"> </a>You can usually specify <span style="font-family: monospace">kPdiDefaultFields</span> and allow the PDI Reader to use the information in the dictionary to properly parse the value. However, this might not always meet your needs, especially if your input stream contains custom properties.
</p>
<p class="Body">
  <a name="979412"> </a><a href="PersonalDataInterchange.html#979418">Table 3.1</a> shows the results of using the different format constants to read the same property from the input stream. The example property is a standard address (<span style="font-family: monospace">ADR</span>) property that has a structured value with seven, semicolon-delimited fields:
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
ADR:postoffice;extended;street;locale;region;postal_code;country<a name="979413"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="979414"> </a>Note that since the <span style="font-family: monospace">ADR</span> property is defined in the vCard standard as a structured value with seven, semicolon-delimited field, the PDI library dictionary defines its default format as <span style="font-family: monospace">kPdiSemicolon</span>.
</p>

<h5 class="TgTable">
  <a name="979465"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="979418"> </a><div class="TableTitle">Table 3.1  Parsing a structured value with different value format types </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="979425"> </a><div class="CellHeading">Value format type</div></th>
    <th><a name="979431"> </a><div class="CellHeading">Description of <a href="PDILib.html#1396792">PdiReadPropertyField</a> results</div></th>
  </tr>
  <tr valign="top">
    <td><a name="979433"> </a><div class="CellBody"><span style="font-family: monospace">kPdiNoFields</span></div></td>
    <td><a name="979435"> </a><div class="CellBody">One call returns the entire value as a string:</div><a name="979436"> </a><div class="CellBody">"postoffice;extended;street;locale;region;postal_code;country"</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979438"> </a><div class="CellBody"><span style="font-family: monospace">kPdiSemicolon</span></div></td>
    <td><a name="979440"> </a><div class="CellBody">Each call returns a single, semicolon-delimited field from the value. For example:</div>
  <a name="979441"> </a><div class="BTBulletTable">&#8226; the first call returns "postoffice"</div>
  <a name="979442"> </a><div class="BTBulletTable">&#8226; the second call returns "extended"</div>
  <a name="979443"> </a><div class="BTBulletTable">&#8226; the third call returns "street"</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979445"> </a><div class="CellBody"><span style="font-family: monospace">kPdiComma</span></div></td>
    <td><a name="979447"> </a><div class="CellBody">Each call returns a single, comma-delimited field from the value. For example, if the input string is "postoffice,extended,street," then:</div>
  <a name="979448"> </a><div class="BTBulletTable">&#8226; the first call returns "postoffice"</div>
  <a name="979449"> </a><div class="BTBulletTable">&#8226; the second call returns "extended"</div>
  <a name="979450"> </a><div class="BTBulletTable">&#8226; the third call returns "street"</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979452"> </a><div class="CellBody"><span style="font-family: monospace">kPdiConvertSemicolon</span></div></td>
    <td><a name="979454"> </a><div class="CellBody">One call returns the entire value as a string that has newline characters wherever a semicolon appeared in the input:</div><a name="979455"> </a><div class="CellBody">"postoffice<br>extended<br>street<br>locale<br>region<br>postal_code<br>country"</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979457"> </a><div class="CellBody"><span style="font-family: monospace">kPdiConvertComma</span></div></td>
    <td><a name="979459"> </a><div class="CellBody">One call returns the entire value as a string that has newline characters wherever a comma appeared in the input:</div><a name="979460"> </a><div class="CellBody">"postoffice<br>extended<br>street<br>locale<br>region<br>postal_code<br>country"</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979462"> </a><div class="CellBody"><span style="font-family: monospace">kPdiDefaultFields</span></div></td>
    <td><a name="979464"> </a><div class="CellBody">Same as <span style="font-family: monospace">kPdiSemicolon</span>, because the PDI library dictionary defines the property value format of the <span style="font-family: monospace">ADR</span> field as <span style="font-family: monospace">kPdiSemicolon</span>.</div></td>
  </tr>
</table>




</h5>
<h4 class="HCHeadC">
  <a name="979466"> </a>Reading Value Fields One At a Time
</h4>
<p class="Body">
  <a name="979467"> </a>If you are reading the fields in a structured value one at a time, and you don't know the exact number of fields, you can call <a href="PDILib.html#1396792"><span style="font-family: monospace">PdiReadPropertyField</span></a> repeatedly until it returns a nonzero result. 
</p>
<p class="Body">
  <a name="979472"> </a>For example, the following code segment from the <span style="font-family: monospace">DateTransfer.c</span> program parses each field of the <span style="font-family: monospace">EXDATE</span> property value fields:
</p>
<p class="CCodeCaption">
  <a name="979473"> </a>Listing 3.4  Reading an undetermined number of value fields
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
while (PdiReadPropertyField(pdiRefNum, reader, &amp;tempP,
                         kPdiResizableBuffer, kPdiSemicolonFields) == 0)<a name="979474"> </a>
   {<a name="979475"> </a>
               // Resize handle to hold exception<a name="979476"> </a>
      err = MemHandleResize(exceptionListH,
sizeof(ExceptionsListType) + sizeof(DateType) * exceptionCount);<a name="979477"> </a>
      ErrFatalDisplayIf(err != 0, "Memory full");<a name="979478"> </a>
              // Lock exception handle<a name="979479"> </a>
      exceptionListP = MemHandleLock(exceptionListH);<a name="979480"> </a>
              // Calc exception ptr<a name="979481"> </a>
      exceptionP = (DateType*)((UInt32)exceptionListP
                         + (UInt32)sizeof(UInt16)<a name="979482"> </a>
                         + (UInt32)(sizeof(DateType) * exceptionCount));<a name="979483"> </a>
               // Store exception into exception handle<a name="979484"> </a>
      MatchDateTimeToken(tempP, exceptionP, NULL);<a name="979485"> </a>
               // Increase exception count<a name="979486"> </a>
      exceptionCount++;<a name="979487"> </a>
               // Unlock exceptions list handle<a name="979488"> </a>
      MemHandleUnlock(exceptionListH);<a name="979489"> </a>
   }<a name="979490"> </a>
</pre><div class="CodeRule"><hr></div>
<div class="NINoteImportant"><hr>
  <a name="979491"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> If you leave fields in a structured value unread, the next call to <span style="font-family: monospace">PdiReadProperty</span> will skip over them and correctly find the beginning of the next property.
<hr>
</div>

<h4 class="HCHeadC">
  <a name="979493"> </a>Adding Custom Extensions
</h4>
<p class="Body">
  <a name="979494"> </a>The vObject standards are extensible, which means that you can add custom properties to vCards and other vObjects. The PDI library handles these custom properties; however, you must either add an entry to the library's dictionary for each custom property, or specify a constant other than <span style="font-family: monospace">kPdiDefaultFields</span> when parsing the property's value.
</p>
<p class="Body">
  <a name="979495"> </a>Each PDI reader object and each PDI writer object can have a custom dictionary associated with it. You can configure the custom dictionary to amend or to replace the standard, built-in dictionary.
</p>
<p class="Body">
  <a name="979496"> </a>To associate a custom dictionary with a reader or writer, you need to first create the dictionary with the You can then call the <a href="PDILib.html#1396284"><span style="font-family: monospace">PdiDefineReaderDictionary</span></a> function to associate that dictionary with a reader object or call the <a href="PDILib.html#1396378"><span style="font-family: monospace">PdiDefineWriterDictionary</span></a> function to associate the dictionary with a writer object.
</p>
<div class="NINoteImportant"><hr>
  <a name="979503"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> For more information about the dictionary tool at <a href="http://www.palmos.com/dev/tech/kb/">http://www.palmos.com/dev/tech/kb</a>.
<hr>
</div>

<h2 class="HBHeadB">
  <a name="979507"> </a>Creating a PDI Writer
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979508"> </a>To create a PDI writer, you need to first access the library, and then call the <a href="PDILib.html#1397464"><span style="font-family: monospace">PdiWriterNew</span></a> function, which is declared as follows:
</p>
<pre  class="Preformatted">
PdiWriterType* PdiWriterNew(UInt16 libRefnum,
UDAWriter *output, UInt8 optionFlags)<a name="979512"> </a>
</pre>
<p class="Body">
  <a name="979513"> </a>The <span style="font-family: monospace">PdiWriterNew</span> parameters are:
</p>

  <a name="979516"> </a><p class="B1Bullet"> &#8226; The library reference number, as described in <a href="PersonalDataInterchange.html#979250">"Accessing the PDI Library."</a>.</p>

  <a name="979518"> </a><p class="B1Bullet"> &#8226; The UDA output stream to use with the writer. For more information, see <a href="PersonalDataInterchange.html#979593">"Using UDA for Different Media."</a></p>

  <a name="979522"> </a><p class="B1Bullet"> &#8226; Option flags that control the output generation behavior of the writer, including its default encoding and compatibility settings. The option flags are described in <a href="PDILib.html#1395971">Reader and Writer Options Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.</p>
<p class="Body">
  <a name="979532"> </a>Once you have created the writer, you can use it to generate properties to the output stream. The section <a href="PersonalDataInterchange.html#979828">"Using a PDI Writer - An Example"</a> provides an example of creating and using a PDI writer.
</p>

<h2 class="HBHeadB">
  <a name="979537"> </a>Writing Properties
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979538"> </a>To write PDI data with a PDI writer, you need to call the data writing functions. The most commonly used functions are:
</p>

  <a name="979543"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1396989"><span style="font-family: monospace">PdiWriteBeginObject</span></a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a vObject Begin tag to the output stream.</p>

  <a name="979548"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1397033"><span style="font-family: monospace">PdiWriteEndObject</span></a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a vObject End tag to the output stream.</p>

  <a name="979553"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1397198"><span style="font-family: monospace">PdiWriteProperty</span></a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a property to the output stream.</p>

  <a name="979558"> </a><p class="B1Bullet"> &#8226; <a href="PDILib.html#1397392"><span style="font-family: monospace">PdiWritePropertyValue</span></a><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">,</span> which writes a property value to the output stream.</p>
<p class="Body">
  <a name="979559"> </a>The most common way to write output data is to follow these steps:
</p>

  <a name="979560"> </a><p class="B1Bullet"> &#8226; Call <span style="font-family: monospace">PdiWriteBeginObject</span> to write the vObject Begin property. For example, if you are writing vCards, you call <span style="font-family: monospace">PdiWriteBeginObject</span> to write the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPRN_BEGIN_VCARD </span>property to the output stream.</p>

  <a name="979561"> </a><p class="B1Bullet"> &#8226; For each property that you want to write, call <span style="font-family: monospace">PdiWriteProperty</span> to write the next property and its parameters, and then call the <span style="font-family: monospace">PdiWritePropertyValue</span> function to write the property's value. </p>

  <a name="979562"> </a><p class="B1Bullet"> &#8226; Call <span style="font-family: monospace">PdiWriteEndObject</span> to write the vObject End property. For example, if you are writing vCards, you call <span style="font-family: monospace">PdiWriteEndObject</span> to write the <span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">kPdiPRN_END_VCARD </span>property to the output stream.</p>

<h2 class="HBHeadB">
  <a name="979565"> </a>Writing Property Values
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979569"> </a>In many cases, you can simply call the <a href="PDILib.html#1397392"><span style="font-family: monospace">PdiWritePropertyValue</span></a> function to write a value to the output stream. If a value contains a variable number of fields, you can instead use the <a href="PDILib.html#1397297"><span style="font-family: monospace">PdiWritePropertyFields</span></a> to write the fields from an array. Or you can use the <a href="PDILib.html#1397338"><span style="font-family: monospace">PdiWritePropertyStr</span></a> to write multiple fields separated by commas or semicolons.
</p>

<h2 class="HBHeadB">
  <a name="979580"> </a>Specifying PDI Versions
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979581"> </a>The PDI library options constants control how the PDI reader and PDI writer operate. These options are described in <a href="PDILib.html#1395971">Reader and Writer Options Constants</a> in <a href="PDILib.html#1395250">Chapter 85, "Personal Data Interchange Library,"</a> in <i>Palm OS Programmer's API Reference</i>.
</p>

<h2 class="HaHeadA">
  <a name="979593"> </a>Using UDA for Different Media 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979594"> </a>The PDI reader and writer objects use Unified Data Access (UDA) Manager objects for reading from and writing to a variety of media. The UDA data types, constants, and functions are documented in <a href="UDAMgr.html#1400298">Chapter 86, "Unified Data Access Manager,"</a> in <i>Palm OS Programmer's API Reference</i>. This section provides an overview of using UDA objects with the PDI library.
</p>

<h2 class="HBHeadB">
  <a name="979601"> </a>About the UDA Library
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979602"> </a>The UDA Manager provides an abstract layer for reading, filtering, and writing data to and from different media. The UDA Manager provides three general purpose object types:
</p>

  <a name="979606"> </a><p class="B1Bullet"> &#8226; <a href="UDAMgr.html#1400431"><span style="font-family: monospace">UDAReaderType</span></a> objects (UDA Readers) read data from an input stream. </p>

  <a name="979610"> </a><p class="B1Bullet"> &#8226; <a href="UDAMgr.html#1400379"><span style="font-family: monospace">UDAFilterType</span></a> objects (UDA Filters) take input from UDA Readers or UDA Filters, perform some encoding or decoding operations, and output the data to a memory buffer.</p>

  <a name="979614"> </a><p class="B1Bullet"> &#8226; <a href="UDAMgr.html#1400472"><span style="font-family: monospace">UDAWriterType</span></a> objects (UDA Writers) write data to a filter or an output stream.</p>
<p class="Body">
  <a name="979615"> </a>The UDA Manager provides general purpose functions for creating these object types. In addition, the UDA Manager provides built-in object types for working with memory buffers and the Exchange Manager.
</p>
<div class="NINoteImportant"><hr>
  <a name="979616"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> The implementation of the UDA Manager in version 4.0 of the Palm OS does not provide built-in filter objects. These objects are planned for future versions.
<hr>
</div>

<h4 class="HCHeadC">
  <a name="979617"> </a>Interfacing with the Exchange Manager
</h4>
<p class="Body">
  <a name="979618"> </a>The UDA Manager provides two functions for interfacing with the Exchange Manager:
</p>

  <a name="979622"> </a><p class="B1Bullet"> &#8226; The <a href="UDAMgr.html#1401001"><span style="font-family: monospace">UDAExchangeReaderNew</span></a> function creates a UDA Reader object that reads data from an Exchange Manager socket. </p>

  <a name="979626"> </a><p class="B1Bullet"> &#8226; The <a href="UDAMgr.html#1401035"><span style="font-family: monospace">UDAExchangeWriterNew</span></a> function creates a UDA Writer object that writes data to an Exchange Manager socket.</p>
<p class="Body">
  <a name="979629"> </a>The Exchange Manager, which is described in <a href="ExchangeManagerConcept.html#969979">Chapter 1, "Object Exchange,"</a> provides a mechanism for reading typed data in a transport-independent manner. 
</p>
<p class="Body">
  <a name="979631"> </a>When you use the UDA interface to the Exchange Manager, you add the benefits of a simple, uniform way to read and write data in a transport-independent manner. This allows you to create PDI readers and writers that can work on data that is stored on a variety of media types. 
</p>
<p class="Body">
  <a name="979632"> </a>If you wish to parse PDI objects from memory, you can use an object created by the <a href="UDAMgr.html#1401067"><span style="font-family: monospace">UDAMemoryReaderNew</span></a> function instead of an Exchange Manager reader object.
</p>
<p class="Body">
  <a name="979636"> </a>The PDI Reader example in the next section reads its data from an Exchange Manger socket, using the <a href="UDAMgr.html#1401001"><span style="font-family: monospace">UDAExchangeReaderNew</span></a> function to create the reader object.
</p>
<p class="Body">
  <a name="979642"> </a>The PDI Writer example in <a href="PersonalDataInterchange.html#979828">"Using a PDI Writer - An Example"</a> writes its data to an Exchange Manager socket, using the <a href="UDAMgr.html#1401035"><span style="font-family: monospace">UDAExchangeWriterNew</span></a> function to create the writer object.
</p>

<h2 class="HaHeadA">
  <a name="979649"> </a>Using a PDI Reader - An Example 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979650"> </a>This section provides an example of reading PDI data from an input stream and storing it in a database. This example is from the <span style="font-family: monospace">AddressTransfer.c </span>file, which is located inside of the <span style="font-family: monospace">Examples/Address/Src</span> folder.
</p>
<p class="Body">
  <a name="979654"> </a><a href="PersonalDataInterchange.html#979683">Listing 3.5</a> shows the <span style="font-family: monospace">TransferReceiveData</span> function from the <span style="font-family: monospace">AddressTransfer.c</span> sample program. This function controls the reading of vCard data into the address database by performing the following operations:
</p>

  <a name="979658"> </a><p class="B1Bullet"> &#8226; Calls the <a href="ExchangeManager.html#1233284"><span style="font-family: monospace">ExgAccept</span></a> function to accept a connection from a remote device.</p>

  <a name="979659"> </a><p class="B1Bullet"> &#8226; Calls a local function, <span style="font-family: monospace">PrvTransferPdiLoadLibrary</span>, to load an open the PDI library. The <span style="font-family: monospace">PrvTransferPdiLoadLibrary</span> function is almost exactly the same as the <span style="font-family: monospace">LoadPdiLibrary</span> function shown in <a href="PersonalDataInterchange.html#979257">Listing 3.2</a>.</p>

  <a name="979666"> </a><p class="B1Bullet"> &#8226; Calls the <a href="UDAMgr.html#1401001"><span style="font-family: monospace">UDAExchangeReaderNew</span></a> function to create an input data stream for connection with the Exchange Manager.</p>

  <a name="979671"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1396664"><span style="font-family: monospace">PdiReaderNew</span></a> function to create a new PDI reader object that reads from the input stream.</p>

  <a name="979672"> </a><p class="B1Bullet"> &#8226; Repeatedly calls the local function <span style="font-family: monospace">TransferImportVCard</span> to read vCard data and store it into the address database. This function is described in the next section, <a href="PersonalDataInterchange.html#979732">Importing vCard Data Into a Database</a>.</p>

  <a name="979679"> </a><p class="B1Bullet"> &#8226; Calls the <a href="ExchangeManager.html#1233680"><span style="font-family: monospace">ExgDisconnect</span></a> function to terminate the transfer and close the connection.</p>

  <a name="979680"> </a><p class="B1Bullet"> &#8226; Calls the <span style="font-family: monospace">PrvTransferPdiLibUnload</span> function to unload the PDI library.</p>

  <a name="979681"> </a><p class="B1Bullet"> &#8226; Deletes the PDI reader and UDA input stream objects.</p>
<p class="CCodeCaption">
  <a name="979683"> </a>Listing 3.5  Reading a PDI input stream
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
extern Err TransferReceiveData(DmOpenRef dbP, ExgSocketPtr exgSocketP)<a name="979684"> </a>
{<a name="979685"> </a>
   volatile Err err;<a name="979686"> </a>
   UInt16 pdiRefNum = sysInvalidRefNum;<a name="979687"> </a>
   PdiReaderType* reader = NULL;<a name="979688"> </a>
   UDAReader* stream = NULL;<a name="979689"> </a>
   Boolean loaded;<a name="979690"> </a>
 <a name="979691"> </a>
   if ((err = ExgAccept(exgSocketP)) != 0)<a name="979692"> </a>
      return err;<a name="979693"> </a>
   if ((err = PrvTransferPdiLibLoad(&amp;pdiRefNum, &amp;loaded)))<a name="979694"> </a>
   {<a name="979695"> </a>
      pdiRefNum = sysInvalidRefNum;<a name="979696"> </a>
      goto errorDisconnect;<a name="979697"> </a>
   }<a name="979698"> </a>
   if ((stream = UDAExchangeReaderNew(exgSocketP)) == NULL)<a name="979699"> </a>
   {<a name="979700"> </a>
      err = exgMemError;<a name="979701"> </a>
      goto errorDisconnect;<a name="979702"> </a>
   }<a name="979703"> </a>
   if ((reader = PdiReaderNew(pdiRefNum, stream, kPdiOpenParser)) == NULL)<a name="979704"> </a>
   {<a name="979705"> </a>
      err = exgMemError;<a name="979706"> </a>
      goto errorDisconnect;<a name="979707"> </a>
   }<a name="979708"> </a>
   reader-&gt;appData = exgSocketP;<a name="979709"> </a>
   ErrTry<a name="979710"> </a>
   {<a name="979711"> </a>
      while(TransferImportVCard(dbP, pdiRefNum, reader, false, false)){};<a name="979712"> </a>
   }<a name="979713"> </a>
   ErrCatch(inErr)<a name="979714"> </a>
   {<a name="979715"> </a>
      err = inErr;<a name="979716"> </a>
   } ErrEndCatch<a name="979717"> </a>
   if (err == errNone &amp;&amp; exgSocketP-&gt;goToParams.uniqueID == 0)<a name="979718"> </a>
      err = exgErrBadData;<a name="979719"> </a>
errorDisconnect:<a name="979720"> </a>
   if (reader)<a name="979721"> </a>
      PdiReaderDelete(pdiRefNum, &amp;reader);<a name="979722"> </a>
   if (stream)<a name="979723"> </a>
      UDADelete(stream);<a name="979724"> </a>
   if (pdiRefNum != sysInvalidRefNum)<a name="979725"> </a>
      PrvTransferPdiLibUnload(pdiRefNum, loaded);<a name="979726"> </a>
   ExgDisconnect(exgSocketP, err); // closes transfer dialog<a name="979727"> </a>
   err = errNone; // error was reported, so don't return it<a name="979728"> </a>
   return err;<a name="979729"> </a>
}<a name="979730"> </a>
</pre><div class="CodeRule"><hr></div>

<h4 class="HCHeadC">
  <a name="979732"> </a>Importing vCard Data Into a Database
</h4>
<p class="Body">
  <a name="979733"> </a>The <span style="font-family: monospace">TransferImportVCard</span> function imports a vCard record from an input stream. <a href="PersonalDataInterchange.html#979739">Listing 3.6</a> shows the basic outline of the <span style="font-family: monospace">TransferImportVCard</span> function; you can review the entire function by viewing the <span style="font-family: monospace">AddressTransfer.c</span> file, which is located inside of the <span style="font-family: monospace">Examples/Address/Src</span> folder.
</p>
<p class="CCodeCaption">
  <a name="979739"> </a>Listing 3.6  Importing vCard data into a database
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
Boolean TransferImportVCard(DmOpenRef dbP, UInt16 pdiRefNum,
PdiReaderType* reader, Boolean obeyUniqueIDs, Boolean beginAlreadyRead)<a name="979740"> </a>
{<a name="979741"> </a>
 <a name="979742"> </a>
...    // local declarations and initialization code<a name="979743"> </a>
 <a name="979744"> </a>
   ErrTry<a name="979745"> </a>
   {<a name="979746"> </a>
      phoneField = firstPhoneField;<a name="979747"> </a>
      if (!beginAlreadyRead)<a name="979748"> </a>
      {<a name="979749"> </a>
         PdiReadProperty(pdiRefNum, reader);<a name="979750"> </a>
         beginAlreadyRead = reader-&gt;property == kPdiPRN_BEGIN_VCARD;<a name="979751"> </a>
      }<a name="979752"> </a>
      if (!beginAlreadyRead)<a name="979753"> </a>
         ErrThrow(exgErrBadData);<a name="979754"> </a>
      PdiEnterObject(pdiRefNum, reader);<a name="979755"> </a>
      PdiDefineResizing(pdiRefNum, reader, 16, tableMaxTextItemSize);<a name="979756"> </a>
      while (PdiReadProperty(pdiRefNum, reader) == 0 
               &amp;&amp; (property = reader-&gt;property) != kPdiPRN_END_VCARD)<a name="979757"> </a>
      {<a name="979758"> </a>
         switch(property)<a name="979759"> </a>
         {<a name="979760"> </a>
         case kPdiPRN_N:<a name="979761"> </a>
         PdiReadPropertyField(pdiRefNum, reader,
                        (Char **) &amp;newRecord.fields[name],
                           kPdiResizableBuffer, kPdiDefaultFields);<a name="979762"> </a>
         PdiReadPropertyField(pdiRefNum, reader,
                        (Char **) &amp;newRecord.fields[firstName],
                           kPdiResizableBuffer, kPdiDefaultFields);<a name="979763"> </a>
      break;<a name="979764"> </a>
         case kPdiPRN_NOTE:<a name="979765"> </a>
            PdiDefineResizing(pdiRefNum, reader, 16,
                           noteViewMaxLength);<a name="979766"> </a>
            PdiReadPropertyField(pdiRefNum, reader,
                        Char **) &amp;newRecord.fields[note],
                           kPdiResizableBuffer, kPdiNoFields);<a name="979767"> </a>
            PdiDefineResizing(pdiRefNum, reader, 16,
                           tableMaxTextItemSize);<a name="979768"> </a>
             break;<a name="979769"> </a>
 <a name="979770"> </a>
,,,  // other cases here for other properties<a name="979771"> </a>
 <a name="979772"> </a>
      }<a name="979773"> </a>
      } // end while<a name="979774"> </a>
                if (newRecord.fields[name] != NULL<a name="979775"> </a>
         &amp;&amp; newRecord.fields[company] != NULL<a name="979776"> </a>
         &amp;&amp; newRecord.fields[firstName] != NULL<a name="979777"> </a>
         &amp;&amp; StrCompare(newRecord.fields[name],
                              newRecord.fields[company]) == 0)<a name="979778"> </a>
      {     // if company &amp; name fields are identical, assume company only<a name="979779"> </a>
         MemPtrFree(newRecord.fields[name]);<a name="979780"> </a>
         newRecord.fields[name] = NULL;<a name="979781"> </a>
      }<a name="979782"> </a>
AddRecord:<a name="979783"> </a>
         err = AddrDBNewRecord(dbP, (AddrDBRecordType*) &amp;newRecord,
                                 &amp;indexNew);<a name="979784"> </a>
         if (err)<a name="979785"> </a>
            ErrThrow(exgMemError);<a name="979786"> </a>
 <a name="979787"> </a>
   ...      // handle category assignment here<a name="979788"> </a>
 <a name="979789"> </a>
   }   //end of ErrTry<a name="979790"> </a>
   if (error == exgErrBadData)<a name="979791"> </a>
      return false;<a name="979792"> </a>
   if (error != errNone)<a name="979793"> </a>
      ErrThrow(error);<a name="979794"> </a>
   return ((reader-&gt;events &amp; kPdiEOFEventMask) == 0);<a name="979795"> </a>
}<a name="979796"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="979797"> </a>The <span style="font-family: monospace">TransferImportVCard</span> function performs the following operations:
</p>

  <a name="979801"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1396737"><span style="font-family: monospace">PdiReadProperty</span></a> function to read the <span style="font-family: monospace">BEGIN:VCard</span> property from the input stream.</p>

  <a name="979806"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1396402"><span style="font-family: monospace">PdiEnterObject</span></a> function to notify the PDI library that it is reading a new object from the input stream.</p>

  <a name="979810"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1396308"><span style="font-family: monospace">PdiDefineResizing</span></a> function to set the maximum buffer size for reading properties for the address card.</p>

  <a name="979814"> </a><p class="B1Bullet"> &#8226; Repeatedly calls the <a href="PDILib.html#1396737"><span style="font-family: monospace">PdiReadProperty</span></a> function to read properties of the address card. This repeats until <span style="font-family: monospace">PdiReadProperty</span> reads the <span style="font-family: monospace">END:VCard</span> property, which indicates the end of data for the address card.</p>

  <a name="979815"> </a><p class="B1Bullet"> &#8226; For each address card property, calls <a href="PDILib.html#1396792"><span style="font-family: monospace">PdiReadPropertyField</span></a> as required to read the values associated with the property. For example, when it reads the <span style="font-family: monospace">kPdiPRN_N</span> name property, <span style="font-family: monospace">AddrImportVCard</span> calls <span style="font-family: monospace">PdiReadPropertyField</span> twice: once to read the last name, and a second time to read the first name.</p>

  <a name="979820"> </a><p class="B1Bullet"> &#8226; Creates a new address record and adds it to the Address Book database.</p>

  <a name="979821"> </a><p class="B1Bullet"> &#8226; Deallocates memory that it has allocated and performs other cleanup operations.</p>
<p class="Body">
  <a name="979825"> </a>Again, note that <a href="PersonalDataInterchange.html#979739">Listing 3.6</a> only shows the outline of this function. You can find the entire function in the <span style="font-family: monospace">AddressTransfer.c</span> file.
</p>

<h2 class="HaHeadA">
  <a name="979828"> </a>Using a PDI Writer - An Example 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>

<p class="Body">
  <a name="979829"> </a>This section provides an example of writing PDI data from a database record to an output stream. This example is from the <span style="font-family: monospace">ToDoTransfer.c</span> file, which is located inside of the <span style="font-family: monospace">Examples/ToDo/Src</span> folder.
</p>
<p class="Body">
  <a name="979833"> </a><a href="PersonalDataInterchange.html#979865">Listing 3.7</a> shows an example of creating and using a PDI writer. The <span style="font-family: monospace">ToDoSendRecordTryCatch</span> function controls the writing of data from the To Do database to vCal objects by performing the following operations:
</p>

  <a name="979834"> </a><p class="B1Bullet"> &#8226; Calls a local function, <span style="font-family: monospace">LoadPdiLibrary</span>, to load and open the PDI library. The <span style="font-family: monospace">LoadPdiLibrary</span> function is shown in <a href="PersonalDataInterchange.html#979257">Listing 3.2</a>.</p>

  <a name="979841"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397464"><span style="font-family: monospace">PdiWriterNew</span></a> function to create a new PDI writer object that writes to the UDA output stream specified by the <span style="font-family: monospace">media</span> parameter.</p>

  <a name="979846"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1396989"><span style="font-family: monospace">PdiWriteBeginObject</span></a> function to write the <span style="font-family: monospace">BEGIN:VCAL</span> property to the output stream.</p>

  <a name="979850"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397198"><span style="font-family: monospace">PdiWriteProperty</span></a> function to write the <span style="font-family: monospace">VERSION</span> property, and then calls the <a href="PDILib.html#1397392"><span style="font-family: monospace">PdiWritePropertyValue</span></a> function to write the version value.</p>

  <a name="979854"> </a><p class="B1Bullet"> &#8226; Calls the <span style="font-family: monospace">ToDoExportVCal</span> function to write the To Do record, as described in the next section, <a href="PersonalDataInterchange.html#979895">Exporting vCal Data From a Database</a>.</p>

  <a name="979862"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397033"><span style="font-family: monospace">PdiWriteEndObject</span></a> function to write the <span style="font-family: monospace">END:VCAL</span> property to the output stream.</p>

  <a name="979863"> </a><p class="B1Bullet"> &#8226; Deletes the PDI writer object and unloads the PDI library.</p>
<p class="CCodeCaption">
  <a name="979865"> </a>Listing 3.7  Writing a PDI Output Stream
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
static Err ToDoSendRecordTryCatch (DmOpenRef dbP,
        Int16 recordNum, ToDoDBRecordPtr recordP, UDAWriter* media)<a name="979866"> </a>
{<a name="979867"> </a>
   volatile Err error = 0;<a name="979868"> </a>
   UInt16 pdiRefNum;<a name="979869"> </a>
   PdiWriterType* writer;<a name="979870"> </a>
 <a name="979871"> </a>
   if ((error = LoadPdiLibrary(&amp;pdiRefNum)))<a name="979872"> </a>
       return error;<a name="979873"> </a>
   writer = PdiWriterNew(pdiRefNum, media, kPdiPalmCompatibility);<a name="979874"> </a>
   if (writer)<a name="979875"> </a>
      {<a name="979876"> </a>
ErrTry<a name="979877"> </a>
      {<a name="979878"> </a>
         PdiWriteBeginObject(pdiRefNum, writer,
                                                  kPdiPRN_BEGIN_VCALENDAR);<a name="979879"> </a>
         PdiWriteProperty(pdiRefNum, writer, kPdiPRN_VERSION);<a name="979880"> </a>
         PdiWritePropertyValue(pdiRefNum, writer, (Char*)"1.0",
                                         kPdiWriteData);<a name="979881"> </a>
          ToDoExportVCal(dbP, recordNum, recordP, pdiRefNum,
                                 writer, true);<a name="979882"> </a>
          PdiWriteEndObject(pdiRefNum, writer,
                                                         kPdiPRN_END_VCALENDAR);<a name="979883"> </a>
          }<a name="979884"> </a>
ErrCatch(inErr)<a name="979885"> </a>
        {<a name="979886"> </a>
           error = inErr;<a name="979887"> </a>
        } ErrEndCatch<a name="979888"> </a>
         PdiWriterDelete(pdiRefNum, &amp;writer);<a name="979889"> </a>
       }<a name="979890"> </a>
   UnloadPdiLibrary(pdiRefNum);<a name="979891"> </a>
   return error;<a name="979892"> </a>
}<a name="979893"> </a>
</pre><div class="CodeRule"><hr></div>

<h4 class="HCHeadC">
  <a name="979895"> </a>Exporting vCal Data From a Database
</h4>
<p class="Body">
  <a name="979896"> </a>The <span style="font-family: monospace">ToDoExportVCal</span> function exports a vCal record from the To Do database to an output stream. <a href="PersonalDataInterchange.html#979901">Listing 3.8</a> shows the basic outline of the <span style="font-family: monospace">ToDoExportVCal</span> function; you can review the entire function by viewing the <span style="font-family: monospace">ToDoTransfer.c</span> file, which is located inside of the <span style="font-family: monospace">Examples/Address/Src</span> folder.
</p>
<p class="CCodeCaption">
  <a name="979901"> </a>Listing 3.8  Exporting vCal data from a database
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
extern void ToDoExportVCal(DmOpenRef dbP, Int16 index,
ToDoDBRecordPtr recordP, UInt16 pdiRefNum, PdiWriterType* writer,
Boolean writeUniqueIDs)<a name="979902"> </a>
{<a name="979903"> </a>
Char *          note;<a name="979904"> </a>
      UInt32      uid;<a name="979905"> </a>
      Char        tempString[tempStringLengthMax];<a name="979906"> </a>
      UInt16      attr;<a name="979907"> </a>
...<a name="979908"> </a>
 <a name="979909"> </a>
   PdiWriteBeginObject(pdiRefNum, writer, kPdiPRN_BEGIN_VTODO);<a name="979910"> </a>
      // Emit the Category<a name="979911"> </a>
   PdiWriteProperty(pdiRefNum, writer, kPdiPRN_CATEGORIES);<a name="979912"> </a>
      // ...code to create the property string (tempString)<a name="979913"> </a>
   PdiWritePropertyValue(pdiRefNum, writer, tempString, kPdiWriteText);<a name="979914"> </a>
 <a name="979915"> </a>
      // Code to emit the record information, including the:<a name="979916"> </a>
      //   - due date<a name="979917"> </a>
      //   - completed flag<a name="979918"> </a>
      //   - priority value<a name="979919"> </a>
      //   - description text<a name="979920"> </a>
...<a name="979921"> </a>
 <a name="979922"> </a>
 <a name="979923"> </a>
      // Emit the note<a name="979924"> </a>
   if (*note != '\0')<a name="979925"> </a>
   {<a name="979926"> </a>
      PdiWriteProperty(pdiRefNum, writer, kPdiPRN_ATTACH);<a name="979927"> </a>
      PdiWritePropertyValue(pdiRefNum, writer, note, kPdiWriteText);<a name="979928"> </a>
   }<a name="979929"> </a>
 <a name="979930"> </a>
      // Emit an unique id<a name="979931"> </a>
   if (writeUniqueIDs)<a name="979932"> </a>
   {<a name="979933"> </a>
      PdiWriteProperty(pdiRefNum, writer, kPdiPRN_UID);<a name="979934"> </a>
      // Get the record's unique id and append to the string.<a name="979935"> </a>
      DmRecordInfo(dbP, index, NULL, &amp;uid, NULL);<a name="979936"> </a>
      StrIToA(tempString, uid);<a name="979937"> </a>
      PdiWritePropertyValue(pdiRefNum, writer, tempString, kPdiWriteData);<a name="979938"> </a>
   }<a name="979939"> </a>
 <a name="979940"> </a>
   PdiWriteEndObject(pdiRefNum, writer, kPdiPRN_END_VTODO);<a name="979941"> </a>
}<a name="979942"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="979943"> </a>The <span style="font-family: monospace">ToDoExportVCal</span> function performs the following operations:
</p>

  <a name="979947"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1396989"><span style="font-family: monospace">PdiWriteBeginObject</span></a> function to write the <span style="font-family: monospace">BEGIN:VTODO</span> property to the output stream.</p>

  <a name="979951"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397198"><span style="font-family: monospace">PdiWriteProperty</span></a> function to write the category information for the To Do record.</p>

  <a name="979955"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397198"><span style="font-family: monospace">PdiWriteProperty</span></a> function to write other information for the To Do record, including the due date, completed flag, priority value, and description text.</p>

  <a name="979959"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397198"><span style="font-family: monospace">PdiWriteProperty</span></a> function to write the note and again to write a unique ID for the note.</p>

  <a name="979963"> </a><p class="B1Bullet"> &#8226; Calls the <a href="PDILib.html#1397033"><span style="font-family: monospace">PdiWriteEndObject</span></a> function to write the <span style="font-family: monospace">END:VTODO</span> property to the output stream.</p>
<p class="Body">
  <a name="979967"> </a>Again, note that <a href="PersonalDataInterchange.html#979901">Listing 3.8</a> only shows the outline of this function. You can find the entire function in the <span style="font-family: monospace">ToDoTransfer.c</span> file.
</p>

<h2 class="HaHeadA">
  <a name="979970"> </a>Summary of Personal Data Interchange 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>


<h5 class="TgTable">
  <a name="980094"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="979973"> </a><div class="CellHeading">PDI Library Functions</div></th>
    <th><a name="979975"> </a><div class="CellHeading"><br></div></th>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="979977"> </a><div class="CellHeading">Library Open and Close</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979984"> </a><div class="CellBody"><a href="PDILib.html#1396434"><span style="font-family: monospace">PdiLibClose</span></a></div></td>
    <td><a name="979989"> </a><div class="CellBody"><a href="PDILib.html#1396463"><span style="font-family: monospace">PdiLibOpen</span></a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="979991"> </a><div class="CellHeading">Object Creation and Deletion</div></td>
  </tr>
  <tr valign="top">
    <td><a name="979998"> </a><div class="CellBody"><a href="PDILib.html#1396664"><span style="font-family: monospace">PdiReaderNew</span></a><br><a href="PDILib.html#1396635"><span style="font-family: monospace">PdiReaderDelete</span></a></div></td>
    <td><a name="980006"> </a><div class="CellBody"><a href="PDILib.html#1397464"><span style="font-family: monospace">PdiWriterNew</span></a><br><a href="PDILib.html#1397435"><span style="font-family: monospace">PdiWriterDelete</span></a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="980011"> </a><div class="CellBody">Property Reading</div></td>
  </tr>
  <tr valign="top">
    <td><a name="980018"> </a><div class="CellBody"><a href="PDILib.html#1396308"><span style="font-family: monospace">PdiDefineResizing</span></a><br><a href="PDILib.html#1396402"><span style="font-family: monospace">PdiEnterObject</span></a><br><a href="PDILib.html#1396601"><span style="font-family: monospace">PdiParameterPairTest</span></a><br><a href="PDILib.html#1396701"><span style="font-family: monospace">PdiReadParameter</span></a></div></td>
    <td><a name="980032"> </a><div class="CellBody"><a href="PDILib.html#1396737"><span style="font-family: monospace">PdiReadProperty</span></a><br><a href="PDILib.html#1396792"><span style="font-family: monospace">PdiReadPropertyField</span></a><br><a href="PDILib.html#1396854"><span style="font-family: monospace">PdiReadPropertyName</span></a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="980040"> </a><div class="CellBody">Property Writing</div></td>
  </tr>
  <tr valign="top">
    <td><a name="980047"> </a><div class="CellBody"><a href="PDILib.html#1396917"><span style="font-family: monospace">PdiSetCharset</span></a><br><a href="PDILib.html#1396955"><span style="font-family: monospace">PdiSetEncoding</span></a><br><a href="PDILib.html#1396989"><span style="font-family: monospace">PdiWriteBeginObject</span></a><br><a href="PDILib.html#1397033"><span style="font-family: monospace">PdiWriteEndObject</span></a><br><a href="PDILib.html#1397077"><span style="font-family: monospace">PdiWriteParameter</span></a></div></td>
    <td><a name="980064"> </a><div class="CellBody"><a href="PDILib.html#1397151"><span style="font-family: monospace">PdiWriteParameterStr</span></a><br><a href="PDILib.html#1397198"><span style="font-family: monospace">PdiWriteProperty</span></a><br><a href="PDILib.html#1397252"><span style="font-family: monospace">PdiWritePropertyBinaryValue</span></a><br><a href="PDILib.html#1397297"><span style="font-family: monospace">PdiWritePropertyFields</span></a><br><a href="PDILib.html#1397338"><span style="font-family: monospace">PdiWritePropertyStr</span></a><br><a href="PDILib.html#1397392"><span style="font-family: monospace">PdiWritePropertyValue</span></a></div></td>
  </tr>
  <tr valign="top">
    <td colspan="2" rowspan="1"><a name="980081"> </a><div class="CellBody">Property Dictionary</div></td>
  </tr>
  <tr valign="top">
    <td><a name="980088"> </a><div class="CellBody"><a href="PDILib.html#1396284"><span style="font-family: monospace">PdiDefineReaderDictionary</span></a></div></td>
    <td><a name="980093"> </a><div class="CellBody"><a href="PDILib.html#1396378"><span style="font-family: monospace">PdiDefineWriterDictionary</span></a></div></td>
  </tr>
</table>




</h5>
<h2 class="HaHeadA">
  <a name="980095"> </a>Summary of Unified Data Access Manager 
<a href="#978818"><img src="images/top.gif" border="0"></a></h2>


<h5 class="TgTable">
  <a name="980150"> </a>

<table border="1" cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th colspan="2" rowspan="1"><a name="980099"> </a><div class="CellHeading">UDA Manager Functions</div></th>
  </tr>
  <tr valign="top">
    <td><a name="980106"> </a><div class="CellBody"><a href="UDAMgr.html#1400636"><span style="font-family: monospace">UDAControl</span></a><br><a href="UDAMgr.html#1400710"><span style="font-family: monospace">UDADelete</span></a><br><a href="UDAMgr.html#1400745"><span style="font-family: monospace">UDAEndOfReader</span></a><br><a href="UDAMgr.html#1400768"><span style="font-family: monospace">UDAFilterJoin</span></a><br><a href="UDAMgr.html#1400801"><span style="font-family: monospace">UDAInitiateWrite</span></a></div></td>
    <td><a name="980123"> </a><div class="CellBody"><a href="UDAMgr.html#1400830"><span style="font-family: monospace">UDAMoreData</span></a><br><a href="UDAMgr.html#1400856"><span style="font-family: monospace">UDARead</span></a><br><a href="UDAMgr.html#1400913"><span style="font-family: monospace">UDAWriterFlush</span></a><br><a href="UDAMgr.html#1400952"><span style="font-family: monospace">UDAWriterJoin</span></a></div></td>
  </tr>
  <tr valign="top">
    <td><a name="980134"> </a><div class="CellHeading">Object Creation</div></td>
    <td><a name="980136"> </a><div class="CellBody"><br></div></td>
  </tr>
  <tr valign="top">
    <td><a name="980141"> </a><div class="CellBody"><a href="UDAMgr.html#1401001"><span style="font-family: monospace">UDAExchangeReaderNew</span></a><br><a href="UDAMgr.html#1401035"><span style="font-family: monospace">UDAExchangeWriterNew</span></a></div></td>
    <td><a name="980149"> </a><div class="CellBody"><a href="UDAMgr.html#1401067"><span style="font-family: monospace">UDAMemoryReaderNew</span></a></div></td>
  </tr>
</table>




</h5>
&nbsp;<br>
				<!-- CONTENT_END -->

		</td>
		<td width="5">&nbsp;&nbsp;</td>
	</tr>
      </table>
    </td>
			</tr>
  <tr>
				<td>
					<table border="0" cellpadding="0" cellspacing="0" width="760">
        <!-- CONTENTCELL_END -->
        <tr valign="top"> 
          <td width="10">&nbsp;<!-- FOOTER_START --></td>
          <td width="72">&nbsp;</td>
          <td width="25" bgcolor="white" background="images/bkgrnd.gif">&nbsp;</td>
          <td width="600"> 
            <table border="0" cellpadding="0" cellspacing="0" width="600">
              <tr> 
                <td><img src="images/rule_10-1-5_ltblue.gif" width="600" height="16" border="0"></td>
              </tr>
              <tr> 
                <td> 
                  <p align="center" class="footer"> ©2002 PalmSource, Inc. and its affiliates.  All rights reserved. 
<a href="http://www.palmos.com/dev/training/">Training</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a>&nbsp;|&nbsp;<a href="http://www.palmos.com/">Palm&nbsp;OS&nbsp;Platform</a>&nbsp;|&nbsp;<a href="Companion2Front.html" target="_blank">Legal Notices</a>&nbsp;<br>
												<!-- FOOTER_END --><br>
											</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
				</td>
			</tr>
</table>
</BODY>
</HTML>