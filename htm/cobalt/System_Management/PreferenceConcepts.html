<html>
<head>
<title>(Protein) Preferences | System Management</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:27:11">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="608590"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SysMgt_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Features.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Sound.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SysMgt_IX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">3 &nbsp;&nbsp;
Preferences</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">System Management</p>
<p class="SubTitle">Exploring Palm OS&#174; </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="SysMgt_Part1.html">Part I: Concepts</a> </h1>
<h1 class="SideTOC1"><a href="PreferenceConcepts.html">3  Preferences</a></h1>

   <h2 class="SideTOC2"><a href="#992911">
   Accessing System Preferences</a></h2>

   <h2 class="SideTOC2"><a href="#993001">
   Setting System Preferences</a></h2>

   <h2 class="SideTOC2"><a href="#993020">
   Setting Application-Specific Preferences</a></h2>

      <h3 class="SideTOC3"><a href="#993048">
      When to Use Application Preferences</a></h3>

      <h3 class="SideTOC3"><a href="#993064">
      How to Store Preferences</a></h3>

      <h3 class="SideTOC3"><a href="#993074">
      Which Preferences Database to Use</a></h3>

      <h3 class="SideTOC3"><a href="#993154">
      Updating Preferences Upon a New Release</a></h3>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="992894"> </a>The Preferences Manager handles both system-wide preferences and application-specific preferences. The Preferences Manager maintains preferences in two separate databases: </p>
<ul type="disc">
  <li><a name="992895"> </a>The "saved" preferences database contains preferences that are backed up during a HotSync operation. There is one "saved" preferences database that all applications use. This database contains all system-wide preferences as well as application-specific preferences. 
  <li><a name="992896"> </a>The "unsaved" preferences database contains application-specific preferences that are not to be backed up during a HotSync operation. There is one "unsaved" preferences database that all application use. 
</ul>

<p><a name="992897"> </a>This section describes how to obtain and set values for each of these preferences databases. It covers: </p>
<ul type="disc">
  <li><a name="992901"> </a><a href="PreferenceConcepts.html#992911">Accessing System Preferences</a>
  <li><a name="992905"> </a><a href="PreferenceConcepts.html#993001">Setting System Preferences</a>
  <li><a name="992909"> </a><a href="PreferenceConcepts.html#993020">Setting Application-Specific Preferences</a>
</ul>

<h2 class="haH2">
  <a name="992911"> </a>Accessing System Preferences <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="992912"> </a>The system preferences specify how users want their Palm Powered<sup>&#8482;</sup> handhelds to behave. For example, system preferences specify how dates and times are displayed and whether the system plays a sound when an alarm fires. These values are typically set using the built-in Preferences or Security application. Applications should, as a rule, respect the values stored in the system preferences. </p>

<p><a name="992913"> </a>To obtain the value of a system preference, use the <a href="Preferences.html#994111"><code>PrefGetPreference()</code></a> function and pass one of the <a href="Preferences.html#1020510"><code>SystemPreferencesChoice</code></a> enum constants. For example, if an application's user interface displays the current date and time, it could do the following to find out how the user wants the date and time displayed: </p>
<a name="992922"> </a>
TimeFormatType timeFormat = (TimeFormatType)<a name="996182"> </a>
   PrefGetPreference(prefTimeFormat);<a name="992923"> </a>
DateFormatType dateFormat = (DateFormatType)<a name="992924"> </a>
   PrefGetPreference(prefDateFormat);<a name="992925"> </a>
<a name="996183"> </a>

<p><a name="992927"> </a>Note that the <code>PrefGetPreference</code> function by default returns a <code>uint32_t</code> value. This return value must be cast to the appropriate type for the preference being returned. </p>

<p><a name="992928"> </a>Also note that the system preferences structure has been updated many times and maintains its own version information. Each Palm OS release that modifies the system preferences structure adds its new values to the end and increments the structure's version number. Palm OS Cobalt supports version 11 and earlier preferences; see the documentation on <a href="Preferences.html#1020510"><code>SystemPreferencesChoice</code></a> for more information.</p>

<h2 class="haH2">
  <a name="993001"> </a>Setting System Preferences <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="993002"> </a>Occasionally, an application may need to set the value of a system-wide preference. It is strongly recommended that you not override the system preferences without user input. </p>

<p><a name="993003"> </a>For example, suppose you are writing a replacement for the built-in Address Book application. The Preferences application contains a panel where the user can remap the Address Book hard key to open any application they choose. However, you want to make it more convenient for your users to remap the Address Book button, so you might display an alert that asks first-time users if they want the button remapped. If they tap Yes, then you should call <a href="Preferences.html#994532"><code>PrefSetPreference()</code></a> with the new value. The code might look like the following: </p>
<p class="CCodeCaption">
  <a name="993007"> </a><b>Listing 3.1&nbsp;&nbsp;Setting a system preference</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
if (PrefGetPreference(prefHard2CharAppCreator != <a name="993008"> </a>
      myAppCreatorId)) {<a name="993009"> </a>
   if (FrmAlert(MakeMeTheDefaultAlert) == 0) { <a name="993010"> </a>
      /* user pressed Yes */<a name="993011"> </a>
      PrefSetPreference(prefHard2CharAppCreator, <a name="993012"> </a>
         myAppCreatorId);<a name="993013"> </a>
   }<a name="993014"> </a>
}<a name="993015"> </a>
</pre><div class="CodeRule"><hr></div>


<h4 class="hcH4">
  <a name="993308"> </a>Preferences in the User Interface
</h4>

<p><a name="993313"> </a><a href="PreferenceConcepts.html#993323">Table 3.1</a> shows the <code>SystemPreferencesChoice</code> constants and how they correspond to the values that users can set in the Preferences and Security applications. For further information about each preference, see the <a href="Preferences.html#1020510"><code>SystemPreferencesChoice</code></a> enum documentation.</p>

<p class="caption"><a name="993323"> </a><b>Table 3.1&nbsp;&nbsp;Preferences set in Preferences and Security apps </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="993329"> </a><b>Application/Panel </b></p>
    </th>
    <th><p class="tt"><a name="993331"> </a><b>Field</b></p>
    </th>
    <th><p class="tt"><a name="993333"> </a><b>SystemPreferencesChoice Constant</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="8"><p class="tt"><a name="993335"> </a>Preferences application </p>
<p class="tt"><a name="993336"> </a>General panel </p>
    </td>
    <td><p class="tt"><a name="993338"> </a>Auto-off After </p>
    </td>
    <td><p class="tt"><a name="993340"> </a><code>prefAutoOffDuration</code>, <code>prefAutoOffDurationSecs</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993344"> </a>Stay on in Cradle</p>
    </td>
    <td><p class="tt"><a name="993346"> </a><code>prefStayOnWhenPluggedIn</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993350"> </a>System Sound </p>
    </td>
    <td><p class="tt"><a name="993352"> </a><code>prefSysSoundLevelV20</code>, <code>prefSysSoundVolume</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993356"> </a>Alarm Sound</p>
    </td>
    <td><p class="tt"><a name="993358"> </a><code>prefAlarmSoundLevelV20</code>, <code>prefAlarmSoundVolume</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993365"> </a>Alarm Vibrate<a href="#993364"><sup>1</sup></a></p>
    </td>
    <td><p class="tt"><a name="993367"> </a><code>prefAttentionFlags</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993371"> </a>Alarm LED<sup>1</sup></p>
    </td>
    <td><p class="tt"><a name="993373"> </a><code>prefAttentionFlags</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993377"> </a>Game Sound</p>
    </td>
    <td><p class="tt"><a name="993379"> </a><code>prefGameSoundLevelV20</code>, <code>prefGameSoundVolume</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993383"> </a>Beam Receive field</p>
    </td>
    <td><p class="tt"><a name="993385"> </a><code>prefBeamReceive</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993387"> </a></p>
    </td>
    <td><p class="tt"><a name="993389"> </a></p>
    </td>
    <td><p class="tt"><a name="993391"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="2"><p class="tt"><a name="993393"> </a>Preferences application Date &amp; Time panel </p>
    </td>
    <td><p class="tt"><a name="993395"> </a>Set Time Zone field</p>
    </td>
    <td><p class="tt"><a name="993397"> </a><code>prefTimeZone </code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993401"> </a>Daylight Saving</p>
    </td>
    <td><p class="tt"><a name="993403"> </a><code>prefDaylightSaving<br>Adjustment</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993405"> </a></p>
    </td>
    <td><p class="tt"><a name="993407"> </a></p>
    </td>
    <td><p class="tt"><a name="993409"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="5"><p class="tt"><a name="993411"> </a>Preferences application </p>
<p class="tt"><a name="993412"> </a>Formats panel </p>
    </td>
    <td><p class="tt"><a name="993414"> </a>Preset to </p>
    </td>
    <td><p class="tt"><a name="993416"> </a><code>prefCountry68K</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993420"> </a>Time </p>
    </td>
    <td><p class="tt"><a name="993422"> </a><code>prefTimeFormat</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993426"> </a>Date </p>
    </td>
    <td><p class="tt"><a name="993428"> </a><code>prefDateFormat</code>, <code>prefLongDateFormat</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993432"> </a>Week starts </p>
    </td>
    <td><p class="tt"><a name="993434"> </a><code>prefWeekStartDay</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993438"> </a>Numbers </p>
    </td>
    <td><p class="tt"><a name="993440"> </a><code>prefNumberFormat</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="3"><p class="tt"><a name="993442"> </a>Preferences application Buttons panel </p>
<p class="tt"><a name="993443"> </a> </p>
    </td>
    <td><p class="tt"><a name="993445"> </a>Buttons on main panel</p>
    </td>
    <td><p class="tt"><a name="993447"> </a><code>prefHard1CharAppCreator</code>, <code>prefHard2CharAppCreator</code>, <code>prefHard3CharAppCreator</code>, <code>prefHard4CharAppCreator</code>, <code>prefCalcCharAppCreator</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993451"> </a>Pen button </p>
    </td>
    <td><p class="tt"><a name="993453"> </a><code>prefRonamaticChar</code> </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993457"> </a>HotSync button </p>
    </td>
    <td><p class="tt"><a name="993459"> </a><code>prefHardCradleCharApp<br>Creator<br>prefHardCradle2CharApp<br>Creator</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994188"> </a></p>
    </td>
    <td><p class="tt"><a name="994190"> </a></p>
    </td>
    <td><p class="tt"><a name="994192"> </a></p>
    </td>
  </tr>
  <tr valign="top">
    <td colspan="1" rowspan="3"><p class="tt"><a name="994194"> </a>Security application </p>
    </td>
    <td><p class="tt"><a name="994196"> </a>Auto Lock Handheld</p>
    </td>
    <td><p class="tt"><a name="994198"> </a><code>prefAutoLockType</code>, <code>prefAutoLockTime</code>, <code>prefAutoLockTimeFlag</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993469"> </a>Current Security</p>
    </td>
    <td><p class="tt"><a name="993471"> </a><code>prefHidePrivateRecordsV33</code>, <code>prefShowPrivateRecords</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993481"> </a>Lock &amp; Turn Off... button</p>
    </td>
    <td><p class="tt"><a name="993483"> </a><code>prefDeviceLocked</code></p>
    </td>
  </tr>
</table>
<div class="tablediv"><table cellspacing="0" class="tTableNR">
   <tr>
     <td><div class="FNTFootnoteTable">
<a name="993364"> </a><a href="#993365">1</a>. The Alarm Vibrate and Alarm LED preferences only appear on handhelds that have the appropriate hardware capabilities. </div>
</td>
   </tr>
</table></div>

</div>


<h2 class="haH2">
  <a name="993020"> </a>Setting Application-Specific Preferences <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="993021"> </a>You can use the Preferences Manager to set and retrieve preferences specific to your application. You do this by storing the preferences in one of two databases: the "saved" preferences database or the "unsaved" preferences database. </p>

<p><a name="993022"> </a>To write application preferences, you use <a href="Preferences.html#994427"><code>PrefSetAppPreferences()</code></a>. To read them back in, you use <a href="Preferences.html#994053"><code>PrefGetAppPreferences()</code></a>. Typically, you write the preferences in response to the <code>appStopEvent</code> when control is about to pass to another application. You read the preferences in response to a normal launch. </p>

<p><a name="993029"> </a><code>PrefSetAppPreferences()</code> and <code>PrefGetAppPreferences()</code> take roughly the same parameters: the application creator ID, a preference ID that uniquely identifies this preference resource, a pointer to a structure that holds the preference values, the size of the preferences structure, and a Boolean that indicates whether the "saved" or the "unsaved" preferences database is to be used. <code>PrefSetAppPreferences()</code> also takes a version number for the preference structure. This value is the return value for <code>PrefGetAppPreferences()</code>. </p>

<p><a name="993030"> </a>The following sections discuss the issues involved in using application-specific preferences:</p>
<ul type="disc">
  <li><a name="993034"> </a><a href="PreferenceConcepts.html#993048">When to Use Application Preferences</a>
  <li><a name="993038"> </a><a href="PreferenceConcepts.html#993064">How to Store Preferences</a>
  <li><a name="993042"> </a><a href="PreferenceConcepts.html#993074">Which Preferences Database to Use</a>
  <li><a name="993046"> </a><a href="PreferenceConcepts.html#993154">Updating Preferences Upon a New Release</a>
</ul>
<h3 class="hbH3">
  <a name="993048"> </a>When to Use Application Preferences <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="993049"> </a>You use application preferences to store state specific to your application that should persist across invocations of your application. For example, the built-in applications store information about the last form and the last record or records displayed before control is switched to another application. This way, the user can be returned to the same view when he or she goes back to that application. </p>

<p><a name="993050"> </a>You can also use preferences for other values. You might allow the user to customize the way the application behaves and store such information in the preferences database. You might also use the preferences database as a way to share information with other applications. </p>

<p><a name="993051"> </a>Make sure that the preference values you choose are as concise as possible. In games, for example, it is often tempting to store a bitmap for the current state of the screen. Such a bitmap is over 25KB on a color handheld, and it is therefore best avoided. Instead, it is better to store items that let you recreate the current state, such as the player's position in pixels and the current level. </p>

<p><a name="993052"> </a>There are other ways to store values pertinent to your application. For example, you can store a single value as a feature using the <a href="FeatureMgr.html#992934">Feature Manager</a>. Note, however, that preferences (including those stored in the "unsaved" database) survive a soft reset because they reside in the storage heap. Features are deleted upon a soft reset. For this reason, preferences are more appropriate for storing application state than feature are.</p>

<p><a name="993059"> </a>Instead of storing application state values as preferences or features, you could also use a database that your application creates and maintains itself. If you choose this method of storing application preference values, you must write your own functions to read the preferences from the database and write the preferences to the database. If you want the preferences backed up, you need to set the backup bit. However, there may be cases where using your own database has advantages. See <a href="PreferenceConcepts.html#993074">"Which Preferences Database to Use"</a>. </p>
<h3 class="hbH3">
  <a name="993064"> </a>How to Store Preferences <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="993065"> </a>Most applications store a single preference structure under a single preference resource ID. When the application receives an <code>appStopEvent</code>, it writes the entire structure to the resource using <a href="Preferences.html#994427"><code>PrefSetAppPreferences()</code></a>. When it receives a <code>sysAppLaunchCmdNormalLaunch</code>, it reads the structure back in using <a href="Preferences.html#994053"><code>PrefGetAppPreferences()</code></a>. </p>

<p><a name="993072"> </a>Storing a single preference structure in the database is a convention that most applications follow because it is convenient to access the all preferences at once. Your application can store more than one preference resource, if you prefer. This requires more calls to <code>PrefSetAppPreferences()</code> and <code>PrefGetAppPreferences()</code>, but you may find it more convenient to use several preference resources if you have several variable-length preferences. </p>
<h3 class="hbH3">
  <a name="993074"> </a>Which Preferences Database to Use <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="993081"> </a>Both <a href="Preferences.html#994053"><code>PrefGetAppPreferences()</code></a> and <a href="Preferences.html#994427"><code>PrefSetAppPreferences()</code></a> take a boolean value that indicates whether the value is to be read from and written to the "saved" or the "unsaved" preferences database. To write the preference to the "saved" preferences database, set this boolean value to <code>true</code>. To write to the "unsaved" preferences database, set it to <code>false</code>. </p>

<p><a name="993082"> </a>The only difference between the two databases is that the "saved" preferences database is backed up when a user performs a HotSync operation, while the "unsaved" preferences database is not backed up by default. (The user can use a third-party tool to set the backup bit in the "unsaved" preferences database, which would cause it to be backed up.) Both the "saved" and the "unsaved" preferences reside in the storage heap and thus persist across soft resets. The only way that preferences are lost is if a hard reset is performed. </p>

<p><a name="993083"> </a>Use the "saved" preferences only for items that must be restored after a hard reset, and use the "unsaved" preferences for the current state of the application. For example, if your application has a registration code, you might write that to the "saved" preferences database so that the user does not have to look up the registration code and re-enter it after a hard reset. However, the loss of such items as the current form being displayed and the current database record being displayed isn't devastating, so they are written to the "unsaved" preferences database. For games, you might write the high score to the "saved" preferences database and any information about the current game to the "unsaved" preferences database. </p>

<p><a name="993084"> </a>It is important to use the "saved" preferences database sparingly. Any time that any application stores or changes a preference in the "saved" preferences database, the <b>entire</b> database is backed up during the next HotSync operation. For users with a large number of applications, this practice can potentially impact the amount of time that it takes to perform a HotSync operation. </p>

<p><a name="994135"> </a><a href="PreferenceConcepts.html#994138">Listing 3.2</a> shows the preferences structures and the <code>StopApplication</code> function from the HardBall application. The <code>HardBallPreferenceType</code>, which is written to the "saved" preferences database, only stores the high score information and accumulated time. All other preferences are stored in <code>GameStatusType</code>, which is written to the "unsaved" preferences database.</p>
<p class="CCodeCaption">
  <a name="994138"> </a><b>Listing 3.2&nbsp;&nbsp;Saving application-specific preferences</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct {<a name="994139"> </a>
   SavedScore highScore[highScoreMax];<a name="993092"> </a>
   uint8_t lastHighScore;<a name="993093"> </a>
   uint8_t startLevel;<a name="993094"> </a>
   uint32_t  accumulatedTime;<a name="993095"> </a>
} HardBallPreferenceType;<a name="993096"> </a>
 <a name="993097"> </a>
typedef struct {<a name="993098"> </a>
   enum gameProgress  status;<a name="993099"> </a>
   uint8_t  periodLength;<a name="993100"> </a>
   uint32_t nextPeriodTime;<a name="993101"> </a>
   uint32_t periodsToWait;<a name="993102"> </a>
   Boolean  paused;<a name="993103"> </a>
   uint32_t  pausedTime;<a name="993104"> </a>
   BrickType  brick[rowsOfBricks][columnsOfBricks];<a name="993105"> </a>
   uint8_t  bricksRemaining;<a name="993106"> </a>
   uint8_t level;<a name="993107"> </a>
   WorldState last;<a name="993108"> </a>
   WorldState next;<a name="993109"> </a>
   RemovedBrick brokenBricks[brokenBricksMax];<a name="993110"> </a>
   int16_t  brokenBricksCount;<a name="993111"> </a>
   uint8_t ballsRemaining;<a name="993112"> </a>
   Boolean movePaddleLeft;<a name="993113"> </a>
   Boolean movePaddleRight;<a name="993114"> </a>
   SoundType  soundToMake;<a name="993115"> </a>
   int8_t  soundPeriodsRemaining;<a name="993116"> </a>
   int32_t  scoreToAwardBonusBall;<a name="993117"> </a>
   Boolean lowestHighScorePassed;<a name="993118"> </a>
   Boolean highestHighScorePassed;<a name="993119"> </a>
   Boolean gameSpedUp;<a name="993120"> </a>
   Boolean  cheatMode;<a name="993121"> </a>
   uint32_t startTime;<a name="993122"> </a>
} GameStatusType;<a name="993123"> </a>
 <a name="993124"> </a>
HardBallPreferenceType Prefs;<a name="993125"> </a>
static GameStatusType GameStatus;<a name="993126"> </a>
 <a name="993127"> </a>
static void StopApplication (void)<a name="993128"> </a>
{<a name="993129"> </a>
   ...<a name="993130"> </a>
   // Update the time accounting.<a name="993131"> </a>
   Prefs.accumulatedTime += (TimGetTicks() - <a name="993132"> </a>
      GameStatus.startTime);<a name="993133"> </a>
   <a name="993134"> </a>
   // If we are saving a game resuming (it hasn't started <a name="993135"> </a>
   // playing yet) then preserve the game status.<a name="993136"> </a>
   if (GameStatus.status == gameResuming) {<a name="993137"> </a>
      GameStatus.status = SavedGameStatus;<a name="993138"> </a>
   }<a name="993139"> </a>
   <a name="993140"> </a>
   // Save state/prefs.<a name="993141"> </a>
   PrefSetAppPreferences (appFileCreator, appPrefID, <a name="993142"> </a>
      appPrefVersion, &amp;Prefs, sizeof (Prefs), true);<a name="993143"> </a>
   <a name="993144"> </a>
   PrefSetAppPreferences (appFileCreator, appSavedGameID, <a name="993145"> </a>
      appSavedGameVersion, &amp;GameStatus, sizeof (GameStatus), <a name="993146"> </a>
      false);<a name="993147"> </a>
      <a name="993148"> </a>
   // Close all the open forms.<a name="993149"> </a>
   FrmCloseAllForms ();<a name="993150"> </a>
}<a name="993151"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="993152"> </a>If you have a large amount of preference data that must be backed up during a HotSync operation and is frequently changed, you could, as a performance optimization, store the preferences in a database that your own application creates and maintains rather than in the "saved" preferences database. This saves the user from having to have the entire "saved" preferences database backed up on every HotSync operation. The disadvantage of this technique is that you must write all code to maintain the database and to retrieve information from it. </p>
<h3 class="hbH3">
  <a name="993154"> </a>Updating Preferences Upon a New Release <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="993155"> </a>When you update your application, you may have new items that you want to store in the preferences database. You may choose to write a separate preference record to the database. However, it is better to update the current preference structure, size permitting. </p>

<p><a name="993162"> </a>The <a href="Preferences.html#994427"><code>PrefSetAppPreferences()</code></a> and <a href="Preferences.html#994053"><code>PrefGetAppPreferences()</code></a> functions use a versioning system that allows you to update an existing preference structure. To use it, keep track of the version number that you pass to <code>PrefSetAppPreferences()</code>. Add any new preferences to the end of the preferences structure, and then increment the version number. You might use a macro for this purpose: </p>
<a name="993163"> </a>
#define CurrentPrefsVersion 2<a name="996224"> </a>

<p><a name="993164"> </a>When a user launches the new version of the application, <code>PrefGetAppPreferences()</code> is called before <code>PrefSetAppPreferences()</code>. The <code>PrefGetAppPreferences()</code> function returns the version number of the preference structure that it retrieved from the database. For example, if the new version is version 2, <code>PrefGetAppPreferences()</code> returns 1 the first time that version 2 of the application is run. If the returned version does not match the current version, you know that the user does not have values for the new preferences introduced in version 2. You can then decide to provide default values for those new preferences. </p>

<p><a name="993165"> </a>The first time any version of your application is run, <code>PrefGetAppPreferences()</code> returns <code>noPreferenceFound</code>. This indicates that the user does not have any preferences for the current application and the application must supply default values for the entire preferences structure. <a href="PreferenceConcepts.html#993170">Listing 3.3</a> shows how the Datebook handles retrieving the version number from <code>PrefGetAppPreferences()</code>.</p>
<p class="CCodeCaption">
  <a name="993170"> </a><b>Listing 3.3&nbsp;&nbsp;Checking the preference version number</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define datebookPrefsVersionNum 4<a name="993171"> </a>
 <a name="993172"> </a>
int16_t DatebookLoadPrefs (DatebookPreferenceType* prefsP)<a name="993173"> </a>
{<a name="993174"> </a>
   uint16_t prefsSize;<a name="993175"> </a>
   int16_t prefsVersion = noPreferenceFound;<a name="993176"> </a>
   Boolean haveDefaultFont = false;<a name="993177"> </a>
   uint32_t defaultFont;<a name="993178"> </a>
   <a name="993179"> </a>
   ErrNonFatalDisplayIf(!prefsP, "null prefP arg");<a name="993180"> </a>
   <a name="993181"> </a>
   <a name="993182"> </a>
   // Read the preferences / saved-state information.  Fix-up if no prefs or <a name="993183"> </a>
   // older/newer version<a name="993184"> </a>
   prefsSize = sizeof (DatebookPreferenceType);<a name="993185"> </a>
   prefsVersion = PrefGetAppPreferences (sysFileCDatebook, datebookPrefID, <a name="993186"> </a>
      prefsP, &amp;prefsSize, true);<a name="993187"> </a>
   <a name="993188"> </a>
   // If the preferences version is from a future release (as can happen when <a name="993189"> </a>
   // going back and syncing to an older version of the device), treat it the <a name="993190"> </a>
   // same as "not found" because it could be significantly different<a name="993191"> </a>
   if ( prefsVersion &gt; datebookPrefsVersionNum )<a name="993192"> </a>
      prefsVersion = noPreferenceFound;<a name="993193"> </a>
   <a name="993194"> </a>
   if ( prefsVersion == noPreferenceFound ) {<a name="993195"> </a>
      // Version 1 and 2 preferences<a name="993196"> </a>
      prefsP-&gt;dayStartHour = defaultDayStartHour;<a name="993197"> </a>
      prefsP-&gt;dayEndHour = defaultDayEndHour;<a name="993198"> </a>
      prefsP-&gt;alarmPreset.advance = defaultAlarmPresetAdvance;<a name="993199"> </a>
      prefsP-&gt;alarmPreset.advanceUnit = defaultAlarmPresetUnit;<a name="993200"> </a>
      prefsP-&gt;saveBackup = defaultSaveBackup;<a name="993201"> </a>
      prefsP-&gt;showTimeBars = defaultShowTimeBars;<a name="993202"> </a>
      prefsP-&gt;compressDayView = defaultCompressDayView;<a name="993203"> </a>
      prefsP-&gt;showTimedAppts = defaultShowTimedAppts;<a name="993204"> </a>
      prefsP-&gt;showUntimedAppts = defaultShowUntimedAppts;<a name="993205"> </a>
      prefsP-&gt;showDailyRepeatingAppts = <a name="993206"> </a>
         defaultShowDailyRepeatingAppts;<a name="993207"> </a>
 <a name="993208"> </a>
      // We need to set up the note font with a default value for the system.<a name="993209"> </a>
      FtrGet(sysFtrCreator, sysFtrDefaultFont, &amp;defaultFont);<a name="993210"> </a>
      haveDefaultFont = true;<a name="993211"> </a>
      <a name="993212"> </a>
      prefsP-&gt;v20NoteFont = (FontID)defaultFont;<a name="993213"> </a>
   }<a name="993214"> </a>
   <a name="993215"> </a>
   if ((prefsVersion == noPreferenceFound) || (prefsVersion &lt; <a name="993216"> </a>
         datebookPrefsVersionNum)) {<a name="993217"> </a>
      // Version 3 preferences<a name="993218"> </a>
      prefsP-&gt;alarmSoundRepeatCount = defaultAlarmSoundRepeatCount;<a name="993219"> </a>
      prefsP-&gt;alarmSoundRepeatInterval = defaultAlarmSoundRepeatInterval;<a name="993220"> </a>
      prefsP-&gt;alarmSoundUniqueRecID = defaultAlarmSoundUniqueRecID;<a name="993221"> </a>
      prefsP-&gt;noteFont = prefsP-&gt;v20NoteFont;<a name="993222"> </a>
      <a name="993223"> </a>
      // Fix up the note font if we copied from older preferences.<a name="993224"> </a>
      if ((prefsVersion != noPreferenceFound) &amp;&amp; (prefsP-&gt;noteFont == <a name="993225"> </a>
            largeFont))<a name="993226"> </a>
         prefsP-&gt;noteFont = largeBoldFont;<a name="993227"> </a>
      <a name="993228"> </a>
      if (!haveDefaultFont)<a name="993229"> </a>
         FtrGet(sysFtrCreator, sysFtrDefaultFont, &amp;defaultFont);<a name="993230"> </a>
      <a name="993231"> </a>
      prefsP-&gt;apptDescFont = (FontID)defaultFont;<a name="993232"> </a>
   }<a name="993233"> </a>
   <a name="993234"> </a>
   if ((prefsVersion == noPreferenceFound) || (prefsVersion &lt; <a name="993235"> </a>
         datebookPrefsVersionNum)) {<a name="993236"> </a>
      // Version 4 preferences<a name="993237"> </a>
      prefsP-&gt;alarmSnooze = defaultAlarmSnooze;<a name="993238"> </a>
   }<a name="993239"> </a>
   <a name="993240"> </a>
   return prefsVersion;<a name="993241"> </a>
}<a name="993242"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="986245"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="SysMgt_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SysMgt_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Features.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Sound.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SysMgt_IX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>