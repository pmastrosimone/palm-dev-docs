<html>
<head>
<title>(Protein) Attentions and Alarms | System Management</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:26:37">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="1009989"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SysMgt_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SysMgt_Part1.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Features.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SysMgt_IX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">1 &nbsp;&nbsp;
Attentions and Alarms</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">System Management</p>
<p class="SubTitle">Exploring Palm OS&#174; </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="SysMgt_Part1.html">Part I: Concepts</a> </h1>
<h1 class="SideTOC1"><a href="AttnsAndAlarms.html">1  Attentions and Alarms</a></h1>

   <h2 class="SideTOC2"><a href="#1010001">
   Getting the User's Attention</a></h2>

      <h3 class="SideTOC3"><a href="#1010004">
      The Role of the Attention Manager</a></h3>

      <h3 class="SideTOC3"><a href="#1010024">
      Attention Manager Operation</a></h3>

      <h3 class="SideTOC3"><a href="#1010100">
      Getting the User's Attention</a></h3>

      <h3 class="SideTOC3"><a href="#1010344">
      Attentions and Alarms</a></h3>

      <h3 class="SideTOC3"><a href="#1010377">
      Detecting and Updating Pending Attentions</a></h3>

      <h3 class="SideTOC3"><a href="#1010434">
      Detecting Device Capabilities</a></h3>

      <h3 class="SideTOC3"><a href="#1010521">
      Controlling the Attention Indicator</a></h3>

   <h2 class="SideTOC2"><a href="#1010537">
   Alarms</a></h2>

      <h3 class="SideTOC3"><a href="#1010559">
      Setting an Alarm</a></h3>

      <h3 class="SideTOC3"><a href="#1010623">
      Alarm Scenario</a></h3>

   <h2 class="SideTOC2"><a href="#1010731">
   Summary of Attentions and Alarms</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1009990"> </a>In this chapter you learn how to get the user's attention and how to set real-time alarms that can be used to either perform some periodic activity or display a reminder to the user.</p>

<p><a name="1009991"> </a>This chapter is divided into the following broad topics: </p>
<ul type="disc">
  <li><a name="1009995"> </a><a href="AttnsAndAlarms.html#1010001">Getting the User's Attention</a> begins with an introduction to the Attention Manager. This is followed by a detailed description of the Attention Manager from a user's perspective. Finally, it details what developers need to do in order to use the Attention Manager in their applications.
  <li><a name="1009999"> </a><a href="AttnsAndAlarms.html#1010537">Alarms</a> covers the Alarm Manager, which can notify your programs when a specified point in time is reached.
</ul>

<h2 class="haH2">
  <a name="1010001"> </a>Getting the User's Attention <a href="#1009989"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1010002"> </a>Palm OS<sup>&#174;</sup> contians a standard mechanism that manages competing demands for the user's attention by both applications and drivers. This mechanism is known as the Attention Manager. </p>
<h3 class="hbH3">
  <a name="1010004"> </a>The Role of the Attention Manager <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010005"> </a>This section provides a brief introduction to the Attention Manager. It covers the relationship between the Attention, Alarm and Notification Managers, and then discusses when it is appropriate to make use of the Attention Manager.</p>

<p><a name="1010006"> </a>The Attention Manager provides a standard mechanism by which applications can tell the user that something of significance has occurred. It is designed to support communications devices which can receive data without explicit user interaction. The Attention Manager is responsible only for interacting with the user; it is not responsible for generating those events. In particular, the Alarm Manager can be used in conjunction with the Attention Manager to inform the user that a particular point in time has been reached.</p>

<p><a name="1010008"> </a>By maintaining a single list of all "alarm-like" things, the Attention Manager also improves the user's experience when returning to the handheld after being gone for a while: he doesn't have to click through a series of old alarm dialogs. Often the user doesn't care about most of the missed appointments&#8212;although he might care about a few of them. Without the Attention Manager, the user cannot selectively dismiss or follow up on alarms.</p>

<p><a name="1010009"> </a>Applications have complete control over the types of attention they can ask for. They can query the handheld for the set of special effects available&#8212;possibly including sound, vibration, and an LED&#8212;and then act on that set. The default option is to beep. All other options are either on or off; different vibrating patterns or multicolored LEDs are currently not supported. Note that the set of special effects is extensible; manufacturers may choose to add other means to get the user's attention beyond the anticipated LED and vibration.</p>

<p><a name="1010014"> </a>The Datebook, SMS, and Clock applications use the Attention Manager. Refer to the Datebook application's source code for real-world examples of how you might use the Attention and Alarm Managers.</p>

<h4 class="hcH4">
  <a name="1010015"> </a>Attentions, Alarms and Notifications
</h4>

<p><a name="1010016"> </a>The Attention, Alarm, and Notification Managers are distinct subsystems that are often used in combination. </p>
<ul type="disc">
  <li><a name="1010017"> </a>The Attention Manager is designed solely to interact with the user when an event must be brought to the user's attention. 
  <li><a name="1010018"> </a>The Alarm Manager simply sends an event to an application when a particular point in time is reached. The application can then use the Attention Manager or some other mechanism to bring the alarm to the user's attention, if appropriate.
  <li><a name="1010019"> </a>The Notification Manager informs those applications that have registered their interest whenever certain system-level or application-level events occur. If the user is to be informed of the event, the executable can use the Attention Manager.
</ul>

<h4 class="hcH4">
  <a name="1010020"> </a>When the Attention Manager Isn't Appropriate
</h4>

<p><a name="1010021"> </a>The Attention Manager is only designed for attempts to get attention that can be effectively suspended. It is not suitable for anything requiring an immediate response, such as a request to connect to another user or the "put away" dialog that is used during beaming. The Attention Manager also doesn't attempt to replace error messages. Applications must use modal dialogs and other existing OS facilities to handle these cases.</p>

<p><a name="1010022"> </a>The Attention Manager is also not intended to replace the ToDo application, or to act as a universal inbox. Applications must make it clear that an item appearing in the Attention Manager is simply a reminder, and that dismissing it does not delete the item itself. That is, saying "OK" to an alarm does not delete the appointment, and dismissing an SMS reminder does not delete the SMS message from the SMS inbox.</p>
<h3 class="hbH3">
  <a name="1010024"> </a>Attention Manager Operation <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010025"> </a>This section provides a detailed introduction to the Attention Manager from a user's point of view, introducing some of the terminology used throughout the rest of the chapter and pointing out operational subtleties that you should be aware of when developing applications that use the Attention Manager.</p>

<p><a name="1010027"> </a>Attention-getting attempts can either be <b>insistent</b> or <b>subtle</b>. They differ only in the lengths to which each goes to get your attention. Insistent attempts get "in your face" by popping up a slip window (or "slip") and triggering other visible and audible special effects in an effort to bring important events to your attention. A meeting reminder or incoming high-priority email message might warrant interrupting your work in this fashion. Subtle attentions substitute a small on-screen <b>attention indicator</b> for the slip, allowing you to be made aware of less-critical events without interrupting your current work flow. Although they can also trigger various special effects, subtle attentions don't typically do so. Examples of subtle events might include a reminder of an upcoming birthday or holiday, or an incoming SMS message.</p>

<h4 class="hcH4">
  <a name="1010030"> </a>Insistent Attentions
</h4>

<p><a name="1010031"> </a>When an application makes an insistent attempt to get the user's attention, the <b>detail slip</b> opens:</p>

<p class="FFigureCaption">
  <a name="1010034"> </a><b>Figure 1.1&nbsp;&nbsp;Detail slip</b>
</p>
<div align="left"><img src="images/DetailView1.jpg" height="486" width="750" border="0" hspace="0" vspace="0">
</div>

<p><a name="1010039"> </a>The Attention Manager draws the title and the buttons. The application is responsible for drawing the rest. Most applications draw text and an appropriate icon, as shown in <a href="AttnsAndAlarms.html#1010034">Figure 1.1</a>.</p>

<p><a name="1010043"> </a>When a second application attempts to get attention, or when the first application makes a second attempt, and the first has not yet been dismissed or snoozed, the window changes to the <b>list slip</b>, presenting a list of things that require the user's attention:</p>

<p class="FFigureCaption">
  <a name="1010045"> </a><b>Figure 1.2&nbsp;&nbsp;List slip</b>
</p>
<div align="left"><img src="images/ListView12.jpg" height="488" width="750" border="0" hspace="0" vspace="0">
</div>

<p><a name="1010050"> </a>In this slip, the Attention Manager draws the title and the buttons, and manages the list of items including the checkbox in the left-hand column. Items are listed in order of occurrence, with the newest at the top. The application is responsible for drawing some part of each line, giving it some flexibility over what to display. Applications have space to draw an icon and two lines of text in the standard font on the right-hand side of the list area.</p>

<p><a name="1010052"> </a>In the detail slip the OK button dismisses the item. In the list slip, tapping the checkbox to the left of the item dismisses it. The Clear All button can be used to dismiss all items in the list view. Dismissing an item removes it from the list or closes the detail slip. Note that although it is gone from the Attention Manager, the item itself remains in the application.</p>

<p><a name="1010055"> </a>In either slip, the "Snooze" button temporarily dismisses the Attention Manager slip. The attention indicator remains visible and the user can redisplay the slip at any time. After an interval of five minutes, if any attempts to get attention are still pending the Attention Manager redisplays the slip. Snooze does not remove attempts to get attention.</p>

<p><a name="1010057"> </a>There is just one "Snooze" timer, and the snooze operation applies to the Attention Manager as a whole. This can lead to seemingly odd behavior when new attention items are coming in while there is currently a snooze in progress. This situation should be rare, however.</p>

<p><a name="1010059"> </a>To "go to" an individual item, tap the text or icon of the item in the list slip or tap the "Go To" button in the detail slip. This temporarily dismisses the Attention Manager and launches the appropriate application to display details about the item. For an alarm, this could take you to the Datebook view for the current day, with the current meeting scrolled into view. A successful "go to" also removes the attention item from the list.</p>

<h4 class="hcH4">
  <a name="1010063"> </a>Subtle Attentions
</h4>

<p><a name="1010064"> </a>When an application makes a subtle attempt to get the users attention, no slip appears. Instead, on devices with no dedicated hardware, if the status bar is visible the attention indicator appears in the status bar as shown in <a href="AttnsAndAlarms.html#1020242">Figure 1.3</a>.</p>

<p class="FFigureCaption">
  <a name="1020242"> </a><b>Figure 1.3&nbsp;&nbsp;Attention indicator on the status bar</b>
</p>
<div align="left"><img src="images/AttentionIndicator2.gif" border="0" hspace="0" vspace="0">
</div>

<p><a name="1020233"> </a>If the status bar is not visible, the attention indicator appears, blinking, in the top left corner of the screen, as shown in <a href="AttnsAndAlarms.html#1020337">Figure 1.4</a>.</p>

<p class="FFigureCaption">
  <a name="1020337"> </a><b>Figure 1.4&nbsp;&nbsp;Attention indicator when status bar is not visible</b>
</p>
<div align="left"><img src="images/AttentionIndicator1.gif" border="0" hspace="0" vspace="0">
</div>

<p><a name="1010071"> </a>When the list contains one or more items, all of which have been seen by the user, the indicator (the bell icon in the status bar, or the blinking bell in the top left corner of the screen if the status bar is not visible) remains until the list is empty.</p>

<p><a name="1010072"> </a>Tapping this indicator opens the Attention Manager in the list mode, even if there is only one item. Tapping to the right of the indicator, or tapping in the indicator's area when there are no pending attention attempts opens the menu bar as expected.</p>

<p><a name="1010074"> </a>When the status bar is not visible, the attention indicator only functions with applications which use a standard form title object. In this case, however, the indicator doesn't appear when any of the following are true:</p>
<ul type="disc">
  <li><a name="1010076"> </a>the current application uses a custom title.
  <li><a name="1010077"> </a>the current application draws in the title area.
  <li><a name="1010078"> </a>the current form uses the Dialog title style.
  <li><a name="1010079"> </a>the current application's form title is too narrow to include the attention indicator.
</ul>

<p><a name="1020821"> </a>Note that the attention indicator doesn't appear at all when there are no items in the Attention Manager's queue, whether or not the status bar is visible.</p>

<h4 class="hcH4">
  <a name="1010080"> </a>Special Effects
</h4>

<p><a name="1010081"> </a>When a new attention item is added, the Attention Manager performs some combination of special effects, which can include playing sounds, flashing a LED, and triggering vibration. The exact combination of effects depends on user settings and on the application itself.</p>

<p><a name="1010083"> </a>The Attention Manager attempts to open the slip before performing any special effects so you know immediately why it is trying to get your attention. However, it may not be possible to open the Attention Manager slip. If this is the case, the Attention Manager performs the special effects as soon as possible. It's better for the user to be made aware that something is happening, even if the handheld cannot say exactly what it is.</p>

<p><a name="1010084"> </a>System-wide user preferences control the special effects: the volume at which to play alarms, whether or not to flash the LED (if any), whether or not to vibrate (if equipped). Applications can override these system-wide settings in either a positive or a negative way. For instance, an application could always blink the LED, even if the user said not to, or never blink the LED, even if the user desires it in general.</p>

<h4 class="hcH4">
  <a name="1010085"> </a>Nagging
</h4>

<p><a name="1010086"> </a>If you don't explicitly dismiss or snooze an attention item it continues to "nag" you at predefined intervals, using the item's specified special effects. Applications control how frequently the user should be reminded, and how many times before the Attention Manager gives up. </p>

<p><a name="1016948"> </a>When there are multiple attention items competing for nagging, the Attention Manager respects the nag settings for the most recent insistent item, or if there are none then for the most recent subtle item. Each special effect is handled separately; if one reminder wants sound but no vibration, and another wants vibration but no sound, the combination results in the sound from the first one and the vibration from the second one.</p>

<h4 class="hcH4">
  <a name="1010095"> </a>Attention Manager and Applications That Display Their Own Alarms
</h4>

<p><a name="1010096"> </a>The Attention Manager makes no attempt to override application behavior. If an application puts up it's own dialog to get the user's attention, the Attention Manager doesn't get involved. Applications must be specifically written to use the Attention Manager in order to take advantage of its features and seamless integration with the Palm<sup>&#8482;</sup> user experience.</p>
<h3 class="hbH3">
  <a name="1010100"> </a>Getting the User's Attention <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010101"> </a>This section shows how your applications request the user's attention through the Attention Manager.</p>

<p><a name="1010102"> </a>Getting the user's attention is simply a matter of calling <a href="AttentionMgr.html#994407"><code>AttnGetAttention()</code></a> with the appropriate parameters and then handling various launch codes sent by the Attention Manager. These launch codes allow your application to control what is displayed in the Attention Manager slips, to play sounds or perform other special effects, and to do any necessary processing when the user takes action on an existing attention item.</p>

<p><a name="1010107"> </a>The <code>AttnGetAttention()</code> prototype looks like this:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
status_t AttnGetAttention (DatabaseID <code class="par">dbID</code>,
uint32_t <code class="par">userData</code>, AttnLevelType <code class="par">level</code>, AttnFlagsType <code class="par">flags</code>,
uint16_t <code class="par">nagRateInSeconds</code>, uint16_t <code class="par">nagRepeatLimit</code>)<a name="1020122"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1010109"> </a>Specify the application requesting the user's attention in the <code class="par">dbID</code> argument. You can use the <a href="../Memory_Databases_Files/DataMgr.html#999000"><code>DmGetNextDatabaseByTypeCreator()</code></a> function to obtain these values.</p>

<p><a name="1010113"> </a><code class="par">userData</code> is used to distinguish a given attention attempt from others made by the same application; most applications pass the unique ID or other key for the record which caused the attention request. This value is passed to your code along with the launch code, and can be an integer, a pointer, or any other 32-bit value as needed by your application. </p>

<p><a name="1010118"> </a>For the <code class="par">level</code> argument, supply <code>kAttnLevelInsistent</code> or <code>kAttnLevelSubtle</code> depending on whether the given attention attempt is to be insistent or subtle.</p>

<p><a name="1010119"> </a>Regardless of the level of the attention attempt, set the appropriate bits in the <code class="par">flags</code> argument to cause sounds to play, LEDs to blink, or other physical effects to be performed. Depending on which flags you specify, the effect can always occur or can be suppressed by the user. For instance, to trigger a sound while honoring the user's preferences, you need only supply <code>kAttnFlagsSoundBit</code>. Or, to blink the LED but suppress any sounds, regardless of any preferences the user may have set, supply a value of <code>kAttnFlagsAlwaysLED | kattnFlagsNoSound</code>. Finally, to choose only vibrate, do something like:</p>
<a name="1010120"> </a>
flags = kAttnFlagsNothing ^ kAttnFlagsNoVibrate
   | kAttnFlagsAlwaysVibrate;<a name="1021926"> </a>
<a name="1021947"> </a>

<p><a name="1010121"> </a>While the above is somewhat complex, it does ensure that you override all defaults in the negative except vibration, which is overridden in the positive. See the definition of <a href="AttentionMgr.html#993360"><code>AttnFlagsType</code></a> in the <i>Palm OS Programmer's API Reference</i> for a complete set of constants that can be used in combination for the <code class="par">flags</code> argument.</p>

<div><hr>
  <a name="1010128"> </a> <b>NOTE: </b> Applications may want to verify that the handheld is properly equipped to perform the desired effect. See <a href="AttnsAndAlarms.html#1010434">"Detecting Device Capabilities"</a> for information on how to do this. If the handheld isn't properly equipped to handle a given special effect, the effect isn't performed. For example, if you set the <code>kAttnFlagsLEDBit</code> flag and the Palm Powered<!-PS02-><span style="color: #000000;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: super">&#8482;</span> handheld doesn't have an LED, the attention attempt is processed as if the <code>kAttnFlagsLEDBit</code> had never been set.
<hr>
</div>

<p><a name="1010132"> </a>Assuming that the handheld is capable of getting the user's attention using the requested special effect, the <code class="par">nagRateInSeconds</code> and <code class="par">nagRepeatLimit</code> arguments control how often and how many times the special effect is triggered in an attempt to get the user's attention. As the name implies, specify the amount of time, in seconds, the Attention Manager should wait between special effect triggers with <code class="par">nagRateInSeconds</code>. Indicate the desired number of times the effect should be triggered using <code class="par">nagRepeatLimit</code>. Applications typically supply a value of 300 for <code class="par">nagRateInSeconds</code> and a value of 3 for <code class="par">nagRepeatLimit</code>, indicating that the special effect should be triggered three times after the initial attempt, at five minute intervals. </p>

<p><a name="1010134"> </a>The following line of code shows how the SMS application calls the Attention Manager upon receiving a new SMS message. Note that a subtle attention is generated so that the user isn't interrupted every time an SMS message is received. Also note that the application doesn't override the user's settings when getting his attention. Finally, if the user doesn't respond to the first attention-getting attempt, the special effects are repeated three additional times in five-minute intervals.</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
err = AttnGetAttention(dbID, NULL, kAttnLevelSubtle,
   kAttnFlagsUseUserSettings, 300, 3);<a name="1010135"> </a>
</pre><div class="CodeRule"><hr></div>


<h4 class="hcH4">
  <a name="1010157"> </a>Attention Manager Commands
</h4>

<p><a name="1010161"> </a>In addition to calling <a href="AttentionMgr.html#994407"><code>AttnGetAttention()</code></a>, your code must also respond to commands from the Attention Manager. The Attention Manager issues these commands by issuing a launch code. Among the possible commands are requests for your application to draw the contents of the detail and list slips, play application-specific sounds or perform other special effects, navigate to the item in your application that caused the attention item to be posted, and so forth.</p>

<h5 class="hdH5">
  <a name="1010163"> </a>Draw Detail and List Slips
</h5>

<p><a name="1010164"> </a>The Attention Manager's detail and list slips are drawn as a joint effort between the Attention Manager and applications requesting the user's attention. The shell of each slip, the title, and the buttons and checkboxes are drawn by the Attention Manager, while the remainder&#8212;text specific to each attention attempt, and frequently an accompanying icon&#8212;is drawn by the application itself. This gives each application full control over what sort of information to display.</p>

<p class="FFigureCaption">
  <a name="1010165"> </a><b>Figure 1.5&nbsp;&nbsp;Attention Manager slips</b>
</p>
<div align="left"><img src="images/AttnsAndAlarms5.jpg" height="494" width="750" border="0" hspace="0" vspace="0">
</div>

<p><a name="1010172"> </a>Although your application has full control over the display of its attention items, it may only draw in the designated area; active UI elements, such as scroll bars, custom buttons, or other widgets cannot be included. Users should be encouraged to launch the application with the "Go To" button and use the richer UI provided there. The clipping region is appropriately set so that your application cannot accidentally draw outside the designated area.</p>

<p><a name="1010174"> </a>The <code>kAttnCommandDrawDetail</code> command indicates that your application is to draw the contents of the detail slip. Along with the command, the Attention Manager passes a structure of type <a href="AttentionMgr.html#1025451"><code>AttnCommandArgsDrawDetailTag</code></a>. This structure contains the window-relative boundaries of the screen rectangle in which your application is to draw, a flag indicating whether this is the first time the user has seen this attention item, and a set of flags indicating which special effects will also be triggered.</p>

<p><a name="1010180"> </a>The following code excerpt shows how a simple application might render the contents of the detail slip in response to <a href="AttentionMgr.html#1063135"><code>sysAppLaunchCmdAttention</code></a> launch code accompanied by a <code>kAttnCommandDrawDetail</code> command:</p>
<p class="CCodeCaption">
  <a name="1010184"> </a><b>Listing 1.1&nbsp;&nbsp;Drawing the contents of the detail slip</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
// Draw the icon<a name="1010185"> </a>
resH = DmGetResource(bitmapRsc, MyIconBitmap);<a name="1010186"> </a>
WinDrawBitmap(MemHandleLock(resH), 
    paramsPtr-&gt;drawDetail.bounds.topLeft.x,
    paramsPtr-&gt;drawDetail.bounds.topLeft.y + 4);<a name="1010187"> </a>
MemHandleUnlock(resH);<a name="1010188"> </a>
DmReleaseResource(resH);<a name="1010189"> </a>
 <a name="1010190"> </a>
// Draw the text. The content of the string depends on the<a name="1010191"> </a>
// uniqueID that accompanies the kAttnCommandDrawDetail<a name="1010192"> </a>
// command<a name="1010193"> </a>
curFont = FntSetFont (largeBoldFont);<a name="1010194"> </a>
x = paramsPtr-&gt;drawDetail.bounds.topLeft.x + 37;<a name="1010195"> </a>
y = paramsPtr-&gt;drawDetail.bounds.topLeft.y + 4;<a name="1010196"> </a>
WinDrawChars(alertString, StrLen(alertString), x, y);<a name="1010197"> </a>
FntSetFont(curFont);<a name="1010198"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1010199"> </a>For a more complex, real-world example, see the <code>DrawDetailAlarm()</code> function in the Datebook application. In particular, note how that application adjusts the displayed text so that it all fits in the allocated space.</p>

<p><a name="1010200"> </a>Note that because subtle attention items are only shown using the list view, your application doesn't need to respond to <code>kAttnCommandDrawDetail</code> if it doesn't produce insistent attention attempts.</p>

<p><a name="1010202"> </a>The <code>kAttnCommandDrawList</code> command is similar; it indicates that your application is to draw a portion of the contents of the list slip. Along with this command, the Attention Manager passes a structure of type <a href="AttentionMgr.html#1027663"><code>AttnCommandArgsDrawListTag</code></a>. Before sending your application the <code>kAttnCommandDrawList</code> command, the Attention Manager sets the background, foreground, and text colors as follows, depending on whether or not the item is selected:</p>


<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1010210"> </a><b>Affected Color</b></p>
    </th>
    <th><p class="tt"><a name="1010212"> </a><b>Not Selected</b></p>
    </th>
    <th><p class="tt"><a name="1010214"> </a><b>Selected</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1010216"> </a>Background Color</p>
    </td>
    <td><p class="tt"><a name="1010218"> </a><code>UIFieldBackground</code></p>
    </td>
    <td><p class="tt"><a name="1010220"> </a><code>UIObjectSelectedFill</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1010222"> </a>Foreground Color</p>
    </td>
    <td><p class="tt"><a name="1010224"> </a><code>UIObjectForeground</code></p>
    </td>
    <td><p class="tt"><a name="1010226"> </a><code>UIObjectSelectedForeground</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1010228"> </a>Text Color</p>
    </td>
    <td><p class="tt"><a name="1010230"> </a><code>UIObjectForeground</code></p>
    </td>
    <td><p class="tt"><a name="1010232"> </a><code>UIObjectSelectedForeground</code></p>
    </td>
  </tr>
</table>

</div>


<p><a name="1010235"> </a>The code to draw an attention item in the list slip is very similar to the code you use to draw the same item in the detail slip. Here is an excerpt:</p>
<p class="CCodeCaption">
  <a name="1010236"> </a><b>Listing 1.2&nbsp;&nbsp;Drawing the contents of the list slip</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
// Draw the icon.<a name="1010237"> </a>
resH = DmGetResource(bitmapRsc, MySmallIconBitmap);<a name="1010238"> </a>
iconP = (BitmapPtr)(MemHandleLock(resH));<a name="1010239"> </a>
// center it in the space allotted<a name="1010240"> </a>
iconOffset = (kAttnListMaxIconWidth - iconP-&gt;width)/2;<a name="1010241"> </a>
x = paramsPtr-&gt;drawList.bounds.topLeft.x;<a name="1010242"> </a>
y = paramsPtr-&gt;drawList.bounds.topLeft.y;<a name="1010243"> </a>
WinDrawBitmap(iconP, x + iconOffset, y);	<a name="1010244"> </a>
MemHandleUnlock(resH);<a name="1010245"> </a>
DmReleaseResource(resH);<a name="1010246"> </a>
 <a name="1010247"> </a>
// Draw the text<a name="1010248"> </a>
curFont = FntSetFont(stdFont);<a name="1010249"> </a>
WinDrawChars(alertString, StrLen(alertString), 
    x + kAttnListTextOffset, y);<a name="1010250"> </a>
FntSetFont(curFont);<a name="1010251"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1010252"> </a>The primary differences arise from the fact that the list slip provides a smaller, more structured area in which to draw. Also, the area in which you draw will always have been erased before you are asked to draw in it, so you don't ever have to erase it beforehand.</p>

<p><a name="1010253"> </a>The icon should be no wider than <code>kAttnListMaxIconWidth</code> pixels, and should be centered within this width if it is smaller than <code>kAttnListMaxIconWidth</code>. The text should honor a left-hand margin of <code>kAttnListTextOffset</code> pixels. In the above example, the alert string is assumed to fit within the available space; see the <code>DrawListAlarm()</code> function in the Datebook application for an example of how that application adjusts the displayed text in the event that it doesn't all fit in the allocated space.</p>

<div><hr>
  <a name="1010254"> </a> <b>NOTE: </b> Applications may, in certain rare circumstances, receive a <code>kAttnCommandDrawDetail</code> or <code>kAttnCommandDrawList</code> command for an item which is no longer valid. Respond by either calling <a href="AttentionMgr.html#994027"><code>AttnForgetIt</code></a>, by drawing nothing, or by drawing an error message.
<hr>
</div>

<h5 class="hdH5">
  <a name="1010260"> </a>Play Sound or Perform a Custom Effect
</h5>

<p><a name="1010261"> </a>Most applications play a sound when attempting to get the user's attention. If the <code>kAttnFlagsAlwaysSound</code> is set when your application calls <a href="AttentionMgr.html#994407"><code>AttnGetAttention</code></a>, the Attention Manager sends a <code>kAttnCommandPlaySound</code> command to your application when attempting to get the user's attention. Your application should simply play the appropriate sound in response to this command. Both the Datebook and SMS applications play sounds based upon the user's preferences when getting the user's attention; see the Datebook application's source code for an example of how to respond to the <code>kAttnCommandPlaySound</code> command.</p>

<p><a name="1010267"> </a>Because the Attention Manager can potentially play a sound, blink an LED, and vibrate in addition to displaying a slip or presenting the attention indicator, most applications don't request that some other application-specific custom effect be performed. If your application needs to do something different, you can specify <code>kAttnFlagsAlwaysCustomEffect</code> when calling <code>AttnGetAttention()</code>. This causes a <code>kAttnCommandCustomEffect</code> command to be sent to your application, at which time it should perform the desired effect. If your application is like most, however, it won't ever receive a <code>kAttnCommandCustomEffect</code> command, so you needn't worry about responding to it.</p>

<p><a name="1010269"> </a>Neither <code>kAttnCommandPlaySound</code> nor <code>kAttnCommandCustomEffect</code> are accompanied by any kind of data structure indicating the sound or effect to be performed. If your application doesn't hard-wire this information, you may want to store it in the application's preferences database.</p>

<h5 class="hdH5">
  <a name="1010271"> </a>Go There
</h5>

<p><a name="1010272"> </a>When the user taps on the "Go To" button in the detail view or on the item text or icon (not the checkbox) in the list view, your application receives a <code>kAttnCommandGoThere</code> command. It then needs to switch to your application and display the information relating to the chosen attention item. The <code>kAttnCommandGoThere</code> command is similar to the <a href="../Programming_Basics/CmnLaunchCodes.html#993710"><code>sysAppLaunchCmdGoTo</code></a> launch code, but you don't have globals when your application receives the <code>kAttnCommandGoThere</code> command and your application is called using <a href="../Programming_Basics/AppMgr.html#995070"><code>SysAppLaunch()</code></a>, rather than <a href="../Programming_Basics/AppMgr.html#996594"><code>SysUIAppSwitch()</code></a>. Because of this, most applications perform a <code>SysUIAppSwitch()</code> upon receiving <code>kAttnCommandGoThere</code>.</p>

<p><a name="1010286"> </a>Note that your application should verify that the data that triggered the attention attempt is still relevant. In the Datebook, for instance, the user could:</p>
<ol type="1">
  <li value="1"><a name="1010287"> </a>Be alerted to an appointment by the Attention Manager.
  <li value="2"><a name="1010288"> </a>Tap "Snooze."
  <li value="3"><a name="1010289"> </a>Press the Datebook button and delete the appointment that was just brought to the user's attention.
  <li value="4"><a name="1010290"> </a>Tap the attention indicator.
  <li value="5"><a name="1010291"> </a>Tap the attention item corresponding to the now-deleted appointment.
</ol>

<p><a name="1010292"> </a>In this scenario, the Datebook application could theoretically receive a <code>kAttnCommandGoThere</code> command along with a unique ID referencing a Datebook record that has been deleted. Whenever the Datebook application receives <code>kAttnCommandGoThere</code> along with a unique ID for a deleted Datebook database record, it calls <a href="AttentionMgr.html#994027"><code>AttnForgetIt</code></a> for the now defunct attention item and then returns.</p>

<p><a name="1010297"> </a>In reality, the Datebook calls <code>AttnForgetIt()</code> whenever the user deletes an alarm, and whenever an alarm is determined to be no longer valid. It can do this without even checking to see if the alarm is among those that the Attention Manager is currently tracking; if you pass a combination of database ID and unique ID to <code>AttnForgetIt()</code> that doesn't correspond to an item in the Attention Manager's queue, <code>AttnForgetIt()</code> does nothing and returns a value of <code>false</code>.</p>

<p><a name="1010298"> </a>Most applications will choose to call <code>AttnForgetIt()</code> once the user has viewed the data corresponding to the attention item. This is how the SMS application operates: incoming messages are brought to the user's attention via the Attention Manager, and are removed from the Attention Manager's queue once they've been read.</p>

<h5 class="hdH5">
  <a name="1010300"> </a>Got It
</h5>

<p><a name="1010301"> </a>When the user dismisses a particular attention item, a <code>kAttnCommandGotIt</code> command is sent to the application. Along with this command is a boolean that indicates if the item was explicitly dismissed by the user, since <code>kAttnCommandGotIt</code> is also issued as the result of a successful <a href="AttentionMgr.html#994027"><code>AttnForgetIt</code></a> call. Upon receipt of this command, you may want to clean up memory, delete an alarm, or do other application-specific processing. </p>

<h5 class="hdH5">
  <a name="1010309"> </a>Iterate
</h5>

<p><a name="1010310"> </a>When something happens that may potentially cause an application's attention items to become invalid, that application should call <a href="AttentionMgr.html#994949"><code>AttnIterate()</code></a>. <code>AttnIterate()</code> generates a series of <code>kAttnCommandIterate</code> commands, one for each of the application's pending attention items. Thus, when your application receives a <code>kAttnCommandIterate</code> command it should validate the indicated attention item and take appropriate action if the item is no longer valid&#8212;up to and including calling <a href="AttentionMgr.html#994027"><code>AttnForgetIt</code></a> for the item.</p>

<p><a name="1010320"> </a>The SMS application does not respond to <code>kAttnCommandIterate</code>. The Datebook does; this command is generated whenever the user updates his preferences. Many applications call <code>AttnIterate()</code> after receiving a <a href="../Programming_Basics/CmnLaunchCodes.html#993716"><code>sysAppLaunchCmdSyncNotify</code></a> launch code so that they can update (with <a href="AttentionMgr.html#995137"><code>AttnUpdate</code></a>) or remove (with <code>AttnForgetIt()</code>) items which were affected by the HotSync<sup>&#174;</sup> operation.</p>

<p><a name="1010328"> </a>Note that you can safely call <code>AttnForgetIt()</code> from within the iteration since <code>AttnForgetIt()</code> only marks the record for deletion and thus doesn't confuse the iteration.</p>

<h5 class="hdH5">
  <a name="1010330"> </a>Snooze
</h5>

<p><a name="1010331"> </a>Most applications&#8212;including the Datebook and SMS applications&#8212;ignore <code>kAttnCommandSnooze</code>, which indicates that the user has tapped the Snooze button. Beyond the unique ID that identifies the attention item, nothing accompanies the Snooze command. <code>kAttnCommandSnooze</code> is passed to each and every item currently pending, insistent or subtle. This means that applications with more than one attention item pending receive this command more than once.</p>

<h4 class="hcH4">
  <a name="1010334"> </a>Triggering Special Effects
</h4>

<p><a name="1010335"> </a>The Attention Manager activates any requested special effects for each attention item, but your application might want to activate those special effects without also posting an attention item to the queue. You can do this through a call to <a href="AttentionMgr.html#993782"><code>AttnDoSpecialEffects()</code></a>. Supply the appropriate combination of flags to trigger the desired effects. See <a href="AttentionMgr.html#993360"><code>AttnFlagsType</code></a> for a complete list of flags.</p>
<h3 class="hbH3">
  <a name="1010344"> </a>Attentions and Alarms <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010346"> </a>The Attention Manager is often used in conjunction with the Alarm Manager to get the user's attention at a particular time. The basic use of the Alarm Manager is covered in <a href="AttnsAndAlarms.html#1010537">"Alarms"</a>, but because the Attention Manager handles UI synchronization, do the following when using the Alarm Manager with the Attention Manager:</p>
<ul type="disc">
  <li><a name="1010355"> </a>Call <a href="AttentionMgr.html#994407"><code>AttnGetAttention</code></a> when your application receives the <a href="AlarmMgr.html#995029"><code>sysAppLaunchCmdAlarmTriggered</code></a> launch code.
  <li><a name="1010360"> </a>In your <code>sysAppLaunchCmdAlarmTriggered</code> handling code, set the <code>purgeAlarm</code> field in the launch code's parameter block to <code>true</code> before returning. This removes the alarm from the queue, so your application won't receive the <a href="AlarmMgr.html#995265"><code>sysAppLaunchCmdDisplayAlarm</code></a> launch code.
</ul>

<p><a name="1010366"> </a>Don't wait until the <code>sysAppLaunchCmdDisplayAlarm</code> launch code is received to call <code>AttnGetAttention()</code>.</p>
<h3 class="hbH3">
  <a name="1010377"> </a>Detecting and Updating Pending Attentions <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010378"> </a>Once your application has requested that the Attention Manager get the user's attention, it may later need to update that attention request. For instance, if your application uses a single attention item to indicate that a number of unread messages have been received, it should update that item as additional items are received and read. The Attention Manager provides a handful of functions that allow applications to examine the Attention Manager's queue and update the items within that queue.</p>

<p><a name="1010383"> </a>The <a href="AttentionMgr.html#994551"><code>AttnGetCounts()</code></a> function allows you to determine how many items are currently competing for the user's attention. It always returns the total number of items, but can return the number of subtle and/or insistent items as well. It can also return the counts for all applications. For instance, the following would set <code>numItems</code> to the total number of pending attention items from all sources:</p>
<a name="1010384"> </a>
numItems = AttnGetCounts(0, 0, NULL, NULL);<a name="1021952"> </a>

<p><a name="1010386"> </a>Or, to get the number of subtle and insistent attention items in addition to the total requested by a single application, use something like:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
numItems = AttnGetCounts(dbID, &amp;insistentItems,
   &amp;subtleItems);<a name="1010387"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1010388"> </a>To verify each pending attention item for a given application, use the Attention Manager's <a href="AttentionMgr.html#994949"><code>AttnIterate()</code></a> function as described under <a href="AttnsAndAlarms.html#1010309">"Iterate"</a>.</p>

<p><a name="1010396"> </a>After a HotSync is a popular time to invoke <code>AttnIterate()</code>; the HotSync operation may have altered the application's underlying data in such a way as to render pending attention items obsolete or invalid. </p>

<h4 class="hcH4">
  <a name="1010398"> </a>Deleting Pending Attention Items
</h4>

<p><a name="1010399"> </a>In many cases you'll need to delete an attention item. For instance, a HotSync may alter the underlying application data in such a way so as to invalidate the attention attempt. Or, the user might switch to your application and manually update the data in a similar way, for example by deleting an appointment for which there is a pending alarm. The <a href="AttentionMgr.html#994027"><code>AttnForgetIt</code></a> function exists for this purpose. Simply invoke this function and supply the database ID and user data that uniquely identify the attention attempt. You don't even have to verify that the attention attempt is still in the Attention Manager's queue: <code>AttnForgetIt()</code> doesn't complain if the attention attempt doesn't exist, merely returning a value of <code>false</code> to indicate this condition.</p>

<h4 class="hcH4">
  <a name="1010405"> </a>Updating Pending Attention Items
</h4>

<p><a name="1010410"> </a>To update an existing attention item, use <a href="AttentionMgr.html#995137"><code>AttnUpdate</code></a>. This function is very similar to <a href="AttentionMgr.html#994407"><code>AttnGetAttention</code></a>, though instead of actual values you pass pointers to those values you want to update. Supply <code>NULL</code> pointers for <code class="par">flagsP</code>, <code class="par">nagRateInSecondsP</code>, and/or <code class="par">nagRepeatLimitP</code> to leave them untouched. For instance, to change the flags that control the special effects used to get the user's attention, do the following:</p>
<p class="CCodeCaption">
  <a name="1010414"> </a><b>Listing 1.3&nbsp;&nbsp;Updating an existing attention item</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
// This assumes that dbID and myUserData are<a name="1010415"> </a>
// declared and set elsewhere to values that identify the<a name="1010416"> </a>
// attention item we're trying to update<a name="1010417"> </a>
Boolean updated;<a name="1010418"> </a>
AttnFlagsType newFlags;<a name="1010419"> </a>
 <a name="1010420"> </a>
// set newFlags appropriately<a name="1010421"> </a>
updated = AttnUpdate(dbID, myUserData, NULL, &amp;newFlags, NULL,
   NULL);<a name="1010422"> </a>
if (updated){<a name="1010423"> </a>
    // update succeeded<a name="1010424"> </a>
} else {<a name="1010425"> </a>
    // update failed - attention item may no longer exist<a name="1010426"> </a>
}<a name="1010427"> </a>
</pre><div class="CodeRule"><hr></div>


<div><hr>
  <a name="1013800"> </a> <b>NOTE: </b> Although <code>AttnUpdate()</code> may cause a given attention item to redraw, it does not rerun the special effects (if any) that occurred when that attention item was added. If you want to trigger Attention Manager effects for a particular item, call <a href="AttentionMgr.html#994027"><code>AttnForgetIt</code></a> followed by <a href="AttentionMgr.html#994407"><code>AttnGetAttention</code></a>.
<hr>
</div>

<p><a name="1010430"> </a>While updating the attention item, if the handheld is on and the Attention Manager slip is currently showing then <code>AttnUpdate()</code> forces the item to be redrawn. This in turn calls back to the client application so that it can update its portion of the slip. <code>AttnUpdate()</code> causes the specified item to be redrawn if it is visible, regardless of the <code class="par">flags</code>, <code class="par">nagRateInSeconds</code>, and <code class="par">nagRepeatLimit</code> parameters.Thus, <code>AttnUpdate()</code> isn't limited to updating one or more aspects of an attention item; it also allows an application to update the text of an attention attempt without having to destroy and then rebuild the Attention Manager slip.</p>

<p><a name="1010432"> </a>Note that if the handheld is off, the update is delayed until the handheld is next turned on; <code>AttnUpdate()</code> doesn't itself turn the screen on.</p>
<h3 class="hbH3">
  <a name="1010434"> </a>Detecting Device Capabilities <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010435"> </a>Although you can blindly request that a given special effect, such as vibration, be used to get the user's attention without checking to see if that special effect is supported on the Palm Powered handheld, you may want your application to behave differently in the absence of a particular device feature. The Attention Manager defines a feature that you use with the <a href="FeatureMgr.html#992990"><code>FtrGet()</code></a> function to determine the handheld's physical capabilities. You can also use this feature to determine the user's attention-getting preferences. For example:</p>
<p class="CCodeCaption">
  <a name="1010439"> </a><b>Listing 1.4&nbsp;&nbsp;Checking for vibrate capability</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
// See if the device supports vibration<a name="1010440"> </a>
FtrGet(kAttnFtrCreator, kAttnFtrCapabilities, &amp;capabilities);<a name="1010441"> </a>
if (capabilities &amp; kAttnFlagsHasVibrate){<a name="1010442"> </a>
    // Vibrate-specific processing goes here<a name="1010443"> </a>
    ...<a name="1010444"> </a>
}<a name="1010445"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1010451"> </a>See <a href="AttentionMgr.html#993490">"Attention Manager Constants"</a> for descriptions of all of the relevant flags.</p>
<h3 class="hbH3">
  <a name="1010521"> </a>Controlling the Attention Indicator <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010522"> </a>For the most part, applications can ignore the attention indicator, which consumes a small portion of a form's title bar if the status bar is not visible. If the status bar is visible, or if the currently-displayed form doesn't have a title bar, or if the form is modal, the attention indicator isn't drawn in the form's title bar. If an application takes over the entire screen or does something special with the form's title bar, it should explicitly disable the attention indicator while the form is displayed.</p>

<p><a name="1010523"> </a>As an example, the Datebook application disables the attention indicator when:</p>
<ul type="disc">
  <li><a name="1010524"> </a>a note associated with a Datebook entry is displayed.
  <li><a name="1010525"> </a>an entry's description is being displayed in the week view.
  <li><a name="1010526"> </a>the time is being displayed in the title bar in place of the date.
</ul>

<p><a name="1010527"> </a>To disable the attention indicator that is displayed in the upper left corner of the screen when the status bar is not visible, simply call <a href="AttentionMgr.html#994863"><code>AttnIndicatorEnable()</code></a> and supply a value of <code>false</code> for the <code class="par">enableIt</code> argument. To re-enable it, call <code>AttnIndicatorEnable()</code> again, this time supplying an argument value of <code>true</code>.</p>

<p><a name="1010531"> </a>If your application disables the attention indicator, it may want to provide some means for the user to open the Attention Manager's slip in list mode. The <a href="AttentionMgr.html#995097"><code>AttnListOpen()</code></a> function can be used to do this.</p>

<h2 class="haH2">
  <a name="1010537"> </a>Alarms <a href="#1009989"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1010539"> </a>The Palm OS Alarm Manager provides support for setting real-time alarms, for performing some periodic activity, or for displaying a reminder. The Alarm Manager:</p>
<ul type="disc">
  <li><a name="1010540"> </a>Works closely with the Time Manager to handle real-time alarms.
  <li><a name="1010541"> </a>Sends launch codes to applications that set a specific alarm to inform the application the alarm is due.
  <li><a name="1010542"> </a>Allows only one alarm to be set per application.
  <li><a name="1010543"> </a>Handles alarms by application in a two cycle operation:
  <ul type="disc">
    <li><a name="1010544"> </a>First, it notifies each application that the alarm has occurred. The application verifies that the alarm is still valid at this point. Applications that don't use the Attention Manager typically play a sound here.
    <li><a name="1010545"> </a>Second, after all pending alarms have received their first notification, the Alarm Manager sends another notification to each application, allowing it to display some UI.
  </ul>
</ul>

<p><a name="1010546"> </a>The Alarm Manager doesn't have any UI of its own; it doesn't provide reminder dialog boxes, and it doesn't play the alarm sound. Applications that need to bring an alarm to the user's attention must do this themselves. The Attention Manager is designed specifically to handle this interaction with the user; see <a href="AttnsAndAlarms.html#1010344">"Attentions and Alarms"</a> for tips on doing this.</p>

<div><hr>
  <a name="1010553"> </a> <b>IMPORTANT: </b> When the handheld is in sleep mode, alarms can occur almost a minute late.
<hr>
</div>
<h3 class="hbH3">
  <a name="1010559"> </a>Setting an Alarm <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010560"> </a>The most common use of the Alarm Manager is to set a real-time alarm within an application. Often, you set this type of alarm because you want to inform the user of an event. For example, the Datebook application sets alarms to inform users of their appointments. </p>

<p><a name="1010561"> </a>Implementing such an alarm is a two step process. First, use the function <a href="AlarmMgr.html#993363"><code>AlmSetAlarm()</code></a> to set the alarm. Specify when the alarm should trigger and which application should be informed at that time. </p>

<p><a name="1010569"> </a><a href="AttnsAndAlarms.html#1010571">Listing 1.5</a> shows how the Datebook application sets an alarm. </p>
<p class="CCodeCaption">
  <a name="1010571"> </a><b>Listing 1.5&nbsp;&nbsp;Setting an alarm</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
static void SetTimeOfNextAlarm (uint32_t alarmTime, 
uint32_t ref) {<a name="1010572"> </a>
    LocalID dbID;<a name="1010575"> </a>
    DmSearchStateType searchInfo;<a name="1010576"> </a>
 <a name="1010577"> </a>
    DmGetNextDatabaseByTypeCreator (true, &amp;searchInfo,
        sysFileTApplication, sysFileCDatebook, true, &amp;dbID);<a name="1010578"> </a>
 <a name="1010579"> </a>
    AlmSetAlarm (dbID, ref, alarmTime, true);<a name="1010580"> </a>
}<a name="1010581"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1010585"> </a>Second, have your <a href="../Programming_Basics/AppMgr.html#994755"><code>PilotMain()</code></a> function respond to the <a href="AlarmMgr.html#995029"><code>sysAppLaunchCmdAlarmTriggered</code></a> and <a href="AlarmMgr.html#995265"><code>sysAppLaunchCmdDisplayAlarm</code></a> launch codes.</p>

<p><a name="1010594"> </a>When an alarm is triggered, the Alarm Manager notifies each application that set an alarm for that time via the <code>sysAppLaunchCmdAlarmTriggered</code> launch code. After each application has processed this launch code, the Alarm Manager sends each application <code>sysAppLaunchCmdDisplayAlarm</code> so that the application can display the alarm. The section <a href="AttnsAndAlarms.html#1010623">"Alarm Scenario"</a> gives more information about when these launch codes are received and what actions your application might take. For a specific example of responding to these launch codes, see the Datebook sample code.</p>

<p><a name="1010598"> </a>It's important to note the following:</p>
<ul type="disc">
  <li><a name="1010599"> </a>An application can have only one alarm pending at a time. If you call <code>AlmSetAlarm()</code> and then call it again before the first alarm has triggered, the Alarm Manager replaces the first alarm with the second alarm. You can use the <a href="AlarmMgr.html#993317"><code>AlmGetAlarm()</code></a> function to find out if the application has any alarms pending. 
  <li><a name="1010604"> </a><code>AlmSetAlarm()</code> takes a <code>uint32_t </code>parameter that you can use to pass a specific value to your alarm handling code when the alarm triggers. (This is the <code class="par">ref</code> parameter shown in <a href="AttnsAndAlarms.html#1010571">Listing 1.5</a>.) The parameter blocks for both launch codes provide access to this reference parameter.
  <li><a name="1010615"> </a>The database ID that you pass to <code>AlmSetAlarm()</code> is the local ID of the <i>application</i> (the <code>.prc</code> file), not of the record database that the application accesses. You use a record database's local ID more frequently than you do the application's local ID, so this is a common mistake to make. 
  <li><a name="1010616"> </a>In <code>AlmSetAlarm()</code>, the alarm time is given as the number of seconds since 1/1/1904. If you need to convert a conventional date and time value to the number of seconds since 1/1/1904, use <a href="DateTime.html#996102"><code>TimDateTimeToSeconds()</code></a>. 
</ul>

<p><a name="1010621"> </a>To clear a pending alarm, call <code>AlmSetAlarm()</code> and pass 0 for the alarm seconds parameter. </p>
<h3 class="hbH3">
  <a name="1010623"> </a>Alarm Scenario <a href="#1009989"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1010624"> </a>Here's how an application and the Alarm Manager typically interact when processing an alarm:</p>
<ol type="1">
  <li value="1"><a name="1010628"> </a>The application sets an alarm using <a href="AlarmMgr.html#993363"><code>AlmSetAlarm()</code></a>. 
   <p><a name="1010629"> </a>The Alarm Manager adds the new alarm to its alarm queue. The alarm queue contains all alarm requests. Triggered alarms are queued up until the Alarm Manager can send the launch code to the application that created the alarm. However, if the alarm queue becomes full, the oldest entry that has been both triggered and notified is deleted to make room for a new alarm.</p>
  <li value="2"><a name="1010630"> </a>When the alarm time is reached, the Alarm Manager searches the alarm queue for the first application that set an alarm for this alarm time.
  <li value="3"><a name="1010631"> </a>The Alarm Manager sends this application the <a href="AlarmMgr.html#995029"><code>sysAppLaunchCmdAlarmTriggered</code></a> launch code.
  <li value="4"><a name="1010636"> </a>The application can now:
  <ul type="disc">
    <li><a name="1010637"> </a>Set the next alarm.
    <li><a name="1010638"> </a>Play a short sound.
    <li><a name="1010639"> </a>Perform some quick maintenance activity. 
   <p><a name="1010640"> </a>The application should not perform any lengthy tasks in response to <code>sysAppLaunchCmdAlarmTriggered</code> because doing so delays other applications from receiving alarms that are set to trigger at the same time. </p>
   <p><a name="1010641"> </a>If the application is using the Attention Manager to bring this alarm to the user's attention, call <a href="AttentionMgr.html#994407"><code>AttnGetAttention()</code></a> here and set the <code>purgeAlarm</code> field in the launch code's parameter block to <code>true</code> before returning.</p>
   <p><a name="1010645"> </a>If this alarm requires no further processing, the application should set the <code>purgeAlarm</code> field in the launch code's parameter block to <code>true</code> before returning. Doing so removes the alarm from the queue, which means it won't receive the <a href="AlarmMgr.html#995265"><code>sysAppLaunchCmdDisplayAlarm</code></a> launch code.</p>
  </ul>
  <li value="5"><a name="1010649"> </a>The Alarm Manager finds in the alarm queue the next application that set an alarm and repeats steps <a href="AttnsAndAlarms.html#1010631">3</a> and <a href="AttnsAndAlarms.html#1010636">4</a>. 
   <p><a name="1010650"> </a>This process is repeated until no more applications are found with this alarm time.</p>
  <li value="6"><a name="1010652"> </a>The Alarm Manager then once again finds the first application in the alarm queue who set an alarm for this alarm time and sends this application the launch code <!-PS02-><span style="color: #0000ff;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: underline; text-transform: none; vertical-align: baseline">sysAppLaunchCmdDisplayAlarm</span>. Note that alarms that had their <code>purgeAlarm</code> field set to <code>true</code> during the processing of <code>sysAppLaunchCmdAlarmTriggered</code>&#8212;including all alarms that are being brought to the user's attention through the Attention Manager&#8212;are no longer in the queue at this point.
  <li value="7"><a name="1010654"> </a>The application can now display a dialog box or some other type of reminder, if appropriate. At this point it isn't restricted to working quickly; it can take whatever time it needs since at this point all applications have been notified that the alarm was triggered.
  <li value="8"><a name="1010658"> </a>The Alarm Manager then finds the next entry in the alarm queue that has the same alarm time as the one being triggered, and repeats steps <a href="AttnsAndAlarms.html#1010652">6</a> and <a href="AttnsAndAlarms.html#1010654">7</a>. 
   <p><a name="1010659"> </a>This process is repeated until no more applications are found with this alarm time.</p>
</ol>

<p><a name="1010660"> </a>If a new alarm time is triggered while an older alarm is still being displayed, all applications with alarms scheduled for this second alarm time are sent the <code>sysAppLaunchCmdAlarmTriggered</code> launch code, but the display cycle for the second set of alarms is postponed until all earlier alarms have finished displaying.</p>

<p><a name="1010661"> </a>If a second alarm goes off before the first has been dismissed, the alarm manager sends the <a href="AlarmMgr.html#995029"><code>sysAppLaunchCmdAlarmTriggered</code></a> launch code for the second alarm but waits to send the <a href="AlarmMgr.html#995265"><code>sysAppLaunchCmdDisplayAlarm</code></a> launch code until after the first alarm's dialog has been dismissed. For applications that put up dialogs, this typically means that only one dialog at a time will appear on the screen. The Alarm Manager doesn't return to the event loop between the issuing of launch codes, so when the first alarm's dialog has been dismissed, the second alarm's dialog is immediately displayed. The net result for the user is that each alarm dialog in turn must be dismissed before the handheld can be used.</p>

<h2 class="haH2">
  <a name="1010731"> </a>Summary of Attentions and Alarms <a href="#1009989"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1010734"> </a><b>Attention Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1010736"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1010741"> </a><a href="AttentionMgr.html#993782"><code>AttnDoSpecialEffects()</code></a><br><a href="AttentionMgr.html#994027"><code>AttnForgetIt()</code></a><br><a href="AttentionMgr.html#994407"><code>AttnGetAttention()</code></a><br><a href="AttentionMgr.html#994551"><code>AttnGetCounts()</code></a><br><a href="AttentionMgr.html#994863"><code>AttnIndicatorEnable()</code></a></p>
    </td>
    <td><p class="tt"><a name="1010758"> </a><a href="AttentionMgr.html#994905"><code>AttnIndicatorEnabled()</code></a><br><a href="AttentionMgr.html#994949"><code>AttnIterate()</code></a><br><a href="AttentionMgr.html#995097"><code>AttnListOpen()</code></a><br><a href="AttentionMgr.html#995137"><code>AttnUpdate()</code></a></p>
    </td>
  </tr>
</table>

</div>









<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1010772"> </a><b>Alarm Manager Functions</b></p>
    </th>
    <th><p class="tt"><a name="1010774"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1010779"> </a><a href="AlarmMgr.html#993363"><code>AlmSetAlarm()</code></a></p>
    </td>
    <td><p class="tt"><a name="1010787"> </a><a href="AlarmMgr.html#993317"><code>AlmGetAlarm()</code></a></p>
    </td>
  </tr>
</table>

</div>


<p><a name="1021982"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="SysMgt_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SysMgt_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SysMgt_Part1.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Features.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SysMgt_IX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>