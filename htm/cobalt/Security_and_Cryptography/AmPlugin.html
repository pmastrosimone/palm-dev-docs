<html>
<head>
<title>(Protein) AmPlugin | Security and Cryptography</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:23:49">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="992934"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SecurityAndCryptographyTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Am.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AmPluginCodePrint.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SecurityAndCryptographyIX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">4 &nbsp;&nbsp;
AmPlugin</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Security and Cryptography</p>
<p class="SubTitle">Exploring Palm OS </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="SecurityAndCrypto_Part2.html">Part II: Reference</a> </h1>
<h1 class="SideTOC1"><a href="AmPlugin.html">4  AmPlugin</a></h1>

   <h2 class="SideTOC2"><a href="#992942">
   AmPlugin Structures and Types</a></h2>

      <h3 class="SideTOC3"><a href="#992950">
      AmMemHandle</a></h3>

      <h3 class="SideTOC3"><a href="#992975">
      AmPluginFunctionsType</a></h3>

      <h3 class="SideTOC3"><a href="#993267">
      AmPluginPrivType</a></h3>

      <h3 class="SideTOC3"><a href="#993323">
      AmTokenDataType</a></h3>

      <h3 class="SideTOC3"><a href="#993359">
      AmTokenPrivType</a></h3>

   <h2 class="SideTOC2"><a href="#993573">
   AmPlugin Constants</a></h2>

      <h3 class="SideTOC3"><a href="#993605">
      AmCallMode</a></h3>

   <h2 class="SideTOC2"><a href="#993648">
   AmPlugin Functions and Macros</a></h2>

      <h3 class="SideTOC3"><a href="#993680">
      AmInitializeUIContext</a></h3>

      <h3 class="SideTOC3"><a href="#993720">
      AmMemHandleFree</a></h3>

      <h3 class="SideTOC3"><a href="#993787">
      AmMemHandleLock</a></h3>

      <h3 class="SideTOC3"><a href="#993829">
      AmMemHandleNew</a></h3>

      <h3 class="SideTOC3"><a href="#993875">
      AmMemHandleUnlock</a></h3>

      <h3 class="SideTOC3"><a href="#994001">
      AmReleaseUIContext</a></h3>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="992936"> </a><code>AmPlugin.h</code> declares a set of APIs that are used by Authentication Manager plug-ins to implement a particular authentication model.. These plug-ins are shared libraries of type <code>'ampl'</code>. After initialization, which is done by sending the plug-in standard launch codes, the Authentication Manager interacts with functions exported by the plug-in through the <code>AmPluginFunctionsType</code> structure.</p>

<p><a name="996336"> </a>The contents of this chapter are divided into the following sections:</p>
   <blockquote class = "bq"><a name="992948"> </a><a href="AmPlugin.html#992942">AmPlugin Structures and Types</a></blockquote>
   <blockquote class = "bq"><a name="993579"> </a><a href="AmPlugin.html#993573">AmPlugin Constants</a></blockquote>
   <blockquote class = "bq"><a name="993654"> </a><a href="AmPlugin.html#993648">AmPlugin Functions and Macros</a></blockquote>

<p><a name="992938"> </a>The header file <code>AmPlugin.h</code> declares the API that this chapter describes.</p>

<p><a name="992940"> </a>For information on writing Authentication Manager plug-ins, see <a href="SecurityConcepts.html#1009026">"Creating an Authentication Manager Plug-In."</a> Information on registering a plug-in with the Authentication Manager or removing a registered plug-in can be found under <a href="SecurityConcepts.html#1009348">"Manipulating Authentication Manager Plug-Ins."</a></p>

<h2 class="haH2">
  <a name="992942"> </a>AmPlugin Structures and Types <a href="#992934"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="992950"> </a>AmMemHandle Typedef <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="992955"> </a>Purpose 
</h4>

<p><a name="992958"> </a>Handle to a memory chunk allocated in the vault.</p>
<h4>
  <a name="992960"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="992963"> </a></code><h4>
  <a name="992965"> </a>Prototype 
</h4>
<pre class="proto"><a name="992968"></a>typedef uint32_t AmMemHandle
</pre>
<h4>
  <a name="992970"> </a>Comments 
</h4>

<p><a name="998836"> </a>You must use the <code>AmMemHandle...</code> functions to manipulate Authentication Memory handles. All dynamic memory used by a plug-in that is associated with a token should be done through a call to one of the <code>AmMemHandle...</code> functions.</p>

<h3 class="hbH3">
  <a name="992975"> </a>AmPluginFunctionsType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="992980"> </a>Purpose 
</h4>

<p><a name="992983"> </a>Identifies those functions in the set that makes up the interface between the Authentication Manager and a plug-in that are implemented by the plug-in. </p>
<h4>
  <a name="992985"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="992988"> </a></code><h4>
  <a name="992990"> </a>Prototype 
</h4>
<pre class="proto"><a name="992993"></a>typedef struct {
   status_t (*pluginCaptureFtn)(AmCallMode <code class="par">mode</code>,
      AmApplicationCtxType *<code class="par">pAppContext</code>,
      AmTokenPrivType *<code class="par">pPrivToken</code>,
      AmAuthenticationEnum <code class="par">authType</code>,
      char *<code class="par">title</code>, char *<code class="par">description</code>);
   status_t (*pluginMatchFtn)
      (AmApplicationCtxType *<code class="par">pAppContext</code>,
      AmTokenPrivType *<code class="par">pToken1</code>,
      AmTokenPrivType *<code class="par">pToken2</code>);
   status_t (*pluginDestroyNotifyFtn)
      (AmTokenPrivType *<code class="par">pPrivToken</code>);
   status_t (*pluginGetTokenExtendedInfoFtn)
      (AmTokenPrivType *<code class="par">pPrivToken</code>,
      uint8_t *<code class="par">pExtInfo</code>, uint32_t <code class="par">extInfoLen</code>);
   status_t (*pluginImportTokenFtn)
      (AmTokenPrivType *<code class="par">pPrivToken</code>, 
      uint8_t *<code class="par">pBuffer</code>, uint32_t <code class="par">bufferLen</code>);
   status_t (*pluginExportTokenFtn)
      (AmTokenPrivType *<code class="par">pPrivToken</code>,
      uint8_t *<code class="par">pBuffer</code>, uint32_t *<code class="par">bufferLen</code>);
   status_t (*pluginGetDerivedData)
      (AmTokenPrivType *<code class="par">pPrivToken</code>,
      uint8_t *<code class="par">data</code>, uint32_t *<code class="par">dataLength</code>);
   status_t (*pluginAdminFtn)
      (AmPluginType *<code class="par">plugin</code>);
} AmPluginFunctionsType
</pre>
<h4>
  <a name="993007"> </a>Fields 
</h4>

<dl>
<dt><a name="993058"> </a><code>pluginCaptureFtn</code></dt>
<dd><a name="993132"> </a>The <a href="SecurityConcepts.html#1009133">Capture</a> function is called whenever the AM needs your plug-in to create a new token, or to verify or replace an existing token created by the plug-in. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1001888"> </a><code><code class="par">mode</code></code></dt>
<dd><a name="1001901"> </a>An <a href="AmPlugin.html#993605"><code>AmCallMode</code></a> that indicates whether the plug-in should create, verify, or replace a token.</dd>

<dt><a name="1001905"> </a><code><code class="par">pAppContext</code></code></dt>
<dd><a name="1001906"> </a>An <a href="Am.html#992950"><code>AmApplicationCtxType</code></a> structure that holds information about the application that needs to be authenticated and other private data specific to the plug-in.</dd>

<dt><a name="1001918"> </a><code><code class="par">pPrivToken</code></code></dt>
<dd><a name="1002014"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information regarding the credentials that must be matched for a valid authentication to occur.</dd>

<dt><a name="1002205"> </a><code><code class="par">authType</code></code></dt>
<dd><a name="1002206"> </a>A <a href="Am.html#994510"><code>AmAuthenticationEnum</code></a> value that identifies the authentication situation&#8212;the reason that the plug-in is being called.</dd>

<dt><a name="1002294"> </a><code><code class="par">title</code></code></dt>
<dd><a name="1002378"> </a>An optional string that the plug-in may choose to display to the user.  The string is meant to be a reason for the authentication request. This parameter is <code>NULL</code> if the caller doesn't want a string to be displayed.</dd>

<dt><a name="1002376"> </a><code><code class="par">description</code></code></dt>
<dd><a name="1002525"> </a>An optional string that the plug-in may choose to display to the user.  The string is meant to be a more in-depth description of the reason for the authentication request. This parameter is <code>NULL</code> if the caller doesn't want such a string to be displayed.</dd>

</dl>
<dt><a name="993182"> </a><code>pluginMatchFtn</code></dt>
<dd><a name="1001138"> </a>When the AM needs to verify a token it invokes the associated plug-in's <a href="SecurityConcepts.html#1009147">Match</a> entry point, passing in two token structures for comparision. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1002780"> </a><code><code class="par">pAppContext</code></code></dt>
<dd><a name="1002784"> </a>An <a href="Am.html#992950"><code>AmApplicationCtxType</code></a> structure that holds information about the application that needs to be authenticated and other private data specific to the plug-in.</dd>

<dt><a name="1002824"> </a><code><code class="par">pToken1</code></code></dt>
<dd><a name="1002828"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information regarding the credentials for the first token being matched.</dd>

<dt><a name="1002832"> </a><code><code class="par">pPToken2</code></code></dt>
<dd><a name="1003417"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information regarding the credentials for the second token being matched.</dd>

</dl>
<dt><a name="993234"> </a><code>pluginDestroyNotifyFtn</code></dt>
<dd><a name="993236"> </a>The <a href="SecurityConcepts.html#1009157">Destroy Notify</a> entry point is called when a token is destroyed.  Destroying a token is an action that may be taken if the user has lost the ability to authenticate against that token (as in the case of a lost password). This function takes a single parameter:</dd>

<dl>
<dt><a name="1003877"> </a><code><code class="par">pPrivToken</code></code></dt>
<dd><a name="1003881"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information about the token being destroyed.</dd>

</dl>
<dt><a name="993238"> </a><code>pluginGetTokenExtendedInfoFtn</code></dt>
<dd><a name="993244"> </a>The <a href="SecurityConcepts.html#1009167">Get Extended Info</a> function is used to answer the query for extended info by an application. A plug-in is not required to support this entry point, though it can be useful for certain types of tokens. The Palm OS PKI plug-in returns the certificate ID of the token (in an <a href="AmPluginSignedCode.html#992950"><code>AmPluginSignedCodeExtInfoType</code></a> structure). The Palm OS Code Fingerprint plug-in returns the type, creator, and name of the database that was fingerprinted (in an <a href="AmPluginCodePrint.html#992950"><code>AmPluginCodePrintExtInfoType</code></a> structure). The Palm OS password plug-in, however, doesn't implement this function. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1004453"> </a><code><code class="par">pPrivToken</code></code></dt>
<dd><a name="1004457"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information about the token for which extended information is being requested.</dd>

<dt><a name="1004036"> </a><code><code class="par">pExtInfo</code></code></dt>
<dd><a name="1004037"> </a>Pointer to the buffer into which the information is to be written.</dd>

<dt><a name="1004038"> </a><code><code class="par">extInfoLen</code></code></dt>
<dd><a name="1004099"> </a>The size, in bytes, of the <code class="par">pExtInfo</code> buffer.</dd>

</dl>
<dt><a name="993246"> </a><code>pluginImportTokenFtn</code></dt>
<dd><a name="993248"> </a>The <a href="SecurityConcepts.html#1009177">Import and Export</a> entry points are for copying internal data about a token for import or export. In your import function, the contents of the provided buffer should be copied to memory that is associated with a token <i>and is managed by the plug-in</i>. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1004592"> </a><code><code class="par">pPrivToken</code></code></dt>
<dd><a name="1004596"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information about the token being imported.</dd>

<dt><a name="1004597"> </a><code><code class="par">pBuffer</code></code></dt>
<dd><a name="1004598"> </a>Pointer to the buffer containing the token info being imported.</dd>

<dt><a name="1004599"> </a><code><code class="par">bufferLen</code></code></dt>
<dd><a name="1004600"> </a>The size, in bytes, of the <code class="par">pBuffer</code> buffer.</dd>

</dl>
<dt><a name="993250"> </a><code>pluginExportTokenFtn</code></dt>
<dd><a name="1001704"> </a>The <a href="SecurityConcepts.html#1009177">Import and Export</a> entry points are for copying internal data about a token for import or export. In your export function, memory that is associated with a token <i>and is managed by the plug-in</i> should be copied to the provided buffer and returned to the AM. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1004682"> </a><code><code class="par">pPrivToken</code></code></dt>
<dd><a name="1004686"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information about the token being exported.</dd>

<dt><a name="1004687"> </a><code><code class="par">pBuffer</code></code></dt>
<dd><a name="1004688"> </a>Pointer to the buffer into which the token info should be written.</dd>

<dt><a name="1004689"> </a><code><code class="par">bufferLen</code></code></dt>
<dd><a name="1004690"> </a>The size, in bytes, of the <code class="par">pBuffer</code> buffer.</dd>

</dl>
<dt><a name="993254"> </a><code>pluginGetDerivedData</code></dt>
<dd><a name="993256"> </a>The <a href="SecurityConcepts.html#1009188">Get Derived Data</a> function is used solely by the operating system to get seed data for a cryptographic key derived from an authentication token (such as password derived keys). Currently the only user of this feature is the Data Manager; it uses this feature to generate password-derived keys for the backup  function. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1005569"> </a><code><code class="par">pPrivToken</code></code></dt>
<dd><a name="1005573"> </a>An <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> data structure that holds information about the token for which derived data is being requested.</dd>

<dt><a name="1005691"> </a><code><code class="par">data</code></code></dt>
<dd><a name="1005779"> </a>Buffer into which your function should write seed data derived from the authentication token.</dd>

<dt><a name="1005864"> </a><code><code class="par">dataLength</code></code></dt>
<dd><a name="1005865"> </a>Size, in bytes, of the <code class="par">data</code> buffer.</dd>

</dl>
<dt><a name="993258"> </a><code>pluginAdminFtn</code></dt>
<dd><a name="1006037"> </a>This function is the admin entry point for the plug-in. Some plug-ins may have settings that can be changed (a biometric plug-in, for instance, might allow the user to tweak the settings it uses to match tokens); accordingly, the plug-in can implement an admin UI in its implementation of this function. Parameters passed to this function are:</dd>

<dl>
<dt><a name="1006178"> </a><code><code class="par">plugin</code></code></dt>
<dd><a name="1006179"> </a>A reference to the plug-in.</dd>

</dl>
</dl>
<h4>
  <a name="993262"> </a>Comments 
</h4>

<p><a name="993265"> </a>These functions may return any error defined in <code>Am.h</code>.</p>

<p><a name="1006313"> </a>Upon receipt of a <a href="../Programming_Basics/CmnLaunchCodes.html#994023"><code>sysAppLaunchCmdNormalLaunch</code></a> launch code, the plug-in should, among other things, identify which of these functions it implements. Accompanying the launch code is a <a href="AmPlugin.html#993359"><code>AmTokenPrivType</code></a> structure; this structure's <code class="par">ftn</code> field is an <span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">AmPluginFunctionsType</span> structure into which you write the addresses of those functions that your plug-in implements.</p>

<h3 class="hbH3">
  <a name="993267"> </a>AmPluginPrivType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993272"> </a>Purpose 
</h4>

<p><a name="993275"> </a>Describes a plug-in. This structure is used by the AM to reference a plug-in loaded onto the system.</p>
<h4>
  <a name="993277"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993280"> </a></code><h4>
  <a name="993282"> </a>Prototype 
</h4>
<pre class="proto"><a name="993285"></a>typedef struct {
   AmPluginType pluginRef;
   uint32_t recordId;
   AmPluginInfoType info;
   uint32_t tokenDataLength;
   uint32_t tokenExtendedInfoLength;
   AmPluginFunctionsType ftn;
} AmPluginPrivType, *AmPluginPrivPtr
</pre>
<h4>
  <a name="993287"> </a>Fields 
</h4>

<dl>
<dt><a name="993290"> </a><code>pluginRef</code></dt>
<dd><a name="993292"> </a>Reference to this plug-in. This field is set by the AM.</dd>

<dt><a name="993294"> </a><code>recordId</code></dt>
<dd><a name="993296"> </a>Record ID for this plug-in in the AM vault. This field is set by the AM.</dd>

<dt><a name="993298"> </a><code>info</code></dt>
<dd><a name="993300"> </a>An <a href="Am.html#993343"><code>AmPluginInfoType</code></a> structure that contains information about the plug-in to be shared with applications.</dd>

<dt><a name="993306"> </a><code>tokenDataLength</code></dt>
<dd><a name="993308"> </a>The size, in bytes, of the tokens managed by this plug-in.</dd>

<dt><a name="993310"> </a><code>tokenExtendedInfoLength</code></dt>
<dd><a name="993312"> </a>The length, in bytes, of any extended information that is returned to caller by the <a href="SecurityConcepts.html#1009167">Get Extended Info</a> entry point.</dd>

<dt><a name="993314"> </a><code>ftn</code></dt>
<dd><a name="993316"> </a>A list of plug-in entry points. Not all entry point function pointers need to be initialized: only those entry points that a plug-in chooses to implement need to be set in this structure. See <a href="AmPlugin.html#992975"><code>AmPluginFunctionsType</code></a> for the complete set of entry points a plug-in can export.</dd>

</dl>
<h4>
  <a name="999538"> </a>Comments 
</h4>

<p><a name="999537"> </a>An Authentication Manager plug-in fills in a data structure of this type during initialization. Within this data structure are entry points that provide the Authentication Manager with direct access to the plug-in functions.</p>

<p><a name="999488"> </a>See the discussion of the <code>sysAppLaunchCmdNormalLaunch</code> launch code under <a href="SecurityConcepts.html#1009116">"Open and Close"</a> for more information on filling out this structure's fields.</p>

<h3 class="hbH3">
  <a name="993323"> </a>AmTokenDataType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993328"> </a>Purpose 
</h4>

<p><a name="993331"> </a>An optional linked list of record IDs that identify dynamic data associated with the token.</p>
<h4>
  <a name="993333"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993336"> </a></code><h4>
  <a name="993338"> </a>Prototype 
</h4>
<pre class="proto"><a name="993341"></a>typedef struct _AmTokenDataTag {
   uint32_t recordId;
   struct _AmTokenDataTag *next;
} AmTokenDataType, *AmTokenDataPtr
</pre>
<h4>
  <a name="993343"> </a>Fields 
</h4>

<dl>
<dt><a name="993346"> </a><code>recordId</code></dt>
<dd><a name="993348"> </a>ID of the record that contains the dynamic data.</dd>

<dt><a name="993350"> </a><code>next</code></dt>
<dd><a name="993352"> </a>Pointer to the next <code>AmTokenDataType</code> structure in the linked list, or <code>NULL</code> if there is no additional data.</dd>

</dl>

<h3 class="hbH3">
  <a name="993359"> </a>AmTokenPrivType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993364"> </a>Purpose 
</h4>

<p><a name="993367"> </a>An opaque (to AM clients) data structure that holds information regarding the credentials that must be matched for a valid authentication to occur.</p>
<h4>
  <a name="993369"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993372"> </a></code><h4>
  <a name="993374"> </a>Prototype 
</h4>
<pre class="proto"><a name="993377"></a>typedef struct {
   AmTokenInfoType header;
   uint32_t pluginCreatorId;
   uint32_t tokenRecId;
   MemPtr dataPtr;
   uint32_t dataLength;
   AmTokenDataPtr dynamicData;
} AmTokenPrivType, *AmTokenPrivPtr
</pre>
<h4>
  <a name="993379"> </a>Fields 
</h4>

<dl>
<dt><a name="993420"> </a><code>header</code></dt>
<dd><a name="993466"> </a>Public information common to all tokens. See <a href="Am.html#993472"><code>AmTokenInfoType</code></a>.</dd>

<dt><a name="993484"> </a><code>pluginCreatorId</code></dt>
<dd><a name="993550"> </a>The creator ID that manages this token. This is the creator ID of the plug-in.</dd>

<dt><a name="993552"> </a><code>tokenRecId</code></dt>
<dd><a name="993554"> </a>Reference to the record ID for this token in the AM vault.</dd>

<dt><a name="993556"> </a><code>dataPtr</code></dt>
<dd><a name="993558"> </a>Pointer to the token's data segment.</dd>

<dt><a name="993560"> </a><code>dataLength</code></dt>
<dd><a name="993562"> </a>Length, in bytes, of the token't data segment.</dd>

<dt><a name="993564"> </a><code>dynamicData</code></dt>
<dd><a name="993566"> </a>Pointer to an <a href="AmPlugin.html#993323"><code>AmTokenDataType</code></a> structure that holds dynamic data associated with the token.</dd>

</dl>
<h4>
  <a name="993568"> </a>Comments 
</h4>

<p><a name="998958"> </a>The creation and management of tokens (these structures) is left up to the authentication plug-in.</p>

<h2 class="haH2">
  <a name="993573"> </a>AmPlugin Constants <a href="#992934"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="993605"> </a>AmCallMode Enum <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993610"> </a>Purpose 
</h4>

<p><a name="993613"> </a>Indicates whether the <code>pluginCaptureFtn()</code> entry point function is being called to create new credentials, verify existing credentials, or replace existing credentials.</p>
<h4>
  <a name="993615"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993618"> </a></code><h4>
  <a name="993620"> </a>Constants 
</h4>

<dl>
<dt><a name="993623"> </a><code>AmEnrollment = 0</code></dt>
<dd><a name="993625"> </a>The plug-in should create new credentials.</dd>

<dt><a name="993631"> </a><code>AmVerification</code></dt>
<dd><a name="993633"> </a>The plug-in should verify credentials.</dd>

<dt><a name="993635"> </a><code>AmReplacementStart</code></dt>
<dd><a name="993637"> </a>First phase of replacing a token. See the Comments section, below.</dd>

<dt><a name="993639"> </a><code>AmReplacementEnd</code></dt>
<dd><a name="993641"> </a>Second phase of replacing a token. See the Comments section, below.</dd>

</dl>
<h4>
  <a name="993643"> </a>Comments 
</h4>

<p><a name="997986"> </a>The replacement mode is used when a credential is being modified. There are two stages. <code>ReplacementStart</code> is used first. In this stage the plug-in must authenticate whoever is trying to modify the token, be it a user or an application. <code>ReplacementEnd</code> is used last; this is when the plug-in creates the new replacement credentials.</p>

<h2 class="haH2">
  <a name="993648"> </a>AmPlugin Functions and Macros <a href="#992934"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="993680"> </a>AmInitializeUIContext Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993685"> </a>Purpose 
</h4>

<p><a name="993688"> </a>Locks the UI context and grabs the event queue from the calling thread.</p>
<h4>
  <a name="993690"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993693"> </a></code><h4>
  <a name="993695"> </a>Prototype 
</h4>
<pre class="proto"><a name="993698"></a>status_t AmInitializeUIContext (
   void
)
</pre>
<h4>
  <a name="993700"> </a>Parameters 
</h4>

<p><a name="993703"> </a>None.</p>
<h4>
  <a name="993705"> </a>Returns 
</h4>

<p><a name="993708"> </a>Always returns <code>errNone</code>.</p>
<h4>
  <a name="993710"> </a>Comments 
</h4>

<p><a name="993713"> </a>If your plugin needs to interact with the user, at the point where you need to display some form of UI it should call <a href="../User_Interface/UI_Window.html#1617695"><code>WinStartThreadUI()</code></a>, then it should call this function.</p>

<p><a name="997697"> </a>If the UI context is currently locked when this function is called, this function blocks until it is released.</p>
<h4>
  <a name="993715"> </a>See Also 
</h4>

<p><a name="993718"> </a><a href="AmPlugin.html#994001"><code>AmReleaseUIContext()</code></a></p>

<h3 class="hbH3">
  <a name="993720"> </a>AmMemHandleFree Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993725"> </a>Purpose 
</h4>

<p><a name="997005"> </a>Deallocates a dynamically-created memory chunk and disassociates it from the associated token.</p>
<h4>
  <a name="993730"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993733"> </a></code><h4>
  <a name="993735"> </a>Prototype 
</h4>
<pre class="proto"><a name="993738"></a>void AmMemHandleFree (
   AmTokenPrivType <code class="par">*pPrivToken</code>,
   AmMemHandle <code class="par">hMem</code>
)
</pre>
<h4>
  <a name="993740"> </a>Parameters 
</h4>

<dl>
<dt><a name="993743"> </a><code>&rarr;  <i>pPrivToken</i></code></dt>
<dd><a name="993745"> </a>Pointer to the token with which the memory chunk is associated.</dd>

<dt><a name="993747"> </a><code>&rarr;  <i>hMem</i></code></dt>
<dd><a name="993749"> </a>Pointer to the memory chunk to be freed. This memory chunk must have been allocated with <a href="AmPlugin.html#993829"><code>AmMemHandleNew()</code></a>.</dd>

</dl>
<h4>
  <a name="993755"> </a>Returns 
</h4>

<p><a name="993761"> </a>Nothing.</p>
<h4>
  <a name="997454"> </a>Comments 
</h4>

<p><a name="997459"> </a>The memory chunk being freed should not be locked when this function is called.</p>
<h4>
  <a name="993782"> </a>See Also 
</h4>

<p><a name="993785"> </a><a href="AmPlugin.html#993829"><code>AmMemHandleNew()</code></a>, <a href="../Memory_Databases_Files/MemoryMgr.html#994259"><code>MemHandleFree()</code></a></p>

<h3 class="hbH3">
  <a name="993787"> </a>AmMemHandleLock Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993792"> </a>Purpose 
</h4>

<p><a name="993795"> </a>Obtain a pointer to a chunk of memory referenced by an <code>AmMemHandle</code>.</p>
<h4>
  <a name="993797"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993800"> </a></code><h4>
  <a name="993802"> </a>Prototype 
</h4>
<pre class="proto"><a name="993805"></a>MemPtr AmMemHandleLock (
   AmMemHandle <code class="par">hMem</code>
)
</pre>
<h4>
  <a name="993807"> </a>Parameters 
</h4>

<dl>
<dt><a name="993810"> </a><code>&rarr;  <i>hMem</i></code></dt>
<dd><a name="993812"> </a>Handle to the memory chunk. This handle must have been returned from <a href="AmPlugin.html#993829"><code>AmMemHandleNew()</code></a>.</dd>

</dl>
<h4>
  <a name="993814"> </a>Returns 
</h4>

<p><a name="993817"> </a>A pointer to the memory chunk, or <code>NULL</code> if the chunk couldn't be locked.</p>
<h4>
  <a name="993819"> </a>Comments 
</h4>

<p><a name="993822"> </a>This function does not return a pointer to the actual memory chunk in the vault. Instead, an ordinary memory buffer of the corresponding size is allocated using <a href="../Memory_Databases_Files/MemoryMgr.html#996040"><code>MemPtrNew()</code></a> and the contents of the vault chunk are copied into it. The pointer to this new buffer is returned. When <a href="AmPlugin.html#993875"><code>AmMemHandleUnlock()</code></a> is called, the buffer's contents are copied back to the vault and the buffer allocated during the call to <code>AmMemHandleLock()</code> is freed.</p>
<h4>
  <a name="993824"> </a>See Also 
</h4>

<p><a name="993827"> </a><a href="AmPlugin.html#993829"><code>AmMemHandleNew()</code></a>, <a href="AmPlugin.html#993875"><code>AmMemHandleUnlock()</code></a>, <a href="../Memory_Databases_Files/MemoryMgr.html#994367"><code>MemHandleLock()</code></a></p>

<h3 class="hbH3">
  <a name="993829"> </a>AmMemHandleNew Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993834"> </a>Purpose 
</h4>

<p><a name="996610"> </a>Allocates a memory chunk of a specified size in the vault and associates it with a specified token.</p>
<h4>
  <a name="993839"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993842"> </a></code><h4>
  <a name="993844"> </a>Prototype 
</h4>
<pre class="proto"><a name="993847"></a>AmMemHandle AmMemHandleNew (
   AmTokenPrivType <code class="par">*pPrivToken</code>,
   uint32_t <code class="par">size</code>
)
</pre>
<h4>
  <a name="993849"> </a>Parameters 
</h4>

<dl>
<dt><a name="993852"> </a><code>&rarr;  <i>pPrivToken</i></code></dt>
<dd><a name="993854"> </a>Pointer to the token with which the record is to be associated.</dd>

<dt><a name="993856"> </a><code>&rarr;  <i>size</i></code></dt>
<dd><a name="993858"> </a>Size, in bytes, of the memory chunk to be allocated.</dd>

</dl>
<h4>
  <a name="993860"> </a>Returns 
</h4>

<p><a name="993863"> </a>Returns a handle to the newly-allocated memory chunk, or 0 if the chunk could not be allocated as specified.</p>
<h4>
  <a name="993865"> </a>Comments 
</h4>

<p><a name="993868"> </a>The newly-allocated memory chunk is actually a database record of the specified size.</p>

<p><a name="997163"> </a>You must call <a href="AmPlugin.html#993787"><code>AmMemHandleLock()</code></a> in order to obtain a pointer to a buffer into which you can write (or from which you can read).</p>
<h4>
  <a name="993870"> </a>See Also 
</h4>

<p><a name="993873"> </a><a href="AmPlugin.html#993720"><code>AmMemHandleFree()</code></a>, <a href="AmPlugin.html#993787"><code>AmMemHandleLock()</code></a>, <a href="../Memory_Databases_Files/MemoryMgr.html#994503"><code>MemHandleNew()</code></a></p>

<h3 class="hbH3">
  <a name="993875"> </a>AmMemHandleUnlock Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993884"> </a>Purpose 
</h4>

<p><a name="993889"> </a>Unlocks a vault memory chunk previous locked with <a href="AmPlugin.html#993787"><code>AmMemHandleLock()</code></a>.</p>
<h4>
  <a name="993897"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="993908"> </a></code><h4>
  <a name="993918"> </a>Prototype 
</h4>
<pre class="proto"><a name="993929"></a>void AmMemHandleUnlock (
   AmMemHandle <code class="par">hMem</code>,
   MemPtr <code class="par">pMem</code>
)
</pre>
<h4>
  <a name="993943"> </a>Parameters 
</h4>

<dl>
<dt><a name="993954"> </a><code>&rarr;  <i>hMem</i></code></dt>
<dd><a name="993964"> </a>Handle to the vault memory chunk previously allocated with <a href="AmPlugin.html#993829"><code>AmMemHandleNew()</code></a>.</dd>

<dt><a name="993974"> </a><code>&rarr;  <i>pMem</i></code></dt>
<dd><a name="993984"> </a>Pointer to the memory buffer returned from a call to <a href="AmPlugin.html#993787"><code>AmMemHandleLock()</code></a>.</dd>

</dl>
<h4>
  <a name="993986"> </a>Returns 
</h4>

<p><a name="993989"> </a>Nothing.</p>
<h4>
  <a name="993991"> </a>Comments 
</h4>

<p><a name="993994"> </a>This function copies the contents of the memory buffer <code class="par">pMem</code> to the memory chunk in the vault referenced by <code class="par">hMem</code>. It then frees the buffer <code class="par">pMem</code>.</p>
<h4>
  <a name="993996"> </a>See Also 
</h4>

<p><a name="993999"> </a><a href="AmPlugin.html#993787"><code>AmMemHandleLock()</code></a>, <a href="AmPlugin.html#993829"><code>AmMemHandleNew()</code></a>, <a href="../Memory_Databases_Files/MemoryMgr.html#994867"><code>MemHandleUnlock()</code></a></p>

<h3 class="hbH3">
  <a name="994001"> </a>AmReleaseUIContext Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994006"> </a>Purpose 
</h4>

<p><a name="994009"> </a>Unlock the UI context, and release the event queue.</p>
<h4>
  <a name="994011"> </a>Declared In 
</h4>
<code>AmPlugin.h<a name="994014"> </a></code><h4>
  <a name="994016"> </a>Prototype 
</h4>
<pre class="proto"><a name="994019"></a>status_t AmReleaseUIContext (
   void
)
</pre>
<h4>
  <a name="994021"> </a>Parameters 
</h4>

<p><a name="994024"> </a>None.</p>
<h4>
  <a name="994026"> </a>Returns 
</h4>

<p><a name="997741"> </a>Always returns <code>errNone</code>.</p>
<h4>
  <a name="994031"> </a>Comments 
</h4>

<p><a name="994034"> </a>As soon as possible after the AM plugin is done interacting with the user, it should call this function and then it should call <a href="../User_Interface/UI_Window.html#1617340"><code>WinFinishThreadUI()</code></a>.</p>
<h4>
  <a name="994036"> </a>See Also 
</h4>

<p><a name="994039"> </a><a href="AmPlugin.html#993680"><code>AmInitializeUIContext()</code></a></p>

<p><a name="992930"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="SecurityAndCrypto_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SecurityAndCryptographyTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="Am.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AmPluginCodePrint.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SecurityAndCryptographyIX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>