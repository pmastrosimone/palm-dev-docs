<html>
<head>
<title>(Protein) Authentication Manager | Security and Cryptography</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:23:48">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="992934"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SecurityAndCryptographyTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SecurityAndCrypto_Part2.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AmPlugin.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SecurityAndCryptographyIX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">3 &nbsp;&nbsp;
Authentication Manager</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Security and Cryptography</p>
<p class="SubTitle">Exploring Palm OS </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="SecurityAndCrypto_Part2.html">Part II: Reference</a> </h1>
<h1 class="SideTOC1"><a href="Am.html">3  Authentication Manager</a></h1>

   <h2 class="SideTOC2"><a href="#992942">
   Authentication Manager Structures and Types</a></h2>

      <h3 class="SideTOC3"><a href="#992950">
      AmApplicationCtxType</a></h3>

      <h3 class="SideTOC3"><a href="#993343">
      AmPluginInfoType</a></h3>

      <h3 class="SideTOC3"><a href="#993387">
      AmPluginType</a></h3>

      <h3 class="SideTOC3"><a href="#993412">
      AmTokenAttributesType</a></h3>

      <h3 class="SideTOC3"><a href="#993472">
      AmTokenInfoType</a></h3>

      <h3 class="SideTOC3"><a href="#993740">
      AmTokenPropertiesType</a></h3>

      <h3 class="SideTOC3"><a href="#994072">
      AmTokenType</a></h3>

   <h2 class="SideTOC2"><a href="#1001405">
   Authentication Manager Constants</a></h2>

      <h3 class="SideTOC3"><a href="#1002670">
      Well-Known Tokens</a></h3>

      <h3 class="SideTOC3"><a href="#1001406">
      Miscellaneous Authentication Manager Constants</a></h3>

      <h3 class="SideTOC3"><a href="#1001629">
      Authentication Manager Error Codes</a></h3>

      <h3 class="SideTOC3"><a href="#994510">
      AmAuthenticationEnum</a></h3>

      <h3 class="SideTOC3"><a href="#994549">
      AmTokenCacheSettings</a></h3>

      <h3 class="SideTOC3"><a href="#994728">
      AmTokenEnum</a></h3>

      <h3 class="SideTOC3"><a href="#994771">
      AmTokenStrength</a></h3>

   <h2 class="SideTOC2"><a href="#994810">
   Authentication Manager Functions and Macros</a></h2>

      <h3 class="SideTOC3"><a href="#994850">
      AmAuthenticateToken</a></h3>

      <h3 class="SideTOC3"><a href="#994904">
      AmCreateToken</a></h3>

      <h3 class="SideTOC3"><a href="#995174">
      AmDestroyToken</a></h3>

      <h3 class="SideTOC3"><a href="#995272">
      AmGetPluginInfo</a></h3>

      <h3 class="SideTOC3"><a href="#995318">
      AmGetPluginReferences</a></h3>

      <h3 class="SideTOC3"><a href="#995403">
      AmGetTokenBySystemId</a></h3>

      <h3 class="SideTOC3"><a href="#995457">
      AmGetTokenExtendedInfo</a></h3>

      <h3 class="SideTOC3"><a href="#995546">
      AmGetTokenInfo</a></h3>

      <h3 class="SideTOC3"><a href="#995600">
      AmModifyToken</a></h3>

      <h3 class="SideTOC3"><a href="#995675">
      AmRegisterPlugin</a></h3>

      <h3 class="SideTOC3"><a href="#995721">
      AmRemovePlugin</a></h3>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1011226"> </a>The Authentication Manager provides abstract methods for authenticating access to protected objects. It allows modules (plug-ins) to be written that implement specific authentication scenarios, such as PIN, PKI, or password.  Users of the Authentication Manager deal with generic interfaces and opaque objects that define an authentication context.</p>

<p><a name="1011227"> </a>The Authentication Manager is the authority that can answer the question "Are you X?" reliably, by utilizing some method of identity verification. The question "Are you X?" may be asked either about a user or an application.</p>

<p><a name="1011228"> </a>The services provided by the Authentication Manager handle the following tasks: credential (token) management (creation, deletion, modification, and storage), authentication against stored credentials (querying user for system password), and a framework for run-time extensibility via plug-ins. </p>

<p><a name="1011331"> </a>Every authentication model is a plug-in. Palm OS Cobalt includes three authentication models: password, signed code, and hashed code.</p>

<p><a name="992936"> </a>The remainder of this chapter documents the Authentication Manager APIs. It is organized into the following sections:</p>
   <blockquote class = "bq"><a name="992948"> </a><a href="Am.html#992942">Authentication Manager Structures and Types</a></blockquote>
   <blockquote class = "bq"><a name="994103"> </a><a href="Am.html#1001405">Authentication Manager Constants</a></blockquote>
   <blockquote class = "bq"><a name="994816"> </a><a href="Am.html#994810">Authentication Manager Functions and Macros</a></blockquote>

<p><a name="992938"> </a>The header file <code>Am.h</code> declares the API that this chapter describes.</p>

<p><a name="992940"> </a></p>

<h2 class="haH2">
  <a name="992942"> </a>Authentication Manager Structures and Types <a href="#992934"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="992950"> </a>AmApplicationCtxType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="992955"> </a>Purpose 
</h4>

<p><a name="992958"> </a>A data structure that is prepared by the caller of the Authentication Manager, it holds information about the application that needs to be authenticated and other private data specific to the plug-in.  The data for the plug-in is defined by plug-in type.</p>
<h4>
  <a name="992960"> </a>Declared In 
</h4>
<code>Am.h<a name="992963"> </a></code><h4>
  <a name="992965"> </a>Prototype 
</h4>
<pre class="proto"><a name="992968"></a>typedef struct {
   uint32_t processIDKey;
   AmTokenEnum dataType;
   uint8_t padding1;
   uint16_t padding2;
   union {
      struct {
         char *password;
         uint32_t passwordLength;
         char *hint;
         uint32_t hintLength;
      } passwordCtxType;
      struct {
         uint8_t *certificateId;
         uint32_t certificateIdLength;
      } signatureCtxType;
      struct {
         uint32_t type;
         uint32_t creator;
         char *dbname;
         uint32_t dbnameLength;
      } appFingerprintCtxType;
      struct {
         uint8_t *dataPtr;
         uint32_t dataLength;
      } customCtxType;
   } data;
} AmApplicationCtxType, *AmApplicationCtxPtr
</pre>
<h4>
  <a name="992987"> </a>Fields 
</h4>

<dl>
<dt><a name="993054"> </a><code>processIDKey</code></dt>
<dd><a name="1009388"> </a>Used during authentication. The key ID of the application being authenticated must be placed here. Mostly used by the Authorization Manager, but anyone calling <a href="Am.html#994850"><code>AmAuthenticateToken()</code></a> should fill this member in.</dd>

<dt><a name="993186"> </a><code>dataType</code></dt>
<dd><a name="993252"> </a>The type of data being passed. This is one of the <a href="Am.html#994728"><code>AmTokenEnum</code></a> values, and it controls which of the <code>data</code> enum data structures applies.</dd>

<dt><a name="993258"> </a><code>padding1</code></dt>
<dd><a name="993260"> </a>Padding bytes.</dd>

<dt><a name="993262"> </a><code>padding2</code></dt>
<dd><a name="1009380"> </a>Padding bytes.</dd>

<dt><a name="1009800"> </a><code>passwordCtxType</code></dt>
<dd><a name="1010356"> </a>Data structure used when creating a password token.</dd>

<dl>
<dt><a name="993266"> </a><code>password</code></dt>
<dd><a name="993268"> </a>The clear-text password. Depending on the call, this field is used to verify or set the password.</dd>

<dt><a name="993270"> </a><code>passwordLength</code></dt>
<dd><a name="993272"> </a>Length of the password buffer, bytes.</dd>

<dt><a name="993274"> </a><code>hint</code></dt>
<dd><a name="993276"> </a>Hint to save in the new password token.</dd>

<dt><a name="993278"> </a><code>hintLength</code></dt>
<dd><a name="993280"> </a>Length of the hint buffer, in bytes.</dd>

</dl>
<dt><a name="1009915"> </a><code>signatureCtxType</code></dt>
<dd><a name="1009916"> </a>Data structure used when creating a signed-code token.</dd>

<dl>
<dt><a name="993286"> </a><code>certificateId</code></dt>
<dd><a name="993288"> </a>ID of the certificate. This field is used during creation.</dd>

<dt><a name="993290"> </a><code>certificateIdLength</code></dt>
<dd><a name="993292"> </a>Length of the certificate ID buffer, in bytes.</dd>

</dl>
<dt><a name="1010002"> </a><code>appFingerprintCtxType</code></dt>
<dd><a name="1010023"> </a>Data structure used when creating a code-fingerprint token.</dd>

<dl>
<dt><a name="993298"> </a><code>type</code></dt>
<dd><a name="993300"> </a>The type of the application's resource database.</dd>

<dt><a name="993302"> </a><code>creator</code></dt>
<dd><a name="1010029"> </a>The creator ID of the application's resource database.</dd>

<dt><a name="993306"> </a><code>dbname</code></dt>
<dd><a name="993308"> </a>The name of the application's resource database.</dd>

<dt><a name="993310"> </a><code>dbnameLength</code></dt>
<dd><a name="993312"> </a>The length, in bytes, of the application's resource database name.</dd>

</dl>
<dt><a name="1010103"> </a><code>customCtxType</code></dt>
<dd><a name="1010412"> </a>Data structure used when both creating and verifying a custom token.</dd>

<dl>
<dt><a name="993318"> </a><code>dataPtr</code></dt>
<dd><a name="993320"> </a>A data buffer passed into the plug-in.</dd>

<dt><a name="993322"> </a><code>dataLength</code></dt>
<dd><a name="993324"> </a>The length, in bytes, of the data buffer passed into the plug-in.</dd>

</dl>
</dl>

<h3 class="hbH3">
  <a name="993343"> </a>AmPluginInfoType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993348"> </a>Purpose 
</h4>

<p><a name="1008967"> </a>A structure through which the Authorization Manager shares information about a plug-in with applications. Use <a href="Am.html#995272"><code>AmGetPluginInfo()</code></a> to get plug-in information.</p>
<h4>
  <a name="993353"> </a>Declared In 
</h4>
<code>Am.h<a name="993356"> </a></code><h4>
  <a name="993358"> </a>Prototype 
</h4>
<pre class="proto"><a name="993361"></a>typedef struct {
   char friendlyName[amPluginFriendlyNameLength];
   char vendor[amPluginVendorLength];
   uint32_t version;
   AmTokenPropertiesType tokenProperties;
} AmPluginInfoType, *AmPluginInfoPtr
</pre>
<h4>
  <a name="993363"> </a>Fields 
</h4>

<dl>
<dt><a name="993366"> </a><code>friendlyName</code></dt>
<dd><a name="1008642"> </a>A "friendly" name for the plug-in that can be used for display purposes.</dd>

<dt><a name="993370"> </a><code>vendor</code></dt>
<dd><a name="993372"> </a>A string that identifies the vendor of this plug-in.</dd>

<dt><a name="993374"> </a><code>version</code></dt>
<dd><a name="993376"> </a>The plug-in's version.</dd>

<dt><a name="993378"> </a><code>tokenProperties</code></dt>
<dd><a name="993380"> </a>The properties of the tokens that this plug-in creates. A <a href="Am.html#993740"><code>AmTokenPropertiesType</code></a> value.</dd>

</dl>

<h3 class="hbH3">
  <a name="993387"> </a>AmPluginType Typedef <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993392"> </a>Purpose 
</h4>

<p><a name="1008749"> </a>Reference to a token.</p>
<h4>
  <a name="993397"> </a>Declared In 
</h4>
<code>Am.h<a name="993400"> </a></code><h4>
  <a name="993402"> </a>Prototype 
</h4>
<pre class="proto"><a name="993405"></a>typedef uint32_t AmPluginType
</pre>
<h4>
  <a name="993407"> </a>Comments 
</h4>

<p><a name="1008753"> </a>Supply a token reference of this type when getting information about a plug-in (<a href="Am.html#995272"><code>AmGetPluginInfo()</code></a>). When you retrieve a list of all plug-ins (with <a href="Am.html#995318"><code>AmGetPluginReferences()</code></a>), you receive a set of <code>AmPluginType</code> values.</p>

<h3 class="hbH3">
  <a name="993412"> </a>AmTokenAttributesType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993421"> </a>Purpose 
</h4>

<p><a name="993424"> </a>Flags that indicate various token attributes. The plug-in sets these values and uses them to allow or reject certain actions.</p>
<h4>
  <a name="993426"> </a>Declared In 
</h4>
<code>Am.h<a name="993429"> </a></code><h4>
  <a name="993431"> </a>Prototype 
</h4>
<pre class="proto"><a name="993434"></a>typedef struct {
   int destroy:1;
   int modify:1;
   int interactive:1;
   int empty:1;
   int system:1;
   int reserved:11;
   uint16_t padding;
} AmTokenAttributesType, *AmTokenAttributesPtr
</pre>
<h4>
  <a name="993436"> </a>Fields 
</h4>

<dl>
<dt><a name="993439"> </a><code>destroy</code></dt>
<dd><a name="993441"> </a>The token may be destroyed.</dd>

<dt><a name="993443"> </a><code>modify</code></dt>
<dd><a name="993445"> </a>The token can be modified.</dd>

<dt><a name="993447"> </a><code>interactive</code></dt>
<dd><a name="993449"> </a>The token is user interactive. That is, it is a password, PIN, or the like.</dd>

<dt><a name="993451"> </a><code>empty</code></dt>
<dd><a name="993453"> </a>The token is empty.</dd>

<dt><a name="993455"> </a><code>system</code></dt>
<dd><a name="993457"> </a>The token is a system token.</dd>

<dt><a name="993459"> </a><code>reserved</code></dt>
<dd><a name="993461"> </a>Reserved for future use.</dd>

<dt><a name="993463"> </a><code>padding</code></dt>
<dd><a name="993465"> </a>Padding bits.</dd>

</dl>

<h3 class="hbH3">
  <a name="993472"> </a>AmTokenInfoType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993477"> </a>Purpose 
</h4>

<p><a name="993480"> </a>The public info block that the plug-in fills in. Applications may request this info block by calling <a href="Am.html#995546"><code>AmGetTokenInfo()</code></a>.</p>
<h4>
  <a name="993482"> </a>Declared In 
</h4>
<code>Am.h<a name="993485"> </a></code><h4>
  <a name="993487"> </a>Prototype 
</h4>
<pre class="proto"><a name="993490"></a>typedef struct {
   AmTokenType ref;
   AmTokenEnum type;
   AmTokenCacheSettings cacheSettings;
   AmTokenStrength strength;
   uint8_t rfu;
   AmTokenAttributesType attributes;
   uint8_t systemId[amTokenSystemIdLength];
   char friendlyName[amTokenFriendlyNameLength];
} AmTokenInfoType, *AmTokenInfoPtr
</pre>
<h4>
  <a name="993508"> </a>Fields 
</h4>

<dl>
<dt><a name="993559"> </a><code>ref</code></dt>
<dd><a name="993609"> </a>Reference to the token.</dd>

<dt><a name="993659"> </a><code>type</code></dt>
<dd><a name="1008529"> </a>The token's type. One of the <a href="Am.html#994728"><code>AmTokenEnum</code></a> values.</dd>

<dt><a name="993711"> </a><code>cacheSettings</code></dt>
<dd><a name="993713"> </a>The cache settings that govern this token. One of the <a href="Am.html#994549"><code>AmTokenCacheSettings</code></a> values.</dd>

<dt><a name="993715"> </a><code>strength</code></dt>
<dd><a name="1008459"> </a>The strength of the token. One of the <a href="Am.html#994771"><code>AmTokenStrength</code></a> values.</dd>

<dt><a name="993719"> </a><code>rfu</code></dt>
<dd><a name="993721"> </a>Reserved for future use.</dd>

<dt><a name="993723"> </a><code>attributes</code></dt>
<dd><a name="993725"> </a>Token attribute flags. See <a href="Am.html#993412"><code>AmTokenAttributesType</code></a> for the attribute flag values.</dd>

<dt><a name="993727"> </a><code>systemId</code></dt>
<dd><a name="993729"> </a>The token's system ID. Token system IDs will never exceed <code>amTokenSystemIdLength</code> bytes in length.</dd>

<dt><a name="993731"> </a><code>friendlyName</code></dt>
<dd><a name="993733"> </a>A "friendly" name for the token that can be used for display purposes.</dd>

</dl>

<h3 class="hbH3">
  <a name="993740"> </a>AmTokenPropertiesType Struct <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="993745"> </a>Purpose 
</h4>

<p><a name="993748"> </a>Structure containing various token properties. Used when creating or modifying a token with <a href="Am.html#994904"><code>AmCreateToken()</code></a> or <a href="Am.html#995600"><code>AmModifyToken()</code></a>.</p>
<h4>
  <a name="993750"> </a>Declared In 
</h4>
<code>Am.h<a name="993767"> </a></code><h4>
  <a name="993787"> </a>Prototype 
</h4>
<pre class="proto"><a name="993824"></a>typedef struct {
   uint32_t identifier;
   AmTokenEnum type;
   AmTokenStrength strength;
   AmTokenCacheSettings cacheSettings;
   uint8_t rfu;
} AmTokenPropertiesType, *AmTokenPropertiesPtr
</pre>
<h4>
  <a name="993884"> </a>Fields 
</h4>

<dl>
<dt><a name="993927"> </a><code>identifier</code></dt>
<dd><a name="993969"> </a>Identifier for the plug-in that will service this token.</dd>

<dt><a name="994011"> </a><code>type</code></dt>
<dd><a name="994053"> </a>The token's type. One of the <a href="Am.html#994728"><code>AmTokenEnum</code></a> values.</dd>

<dt><a name="994055"> </a><code>strength</code></dt>
<dd><a name="994057"> </a>The strength of the token. One of the <a href="Am.html#994771"><code>AmTokenStrength</code></a> values.</dd>

<dt><a name="994059"> </a><code>cacheSettings</code></dt>
<dd><a name="994061"> </a>The cache settings that will govern this token. One of the <a href="Am.html#994549"><code>AmTokenCacheSettings</code></a> values.</dd>

<dt><a name="994063"> </a><code>rfu</code></dt>
<dd><a name="994065"> </a>Reserved for future use.</dd>

</dl>
<h4>
  <a name="994067"> </a>Comments 
</h4>

<p><a name="1007809"> </a>This structure is used during token creation. The application creating the token fills in the token type, strength and cache settings.</p>

<p><a name="1007810"> </a>If the token is supported by a custom plug-in, the application should fill in the custom identifier.  The Authentication Manager will match the custom identifier to the custom identifiers registered with the Authentication Manager.</p>

<h3 class="hbH3">
  <a name="994072"> </a>AmTokenType Typedef <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994077"> </a>Purpose 
</h4>

<p><a name="994080"> </a>Reference to a token.</p>
<h4>
  <a name="994082"> </a>Declared In 
</h4>
<code>Am.h<a name="994085"> </a></code><h4>
  <a name="994087"> </a>Prototype 
</h4>
<pre class="proto"><a name="994090"></a>typedef uint32_t AmTokenType, *AmTokenPtr
</pre>
<h4>
  <a name="994092"> </a>Comments 
</h4>

<p><a name="994095"> </a>Supply a token reference of this type when creating, modifying, destroying, or getting information about a token.</p>

<h2 class="haH2">
  <a name="1001405"> </a>Authentication Manager Constants <a href="#992934"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="1002670"> </a>Well-Known Tokens <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="1002735"> </a>Purpose 
</h4>

<p><a name="1002752"> </a>System IDs of various well-known tokens.</p>
<h4>
  <a name="1002763"> </a>Declared In 
</h4>
<code>Am.h<a name="1002778"> </a></code><h4>
  <a name="1002796"> </a>Constants 
</h4>

<dl>
<dt><a name="1003147"> </a><code>#define SysAdminToken "SysAdminToken"</code></dt>
<dd><a name="1003148"> </a>The Administrator token.</dd>

<dt><a name="1003150"> </a><code>#define SysEmptyToken "SysEmptyToken"</code></dt>
<dd><a name="1003151"> </a>The empty token.</dd>

<dt><a name="1003153"> </a><code>#define SysLockOutToken "SysLockOutToken"</code></dt>
<dd><a name="1003154"> </a>The "lockout" token. </dd>

<dt><a name="1003156"> </a><code>#define SysUserToken "SysUserToken"</code></dt>
<dd><a name="1003157"> </a>The User token.</dd>

</dl>

<h3 class="hbH3">
  <a name="1001406"> </a>Miscellaneous Authentication Manager Constants <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="1001407"> </a>Purpose 
</h4>

<p><a name="1001408"> </a>The header file Am.h also declares these constants.</p>
<h4>
  <a name="1001409"> </a>Declared In 
</h4>
<code>Am.h<a name="1001410"> </a></code><h4>
  <a name="1001411"> </a>Constants 
</h4>

<dl>
<dt><a name="1001482"> </a><code>#define amInvalidToken 0xFFFFFFFF</code></dt>
<dd><a name="1001483"> </a>An invalid token value. If <a href="Am.html#994904"><code>AmCreateToken()</code></a> fails, it returns <code>amInvalidToken</code> as a token value.</dd>

<dt><a name="994461"> </a><code>#define amPluginFriendlyNameLength 48</code></dt>
<dd><a name="994463"> </a>The maximum length, in bytes, of a plug-in's "friendly" name--a name that can be displayed to the user.</dd>

<dt><a name="994465"> </a><code>#define amPluginVendorLength 48</code></dt>
<dd><a name="994467"> </a>The maximum length, in bytes, of a plug-in's vendor string.</dd>

<dt><a name="994469"> </a><code>#define AmServiceName "psysAuthenticationMgr"</code></dt>
<dd><a name="1011382"> </a>The name under which the Authentication Manager is registered with the Service Manager.</dd>

<dt><a name="994477"> </a><code>#define amTokenFriendlyNameLength 36</code></dt>
<dd><a name="1008629"> </a>The maximum length, in bytes, of a token's "friendly" name--a name that can be displayed to the user.</dd>

<dt><a name="994481"> </a><code>#define amTokenSystemIdLength 20</code></dt>
<dd><a name="994483"> </a>The maximum length, in bytes, of a token's system ID.</dd>

<dt><a name="994485"> </a><code>#define amTokenTypeIdentifierLength 8</code></dt>
</dl>

<h3 class="hbH3">
  <a name="1001629"> </a>Authentication Manager Error Codes <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="1001630"> </a>Purpose 
</h4>

<p><a name="1001631"> </a>Error codes returned by the various Authentication Manager functions.</p>
<h4>
  <a name="1001632"> </a>Declared In 
</h4>
<code>Am.h<a name="1001633"> </a></code><h4>
  <a name="1001634"> </a>Constants 
</h4>

<dl>
<dt><a name="1001636"> </a><code>#define amErrActionNotSupported (amErrorClass | 0x16)</code></dt>
<dd><a name="1001637"> </a>The required action is not suppoted for this token by its plug-in.</dd>

<dt><a name="1001639"> </a><code>#define amErrAlreadyRegistered (amErrorClass | 0x0D)</code></dt>
<dd><a name="1001640"> </a>The specified plug-in was already registered.</dd>

<dt><a name="1001642"> </a><code>#define amErrAuthenticationFailed (amErrorClass | 0x10)</code></dt>
<dd><a name="1001643"> </a>The authentication operation failed.</dd>

<dt><a name="1001645"> </a><code>#define amErrBackupInProgress (amErrorClass | 0x17)</code></dt>
<dd><a name="1001646"> </a>A backup is in progress.</dd>

<dt><a name="1001648"> </a><code>#define amErrBufferTooSmall (amErrorClass | 0x14)</code></dt>
<dd><a name="1001649"> </a>The supplied buffer is too small.</dd>

<dt><a name="1001651"> </a><code>#define amErrInvalidImportBuffer (amErrorClass | 0x15)</code></dt>
<dd><a name="1001652"> </a>The supplied import buffer is invalid.</dd>

<dt><a name="1001654"> </a><code>#define amErrInvalidParam (amErrorClass | 0x02)</code></dt>
<dd><a name="1001655"> </a>One or more function parameters is invalid.</dd>

<dt><a name="1001657"> </a><code>#define amErrInvalidPlugin (amErrorClass | 0x0B)</code></dt>
<dd><a name="1007630"> </a>The specified plug-in reference is invalid.</dd>

<dt><a name="1001660"> </a><code>#define amErrInvalidToken (amErrorClass | 0x09)</code></dt>
<dd><a name="1001661"> </a>The specified token reference is invalid.</dd>

<dt><a name="1001663"> </a><code>#define amErrLibNotOpen (amErrorClass | 0x03)</code></dt>
<dd><a name="1001664"> </a>The library has not been opened.</dd>

<dt><a name="1001666"> </a><code>#define amErrLibStillOpen (amErrorClass | 0x04)</code></dt>
<dd><a name="1001667"> </a>An attempt to close the library returned without closing.</dd>

<dt><a name="1001669"> </a><code>#define amErrMaxPlugins (amErrorClass | 0x0A)</code></dt>
<dd><a name="1001670"> </a>The maximum number of plug-ins allowed in the system has been reached.</dd>

<dt><a name="1001672"> </a><code>#define amErrMaxTokens (amErrorClass | 0x08)</code></dt>
<dd><a name="1001673"> </a>The maximum number of tokens allowed in the system has been reached.</dd>

<dt><a name="1001675"> </a><code>#define amErrMemory (amErrorClass | 0x06)</code></dt>
<dd><a name="1001676"> </a>An internal memory error occurred.</dd>

<dt><a name="1001678"> </a><code>#define amErrNoPluginsAllowed (amErrorClass | 0x11)</code></dt>
<dd><a name="1001679"> </a>Security is set to high: no plug-ins are allowed.</dd>

<dt><a name="1001681"> </a><code>#define amErrNotFound (amErrorClass | 0x0C)</code></dt>
<dd><a name="1001682"> </a>The named resource was not found.</dd>

<dt><a name="1001684"> </a><code>#define amErrNotImplemented (amErrorClass | 0x01)</code></dt>
<dd><a name="1001685"> </a>The plug-in does not implement the requested function.</dd>

<dt><a name="1001687"> </a><code>#define amErrOutOfMemory (amErrorClass | 0x05)</code></dt>
<dd><a name="1001688"> </a>There was insufficient memory to complete the requested operation.</dd>

<dt><a name="1001690"> </a><code>#define amErrResourceNotFound (amErrorClass | 0x0E)</code></dt>
<dd><a name="1011167"> </a>An Authentication Manager resource or plug-in is missing.</dd>

<dt><a name="1001693"> </a><code>#define amErrTokenDestroyed (amErrorClass | 0x12)</code></dt>
<dd><a name="1001694"> </a>The token was destroyed during the action.</dd>

<dt><a name="1001696"> </a><code>#define amErrTokenExists (amErrorClass | 0x13)</code></dt>
<dd><a name="1001697"> </a>The named token already exists.</dd>

<dt><a name="1001699"> </a><code>#define amErrUnsupportedTokenType (amErrorClass | 0x07)</code></dt>
<dd><a name="1001700"> </a>The requested token type is unsupported.</dd>

<dt><a name="1001702"> </a><code>#define amErrUserCancel (amErrorClass | 0x0F)</code></dt>
<dd><a name="1001703"> </a>The user cancelled the action (such as password gathering).</dd>

</dl>

<h3 class="hbH3">
  <a name="994510"> </a>AmAuthenticationEnum Enum <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994515"> </a>Purpose 
</h4>

<p><a name="1007123"> </a>An enumeration of the different types of authentication situations.  When calling <a href="Am.html#994850"><code>AmAuthenticateToken()</code></a> you can pass a situation so that the plug-in will have an idea of the type of UI to put up for the user.</p>
<h4>
  <a name="994520"> </a>Declared In 
</h4>
<code>Am.h<a name="994523"> </a></code><h4>
  <a name="994525"> </a>Constants 
</h4>

<dl>
<dt><a name="994528"> </a><code>AmAuthenticationNone = 0</code></dt>
<dd><a name="994530"> </a>System use only.</dd>

<dt><a name="994532"> </a><code>AmAuthenticationOther</code></dt>
<dd><a name="994534"> </a>Other authentication.</dd>

<dt><a name="994536"> </a><code>AmAuthenticationDataAccess</code></dt>
<dd><a name="994538"> </a>Database access.</dd>

<dt><a name="994540"> </a><code>AmAuthenticationDeviceUnlock</code></dt>
<dd><a name="994542"> </a>The device is being unlocked.</dd>

<dt><a name="1011870"> </a><code>AmAuthenticationTokenModify</code></dt>
<dd><a name="1011871"> </a>The token is being modified. For instance, the password is changing.</dd>

</dl>

<h3 class="hbH3">
  <a name="994549"> </a>AmTokenCacheSettings Enum <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994554"> </a>Purpose 
</h4>

<p><a name="994557"> </a>Different policies that can be applied to a token in the system.  The application creating the token defines the cache settings.</p>
<h4>
  <a name="994571"> </a>Declared In 
</h4>
<code>Am.h<a name="994592"> </a></code><h4>
  <a name="994616"> </a>Constants 
</h4>

<dl>
<dt><a name="994643"> </a><code>AmTokenCacheNever</code></dt>
<dd><a name="1006797"> </a>The token is not cached.</dd>

<dt><a name="994695"> </a><code>AmTokenCacheSystem</code></dt>
<dd><a name="994721"> </a>The token is kept in the system's token cache.</dd>

</dl>

<h3 class="hbH3">
  <a name="994728"> </a>AmTokenEnum Enum <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994733"> </a>Purpose 
</h4>

<p><a name="994736"> </a>An enumeration of the different types of tokens that can be requested from the system.</p>
<h4>
  <a name="994738"> </a>Declared In 
</h4>
<code>Am.h<a name="994741"> </a></code><h4>
  <a name="994743"> </a>Constants 
</h4>

<dl>
<dt><a name="994746"> </a><code>AmTokenUnknown = 0</code></dt>
<dd><a name="994748"> </a>The token type is unknown.</dd>

<dt><a name="994750"> </a><code>AmTokenCustom</code></dt>
<dd><a name="994752"> </a>A custom token. See the Comments section, below, for more on custom tokens.</dd>

<dt><a name="994754"> </a><code>AmTokenPassword</code></dt>
<dd><a name="994756"> </a>A password token.</dd>

<dt><a name="994758"> </a><code>AmTokenSignedCode</code></dt>
<dd><a name="994760"> </a>A signed code token.</dd>

<dt><a name="994762"> </a><code>AmTokenCodeFingerprint</code></dt>
<dd><a name="994764"> </a>A code-fingerprint (hash) token.</dd>

</dl>
<h4>
  <a name="994766"> </a>Comments 
</h4>

<p><a name="994769"> </a>These are the most common type of tokens that the device will deal with.  The custom type allows the plug-in to announce a custom type of plug-in that it will service.  If an application requests a custom type token, the Authentication Manager examines all plug-ins and find all that match that custom type.  Out of all the matches the best fit is picked to create the token.</p>

<h3 class="hbH3">
  <a name="994771"> </a>AmTokenStrength Enum <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994776"> </a>Purpose 
</h4>

<p><a name="994779"> </a>Token strengths: the minimum level of strength that a plug-in supports for token creation.</p>
<h4>
  <a name="994781"> </a>Declared In 
</h4>
<code>Am.h<a name="994784"> </a></code><h4>
  <a name="994786"> </a>Constants 
</h4>

<dl>
<dt><a name="994789"> </a><code>AmTokenStrengthLow</code></dt>
<dd><a name="994791"> </a>Lowest level. No requirements for token creation.</dd>

<dt><a name="994793"> </a><code>AmTokenStrengthMedium</code></dt>
<dd><a name="994799"> </a>Some measures are taken to reject weak tokens.</dd>

<dt><a name="994801"> </a><code>AmTokenStrengthHigh</code></dt>
<dd><a name="994803"> </a>The generated token should be guaranteed to not be a weak token.</dd>

</dl>
<h4>
  <a name="994805"> </a>Comments 
</h4>

<p><a name="1005870"> </a>A weak token is an authentication token that can be easily guessed or broken, such as dictionary words for passwords, or weak cryptography keys.</p>

<h2 class="haH2">
  <a name="994810"> </a>Authentication Manager Functions and Macros <a href="#992934"><span class="nav">^TOP^</span></a>
</h2>


<h3 class="hbH3">
  <a name="994850"> </a>AmAuthenticateToken Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994855"> </a>Purpose 
</h4>

<p><a name="994858"> </a>Authenticates a token.</p>
<h4>
  <a name="994860"> </a>Declared In 
</h4>
<code>Am.h<a name="994863"> </a></code><h4>
  <a name="994865"> </a>Prototype 
</h4>
<pre class="proto"><a name="994868"></a>status_t AmAuthenticateToken (
   AmTokenType <code class="par">token</code>,
   AmApplicationCtxPtr <code class="par">pAppCtx</code>,
   AmAuthenticationEnum <code class="par">authType</code>,
   char <code class="par">*titleString</code>,
   char <code class="par">*descriptionString</code>
)
</pre>
<h4>
  <a name="994870"> </a>Parameters 
</h4>

<dl>
<dt><a name="994873"> </a><code>&rarr;  <i>token</i></code></dt>
<dd><a name="994875"> </a>The token to be authenticated.</dd>

<dt><a name="994877"> </a><code>&harr;  <i>pAppCtx</i></code></dt>
<dd><a name="994879"> </a>A pointer to the application context information. The application context contains data that the application wishes to pass to the plug-in. The plug-in may also return data in this structure.</dd>

<dt><a name="994881"> </a><code>&rarr;  <i>authType</i></code></dt>
<dd><a name="994883"> </a>A hint to the Authentication Manager about why the token is being authenticated&#8212;one of the <a href="Am.html#994510"><code>AmAuthenticationEnum</code></a> values.  This hint will be passed onto the plug-in that handles this type of token.  The plug-in is free to use the hint as it sees fit.  The hint is useful when the plug-in displays UI to the user.</dd>

<dt><a name="994885"> </a><code>&rarr;  <i>titleString</i></code></dt>
<dd><a name="1011860"> </a>An optional string that is passed into the plug-in.  The plug-in may choose to display the string to the user if it is interactive.  The string is meant to be a reason for the authentication request. Pass <code>NULL</code> if the plug-in doesn't display a string or if you don't want one displayed.</dd>

<dd><a name="996611"> </a>The plug-in will typically display this string on the title of the modal window for authentication.  Accordingly, the string must fit in the title of the window.</dd>

<dt><a name="1011843"> </a><code>&rarr;  <i>descriptionString</i></code></dt>
<dd><a name="1011844"> </a>An optional string that is passed into the plug-in.  The plug-in may choose to display the string to the user if it is interactive.  The string is meant to be a more in-depth description of the reason for the authentication request. Pass <code>NULL</code> if the plug-in doesn't display a string or if you don't want one displayed.</dd>

</dl>
<h4>
  <a name="994889"> </a>Returns 
</h4>

<p><a name="996711"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="996712"> </a><code>AmErrInvalidToken</code></dt>
<dd><a name="996796"> </a>The token reference is invalid.</dd>

<dt><a name="996713"> </a><code>AmErrAuthenticationFailed</code></dt>
<dd><a name="996847"> </a>The authentication failed.</dd>

<dt><a name="996714"> </a><code>AmErrOutOfMemory</code></dt>
<dd><a name="996858"> </a>The Authentication Manager ran out of memory while attempting to authenticate the token.</dd>

</dl>
<h4>
  <a name="994894"> </a>Comments 
</h4>

<p><a name="994897"> </a>The Authentication Manager invokes the plug-in to gather a new token, and then calls the plug-in to compare the new token with the supplied token.  If the plug-in decides that they are a match, the authentication is successful.</p>

<h3 class="hbH3">
  <a name="994904"> </a>AmCreateToken Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="994909"> </a>Purpose 
</h4>

<p><a name="994912"> </a>Create a new token.</p>
<h4>
  <a name="994914"> </a>Declared In 
</h4>
<code>Am.h<a name="994917"> </a></code><h4>
  <a name="994919"> </a>Prototype 
</h4>
<pre class="proto"><a name="994922"></a>status_t AmCreateToken (
   AmTokenPtr <code class="par">pToken</code>,
   char <code class="par">*pSystemId</code>,
   char <code class="par">*pFriendlyName</code>,
   AmTokenPropertiesPtr <code class="par">pProperties</code>,
   AmApplicationCtxPtr <code class="par">pAppCtx</code>,
   Boolean <code class="par">systemToken</code>
)
</pre>
<h4>
  <a name="994940"> </a>Parameters 
</h4>

<dl>
<dt><a name="994991"> </a><code>&larr;  <i>pToken</i></code></dt>
<dd><a name="1000543"> </a>Pointer to an <a href="Am.html#994072"><code>AmTokenType</code></a> variable that receives the reference to the newly-created token. If an error occurs, <code>*</code><code class="par">pToken</code> is set to <code>amInvalidToken</code>.</dd>

<dt><a name="995091"> </a><code>&rarr;  <i>pSystemId</i></code></dt>
<dd><a name="997019"> </a>Optional system name for this token.  This is a system unique name; applications can later get a reference to this token by looking up this ID. If this argument is set to <code>NULL</code>, a system ID will be assigned by the Authentication Manager to this token.</dd>

<dd><a name="997022"> </a>The name is copied into system space, so it may be de-allocated by the caller as soon as this function returns.</dd>

<dt><a name="995143"> </a><code>&rarr;  <i>pFriendlyName</i></code></dt>
<dd><a name="995145"> </a>Optional pointer to a string buffer containing the "friendly" name that will be associated with this token. This is a name that can be displayed to the user.</dd>

<dt><a name="995147"> </a><code>&rarr;  <i>pProperties</i></code></dt>
<dd><a name="995149"> </a>A description of the parameters the new token should meet.  The system will attempt to meet all requirements, but this is not guaranteed.  The only parameter that must be met is the type of token.</dd>

<dt><a name="997635"> </a><code>&harr;  <i>pAppCtx</i></code></dt>
<dd><a name="997636"> </a>A pointer to the application context information. The application context contains data that the application wishes to pass to the plug-in. The plug-in may also return data in this structure.</dd>

<dt><a name="995155"> </a><code>&rarr;  <i>systemToken</i></code></dt>
<dd><a name="997700"> </a><code>true</code> if this token should be marked as a system token. The only difference between a non-system token and a system token is that when they are destroyed, the reference to the token is not invalidated.  The Authentication Manager will keep the token's reference valid, but the token will be empty after being destroyed.  The notification about the token being destroyed is still sent to the Authorization Manager.</dd>

</dl>
<h4>
  <a name="997972"> </a>Returns 
</h4>

<p><a name="998508"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="998493"> </a><code>AmErrInvalidParam</code></dt>
<dd><a name="998521"> </a>One of the input parameters is invalid (most likely a <code>NULL</code> <code class="par">pToken</code>).</dd>

<dt><a name="998494"> </a><code>AmErrSystemIDInUse</code></dt>
<dd><a name="998530"> </a>The specified token system ID is already in use.</dd>

<dt><a name="998495"> </a><code>AmErrSystemIDTooLong</code></dt>
<dd><a name="998541"> </a>The name was larger than allowed. The token was not created.</dd>

<dt><a name="998496"> </a><code>AmErrOutOfMemory</code></dt>
<dd><a name="998572"> </a>The Authentication Manager ran out of memory</dd>

<dt><a name="998497"> </a><code>AmErrUnsupportedTokenType</code></dt>
<dd><a name="998577"> </a>The specified token type is not supported</dd>

</dl>
<h4>
  <a name="997974"> </a>Comments 
</h4>

<p><a name="997975"> </a>The token property parameter is used by the caller to describe the desired properties of the new token.  The system will find the plug-in that best meets these requirements, but does not guarantee that all (or any) requirements will be met.  Once a token has been created, the caller may call <a href="Am.html#995546"><code>AmGetTokenInfo()</code></a> to get the properties of the created token.</p>
<h4>
  <a name="995169"> </a>See Also 
</h4>

<p><a name="995172"> </a><a href="Am.html#995174"><code>AmDestroyToken()</code></a>, <a href="Am.html#995600"><code>AmModifyToken()</code></a></p>

<h3 class="hbH3">
  <a name="995174"> </a>AmDestroyToken Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995179"> </a>Purpose 
</h4>

<p><a name="995182"> </a>Frees all resources associated with a specified token.</p>
<h4>
  <a name="995184"> </a>Declared In 
</h4>
<code>Am.h<a name="995187"> </a></code><h4>
  <a name="995189"> </a>Prototype 
</h4>
<pre class="proto"><a name="995192"></a>status_t AmDestroyToken (
   AmTokenType <code class="par">token</code>,
   AmApplicationCtxPtr <code class="par">pAppCtx</code>
)
</pre>
<h4>
  <a name="995194"> </a>Parameters 
</h4>

<dl>
<dt><a name="995197"> </a><code>&rarr;  <i>token</i></code></dt>
<dd><a name="995199"> </a>Reference to the token to destroy.</dd>

<dt><a name="998992"> </a><code>&harr;  <i>pAppCtx</i></code></dt>
<dd><a name="998993"> </a>A pointer to the application context information. The application context contains data that the application wishes to pass to the plug-in. The plug-in may also return data in this structure.</dd>

</dl>
<h4>
  <a name="995257"> </a>Returns 
</h4>

<p><a name="999065"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="999034"> </a><code>AmErrInvalidParam</code></dt>
<dd><a name="999097"> </a>One of the input parameters is invalid.</dd>

<dt><a name="999035"> </a><code>AmErrInvalidToken</code></dt>
<dd><a name="999106"> </a>The referenced token does not exist.</dd>

<dt><a name="999036"> </a><code>AmErrTokenDestructionRejected</code></dt>
<dd><a name="999115"> </a>Destruction of the token failed, either due to the user rejecting it, or the plug-in vetoing the destruction, or the authentication of the protecting token failing.</dd>

</dl>
<h4>
  <a name="995262"> </a>Comments 
</h4>

<p><a name="998603"> </a>Call this function when you would like to remove the token from the system, but cannot authenticate against it prior to its deletion.  (That is, the token is lost).</p>

<p><a name="998605"> </a>The Authentication Manager will verify if there are other tokens protecting the destruction of this token. If there are, those tokens must be authenticated prior to destruction of the specified token.</p>

<p><a name="998607"> </a>The Authentication Manager will verify if the action is allowed with the plug-in. If it is allowed then the token will be removed, <i>along with all the data that it protected</i>.  Care must be taken when a plug-in allows destruction of tokens, as the deletion of certain data objects may leave the system in a non-useful state.</p>

<p><a name="998609"> </a>Any application may call this function when a token is lost, even if they did not create the token.  (All data protected by this token is deleted though, so this doesn't introduce a security loophole). The Authentication Manager will display a dialog informing the user that the destruction of the token will lead to possible data loss.</p>

<p><a name="998611"> </a>When the token is destroyed, a notification is broadcast throughout the system about the token being destroyed.</p>
<h4>
  <a name="995267"> </a>See Also 
</h4>

<p><a name="995270"> </a><a href="Am.html#994904"><code>AmCreateToken()</code></a>, <a href="Am.html#995600"><code>AmModifyToken()</code></a></p>

<h3 class="hbH3">
  <a name="995272"> </a>AmGetPluginInfo Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995277"> </a>Purpose 
</h4>

<p><a name="995280"> </a>Get the public info block for a plug-in.</p>
<h4>
  <a name="995282"> </a>Declared In 
</h4>
<code>Am.h<a name="995285"> </a></code><h4>
  <a name="995287"> </a>Prototype 
</h4>
<pre class="proto"><a name="995290"></a>status_t AmGetPluginInfo (
   AmPluginType <code class="par">plugin</code>,
   AmPluginInfoPtr <code class="par">pInfo</code>
)
</pre>
<h4>
  <a name="995292"> </a>Parameters 
</h4>

<dl>
<dt><a name="995295"> </a><code>&rarr;  <i>plugin</i></code></dt>
<dd><a name="995297"> </a><a href="Am.html#993387"><code>AmPluginType</code></a> that references the plug-in for which you want information.</dd>

<dt><a name="995299"> </a><code>&larr;  <i>pInfo</i></code></dt>
<dd><a name="995301"> </a>Pointer to an <a href="Am.html#993343"><code>AmPluginInfoType</code></a> structure, allocated by the caller, that is filled in by this function.</dd>

</dl>
<h4>
  <a name="995303"> </a>Returns 
</h4>

<p><a name="999178"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="999163"> </a><code>AmErrInvalidParam</code></dt>
<dd><a name="999235"> </a><code class="par">pInfo</code> is <code>NULL</code>.</dd>

<dt><a name="999164"> </a><code>AmErrInvalidPlugin</code></dt>
<dd><a name="999236"> </a>The reference to the plug-in is invalid.</dd>

</dl>
<h4>
  <a name="995308"> </a>Comments 
</h4>

<p><a name="995311"> </a>The <a href="Am.html#993343"><code>AmPluginInfoType</code></a> data structure contains information about the plug-in, such as vendor name, friendly name, and information about the type of tokens that the plug-in can create.</p>

<h3 class="hbH3">
  <a name="995318"> </a>AmGetPluginReferences Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995323"> </a>Purpose 
</h4>

<p><a name="995326"> </a>Get references to all of the plug-ins registered on the system.</p>
<h4>
  <a name="995328"> </a>Declared In 
</h4>
<code>Am.h<a name="995331"> </a></code><h4>
  <a name="995333"> </a>Prototype 
</h4>
<pre class="proto"><a name="995336"></a>status_t AmGetPluginReferences (
   AmPluginType <code class="par">*refList</code>,
   uint16_t <code class="par">*pSize</code>
)
</pre>
<h4>
  <a name="995338"> </a>Parameters 
</h4>

<dl>
<dt><a name="995341"> </a><code>&larr;  <i>refList</i></code></dt>
<dd><a name="995343"> </a>A caller-allocated array where references to the installed plug-ins are returned, or <code>NULL</code> to determine how large the array should be. Each array element is an <a href="Am.html#993387"><code>AmPluginType</code></a> that references a single plug-in.</dd>

<dt><a name="995345"> </a><code>&harr;  <i>pSize</i></code></dt>
<dd><a name="995347"> </a>The number of elements in the <code class="par">refList</code> array. If <code class="par">refList</code> is <code>NULL</code>, or if the supplied array isn't large enough, this function sets <code>*</code><code class="par">pSize</code> to the required array size.</dd>

</dl>
<h4>
  <a name="999971"> </a>Returns 
</h4>

<p><a name="999572"> </a>Returns <code>errNone</code> if the operation completed successfully, or <code>AmErrBufferTooSmall</code> if the supplied buffer is too small.</p>
<h4>
  <a name="995368"> </a>Comments 
</h4>

<p><a name="995374"> </a>When calling this function you must pre-allocate an array of references and pass the address of this array in <code class="par">refList</code>. If the buffer is too small or if <code class="par">refList</code> is <code>NULL</code>, the <code class="par">pSize</code> parameter is set to the required number of entries in the array. Accordingly, you may want to call this function twice. First, call it with <code class="par">refList</code> set to <code>NULL</code> in order to obtain the size of the needed buffer. Then, after allocating a buffer of the proper size, call this function again to obtain the plug in references.</p>
<h4>
  <a name="995382"> </a>See Also 
</h4>

<p><a name="995393"> </a><a href="Am.html#995272"><code>AmGetPluginInfo()</code></a></p>

<h3 class="hbH3">
  <a name="995403"> </a>AmGetTokenBySystemId Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995416"> </a>Purpose 
</h4>

<p><a name="995419"> </a>Find a token reference given its system ID.</p>
<h4>
  <a name="995421"> </a>Declared In 
</h4>
<code>Am.h<a name="995424"> </a></code><h4>
  <a name="995426"> </a>Prototype 
</h4>
<pre class="proto"><a name="995429"></a>status_t AmGetTokenBySystemId (
   AmTokenPtr <code class="par">pToken</code>,
   char <code class="par">*pSystemId</code>
)
</pre>
<h4>
  <a name="995431"> </a>Parameters 
</h4>

<dl>
<dt><a name="995434"> </a><code>&larr;  <i>pToken</i></code></dt>
<dd><a name="1000324"> </a>Pointer to an <a href="Am.html#994072"><code>AmTokenType</code></a> variable that receives the reference to the token.</dd>

<dt><a name="995438"> </a><code>&rarr;  <i>pSystemId</i></code></dt>
<dd><a name="995440"> </a>The token's system ID.</dd>

</dl>
<h4>
  <a name="995442"> </a>Returns 
</h4>

<p><a name="1000166"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="1000193"> </a><code>AmErrSystemIDUnknown</code></dt>
<dd><a name="1000214"> </a>The requested token was not found</dd>

<dt><a name="1000194"> </a><code>AmErrInvalidParameter</code></dt>
<dd><a name="1000222"> </a><code class="par">pToken</code> is <code>NULL</code></dd>

</dl>
<h4>
  <a name="995447"> </a>Comments 
</h4>

<p><a name="995450"> </a>This function allows for the creation of "well known" tokens, such as the system password, and the admin password on a device.  Applications that wish to protect data with the system password can get a reference to it by invoking this function. See <a href="Am.html#1002670">"Well-Known Tokens"</a> for the predefined set of well-known tokens.</p>

<h3 class="hbH3">
  <a name="995457"> </a>AmGetTokenExtendedInfo Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995462"> </a>Purpose 
</h4>

<p><a name="1003212"> </a>Get extra information about this token.</p>
<h4>
  <a name="995467"> </a>Declared In 
</h4>
<code>Am.h<a name="995470"> </a></code><h4>
  <a name="995472"> </a>Prototype 
</h4>
<pre class="proto"><a name="995475"></a>status_t AmGetTokenExtendedInfo (
   AmTokenType <code class="par">token</code>,
   uint8_t <code class="par">*pExtInfo</code>,
   uint32_t <code class="par">*pExtInfolen</code>
)
</pre>
<h4>
  <a name="995477"> </a>Parameters 
</h4>

<dl>
<dt><a name="995480"> </a><code>&rarr;  <i>token</i></code></dt>
<dd><a name="995482"> </a>A reference to the token about which information is needed.</dd>

<dt><a name="995484"> </a><code>&larr;  <i>pExtInfo</i></code></dt>
<dd><a name="995486"> </a>Pointer to the buffer into which the information is written, or <code>NULL</code> to determine how large the buffer should be.</dd>

<dt><a name="995488"> </a><code>&larr;  <i>pExtInfolen</i></code></dt>
<dd><a name="995490"> </a>The size of the <code class="par">pExtInfo</code> buffer. If <code class="par">pExtInfo</code> is <code>NULL</code> or if this parameter's value indicates that the <code class="par">pExtInfo</code> buffer isn't large enough to hold the information to be returned, the size of the needed buffer is written to <code>*</code><code class="par">pExtInfolen</code>.</dd>

</dl>
<h4>
  <a name="995492"> </a>Returns 
</h4>

<p><a name="1003848"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="1003885"> </a><code>AmErrInvalidParam</code></dt>
<dd><a name="1003907"> </a><code class="par">pExtInfo</code> is NULL.</dd>

<dt><a name="1003886"> </a><code>AmErrInvalidToken</code></dt>
<dd><a name="1003944"> </a>The referenced token is invalid.</dd>

<dt><a name="1003887"> </a><code>AmErrBufferTooSmall</code></dt>
<dd><a name="1003961"> </a><code class="par">pExtInfo</code> is too small to hold the extended information. The correct size is returned in <code>*</code><code class="par">pExtInfolen</code>.</dd>

<dt><a name="1004149"> </a><code>AmErrNotSupported</code></dt>
<dd><a name="1004150"> </a>The underlying plug-in doesn't provide any extra information about the token.</dd>

</dl>
<h4>
  <a name="995511"> </a>Comments 
</h4>

<p><a name="1004111"> </a>The plug-in responds to this call directly. For PKI tokens managed by the Palm OS PKI plug-in, the returned data is the certificate ID of the token (in an <a href="AmPluginSignedCode.html#992950"><code>AmPluginSignedCodeExtInfoType</code></a> structure). For tokens managed by the Palm OS Code Fingerprint plug-in, the returned data contains the type, creator, and name of the database that was fingerprinted (in an <a href="AmPluginCodePrint.html#992950"><code>AmPluginCodePrintExtInfoType</code></a> structure). For password tokens managed by the Palm OS password plug-in, the returned data is the hint. No extended information is available for code-fingerprint tokens managed by the Palm OS code-fingerprint plug-in.</p>
<h4>
  <a name="995525"> </a>See Also 
</h4>

<p><a name="995536"> </a><a href="Am.html#995546"><code>AmGetTokenInfo()</code></a></p>

<h3 class="hbH3">
  <a name="995546"> </a>AmGetTokenInfo Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995559"> </a>Purpose 
</h4>

<p><a name="1004152"> </a>Get the public info block for the referenced token.</p>
<h4>
  <a name="995564"> </a>Declared In 
</h4>
<code>Am.h<a name="995567"> </a></code><h4>
  <a name="995569"> </a>Prototype 
</h4>
<pre class="proto"><a name="995572"></a>status_t AmGetTokenInfo (
   AmTokenType <code class="par">token</code>,
   AmTokenInfoPtr <code class="par">pInfo</code>
)
</pre>
<h4>
  <a name="995574"> </a>Parameters 
</h4>

<dl>
<dt><a name="995577"> </a><code>&rarr;  <i>token</i></code></dt>
<dd><a name="1004181"> </a>A reference to the token about which information is needed.</dd>

<dt><a name="995581"> </a><code>&larr;  <i>pInfo</i></code></dt>
<dd><a name="995583"> </a>Pointer to a location into which the contents of the token's public info block are written. This should be a <a href="Am.html#993472"><code>AmTokenInfoType</code></a> structure.</dd>

</dl>
<h4>
  <a name="995585"> </a>Returns 
</h4>

<p><a name="1004285"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="1004298"> </a><code>AmErrInvalidParam</code></dt>
<dd><a name="1004308"> </a><code class="par">pInfo</code> is <code>NULL</code>.</dd>

<dt><a name="1004299"> </a><code>AmErrInvalidToken</code></dt>
<dd><a name="1004313"> </a>The referenced token is invalid.</dd>

</dl>
<h4>
  <a name="995590"> </a>Comments 
</h4>

<p><a name="1004236"> </a>Applications call this function after creating a token to examine the properties of the generated token.</p>
<h4>
  <a name="995595"> </a>See Also 
</h4>

<p><a name="995598"> </a><a href="Am.html#994904"><code>AmCreateToken()</code></a>, <a href="Am.html#995457"><code>AmGetTokenExtendedInfo()</code></a></p>

<h3 class="hbH3">
  <a name="995600"> </a>AmModifyToken Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995605"> </a>Purpose 
</h4>

<p><a name="1004315"> </a>Replace or modify an existing token. </p>
<h4>
  <a name="995610"> </a>Declared In 
</h4>
<code>Am.h<a name="995613"> </a></code><h4>
  <a name="995615"> </a>Prototype 
</h4>
<pre class="proto"><a name="995618"></a>status_t AmModifyToken (
   AmTokenType <code class="par">token</code>,
   AmTokenPropertiesPtr <code class="par">pProperties</code>,
   AmApplicationCtxPtr <code class="par">pAppCtxOld</code>,
   AmApplicationCtxPtr <code class="par">pAppCtxNew</code>
)
</pre>
<h4>
  <a name="995620"> </a>Parameters 
</h4>

<dl>
<dt><a name="995623"> </a><code>&rarr;  <i>token</i></code></dt>
<dd><a name="995625"> </a>Reference to the token to be modified.  The new token replaces the old token, using the same reference.</dd>

<dt><a name="995627"> </a><code>&rarr;  <i>pProperties</i></code></dt>
<dd><a name="1004649"> </a>An optional description of the parameters the new token should meet.  The system will attempt to meet all requirements, but that is not guaranteed.  The only parameter that must be met is the type of token.</dd>

<dd><a name="1004650"> </a>If no new properties are specified (pass <code>NULL</code> for this parameter), the properties of the token being modified are not changed.</dd>

<dt><a name="995631"> </a><code>&rarr;  <i>pAppCtxOld</i></code></dt>
<dd><a name="995633"> </a>A pointer to the application context information as it relates the token being modified.  The caller may place information required to authenticate the token&#8212;such as a password, for a password token&#8212;in the application context.</dd>

<dt><a name="995635"> </a><code>&rarr;  <i>pAppCtxNew</i></code></dt>
<dd><a name="995637"> </a>A pointer to the application context information for the new token that will be created to replace the token being modified, or <code>NULL</code>. The caller may place information needed to create the token in this optional parameter.</dd>

</dl>
<h4>
  <a name="995643"> </a>Returns 
</h4>

<p><a name="1004765"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="1004793"> </a><code>AmErrInvalidParam</code></dt>
<dd><a name="1004969"> </a>One of the input parameters is invalid (most likely a <code>NULL</code> <code class="par">pToken</code>).</dd>

<dt><a name="1004794"> </a><code>AmErrInvalidToken</code></dt>
<dd><a name="1005029"> </a>The specified token was not found.</dd>

<dt><a name="1004795"> </a><code>AmErrOutOfMemory</code></dt>
<dd><a name="1005031"> </a>The Authentication Manager ran out of memory</dd>

<dt><a name="1004796"> </a><code>AmErrUnsupportedTokenType</code></dt>
<dd><a name="1005034"> </a>Token type is not supported</dd>

<dt><a name="1004797"> </a><code>AmErrModifyRejected</code></dt>
<dd><a name="1005035"> </a>The modification action was rejected: authentication of the token protecting the to-be-modified token must have failed.</dd>

</dl>
<h4>
  <a name="995657"> </a>Comments 
</h4>

<p><a name="1005236"> </a>Applications wishing to change tokens, (for instance, to change the password, clear the password, and so on) use this function. This function can be used to replace or even remove (by making the token empty) an authentication token. The token being modified is destroyed and a new token is created which takes its place.</p>

<p><a name="1004581"> </a>The actual operation of this function depends on the plug-in.  </p>

<p><a name="1005040"> </a>If the token properties are specified, and a different token type is requested, then the replacement token that is created will be of a different type.  (For example, you may replace a password token with a biometric token).  This means that the authentication model is changed.</p>

<p><a name="1004582"> </a>Tokens may be protected from modification by authentication contexts.  With the help of the Authorization Manager the Authentication Manager authenticates the user prior to modification of the token.</p>

<p><a name="1004583"> </a>After authentication for modify, the Authentication Manager creates a new token, given the properties supplied in <code class="par">pProperties</code>.  The new token will replace the old token.</p>
<h4>
  <a name="995670"> </a>See Also 
</h4>

<p><a name="995673"> </a><a href="Am.html#994904"><code>AmCreateToken()</code></a>, <a href="Am.html#995174"><code>AmDestroyToken()</code></a></p>

<h3 class="hbH3">
  <a name="995675"> </a>AmRegisterPlugin Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995680"> </a>Purpose 
</h4>

<p><a name="995683"> </a>Register a plug-in in the Authentication Manager.</p>
<h4>
  <a name="995685"> </a>Declared In 
</h4>
<code>Am.h<a name="995688"> </a></code><h4>
  <a name="995690"> </a>Prototype 
</h4>
<pre class="proto"><a name="995693"></a>status_t AmRegisterPlugin (
   uint32_t <code class="par">creator</code>,
   Boolean <code class="par">force</code>
)
</pre>
<h4>
  <a name="995695"> </a>Parameters 
</h4>

<dl>
<dt><a name="995698"> </a><code>&rarr;  <i>creator</i></code></dt>
<dd><a name="995700"> </a>The creator ID of the plug-in being registered.</dd>

<dt><a name="995702"> </a><code>&rarr;  <i>force</i></code></dt>
<dd><a name="995704"> </a><code>true</code> to force the registration, even if the plug-in has already been loaded. </dd>

</dl>
<h4>
  <a name="995706"> </a>Returns 
</h4>

<p><a name="1005591"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="1005596"> </a><code>AmErrOutOfMemory</code></dt>
<dd><a name="1005603"> </a>Out of memory.</dd>

<dt><a name="1005597"> </a><code>AmErrAlreadyRegistered</code></dt>
<dd><a name="1005604"> </a>The plug-in was already registered and <code class="par">force</code> is set to <code>false</code>.</dd>

</dl>
<h4>
  <a name="995711"> </a>Comments 
</h4>

<p><a name="995714"> </a>Note that although you specify the plug-in's creator, you don't specify its type. The plug-in type is implicit: all plug-ins are of type <code>'ampl'</code>.</p>

<p><a name="1005527"> </a>The plug-in's shared library need not be loaded prior to registration. This function loads and opens the shared library. If you set <code class="par">force</code> to <code>true</code>, forcing a re-registration, the shared library is closed and unloaded. Then, it is reloaded and reopened. The reference  to the plug-in doesn't change: it is re-used. Thus, all tokens still have a valid reference to their creator.</p>
<h4>
  <a name="995716"> </a>See Also 
</h4>

<p><a name="995719"> </a><a href="Am.html#995721"><code>AmRemovePlugin()</code></a></p>

<h3 class="hbH3">
  <a name="995721"> </a>AmRemovePlugin Function <a href="#992934"><span class="nav">^TOP^</span></a>
</h3>

<h4>
  <a name="995726"> </a>Purpose 
</h4>

<p><a name="995729"> </a>Remove a registered plug-in.</p>
<h4>
  <a name="995731"> </a>Declared In 
</h4>
<code>Am.h<a name="995734"> </a></code><h4>
  <a name="995736"> </a>Prototype 
</h4>
<pre class="proto"><a name="995739"></a>status_t AmRemovePlugin (
   uint32_t <code class="par">creator</code>
)
</pre>
<h4>
  <a name="995741"> </a>Parameters 
</h4>

<dl>
<dt><a name="995744"> </a><code>&rarr;  <i>creator</i></code></dt>
<dd><a name="1005622"> </a>The creator ID of the plug-in being removed.</dd>

</dl>
<h4>
  <a name="995748"> </a>Returns 
</h4>

<p><a name="1005628"> </a>Returns <code>errNone</code> if the operation completed successfully, or one of the following otherwise:</p>

<dl>
<dt><a name="1005633"> </a><code>AmErrNotFound</code></dt>
<dd><a name="1005641"> </a>A plug-in with the specified creator ID has not been registered.</dd>

<dt><a name="1005634"> </a><code>AmErrHasTokens</code></dt>
<dd><a name="1005645"> </a>Tokens exist for this plug-in, and removing the plug-in would invalidate them.</dd>

</dl>
<h4>
  <a name="995753"> </a>Comments 
</h4>

<p><a name="995756"> </a>In order for this function to work, there must not be any tokens with references back to this plug-in.</p>
<h4>
  <a name="995758"> </a>See Also 
</h4>

<p><a name="995761"> </a><a href="Am.html#995675"><code>AmRegisterPlugin()</code></a></p>

<p><a name="992930"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="SecurityAndCrypto_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="SecurityAndCryptographyTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SecurityAndCrypto_Part2.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="AmPlugin.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="SecurityAndCryptographyIX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>