<html>
<head>
<title>(Protein) Multimedia Applications | Multimedia</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:17:00">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="1002294"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="MM_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MM_MultimediaPart.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MM_DefsRef.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MM_IX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">3 &nbsp;&nbsp;
Multimedia Applications</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Multimedia</p>
<p class="SubTitle">Exploring Palm OS&#174; </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="MM_MultimediaPart.html">Part II: Multimedia Library</a> </h1>
<h1 class="SideTOC1"><a href="MM_MultimediaConcept.html">3  Multimedia Applications</a></h1>

   <h2 class="SideTOC2"><a href="#996063">
   Overview</a></h2>

      <h3 class="SideTOC3"><a href="#997657">
      Sessions</a></h3>

      <h3 class="SideTOC3"><a href="#1004620">
      Sources</a></h3>

      <h3 class="SideTOC3"><a href="#1004628">
      Destinations</a></h3>

      <h3 class="SideTOC3"><a href="#1005013">
      Streams</a></h3>

      <h3 class="SideTOC3"><a href="#998060">
      Tracks</a></h3>

      <h3 class="SideTOC3"><a href="#998892">
      Codecs</a></h3>

      <h3 class="SideTOC3"><a href="#999023">
      Formats</a></h3>

      <h3 class="SideTOC3"><a href="#1003189">
      Property Sets </a></h3>

   <h2 class="SideTOC2"><a href="#1004236">
   Using the Multimedia Library</a></h2>

      <h3 class="SideTOC3"><a href="#1002813">
      Working with Sessions</a></h3>

      <h3 class="SideTOC3"><a href="#1002889">
      Working with Properties</a></h3>

      <h3 class="SideTOC3"><a href="#1002839">
      Working with Enumerations</a></h3>

      <h3 class="SideTOC3"><a href="#1004462">
      Working with the URL Scheme</a></h3>

   <h2 class="SideTOC2"><a href="#996612">
   Example Playback Session</a></h2>

      <h3 class="SideTOC3"><a href="#996637">
      Creating the Session</a></h3>

      <h3 class="SideTOC3"><a href="#996678">
      Adding Source Content</a></h3>

      <h3 class="SideTOC3"><a href="#996768">
      Adding Tracks</a></h3>

      <h3 class="SideTOC3"><a href="#997008">
      Finalizing the Session</a></h3>

      <h3 class="SideTOC3"><a href="#997050">
      Playing the File</a></h3>

   <h2 class="SideTOC2"><a href="#997182">
   Example Recording Session</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1002314"> </a>The Multimedia Library is an application-level API used to control the playback and recording of audio-visual media on Palm OS<sup>&#174;</sup> devices. It provides a standard means for applications to reference media content stored locally on the device, stored on a network, or accessible from some attached hardware device such as a microphone or camera. The Multimedia Library also provides a means for applications to query and configure codecs and devices.</p>

<p><a name="996042"> </a>Multiple concurrent playback and recording sessions may be configured, and the processing of playback or recording sessions may continue in the background as the user uses other applications. Multiple components may interact with a session simultaneously. </p>

<p><a name="996027"> </a>The Multimedia Library does not provide a means for developers to write file format handlers or codecs.</p>
   <blockquote class = "bq"><a name="1002570"> </a><a href="MM_MultimediaConcept.html#996063">Overview</a></blockquote>
   <blockquote class = "bq"><a name="1002672"> </a><a href="MM_MultimediaConcept.html#1004236">Using the Multimedia Library</a></blockquote>
   <blockquote class = "bq"><a name="1002614"> </a><a href="MM_MultimediaConcept.html#996612">Example Playback Session</a></blockquote>
   <blockquote class = "bq"><a name="1002629"> </a><a href="MM_MultimediaConcept.html#997182">Example Recording Session</a></blockquote>

<h2 class="haH2">
  <a name="996063"> </a>Overview <a href="#1002294"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="999139"> </a>This section provides an architectural overview of the Multimedia subsystem. </p>

<p><a name="996068"> </a><a href="MM_MultimediaConcept.html#996071">Figure 3.1</a> shows the portions of the system that bring multimedia to the device.</p>

<p class="FFigureCaption">
  <a name="996071"> </a><b>Figure 3.1&nbsp;&nbsp;Multimedia architecture</b>
</p>
<div align="left"><img src="images/MMarchitecture.jpg" height="268" width="480" border="0" hspace="0" vspace="0">
</div>
<ul type="disc">
  <li><a name="996077"> </a>The <b>multimedia client application </b>is an application that a third-party developer may write; it runs in the Application process. The Media Player is an example of such an application.
  <li><a name="996079"> </a>The <b>Multimedia Library</b> provides the public APIs that multimedia clients use to access multimedia features.
  <li><a name="996081"> </a>The <b>Movie Server</b> runs in the System process and provides all multimedia functionality. It spawns <b>sessions</b> that usually run in the Background process. Applications can control sessions via Multimedia Library function calls.
  <li><a name="1000201"> </a>Device drivers enable the use of specific multimedia hardware components such as cameras, microphones, speakers, and so forth.
</ul>

<p><a name="999450"> </a>The multimedia subsystem consists of several different kinds of objects that are described in the following sections.</p>
<h3 class="hbH3">
  <a name="997657"> </a>Sessions <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="999561"> </a>A <b>multimedia session</b> represents a recording or playback request, and controls the data transport. To use the Multimedia Library for playback, for example, you create a session, tell it where to find the data to play back, and then tell the session to start playing. The session automatically sends the data to the appropriate media output device such as the screen and/or the audio mixer.</p>

<p><a name="1004514"> </a>For more information about using sessions, see <a href="MM_MultimediaConcept.html#1002813">"Working with Sessions."</a></p>
<h3 class="hbH3">
  <a name="1004620"> </a>Sources <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004622"> </a>A <b>source</b> represents a source device. For a recording session, the source device might be a camera or a microphone. For a playback session, the source device might be a file or a network stream. </p>

<p><a name="1004626"> </a>A source contains one or more <b>streams</b> of data from the source device. The stream defines the media format produced by the source device and is used to connect with the track. You connect each stream to a different track so that each stream's data goes to a different destination. </p>
<h3 class="hbH3">
  <a name="1004628"> </a>Destinations <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004630"> </a>A <b>destination</b> represents a destination device. For a recording session, the destination device might be a file or network stream. For a playback session, the destination might be the screen or the speakers. </p>

<p><a name="1004633"> </a>Like sources, destinations contain one or more streams that specify the media format the destination expects, and they connect to a track. </p>
<h3 class="hbH3">
  <a name="1005013"> </a>Streams <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1005017"> </a>A stream object represents multimedia data of a particular format. Each source and destination has at least one stream, which represents a single kind of data it produces or consumes. For example, a movie file source might have an audio stream and a video stream.</p>

<p><a name="1005125"> </a>A stream object is created when you finalize a source or destination. You can enumerate the streams in sources and destinations by calling <a href="MM_SessionRef.html#1002293"><code>MMSourceEnumerateStreams()</code></a> and <a href="MM_SessionRef.html#997455"><code>MMDestEnumerateStreams()</code></a>.</p>
<h3 class="hbH3">
  <a name="998060"> </a>Tracks <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="998062"> </a>A <b>track</b> represents a route for one type of media data from a source device to a destination device. For example, to play a movie would require two tracks: an audio track and a video track. </p>

<p><a name="999795"> </a>Tracks are responsible for encoding or decoding data as it is recorded or played.</p>

<p><a name="998067"> </a>Tracks sometimes use a <b>track callback filter</b>, which is usually supplied by the application. A multimedia application can set a track callback filter if it wants to handle the data itself. If so, the track ensures that data is passed from the source device to the track filter, which forwards it to the callback function and then passes it on to the destination.</p>

<p><a name="998106"> </a>To register a track callback filter, call <a href="MM_TrackRef.html#996493"><code>MMTrackInsertCallbackFilter()</code></a>.</p>
<h3 class="hbH3">
  <a name="998892"> </a>Codecs <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1002909"> </a>In order to play from and capture to encoded media files, the Multimedia Library uses software components called <b>codecs</b> (an abbreviation for encoder/decoder.) A codec translates media data from one format to another. Each codec supports a particular encoding algorithm, such as MP3 or MS-ADPCM. </p>

<p><a name="1002936"> </a>A stream uses a codec during playback. During recording, the stream uses an encoder before writing to the file stream.</p>

<p><a name="1003084"> </a>Applications can enumerate the available codecs with <a href="MM_CodecRef.html#996130"><code>MMCodecClassEnumerate()</code></a>, and can enumerate the available file formats with <a href="MM_CodecRef.html#996243"><code>MMFileFormatEnumerate()</code></a>. File formats are distinct from codecs because a file format may encapsulate many kinds of encoded data.</p>

<p><a name="1003028"> </a>File formats are described by an <a href="MM_FormatsRef.html#999693"><code>MMFormatType</code></a> value. Codecs are represented by an <a href="MM_DefsRef.html#999235"><code>MMCodecClassID</code></a>, and the <a href="MM_PropertyRef.html#996149"><code>MMPropertyGet()</code></a> function may be used to obtain more information about a given codec (such as name, creator, and source or destination format.) All codec properties are read-only.</p>

<p><a name="998893"> </a>PalmSource provides several built-in codecs: </p>
<ul type="disc">
  <li><a name="998895"> </a>MS-ADPCM Audio Decoder
  <li><a name="998897"> </a>DVI-ADPCM Audio Decoder
  <li><a name="998899"> </a>MPEG Audio Layer I/II Decoder
  <li><a name="998901"> </a>MPEG-1 Video Decoder
  <li><a name="998905"> </a>MS-ADPCM Audio Encoder
  <li><a name="998909"> </a>AVI Extractor
  <li><a name="998911"> </a>MPEG Audio Extractor
  <li><a name="998913"> </a>MPEG-1 Extractor
  <li><a name="998915"> </a>WAV Extractor
  <li><a name="998917"> </a>WAV Composer
</ul>

<p><a name="1000142"> </a>Different codecs, such as MP3 and MPEG-4, might be available depending on the device manufacturer. </p>
<h3 class="hbH3">
  <a name="999023"> </a>Formats <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="999024"> </a>Formats are used to specify what multimedia formats an object can work with. </p>

<p><a name="999025"> </a>An object that can handle both audio and video data typically has two format objects: one specifying its audio constraints and one specifying its video constraints. Format objects themselves are made up of key/value pairs specifying one value for one attribute. For example, a raw audio format has keys for sample type, frame rate, channel count, and so on. </p>

<p><a name="1003219"> </a>A format object is referenced by an <a href="MM_FormatsRef.html#999682"><code>MMFormat</code></a>. Formats may be retrieved as property values by <a href="MM_PropertyRef.html#996149"><code>MMPropertyGet()</code></a> or returned by <a href="MM_FormatsRef.html#999884"><code>MMFormatCreate()</code></a>, and in every case must be explicitly deleted by the application when it has finished using them. An <a href="MM_FormatsRef.html#999682"><code>MMFormat</code></a> has a type, <a href="MM_FormatsRef.html#999693"><code>MMFormatType</code></a>, which describes the basic kind of media such as <code>P_FORMAT_RAW_AUDIO</code>, <code>P_FORMAT_MPEG4_VIDEO</code>, etc. Every format type has an associated set of format keys, which are documented in <code>MMFormatDefs.h</code>. See <a href="MM_FormatsRef.html#995984">Chapter 6, "Multimedia Formats,"</a> for a list of the keys and values that formats use. </p>

<p><a name="1003184"> </a>During format negotiation, two formats are inspected to see if they are compatible, and any wild values are replaced with actual values. </p>

<p><a name="1003186"> </a>A format object stores a value for each format key. Values are typed by an <a href="MM_DefsRef.html#1000590"><code>MMTypeCode</code></a>, allowing formats to contain a wide range of data. Some common value types are <code>P_MM_INT32_TYPE</code>, <code>P_MM_BOOL_TYPE</code>, and <code>P_MM_WILD_TYPE</code>. The last type simply means that any value is acceptable for the key; the library assigns that key an appropriate value when a session is finalized, and no data is stored.</p>
<h3 class="hbH3">
  <a name="1003189"> </a>Property Sets  <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1003521"> </a><b>Property sets</b> expose configurable parameters, or properties, which control an object's behavior. For example, an audio-renderer supports the <code>P_MM_TRACK_PROP_VOLUME</code> property to allow control of output volume.</p>

<p><a name="1003456"> </a>A property consists of a key/value pair, where the key is a 32-bit constant identifier and the value is a typed chunk of data with a given size. Property values are generally either 32-bit integers or character strings, though some properties may have more complex values (such as those that represent dimensions, regions, or media formats).</p>

<p><a name="1004204"> </a>All objects that support properties are identified by 32-bit ID values, which identify both the object instance and its type. </p>

<p><a name="1004983"> </a>For more information on properties, see <a href="MM_MultimediaConcept.html#1002889">"Working with Properties."</a></p>

<h2 class="haH2">
  <a name="1004236"> </a>Using the Multimedia Library <a href="#1002294"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1002694"> </a>The Multimedia Library is a shared library that the system automatically loads when needed and unloads when not needed. You don't need to do anything to load or initialize the library.</p>

<p><a name="1002695"> </a>This section covers these topics:</p>
<ul type="disc">
  <li><a name="1002699"> </a><a href="MM_MultimediaConcept.html#1002813">Working with Sessions</a>
  <li><a name="1003955"> </a><a href="MM_MultimediaConcept.html#1002889">Working with Properties</a>
  <li><a name="1003965"> </a><a href="MM_MultimediaConcept.html#1002839">Working with Enumerations</a>
  <li><a name="1003972"> </a><a href="MM_MultimediaConcept.html#1004462">Working with the URL Scheme</a>
</ul>
<h3 class="hbH3">
  <a name="1002813"> </a>Working with Sessions <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004507"> </a>A session provides a context for an application's media playback or recording tasks. Before using the Multimedia Library to play or record, you must create a session by calling <a href="MM_SessionRef.html#999232"><code>MMSessionCreate()</code></a>. In this function, you specify the session class, which indicates if the session is for playback or recording (capture).</p>

<p><a name="1003984"> </a>A session is described in terms of sources, destinations, streams, and tracks. Sources and destinations represent the files, network streams, and devices used to get multimedia data into and out of the media-processing engine. Each source and destination has at least one stream, which represents a single kind of data it produces or consumes. For example, a movie file source might have an audio stream and a video stream. </p>

<p><a name="1004719"> </a>A track represents a route for media data in the session. Tracks take data from a source stream, apply some processing (such as decoding and filtering), and send it to a destination stream.</p>

<p><a name="1004738"> </a>To configure a session, your application must first add whichever sources and destinations it requires by calling <a href="MM_SessionRef.html#998642"><code>MMSessionAddSource()</code></a> and <a href="MM_SessionRef.html#998242"><code>MMSessionAddDest()</code></a>. Then finalize the sources and destinations by calling <a href="MM_SessionRef.html#1002413"><code>MMSourceFinalize()</code></a> and <a href="MM_SessionRef.html#997936"><code>MMDestFinalize()</code></a> (if there are destinations). Then, enumerate the available streams by calling <a href="MM_SessionRef.html#1002293"><code>MMSourceEnumerateStreams()</code></a> and <a href="MM_SessionRef.html#997455"><code>MMDestEnumerateStreams()</code></a>. </p>

<p><a name="1004841"> </a>Finally, add tracks for the streams you wish to play back or capture. You can add tracks manually one at a time with <a href="MM_SessionRef.html#998779"><code>MMSessionAddTrack()</code></a>, or automatically by using <a href="MM_SessionRef.html#998129"><code>MMSessionAddDefaultTracks()</code></a>. When you have added all the desired tracks to the session, call <a href="MM_SessionRef.html#1000181"><code>MMSessionFinalize()</code></a> to prepare it for performance. After calling this function, no new sources, destinations, or tracks may be added.</p>

<p><a name="1003986"> </a>To reconfigure a session after it has been finalized, you must first call <a href="MM_SessionRef.html#1001216"><code>MMSessionRemoveAll()</code></a>.</p>

<p><a name="1003987"> </a>To start, stop, pause, or otherwise control the playback or capture process, call <a href="MM_SessionRef.html#998922"><code>MMSessionControl()</code></a>. This call exposes the various transport operations such as run, pause, stop, prefetch, grab a still image, and refresh the display.</p>

<p><a name="1003988"> </a>For playback sessions you can also call <a href="MM_SessionRef.html#1001689"><code>MMSessionSeek()</code></a>, which instructs the decoder to jump to a new position in the content stream. Note that seek functionality may not always be available, depending on the kind of content and on the location it's being streamed from.</p>

<p><a name="1004907"> </a>You can determine the current state of the session by calling <a href="MM_SessionRef.html#1000549"><code>MMSessionGetState()</code></a>.</p>

<p><a name="1005879"> </a>If you want your application to receive multimedia event notifications from a session, call <a href="MM_SessionRef.html#1000652"><code>MMSessionRegisterCallback()</code></a> to register a callback function. If you want your application to receive multimedia event notifications of a persistent session even when the application is no longer running, call <a href="MM_SessionRef.html#1000986"><code>MMSessionRegisterLaunch()</code></a>. Then, when session events occur, the application is sublaunched with the launch code <a href="MM_SessionRef.html#1038632"><code>sysAppLaunchCmdMultimediaEvent</code></a>.</p>
<h3 class="hbH3">
  <a name="1002889"> </a>Working with Properties <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004070"> </a>All objects that support properties are identified by 32-bit ID values, which identify both the object instance and its type. This allows a single set of property functions to operate on any kind of property-bearing object. There are four property functions:</p>
<ul type="disc">
  <li><a name="1004074"> </a><a href="MM_PropertyRef.html#996495"><code>MMPropertySet()</code></a>: sets a property value
  <li><a name="1004078"> </a><a href="MM_PropertyRef.html#996149"><code>MMPropertyGet()</code></a>: returns a property value
  <li><a name="1004082"> </a><a href="MM_PropertyRef.html#996328"><code>MMPropertyInfo()</code></a>: returns various information about a property, such as its minimum, maximum, and default values, whether it is readable and/or writable, and its type
  <li><a name="1004086"> </a><a href="MM_PropertyRef.html#996006"><code>MMPropertyEnumerate()</code></a>: lists the potential values of a property
</ul>

<p><a name="1004087"> </a>Not all of these operations are applicable to all properties, or to all entities that have associated properties; for example, <code>MMPropertyEnumerate()</code> may return <code>sysErrNotAllowed</code> if the specified <a href="MM_DefsRef.html#999587"><code>MMPropInfoType</code></a> parameter does not apply. For example, some properties, such as <code>P_MM_TRACK_PROP_VOLUME</code>, have continuous values with a well-defined minimum and maximum, but have such a wide range of possible values that it doesn't make sense for <code>MMPropertyEnumerate()</code> to list them. These are referred to as "continuous-valued" properties. Other properties, such as <code>P_MM_TRACK_PROP_CODEC_CLASS</code>, allow a discrete set of values for which the concepts of minimum and maximum do not apply, and are thus termed "discrete-valued" properties.</p>

<p><a name="1004091"> </a>Here's an example of retrieving the current value of a property by calling <a href="MM_PropertyRef.html#996149"><code>MMPropertyGet()</code></a> and passing the key:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
err = MMPropertyGet(session, P_MM_CONTENT_PROP_DURATION, 
P_MM_INT64_TYPE, &amp;longduration, 0);<a name="1004095"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1004096"> </a>Here's an example of setting the value of a property by calling <a href="MM_PropertyRef.html#996495"><code>MMPropertySet()</code></a> and passing both the key and the value. The value must have the same type as the current value of the property:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
err = MMPropertySet(session, P_MM_SESSION_PROP_PLAYBACK_RATE, 
P_MM_INT32_TYPE, &amp;rate, 0);<a name="1004100"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1002839"> </a>Working with Enumerations <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1004023"> </a>There are several cases in the Multimedia Library where a given component or object provides access to a set of values or references to objects. A common iterator-based enumeration scheme is used in each case. For example, here is the file format enumerator function:</p>

<p><a name="1004347"> </a><code>status_t MMFileFormatEnumerate (int32_t *ioIterator, MMFormatType *outFormat)</code></p>

<p><a name="1004028"> </a>The value pointed to by <code class="par">ioIterator</code> must be treated as opaque by the caller, with two exceptions:</p>
<ul type="disc">
  <li><a name="1004029"> </a>Before the first call to the enumeration function, the value of <code class="par">ioIterator</code> must be set to <code>P_MM_ENUM_BEGIN</code>.
  <li><a name="1004030"> </a>When the set has been exhausted, the enumeration function will set the value of <code class="par">ioIterator</code> to <code>P_MM_ENUM_END</code>.
</ul>

<p><a name="1004031"> </a>Other values are only guaranteed to be meaningful to the Multimedia Library. If an enumeration function is called with an invalid iterator, or an iterator value of <code>P_MM_ENUM_END</code>, it returns <code>sysErrBadIndex</code>.</p>

<p><a name="1005750"> </a>An example of enumerating the tracks in a session is shown in <a href="MM_MultimediaConcept.html#1005752">Listing 3.1</a>.</p>
<p class="CCodeCaption">
  <a name="1005752"> </a><b>Listing 3.1&nbsp;&nbsp;Enumerating tracks</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
status_t err;<a name="1005794"> </a>
MMTrackID outTrack;<a name="1005833"> </a>
int32_t ioIterator = P_MM_ENUM_BEGIN;<a name="1005795"> </a>
while(true)<a name="1005796"> </a>
{<a name="1005797"> </a>
  err = MMSessionEnumerateTracks(session, &amp;ioIterator, <a name="1005798"> </a>
        &amp;outTrack);<a name="1005870"> </a>
  if(err != errNone)<a name="1005799"> </a>
    break;<a name="1005800"> </a>
  // do something with each track returned in outTrack<a name="1005820"> </a>
}<a name="1005804"> </a>
</pre><div class="CodeRule"><hr></div>

<h3 class="hbH3">
  <a name="1004462"> </a>Working with the URL Scheme <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1003913"> </a>Files on expansion cards or other VFS volumes can be accessed using URLs with the following syntax:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
<code>FileURL = "file://" ["localhost"] "/" [</code><i>VolumeLabel</i><!-PS02-><span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">] "/" </span><i>Path</i><!-PS02-><span style="color: #000000;  font-family: Courier; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> </span><a name="1003914"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1003915"> </a>where <!-PS02-><span style="color: #000000;  font-family: Courier; font-style: oblique; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">VolumeLabel</span> can use any characters except for control codes (unprintable characters), "/", and "?"; and <!-PS02-><span style="color: #000000;  font-family: Courier; font-style: oblique; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">Path</span> can use any characters except for control codes and "?".</p>

<p><a name="1004703"> </a>You may use or omit the optional server name component of the URL ("localhost") when using the file scheme. When omitting it, you must still specify the following slash, so you would write the scheme like this: <code>file:///</code>...</p>

<p><a name="1004679"> </a>instead of this: <code>file://locahost/</code>...</p>

<p><a name="1004714"> </a>The volume label is case-sensitive. The case requirements of the rest of the URL follow the convention of the file system that this volume is mounted on.</p>

<p><a name="1003918"> </a>If no volume label is specified, all volumes are searched for the given path.</p>

<p><a name="1003920"> </a>Here's some URL examples:</p>

<p><a name="1003921"> </a><code>file://localhost/MySDCardVolumeName/PALM/Launcher/Giraffe.prc</code></p>

<p><a name="1003922"> </a><code>file:///OtherCardVolumeName/PALM/Launcher/Giraffe.prc</code></p>

<p><a name="1003923"> </a><code>file:////PALM/Launcher/Giraffe.prc</code></p>

<p><a name="1003924"> </a><code>file:////Audio/mySong.mp3</code></p>

<p><a name="1003925"> </a>URL name conflicts are resolved as follows: All volumes matching the specified name are searched and if multiple databases sharing the same pathname are found, the most recent is returned. If multiple selections share the same date, the file-selection behavior is nondeterministic (this only happens if no volume label is specified).</p>

<p><a name="1005468"> </a>URLs are also used to access specific devices (such as a camera or a microphone) using URLs with the scheme <code>palmdev://</code>. For example, the URL <code>palmdev:///Media/Default/VideoOut</code> specifies any video playback device. For more examples of <code>palmdev://</code> URLs, see <a href="MM_SessionRef.html#1013006">"Default URLs."</a></p>

<h2 class="haH2">
  <a name="996612"> </a>Example Playback Session <a href="#1002294"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996614"> </a>This section describes how to use the Multimedia Library to play multimedia content.</p>

<p><a name="1000482"> </a>The basic steps involved in playback are listed here and described in more detail later: </p>
<ol type="1">
  <li value="1"><a name="996619"> </a><a href="MM_MultimediaConcept.html#996637">"Creating the Session."</a>
  <li value="2"><a name="996623"> </a><a href="MM_MultimediaConcept.html#996678">"Adding Source Content."</a>
  <li value="3"><a name="996627"> </a><a href="MM_MultimediaConcept.html#996768">"Adding Tracks."</a>
  <li value="4"><a name="996631"> </a><a href="MM_MultimediaConcept.html#997008">"Finalizing the Session."</a>
  <li value="5"><a name="996635"> </a><a href="MM_MultimediaConcept.html#997050">"Playing the File."</a>
</ol>
<h3 class="hbH3">
  <a name="996637"> </a>Creating the Session <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="1000832"> </a>The first basic step is to create the multimedia session:</p>
<ol type="1">
  <li value="1"><a name="1000519"> </a>Call the function <a href="MM_SessionRef.html#999232"><code>MMSessionCreate()</code></a>, passing <code>P_MM_SESSION_CLASS_DEFAULT_PLAYBACK</code> as the session class (to create a playback session). 
   <p><a name="1000527"> </a>This tells the Movie Server to create the session. It publishes the following keys and values in the session property set: </p>
   <p><a name="996651"> </a><code>P_MM_SESSION_PROP_PLAYBACK_RATE</code>: 1</p>
   <p><a name="996653"> </a><code>P_MM_SESSION_PROP_MARKER</code>: &#8211;1</p>
   <p><a name="996655"> </a><code>P_MM_SESSION_DEFAULT_AUDIO_ENABLE</code>: true</p>
   <p><a name="996657"> </a><code>P_MM_SESSION_DEFAULT_VIDEO_ENABLE</code>: true</p>
   <p><a name="996659"> </a><code>P_MM_SESSION_DEFAULT_SOURCE_RECT</code>: null </p>
   <p><a name="996661"> </a><code>P_MM_SESSION_DEFAULT_DEST_RECT</code>: null </p>
   <p><a name="996663"> </a><code>P_MM_SESSION_DEFAULT_AUDIO_VOLUME</code>: 1024</p>
  <li value="2"><a name="996676"> </a>Optionally, call <a href="MM_SessionRef.html#1000652"><code>MMSessionRegisterCallback()</code></a> to register a callback function that will receive event notifications from the session. This step is not required, but is quite useful.
</ol>
<h3 class="hbH3">
  <a name="996678"> </a>Adding Source Content <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="996679"> </a>After creating the session, you need to add source content:</p>
<ol type="1">
  <li value="1"><a name="996681"> </a>Call <a href="MM_SessionRef.html#998642"><code>MMSessionAddSource()</code></a>, passing it the URL of the multimedia file to be opened.
  <li value="2"><a name="1000626"> </a>Call <a href="MM_SessionRef.html#1002413"><code>MMSourceFinalize()</code></a>, which prepares the media streams for use. One stream is created for each track in the content; for a movie, there is typically one track for audio and one track for video.
</ol>
<h3 class="hbH3">
  <a name="996768"> </a>Adding Tracks <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="996769"> </a>You now need to specify where the multimedia data should go. To do so, call <a href="MM_SessionRef.html#998129"><code>MMSessionAddDefaultTracks()</code></a>, passing the session ID (returned by <code>MMSessionCreate()</code>), the source ID (returned by <code>MMSessionAddSource()</code>), and the constant <code>P_MM_DEFAULT_DEST</code>. </p>
<h3 class="hbH3">
  <a name="997008"> </a>Finalizing the Session <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="997009"> </a>Now you need to finalize the session: </p>
<ol type="1">
  <li value="1"><a name="997011"> </a>Call <a href="MM_SessionRef.html#1000181"><code>MMSessionFinalize()</code></a>. 
  <li value="2"><a name="997042"> </a>You may want to call <a href="MM_SessionRef.html#1001123"><code>MMSessionReleaseOwnership()</code></a>. This transfers ownership of the session back to the Movie Server now that your application has finished creating it. 
   <p><a name="997047"> </a>When the Movie Server owns the session, if the application exits, the session can continue playing in the background. </p>
  <li value="3"><a name="997048"> </a>For video playback, set a destination rectangle of the size required by the session so that it is ready to display the content. To do this, call <a href="MM_PropertyRef.html#996495"><code>MMPropertySet()</code></a> to set a <code>P_MM_TRACK_PROP_DEST_RECT</code> property for the track, like this:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
MMPropertySet(track, P_MM_TRACK_PROP_DEST_RECT, P_MM_RECT_TYPE, rect, 0);<a name="1001127"> </a>
</pre><div class="CodeRule"><hr></div>

   <p><a name="1001149"> </a>The <code class="par">rect</code> parameter is the destination rectangle for the video content.</p>
</ol>
<h3 class="hbH3">
  <a name="997050"> </a>Playing the File <a href="#1002294"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="997051"> </a>Now that the file has been opened and the objects that are required to play the file have been created, the application can return control to the user. The user presses the Play button on the device, specifying that playback should begin. (The Play button can be a hardware button or a button displayed by the application in its user interface.)</p>

<p><a name="1000958"> </a>Call <a href="MM_SessionRef.html#998922"><code>MMSessionControl()</code></a> with the <code>P_MM_SESSION_CTL_RUN</code> control code. This function forwards the control code to the Movie Server session. It sets its state to <code>P_MM_SESSION_RUNNING</code> and sends an event to notify the application of its change in state.</p>

<p><a name="1001069"> </a>You can call <code>MMSessionControl()</code> with other control codes to perform other functions such as pause and stop. To seek forward or backward in the session, for example, to implement fast forward and rewind functions, call <a href="MM_SessionRef.html#1001689"><code>MMSessionSeek()</code></a>.</p>

<p><a name="997084"> </a>Video and audio playback occur in separate threads. </p>

<h2 class="haH2">
  <a name="997182"> </a>Example Recording Session <a href="#1002294"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1001224"> </a>This section describes how to use the Multimedia Library to record audio content.</p>

<p><a name="997185"> </a>A recording session begins when the user presses the Record button in the application. The Record button can be a hardware button or a button displayed by the application in its user interface, or some other mechanism that you devise.</p>
<ol type="1">
  <li value="1"><a name="1001276"> </a>First, the application must create a name for the file that will hold the recorded data.
  <li value="2"><a name="1001280"> </a>Then create the session by calling the function <a href="MM_SessionRef.html#999232"><code>MMSessionCreate()</code></a>, passing <code>P_MM_SESSION_CLASS_DEFAULT_CAPTURE</code> as the session class (to create a recording session).
  <li value="3"><a name="1001370"> </a>Call <a href="MM_SessionRef.html#1000652"><code>MMSessionRegisterCallback()</code></a> to register a callback function that will receive event notifications from the session. 
  <li value="4"><a name="1001343"> </a>Add the source by calling <a href="MM_SessionRef.html#998642"><code>MMSessionAddSource()</code></a>, specifying <code>P_MM_DEFAULT_AUDIO_CAPTURE_URL</code> as the URL. This source represents the means by which the device receives audio input, such as a microphone or line-input jack.
  <li value="5"><a name="1001379"> </a>Call <a href="MM_SessionRef.html#1002413"><code>MMSourceFinalize()</code></a>. 
  <li value="6"><a name="1001607"> </a>Obtain the source stream ID by enumerating the source streams (there should be only one) by calling <a href="MM_SessionRef.html#1002293"><code>MMSourceEnumerateStreams()</code></a>.
  <li value="7"><a name="1001362"> </a>Add the destination by calling <a href="MM_SessionRef.html#998242"><code>MMSessionAddDest()</code></a>.
  <li value="8"><a name="1001423"> </a>Set the <code>P_MM_DEST_PROP_FILE_FORMAT</code> property of the destination to <code>P_FORMAT_WAV_STREAM</code> (or whatever audio format you want) by calling <a href="MM_PropertyRef.html#996495"><code>MMPropertySet()</code></a>, like this:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
int32_t streamFormat = P_FORMAT_WAV_STREAM;<a name="1001430"> </a>
MMPropertySet(dest, P_MM_DEST_PROP_FILE_FORMAT, P_MM_INT32_TYPE, &amp;streamFormat, 
0);<a name="1001431"> </a>
</pre><div class="CodeRule"><hr></div>

  <li value="9"><a name="1001526"> </a>Finalize the destination by calling <a href="MM_SessionRef.html#997936"><code>MMDestFinalize()</code></a>.
  <li value="10"><a name="1001629"> </a>Obtain the destination stream ID by enumerating the destination streams (there should be only one) by calling <a href="MM_SessionRef.html#997455"><code>MMDestEnumerateStreams()</code></a>.
  <li value="11"><a name="1001644"> </a>Create a media format object and set its type to <code>P_FORMAT_MSADPCM_AUDIO</code>, like this:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
MMFormat encoding = 0;<a name="1001647"> </a>
MMFormatCreate(&amp;encoding);<a name="1001667"> </a>
MMFormatSetType(encoding, P_FORMAT_MSADPCM_AUDIO);<a name="1001645"> </a>
</pre><div class="CodeRule"><hr></div>

  <li value="12"><a name="1001598"> </a>Add a track to provide a route from the audio source to the file destination by calling <a href="MM_SessionRef.html#998779"><code>MMSessionAddTrack()</code></a>, like this:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
err = MMSessionAddTrack(session, sourceStream, 0, destStream, encoding, 
&amp;track);<a name="1001643"> </a>
</pre><div class="CodeRule"><hr></div>

   <p><a name="1001713"> </a>The source stream ID is returned by <code>MMSourceEnumerateStreams()</code> in step 6. The destination stream ID is returned by <code>MMDestEnumerateStreams()</code> in step 10.</p>
  <li value="13"><a name="1001565"> </a>Finalize the session by calling <a href="MM_SessionRef.html#1000181"><code>MMSessionFinalize()</code></a>.
   <p><a name="997262"> </a>Then the session's state is set to <code>P_MM_SESSION_READY</code> to signal that recording can begin. </p>
  <li value="14"><a name="997272"> </a>To start recording, call <a href="MM_SessionRef.html#998922"><code>MMSessionControl()</code></a> with the <code>P_MM_SESSION_CTL_RUN</code> control code.
   <p><a name="1001775"> </a>This function forwards the control code to the Movie Server session. It sets its state to <code>P_MM_SESSION_RUNNING</code> and sends an event to notify the application of its change in state.</p>
</ol>

<p><a name="1001777"> </a>You can call <code>MMSessionControl()</code> with other control codes to perform other functions such as pause and stop. Pass the control code <code>P_MM_SESSION_CTL_STOP</code> to stop recording (and write header data to the file so that it can be used immediately.) </p>

<p><a name="1001949"> </a>The session is deleted after the application that created it exits, unless it has called <a href="MM_SessionRef.html#1001123"><code>MMSessionReleaseOwnership()</code></a> to allow the session to keep running in the background. If the application does call this function, then it should call <a href="MM_SessionRef.html#999345"><code>MMSessionDelete()</code></a> or <a href="MM_SessionRef.html#998029"><code>MMSessionAcquireOwnership()</code></a> to ensure that the session gets deleted.</p>

<p><a name="986245"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="MM_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="MM_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MM_MultimediaPart.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MM_DefsRef.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MM_IX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>