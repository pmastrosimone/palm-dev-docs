<html>
<head>
<title>(Protein) Customizing Hardware Input | Input Services </title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:12:32">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="608590"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="In_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="In_PinletConcept.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="In_RefPart.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="In_IX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">4 &nbsp;&nbsp;
Customizing Hardware Input</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Input Services </p>
<p class="SubTitle">Exploring Palm OS&#174; </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="In_ConceptPart.html">Part I: Concepts</a> </h1>
<h1 class="SideTOC1"><a href="In_HardKeys.html">4  Customizing Hardware Input</a></h1>

   <h2 class="SideTOC2"><a href="#994919">
   Replacing a Built-in Application</a></h2>

   <h2 class="SideTOC2"><a href="#994910">
   Remapping the Hard Keys</a></h2>

   <h2 class="SideTOC2"><a href="#994934">
   Disabling the Hard Keys</a></h2>

   <h2 class="SideTOC2"><a href="#993342">
   Summary</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="994894"> </a>This chapter describes how to work with the hard keys on the device. As described in <a href="In_Overview.html#608590">Chapter 1, "Receiving Input,"</a> you typically let the system handle all hard keys. However, some applications may want to perform the following tasks:</p>
   <blockquote class = "bq"><a name="994925"> </a><a href="In_HardKeys.html#994919">Replacing a Built-in Application</a> </blockquote>
   <blockquote class = "bq"><a name="994898"> </a><a href="In_HardKeys.html#994910">Remapping the Hard Keys</a></blockquote>
   <blockquote class = "bq"><a name="994905"> </a><a href="In_HardKeys.html#994934">Disabling the Hard Keys</a></blockquote>

<h2 class="haH2">
  <a name="994919"> </a>Replacing a Built-in Application <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="994931"> </a>Palm OS<sup>&#174;</sup> contains system-wide preferences that the user sets to have the system work they way he or she likes. There are system preferences to remap the application hard keys and have them launch something other than the default applications. You should respect the user's preferences, but you are allowed to set the preference after asking the user if you may do so. </p>

<p><a name="994940"> </a>Suppose you are writing a replacement for the built-in Address Book application. You want to make it more convenient for your users to remap the Address Book button, so you might display an alert that asks first-time users if they want the button remapped. If they tap OK, then you should call <a href="../System_Management/Preferences.html#994532"><code>PrefSetPreference()</code></a> with the new value. See <a href="In_HardKeys.html#994972">Listing 4.1</a>.</p>
<p class="CCodeCaption">
  <a name="994972"> </a><b>Listing 4.1&nbsp;&nbsp;Remapping the hard key to launch your application</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
if (PrefGetPreference(prefHard2CharAppCreator != 
    myAppCreatorId)) {<a name="994991"> </a>
  if (FrmAlert(MakeMeTheDefaultAlert) == 0) {<a name="995015"> </a>
    /* user said OK to change */<a name="995021"> </a>
    PrefSetPreference(prefHard2CharAppCreator, <a name="995026"> </a>
      myAppCreatorId);<a name="995030"> </a>
  }<a name="995031"> </a>
}<a name="995032"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="995225"> </a>See <i>Exploring Palm OS: System Management</i> for more information about setting and getting user preferences. </p>

<h2 class="haH2">
  <a name="994910"> </a>Remapping the Hard Keys <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="994928"> </a>Sometimes, you want to remap the hard key only while your application is running. A game might want to remap the hard keys to perform some special action such as launching missiles or moving pieces around a board. </p>

<p><a name="996302"> </a>As explained previously, when the user presses a hard key, Palm OS creates a <a href="In_LowEvents.html#993792"><code>keyDownEvent</code></a> containing a virtual character that specifies which key was pressed. The <a href="../System_Management/SystemMgr.html#994346"><code>SysHandleEvent()</code></a> function handles most of these <code>keyDownEvent</code>s. If you want to remap the hard keys, you must intercept them before <code>SysHandleEvent()</code>. See <a href="In_HardKeys.html#996315">Listing 4.2</a>. </p>
<p class="CCodeCaption">
  <a name="996315"> </a><b>Listing 4.2&nbsp;&nbsp;Intercepting hard key events</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
void EventLoop (void)<a name="995247"> </a>
{<a name="995248"> </a>
  uint16_t error;<a name="995249"> </a>
  EventType event;<a name="995250"> </a>
  boolean handled = false;<a name="995251"> </a>
  <a name="995252"> </a>
  do {<a name="995253"> </a>
    EvtGetEvent(&amp;event, evtWaitForever);<a name="995254"> </a>
<a name="995255"> </a>
    //If user pressed first hard key, do something special.<a name="995256"> </a>
    if ((event.eType == keyDownEvent) &amp;&amp;<a name="995258"> </a>
       (event.data.keyDown.chr == vchrHard1) &amp;&amp; <a name="997111"> </a>
       (event.data.keyDown.modifiers &amp; commandKeyMask)) {<a name="996599"> </a>
       handled = HardKeyHandleEvent(&amp;event);<a name="995259"> </a>
    }<a name="995260"> </a>
<a name="995261"> </a>
    //Proceed with normal event loop.<a name="995262"> </a>
    if (!handled) {<a name="995263"> </a>
      if (!SysHandleEvent(&amp;event)) <a name="995264"> </a>
        if (!MenuHandleEvent(NULL, &amp;event, &amp;error) <a name="995265"> </a>
          if (!ApplicationHandleEvent(&amp;event))<a name="995266"> </a>
            FrmDispatchEvent(&amp;event);<a name="995267"> </a>
  } while (event.eType != appStopEvent);<a name="995268"> </a>
}<a name="995269"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="995231"> </a>In general, only games should remap the hard keys. Users expect the hard keys to behave as they have set them up to behave in the system preferences. </p>

<p><a name="995503"> </a><a href="In_HardKeys.html#995709">Table 4.1</a> lists the virtual characters that map to hardware controls on many devices. Remember that not all devices support all of these controls. See <code>Chars.h</code> for a complete list of virtual characters.</p>

<p class="caption"><a name="995709"> </a><b>Table 4.1&nbsp;&nbsp;Hard key virtual characters </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="995713"> </a><b>Character </b></p>
    </th>
    <th><p class="tt"><a name="995715"> </a><b>Hard Key </b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995717"> </a><code>vchrHard1</code> </p>
    </td>
    <td><p class="tt"><a name="995719"> </a>Usually launch Datebook</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995721"> </a><code>vchrHard2</code> </p>
    </td>
    <td><p class="tt"><a name="995723"> </a>Usually launches Address Book </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995725"> </a><code>vchrHard3</code> </p>
    </td>
    <td><p class="tt"><a name="995727"> </a>Usually launches ToDo</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995729"> </a><code>vchrHard4</code> </p>
    </td>
    <td><p class="tt"><a name="995731"> </a>Usually launches Memo</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995733"> </a><code>vchrHardPower</code> </p>
    </td>
    <td><p class="tt"><a name="995735"> </a>Power button</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995737"> </a><code>vchrHardCradle</code> </p>
    </td>
    <td><p class="tt"><a name="995739"> </a>Button on cradle </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995741"> </a><code>vchrHardCradle2</code> </p>
    </td>
    <td><p class="tt"><a name="995743"> </a>Button on cradle</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995745"> </a><code>vchrHardContrast</code> </p>
    </td>
    <td><p class="tt"><a name="995747"> </a>Contrast button</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995749"> </a><code>vchrHardAntenna</code> </p>
    </td>
    <td><p class="tt"><a name="995751"> </a>Antenna switch</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995753"> </a><code>vchrHardBrightness</code> </p>
    </td>
    <td><p class="tt"><a name="995755"> </a>Brightness button</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995757"> </a><code>vchrHard5</code> </p>
    </td>
    <td><p class="tt"><a name="995759"> </a>Licensee-specific</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995761"> </a><code>vchrHard6</code> </p>
    </td>
    <td><p class="tt"><a name="995763"> </a>Licensee-specific</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995765"> </a><code>vchrHard7</code> </p>
    </td>
    <td><p class="tt"><a name="995767"> </a>Licensee-specific</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995769"> </a><code>vchrHard8</code> </p>
    </td>
    <td><p class="tt"><a name="995771"> </a>Licensee-specific</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995773"> </a><code>vchrHard9</code> </p>
    </td>
    <td><p class="tt"><a name="995775"> </a>Licensee-specific</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995777"> </a><code>vchrHard10</code> </p>
    </td>
    <td><p class="tt"><a name="995779"> </a>Licensee-specific</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995781"> </a><code>vchrRockerUp</code> </p>
    </td>
    <td><p class="tt"><a name="995783"> </a>5-way rocker up</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995785"> </a><code>vchrRockerDown</code> </p>
    </td>
    <td><p class="tt"><a name="995787"> </a>5-way rocker down</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995789"> </a><code>vchrRockerLeft</code> </p>
    </td>
    <td><p class="tt"><a name="995791"> </a>5-way rocker left</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995793"> </a><code>vchrRockerRight</code> </p>
    </td>
    <td><p class="tt"><a name="995795"> </a>5-way rocker right</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995797"> </a><code>vchrRockerCenter</code> </p>
    </td>
    <td><p class="tt"><a name="995799"> </a>5-way rocker center</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995801"> </a><code>vchrThumbWheelUp</code> </p>
    </td>
    <td><p class="tt"><a name="995803"> </a>Thumb-wheel scroll up</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995805"> </a><code>vchrThumbWheelDown</code> </p>
    </td>
    <td><p class="tt"><a name="995807"> </a>Thumb-wheel scroll down</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995809"> </a><code>vchrThumbWheelPush</code> </p>
    </td>
    <td><p class="tt"><a name="995811"> </a>Thumb-wheel push center</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="995813"> </a><code>vchrThumbWheelBack</code> </p>
    </td>
    <td><p class="tt"><a name="995815"> </a>Thumb-wheel back button </p>
    </td>
  </tr>
</table>

</div>


<h2 class="haH2">
  <a name="994934"> </a>Disabling the Hard Keys <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="994935"> </a>In very rare circumstances, you may want to disable the hard keys entirely. </p>

<div><hr>
  <a name="995833"> </a> <span class="warning">WARNING! </span> Do not disable the hard keys unless you have a very good reason. If you are writing a general-purpose, third-party consumer application, never disable the hard keys. Do so only if you are writing an enterprise-level application and your client insists that the device must never be used as a personal digital assistant. 
<hr>
</div>

<p><a name="995836"> </a>There are two approaches to disabling the hard keys: </p>
<ul type="disc">
  <li><a name="995837"> </a>Intercept the <a href="In_LowEvents.html#993792"><code>keyDownEvent</code></a>s containing the virtual characters of the keys that you want to disable and ensure that they are never passed to <a href="../System_Management/SystemMgr.html#994346"><code>SysHandleEvent()</code></a>. This approach is similar to that shown in <a href="In_HardKeys.html#996315">Listing 4.2</a>. 
   <p><a name="996672"> </a>Keep in mind that modal dialogs and alerts run their own event loops. If the user presses a hard key while an alert is being displayed, the alert calls <code>SysHandleEvent()</code>, and allows your application to exit. If you do not want this behavior, look for and discard the <a href="../Programming_Basics/EventCodes.html#994789"><code>appStopEvent</code></a> after your application returns from a dialog or alert handler. </p>
  <li><a name="995901"> </a>Use the function <a href="In_KeyMgr.html#994805"><code>KeySetMask()</code></a> to disable the hard keys while your application is active. <a href="In_HardKeys.html#995907">Listing 4.3</a> shows an example that disables the four application hard keys while an application is running.
</ul>
<p class="CCodeCaption">
  <a name="995907"> </a><b>Listing 4.3&nbsp;&nbsp;Using KeySetMask()</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
void StartApplication(void) {<a name="995908"> </a>
   uint32_t disableKeyMask = keyBitHard1 | keyBitHard2 | 
      keyBitHard3 | keyBitHard4;<a name="995938"> </a>
<a name="995944"> </a>
   KeySetMask(~disableKeyMask);<a name="995918"> </a>
   ...<a name="995922"> </a>
}<a name="995911"> </a>
<a name="995951"> </a>
void StopApplication(void) {<a name="995952"> </a>
   KeySetMask(keyBitsAll);<a name="995953"> </a>
}<a name="995954"> </a>
</pre><div class="CodeRule"><hr></div>

   <p><a name="996645"> </a>Keep in mind that <code>KeySetMask()</code> only disables hardware buttons. You won't be able to disable the Application Launcher icon in the status bar, for example. </p>

<h2 class="haH2">
  <a name="993342"> </a>Summary <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="996559"> </a><b>Hard Key Functions</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996564"> </a><a href="In_KeyMgr.html#992956"><code>KeyCurrentState()</code></a><br><a href="In_KeyMgr.html#992996"><code>KeyRates()</code></a><br><a href="In_KeyMgr.html#994805"><code>KeySetMask()</code></a></p>
    </td>
  </tr>
</table>

</div>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 2003, 2004, PalmSource, Inc. and its affiliates. All rights reserved. <br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="In_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="In_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="In_PinletConcept.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="In_RefPart.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="In_IX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>