<html>
<head>
<title>(Protein) The Porting Process | Porting Applications to Palm OS&#174; Cobalt</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:19:08">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="608590"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="PortingPalmAppsTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PACE.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PortingPalmApps_Part2.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">2 &nbsp;&nbsp;
The Porting Process</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">Porting Applications to Palm OS&#174; Cobalt</p>
<p class="SubTitle">Exploring Palm OS&#174; </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="PortingPalmApps_Part1.html">Part I: Porting Techniques</a> </h1>
<h1 class="SideTOC1"><a href="PortingProcess.html">2  The Porting Process</a></h1>

   <h2 class="SideTOC2"><a href="#994477">
   The Basic Porting Procedure</a></h2>

   <h2 class="SideTOC2"><a href="#996450">
   Compatibility Headers</a></h2>

   <h2 class="SideTOC2"><a href="#993918">
   Common Compile-Time Errors</a></h2>

      <h3 class="SideTOC3"><a href="#994468">
      Missing UNIX Header Files</a></h3>

      <h3 class="SideTOC3"><a href="#993931">
      No Resource Search Chain</a></h3>

      <h3 class="SideTOC3"><a href="#994298">
      The cardNo Parameter</a></h3>

      <h3 class="SideTOC3"><a href="#995116">
      No Palm OS Glue</a></h3>

      <h3 class="SideTOC3"><a href="#995220">
      Changes in System Structures</a></h3>

      <h3 class="SideTOC3"><a href="#995760">
      Renamed Functions</a></h3>

      <h3 class="SideTOC3"><a href="#995813">
      DmGetNextDatabaseByTypeCreator() Changes</a></h3>

      <h3 class="SideTOC3"><a href="#997405">
      Changes in the Number of Ticks Per Second</a></h3>

      <h3 class="SideTOC3"><a href="#997059">
      ERROR_CHECK_LEVEL Not Defined</a></h3>

   <h2 class="SideTOC2"><a href="#994978">
   Common Run-Time Errors</a></h2>

      <h3 class="SideTOC3"><a href="#998337">
      The "Save Behind" Bit</a></h3>

      <h3 class="SideTOC3"><a href="#998282">
      Restrictions on Callbacks</a></h3>

      <h3 class="SideTOC3"><a href="#998287">
      Custom Drawing</a></h3>

      <h3 class="SideTOC3"><a href="#998345">
      PIM Database Access</a></h3>

      <h3 class="SideTOC3"><a href="#998452">
      Differences in Endianness</a></h3>

      <h3 class="SideTOC3"><a href="#998330">
      Application Process Tear-down</a></h3>

   <h2 class="SideTOC2"><a href="#995096">
   Beyond the Basic Port</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="994187"> </a>Converting a 68K-based Palm OS application to a native ARM application running on Palm OS Cobalt can usually be done in two steps:</p>
<ol type="1">
  <li value="1"><a name="998887"> </a>Perform a basic port, keeping the new code as close to the original as possible. This results in a running application that looks and feels&#8212;and is&#8212;nearly identical to the original.
  <li value="2"><a name="998889"> </a>Change sections of the application to take advantage of the new capabilities of Palm OS Cobalt. Depending upon your application, you might modify it so that it uses schema databases, or you might re-architect it so that portions of the application run in one or more separate threads.
</ol>

<p><a name="996915"> </a>This book is intended to help you with step <a href="PortingProcess.html#998887">1</a>; this chapter outlines a basic process for doing a straight port and discusses some of the more commonly-encountered problem areas. There isn't a general procedure for performing step <a href="PortingProcess.html#998889">2</a>. Depending upon which Palm OS Cobalt features you want to take advantage of, consult the appropriate books in the <i>Exploring Palm OS</i> series to learn more about how you would write software that can take advantage of those features.</p>

<h2 class="haH2">
  <a name="994477"> </a>The Basic Porting Procedure <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="994518"> </a>The following are a series of steps one can take to convert a basic 68K-based Palm OS application to a native ARM application. Note that the order of these steps is not critical. As well, depending on your application some of these steps may not apply, and additional steps may well be necessary.</p>
<ol type="1">
  <li value="1"><a name="994478"> </a>Before you begin, verify that your project builds and runs cleanly on the Palm OS Garnet version 5.3 simulator. Enable all debugging checks, and fix any errors or warnings that arise. 
  <li value="2"><a name="996949"> </a>Convert all resources.
   <p><a name="994546"> </a>Previously, Palm OS application resources were stored in an encoded format in <code>.rsrc</code> files if you used CodeWarrior, or in <code>.rcp</code> or <code>.ro</code> files otherwise. In Palm OS Cobalt resources are stored using an XML format in one or more <code>.xrd</code> files. Accordingly, each resource must be converted to the new format. Among the tools that make up the Palm OS Cobalt development suite is the "Generate XRD Wizard." This tool lets you </p>
  <ul type="disc">
    <li><a name="994479"> </a>convert all resources from an existing PRC, or
    <li><a name="994480"> </a>convert <code>.rsrc</code> files
   <p><a name="998978"> </a>Note that you must pass to the Wizard the files inside the <code>Resource.frk</code> folder, if on Windows. Developers on Mac OS must convert their resource files to Window format (with all data in the data fork, not in the resource fork), while PilRC users can create a PRC and pass that to the Wizard. </p>
  </ul>
  <li value="3"><a name="994481"> </a>Create a new empty Palm OS project of the appropriate type. Exactly how you do this depends upon your development environment.
  <li value="4"><a name="994482"> </a>Add copies of your 68K-based project's files to the empty project. This includes source files, header files, and the converted resource files that were created in step <a href="PortingProcess.html#996949">2</a>.
  <li value="5"><a name="994483"> </a>Open your C source files and comment out #includes for specific Palm OS header files. Instead, make sure that your C source files include <code>PalmOS.h</code>.
  <li value="6"><a name="994487"> </a>Unless you are trying to maintain a single set of source files that can be compiled for either ARM or 68K&#8212;something that can be tricky to do and would prevent you from taking advantage of the many new capabilities of Palm OS Cobalt&#8212;change declarations of variables of type <code>Err</code> to <code>status_t</code>. Note that in Palm OS Cobalt <code>status_t</code> is a signed 32-bit integer, while <code>Err</code> was defined in the 68K-based SDKs to be an unsigned 16-bit integer. Error values are all less than zero. Some functions may now return "status" codes that aren't errors; these values are greater than zero. Because of this, you should rewrite any code that looks like this:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
if (err) {<a name="997233"> </a>
   // handle errors here. This is WRONG in Palm OS Cobalt<a name="997253"> </a>
}<a name="997275"> </a>
</pre><div class="CodeRule"><hr></div>

   <p><a name="997292"> </a>Ideally, you should check for specific error codes. To check for a no-error condition, compare the returned value against <code>errNone</code>.</p>
   <p><a name="997165"> </a>While you are at it&#8212;and because it is little more than another set of search-and-replace operations&#8212;you may want to change how other variables are declared to better conform with the data types used by the Palm OS Cobalt APIs. For instance, change variables of type <code>UInt16</code> to <code>uint16_t</code>. <a href="PortingProcess.html#994639">Table 2.1</a> lists the basic data types used in the Palm OS Garnet headers and their corresponding Palm OS Cobalt data types.</p>
</ol>

<p class="caption"><a name="994639"> </a><b>Table 2.1&nbsp;&nbsp;Palm OS Cobalt basic data types </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="994643"> </a><b>Palm OS Garnet-style data type</b></p>
    </th>
    <th><p class="tt"><a name="994645"> </a><b>Palm OS Cobalt-style data type</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994647"> </a><code>Char</code></p>
    </td>
    <td><p class="tt"><a name="994649"> </a><code>char</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994651"> </a><code>Err</code></p>
    </td>
    <td><p class="tt"><a name="994653"> </a><code>status_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994725"> </a><code>Int16</code></p>
    </td>
    <td><p class="tt"><a name="994727"> </a><code>int16_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994721"> </a><code>Int32</code></p>
    </td>
    <td><p class="tt"><a name="994723"> </a><code>int32_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994717"> </a><code>Int64</code></p>
    </td>
    <td><p class="tt"><a name="994719"> </a><code>int64_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994713"> </a><code>Int8</code></p>
    </td>
    <td><p class="tt"><a name="994715"> </a><code>int_8</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994709"> </a><code>UInt16</code></p>
    </td>
    <td><p class="tt"><a name="994711"> </a><code>uint16_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994705"> </a><code>UInt32</code></p>
    </td>
    <td><p class="tt"><a name="994707"> </a><code>uint32_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994701"> </a><code>UInt64</code></p>
    </td>
    <td><p class="tt"><a name="994703"> </a><code>uint64_t</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994697"> </a><code>UInt8</code></p>
    </td>
    <td><p class="tt"><a name="994699"> </a><code>uint8</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994693"> </a><code>WChar</code></p>
    </td>
    <td><p class="tt"><a name="999796"> </a><code>wchar32_t</code>, or <code>wchar16_t</code> if you need an explicit 16-bit value for UTF-16/UCS-2 Unicode support. (Although this type is declared in the Palm OS Protein headers, it should be regarded as deprecated).</p>
    </td>
  </tr>
</table>

</div>

   <p><a name="999112"> </a>The header file <code>PalmTypesCompatibility.h</code> maps these data types for you using a series of typedefs. Although it is indirectly included in <code>PalmOS.h</code>&#8212;<code>SslLib.h</code> includes it&#8212;don't count on it being part of <code>PalmOS.h</code> in future SDK releases. Either change your data types as outlined above, or specifically <code>#include</code> this header file in each of your source files in order to get these mappings. <code>PalmTypesCompatibility.h</code> is most useful when you are trying to create a single set of source files that can be compiled using either the Palm OS Garnet or Palm OS Cobalt SDKs. See <a href="PortingProcess.html#996450">"Compatibility Headers"</a> for more information on the compatibility header files.</p>

<div><hr>
  <a name="994884"> </a> <b>NOTE: </b> If your application included <code>PalmCompatibility.h</code> to allow it to use older-style data types&#8212;such as <code>Int</code>, <code>Short</code>, and <code>DWord</code>&#8212;you will have to change your declarations to use the new data types. <code>PalmCompatibility.h</code> is not among the Palm OS Cobalt header files.
<hr>
</div>
<ol type="1">
  <li value="7"><a name="998549"> </a>Remove the call to the <code>RomVersionCompatible()</code> function, or at least update the function so that it checks for version 6.0 as a minimum version number. Note that the <code>AppLaunchWithCommand()</code> function, commonly called from within <code>RomVersionCompatible()</code>, is not part of the Palm OS Cobalt ARM-native API set. 
   <p><a name="999141"> </a>If you leave the <code>RomVersionCompatible()</code> function in place, be sure to remove the check for Palm OS 1.0; it isn't needed since by design ARM-native Palm OS Cobalt applications won't launch on devices running an earlier version of Palm OS (5.x or earlier).</p>
  <li value="8"><a name="994489"> </a>Build your project, and deal with the errors that arise. These errors are the result of differences between the 68K APIs and the Palm OS Cobalt ARM-native APIs. The following are differences that result in many of the errors you'll see:
  <ul type="disc">
    <li><a name="996571"> </a>As discussed under <a href="PortingProcess.html#994468">"Missing UNIX Header Files,"</a> the <code>Core/System/UNIX</code> directory is not part of the Palm OS Cobalt ARM-native API set. 
    <li><a name="996627"> </a>APIs that access a resource file and used to depend on the resource search chain now need to be pointed to the resource file that contains the resource. Until you make the needed changes, the compiler will complain that some of your function calls don't pass enough parameters (and the missing parameter is a <code>DmOpenRef</code>). See <a href="PortingProcess.html#993931">"No Resource Search Chain"</a> for tips on dealing with these errors.
    <li><a name="996652"> </a>Functions that formerly took a <code class="par">cardNo</code> parameter no longer do so. See <a href="PortingProcess.html#994298">"The cardNo Parameter"</a> for the list of affected functions, and some tips on handling this change. Note that the "V50" versions of these functions still take a <code class="par">cardNo</code> parameter, but be aware that the V50 functions work with Classic, not Extended, databases.
    <li><a name="996679"> </a>Calls to Palm OS Glue functions need to be replaced by calls to the function underlying each Palm OS Glue function. See <a href="PortingProcess.html#995116">"No Palm OS Glue"</a> for more details on dealing with these missing functions.
    <li><a name="996714"> </a>Code that directly accessed system structures that are now private, or have undergone significant change, will be flagged. Update the code to use the appropriate accessor function(s) as discussed under <a href="PortingProcess.html#995220">"Changes in System Structures."</a>
    <li><a name="997664"> </a>Most functions that were previously deprecated&#8212;as indicated by an operating system version number on the end of the function name (<code>CategoryEditV20()</code>, for example)&#8212;are not included in the Palm OS Cobalt ARM-native APIs. If your application uses one or more of these functions, see the appropriate chapters in <a href="PortingPalmApps_Part2.html#999351">Part II</a> of this book for the corresponding function to call.
    <li><a name="996592"> </a>Per <a href="PortingProcess.html#995760">"Renamed Functions,"</a> a number of functions have new names in Palm OS Cobalt, meaning that your compiler will flag any attempts to call the function by its old name.
    <li><a name="996605"> </a>The way in which <code>DmGetNextDatabaseByTypeCreator()</code> is used has changed significantly. See <a href="PortingProcess.html#995813">"DmGetNextDatabaseByTypeCreator() Changes."</a>
    <li><a name="998656"> </a>In Palm OS Cobalt applications no longer use the Net Library in order to connect to, and transfer data to and from, other machines using the standard TCP/IP protocols. Instead, you'll have to change your application to use the standard Berkeley sockets APIs declared in <code>sys/sockets.h</code>.
    <li><a name="997653"> </a>There are now 1000 ticks per second, and this value is true on real devices, on emulators, and on the Simulator. Also, tick values are stored in unsigned 64-bit integers. Pay close attention to functions that take a tick value parameter, particularly if you pass a non-zero constant value. See <a href="PortingProcess.html#997405">"Changes in the Number of Ticks Per Second."</a>
    <li><a name="994490"> </a>You'll likely need to do some casting in order to make the compiler happy; a number of function parameters and return types have changed sizes. In some cases you may need to re-declare variables to avoid a loss of precision.
    <li><a name="994499"> </a>There is little left of the Graffiti Manager. In Palm OS Cobalt you typically use the Pen Input Manager instead. One of the more common operations was to set the shift state using <code>GrfSetState()</code>. In Palm OS Cobalt to set the input area to "shifted" mode, use:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
PINSetInputMode(pinInputModeShift);<a name="994500"> </a>
</pre><div class="CodeRule"><hr></div>

      <p><a name="998584"> </a>For more on the Pen Input Manager and user input in general, see <i>Exploring Palm OS: Input Services</i>.</p>
   <p><a name="998588"> </a>A discussion on how you might deal with many of the above issues can be found in one of the sections under <a href="PortingProcess.html#993918">"Common Compile-Time Errors."</a> For details on the differences between the API sets, see <a href="PortingPalmApps_Part2.html#999351">Part II</a> of this book.</p>
  </ul>
  <li value="9"><a name="994975"> </a>Test your application, and deal with the errors that you see. See <a href="PortingProcess.html#994978">"Common Run-Time Errors"</a> for some of the more common run-time errors you may encounter, and tips on how to deal with them.
</ol>

<h2 class="haH2">
  <a name="996450"> </a>Compatibility Headers <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996454"> </a>The Palm OS Cobalt ARM-native API set includes a number of "compatibility" header files. These revert some of the API name changes, and accommodate some of the simpler function parameter list modifications that were made due to the lack of a resource search chain and the elimination of the concept of internal memory cards.</p>

<p><a name="996455"> </a>These compatibility headers are not included by default; you must include the appropriate compatibility headers in each of your application source files as necessary. Note that because they simply allow you to put off a set of rather simple changes, you should consider dispensing with these header files and simply altering your application's source to directly deal with the changes.</p>

<p><a name="996458"> </a>The following are the compatibility header files defined by the Palm OS Cobalt ARM-native SDK:</p>

<dl>
<dt><a name="996460"> </a>DataMgrCompatibility.h</dt>
<dd><a name="996461"> </a>Redirects a number of functions to their "V50" (deprecated) counterparts, and accounts for a number of APIs that have been renamed.</dd>

<dt><a name="996462"> </a>ExgMgrCompatibility.h</dt>
<dd><a name="996463"> </a>Declares three deprecated functions.</dd>

<dt><a name="996464"> </a>FloatMgrCompatibility.h</dt>
<dd><a name="996465"> </a>Declares a number of constants, structures, and macros formerly used in conjunction with the Float Manager.</dd>

<dt><a name="996466"> </a>IrLibCompatibility.h</dt>
<dd><a name="996467"> </a>Declares a number of APIs that allow applications to directly interact with the IR Library.</dd>

<dt><a name="996468"> </a>LocaleMgrCompatibility.h</dt>
<dd><a name="996469"> </a>Declares a set of <code>NumberFormatType</code> values. Rather than use these values, however, applications should be rewritten to use the format preference selected by the user (<code>prefNumberFormat</code>). If you need a locale-specific format, pass <code>lmChoiceNumberFormat</code> to <code>LmGetLocaleSetting()</code>.</dd>

<dt><a name="996470"> </a>MemoryMgrCompatibility.h</dt>
<dd><a name="996471"> </a>Declares a number of functions that take a <code class="par">cardNo</code> parameter. This allows your application to continue to work with card number values. Note, however, that the card number you pass must always be 0, and returned card number values are always 0.</dd>

<dt><a name="996472"> </a>ModemMgrCompatibility.h</dt>
<dd><a name="996473"> </a>Declares a number of APIs that allow applications to directly control a modem.</dd>

<dt><a name="996474"> </a>PalmTypesCompatibility.h</dt>
<dd><a name="996475"> </a>Allows your application to continue to employ the basic data types used in the Palm OS Garnet SDK. Also declares the <code>min()</code>, <code>max()</code>, and <code>OffsetOf()</code> macros.</dd>

<dt><a name="1000526"> </a>SysEventCompatibility.h</dt>
<dd><a name="1000531"> </a>Declares an enum and a struct using their Palm OS Garnet names; applications should use the new enum and structure declared in Palm OS Cobalt. See <a href="SysEvent.html#424916">Chapter 112, "SysEvent.h,"</a> for details. </dd>

<dt><a name="996476"> </a>WindowCompatibility.h</dt>
<dd><a name="996477"> </a>Declares a single function that was part of the Palm OS Garnet PINS API and used to set window constraints. In Palm OS Cobalt this function does nothing.</dd>

</dl>

<h2 class="haH2">
  <a name="993918"> </a>Common Compile-Time Errors <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996566"> </a>The following sections go into some detail about a few of the more common errors you may encounter after compiling your ported application for the first time. These sections are presented in no particular order.</p>
<h3 class="hbH3">
  <a name="994468"> </a>Missing UNIX Header Files <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="992930"> </a>The header files mentioned in step <a href="PortingProcess.html#994483">5.</a> are not the only header files that are not present. The <code>Core/System/UNIX</code> directory is also not part of the Palm OS Cobalt ARM-native API set. Use the header files declared in the <code>posix</code> and <code>streams</code> directories instead. So, for instance, instead of this:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#include &lt;unix_string.h&gt;<a name="993880"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="993886"> </a>do this:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
#include &lt;posix/string.h&gt;<a name="993895"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="998598"> </a>Note that there is not a direct mapping between the header files in <code>Core/System/UNIX</code> and those in the <code>posix</code> and <code>streams</code> directories. As well, differences between the UNIX and POSIX APIs may require you to modify or even rewrite those portions of your application that employ these APIs.</p>
<h3 class="hbH3">
  <a name="993931"> </a>No Resource Search Chain <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="993940"> </a>Prior to Palm OS Cobalt, Palm OS had the concept of a "resource search chain." This was a list of all open resource databases that would be searched by certain APIs. For compatibility purposes (mainly to support PACE) Palm OS Cobalt declares a number of "V50" APIs&#8212;such as <code>DmGetResourceV50()</code>&#8212;that continue to operate on the resource search chain. This functionality is only for backwards compatibility, however, and shouldn't be relied on going forward. Instead, your application should wherever possible explicitly identify the resource database that contains the resource in question.</p>

<p><a name="994049"> </a><a href="PortingProcess.html#993698">Table 2.2</a> lists the affected APIs. These APIs now take an additional parameter, a <code>DmOpenRef</code> that indicates the open resource database that contains the resource. </p>

<p class="caption"><a name="993698"> </a><b>Table 2.2&nbsp;&nbsp;Functions that have an added DmOpenRef parameter </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <td><p class="tt"><a name="993702"> </a><code>DmGetResource()</code></p>
    </td>
    <td><p class="tt"><a name="993704"> </a><code>ErrAlert()<a href="#993791"><sup>1</sup></a></code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993706"> </a><code>FrmAlert()</code></p>
    </td>
    <td><p class="tt"><a name="993708"> </a><code>FrmCustomAlert()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993710"> </a><code>FrmCustomResponseAlert()</code></p>
    </td>
    <td><p class="tt"><a name="993712"> </a><code>FrmGotoForm()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993714"> </a><code>FrmHelp()</code></p>
    </td>
    <td><p class="tt"><a name="993716"> </a><code>FrmInitForm()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993718"> </a><code>FrmPopupForm()</code></p>
    </td>
    <td><p class="tt"><a name="993720"> </a><code>MenuInit()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993722"> </a><code>MenuSetActiveMenuRscID()</code></p>
    </td>
    <td><p class="tt"><a name="993724"> </a><code>ResLoadConstant()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993726"> </a><code>ResLoadForm()</code></p>
    </td>
    <td><p class="tt"><a name="993728"> </a><code>ResLoadMenu()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993730"> </a><code>ResLoadString()</code></p>
    </td>
    <td><p class="tt"><a name="993732"> </a><code>SysCopyStringResource()<a href="#993765"><sup>2</sup></a></code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="993734"> </a><code>SysStringByIndex()</code></p>
    </td>
    <td><p class="tt"><a name="993736"> </a></p>
    </td>
  </tr>
</table>
<div class="tablediv"><table cellspacing="0" class="tTableNR">
   <tr>
     <td><div class="FNTFootnoteTable">
<a name="993791"> </a><a href="#993704">1</a>. Previously this was a macro declared in <code>ErrorBase.h</code>. In Palm OS Cobalt this is a function declared in <code>Form.h</code>.</div>
<div class="FNTFootnoteTable">
<a name="993765"> </a><a href="#993732">2</a>.  Note that unlike the other functions listed in this table, the <code>DmOpenRef</code> is the second parameter, not the first.</div>
</td>
   </tr>
</table></div>

</div>


<p><a name="992940"> </a>Because all of the resources explicitly accessed by most Palm OS applications reside within the application PRC itself, you can usually accommodate this change by doing the following:</p>
<ol type="1">
  <li value="1"><a name="994144"> </a>Declare a global variable of type <code>DmOpenRef</code>.
  <li value="2"><a name="994148"> </a>Early on in the execution of your program&#8212;in <code>StartApplication()</code>, perhaps&#8212;initialize this variable so that it contains a reference to your application's PRC. The loader contains two functions that make retrieving this very easy: <code>SysGetModuleDatabase()</code> and <code>SysGetRefNum()</code>.

<div class="CodeRule"><hr></div><pre class="CodeBlock">
status_t error;<a name="997050"> </a>
<a name="997032"> </a>
if((error = SysGetModuleDatabase(SysGetRefNum(), NULL,
      &amp;g_AppDB)) &lt; errNone)<a name="997033"> </a>
   return error;<a name="997034"> </a>
</pre><div class="CodeRule"><hr></div>

   <p><a name="999190"> </a>Note that <code>SysGetModuleDatabase()</code> performs an IPC, and thus is a bit slow. Because of this, you may not want to call this function for every launch code, but instead only for those where the global referencing your application's PRC is needed.</p>
  <li value="3"><a name="994154"> </a>Pass the global variable you declared in step <a href="PortingProcess.html#994144">1</a> to each function that now needs an exploit reference to your application's resource database.
</ol>

<h4 class="hcH4">
  <a name="996241"> </a>System Resources
</h4>

<p><a name="996254"> </a>Because the resource search chain is no longer supported, you cannot rely upon it to help you locate system resources. If your application employs system resources, you'll have to modify it to access those resources directly. Note that some system resources may have different resource IDs from their Palm OS Garnet counterparts, and some no longer exist at all.</p>

<p><a name="996343"> </a>The standard Edit menu continues to exist; its resource ID is 10000. As well, the alert icon bitmaps remain and can be used by applications. See <code>UIResources.h</code> for the set of system resources that can be used by Palm OS Cobalt applications.</p>
<h3 class="hbH3">
  <a name="994298"> </a>The cardNo Parameter <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="994307"> </a>Palm Powered handhelds were originally designed to have ROM and RAM located on one or more memory modules that were known as <b>cards</b>. (These cards were a logical construct used by the operating system and are in no way connected with the removable memory cards supported by the Expansion Manager.) In the 68K API set a number of functions take or return a <code class="par">cardNo</code> (card number) parameter to identify on which card the memory being referenced is located. Because almost all Palm Powered devices only had one memory card, many Palm OS applications assume that the <code class="par">cardNo</code> parameter is always 0. PACE requires that this parameter be set to 0.</p>

<p><a name="994345"> </a>In Palm OS Cobalt this memory module concept is no longer supported, so the <code class="par">cardNo</code> parameter is no longer needed. <a href="PortingProcess.html#994211">Table 2.3</a> lists those functions that are affected. When porting 68K code to the ARM-native environment, everywhere you have a call to one of these functions you'll have to remove the <code class="par">cardNo</code> parameter.</p>

<p class="caption"><a name="994211"> </a><b>Table 2.3&nbsp;&nbsp;Functions that no longer take a cardNo <br>parameter </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <td><p class="tt"><a name="994215"> </a><code>AlmGetAlarm()</code></p>
    </td>
    <td><p class="tt"><a name="994217"> </a><code>AlmSetAlarm()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994219"> </a><code>AttnForgetIt()</code></p>
    </td>
    <td><p class="tt"><a name="994221"> </a><code>AttnGetAttention()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994223"> </a><code>AttnGetCounts()</code></p>
    </td>
    <td><p class="tt"><a name="994225"> </a><code>AttnIterate()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994227"> </a><code>AttnUpdate()</code></p>
    </td>
    <td><p class="tt"><a name="994229"> </a><code>DmCreateDatabase()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994231"> </a><code>DmDatabaseInfo()</code></p>
    </td>
    <td><p class="tt"><a name="994233"> </a><code>DmDatabaseSize()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994235"> </a><code>DmDeleteDatabase()</code></p>
    </td>
    <td><p class="tt"><a name="994237"> </a><code>DmFindDatabase()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994239"> </a><code>DmGetDatabase()</code></p>
    </td>
    <td><p class="tt"><a name="994241"> </a><code>DmGetNextDatabaseByTypeCreator()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994243"> </a><code>DmNumDatabases()</code></p>
    </td>
    <td><p class="tt"><a name="994245"> </a><code>DmOpenDatabase()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994247"> </a><code>DmOpenDBNoOverlay()</code></p>
    </td>
    <td><p class="tt"><a name="994249"> </a><code>DmSetDatabaseInfo()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994251"> </a><code>(*ExgDbWriteProcPtr)()</code></p>
    </td>
    <td><p class="tt"><a name="994253"> </a><code>FileDelete()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994255"> </a><code>FileOpen()</code></p>
    </td>
    <td><p class="tt"><a name="994257"> </a><code>FindSaveMatch()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994259"> </a><code>MemHeapID()</code></p>
    </td>
    <td><p class="tt"><a name="994261"> </a><code>MemLocalIDToGlobal()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994263"> </a><code>MemLocalIDToLockedPtr()</code></p>
    </td>
    <td><p class="tt"><a name="994265"> </a><code>MemLocalIDToPtr()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994267"> </a><code>MemNumHeaps()</code></p>
    </td>
    <td><p class="tt"><a name="994269"> </a><code>MemNumRAMHeaps()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994271"> </a><code>SysAppLaunch()</code></p>
    </td>
    <td><p class="tt"><a name="994273"> </a><code>SysCurAppDatabase()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994275"> </a><code>SysGetROMToken()</code></p>
    </td>
    <td><p class="tt"><a name="994277"> </a><code>SysNotifyRegister()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994279"> </a><code>SysNotifyUnregister()</code></p>
    </td>
    <td><p class="tt"><a name="994281"> </a><code>SysUIAppSwitch()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994283"> </a><code>VFSExportDatabaseToFile()</code></p>
    </td>
    <td><p class="tt"><a name="994285"> </a><code>VFSExportDatabaseToFileCustom()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="994287"> </a><code>VFSImportDatabaseFromFile()</code></p>
    </td>
    <td><p class="tt"><a name="994289"> </a><code>VFSImportDatabaseFromFileCustom()</code></p>
    </td>
  </tr>
</table>

</div>

<h3 class="hbH3">
  <a name="995116"> </a>No Palm OS Glue <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="995131"> </a>The primary purpose of the Palm OS Glue libraries and macros was to allow developers to write code that would continue to work across the widest range of Palm OS devices, even as the APIs changed from one Palm OS release to another. Because Palm OS Cobalt, version 6.0 exposes the first&#8212;and currently only&#8212;set of ARM-native Palm OS APIs, "glue" functions and macros are not necessary.</p>

<p><a name="995144"> </a>In most cases, where your application used to call a glue function or use a glue macro it should use the underlying operating system function instead. This is usually a function with the same name as the glue function or macro, with the word "Glue" removed. So, for instance, instead of calling <code>WinGlueDrawChar()</code> your application should be updated to call <code>WinDrawChar()</code> instead.</p>

<p><a name="995198"> </a>For a complete list of the Palm OS Glue functions exposed by the latest 68K-based SDK, and the corresponding ARM-native functions you should use in your ported application, see <a href="PalmOSGlue.html#424916">Chapter 79, "PalmOSGlue."</a></p>
<h3 class="hbH3">
  <a name="995220"> </a>Changes in System Structures <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="995239"> </a>The Palm OS defines a number of data structures for use by the operating system. To aid in the debugging process many of these structures were declared in the public APIs, and notes in both the header files and the documentation warned developers not to access the contents of these structures directly.</p>

<p><a name="995244"> </a>In Palm OS Cobalt the internals of many of these structures are no longer publicly declared. For instance, in the latest Palm OS Garnet SDK the <code>FormType</code> structure is declared as follows:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct FormType<a name="995281"> </a>
#ifdef ALLOW_ACCESS_TO_INTERNALS_OF_FORMS // These fields... <a name="995283"> </a>
{<a name="995285"> </a>
   WindowType window;<a name="995287"> </a>
   UInt16 formId;<a name="995289"> </a>
   FormAttrType attr;<a name="995291"> </a>
   WinHandle bitsBehindForm;<a name="995293"> </a>
   FormEventHandlerType *handler;<a name="995295"> </a>
   UInt16 focus;<a name="995297"> </a>
   UInt16 defaultButton;<a name="995299"> </a>
   UInt16 helpRscId;<a name="995301"> </a>
   UInt16 menuRscId;<a name="995303"> </a>
   UInt16 numObjects;<a name="995305"> </a>
   FormObjListType *objects;<a name="995307"> </a>
}<a name="995309"> </a>
#endif<a name="995311"> </a>
FormType;<a name="995275"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="995444"> </a>In Palm OS Cobalt, the <code>FormType</code> structure is declared as follows:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct FormType FormType<a name="995450"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="995232"> </a>If, prior to porting your application to Palm OS Cobalt, you had successfully built your application with all debug checks enabled, the change in how these structures are defined should have no effect. If your application was directly accessing the contents of one of these structures, however, you'll have to rewrite those portions to use the appropriate accessor functions.</p>

<p><a name="995501"> </a>To determine the proper way to access the contents of one of these system structures, see the description of that structure in the reference documentation that is shipped with the Palm OS Garnet SDK: the <i>Palm OS Programmer's API Reference</i>.</p>

<h4 class="hcH4">
  <a name="995524"> </a>Redefined System Structures
</h4>

<p><a name="995525"> </a>Some system structures continue to be declared in such a way as to make their contents directly accessible. However, the structure's contents may have changed. For instance, in the Palm OS Garnet SDK the <code>BitmapType</code> structure is defined as follows:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct BitmapType<a name="995530"> </a>
#ifdef ALLOW_ACCESS_TO_INTERNALS_OF_BITMAPS   // These ...<a name="995532"> </a>
   {<a name="995534"> </a>
   Int16 width;<a name="995536"> </a>
   Int16 height;<a name="995538"> </a>
   UInt16 rowBytes;<a name="995540"> </a>
   BitmapFlagsType flags;<a name="995542"> </a>
   UInt8 pixelSize;<a name="995544"> </a>
   UInt8 version;<a name="995546"> </a>
   }<a name="995548"> </a>
#endif<a name="995550"> </a>
BitmapType;<a name="995552"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="995553"> </a>In Palm OS Cobalt this structure is declared like this, with the fields renamed to show the endianness changes:</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
typedef struct BitmapType {<a name="995622"> </a>
   int16_t widthBE16;<a name="995624"> </a>
   int16_t heightBE16;<a name="995626"> </a>
   uint16_t rowBytesBE16;<a name="995628"> </a>
   uint16_t flagsBE16;<a name="995630"> </a>
   uint8_t pixelSize;<a name="995632"> </a>
   uint8_t version;<a name="995634"> </a>
} BitmapType<a name="995636"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="995637"> </a>Although your application could be modified to access this structure's fields directly, wherever possible use accessor functions instead. So, for example, if your application was determining the dimensions of a bitmap by accessing the <code>BitmapType</code> structure's width and height fields directly, it should instead be rewritten to call <code>BmpGetDimensions()</code>.</p>
<h3 class="hbH3">
  <a name="995760"> </a>Renamed Functions <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="995777"> </a>For various reasons a number of APIs in the Palm OS Cobalt API set were brought forward from the Palm OS Garnet API set with new names. Often this was done to make the purpose of a function more immediately apparent, or to bring the name of a function more in line with similar functions that use a different naming pattern. For instance, the Palm OS Garnet function <code>BmpBitsSize()</code> is named <code>BmpGetSizes()</code> in the ARM-native API set. If the compiler informs you that a particular API is not declared, check the appropriate chapter in <a href="PortingPalmApps_Part2.html#1000443">Part II, "68K vs ARM-Native APIs," </a>to see if it has been renamed.</p>

<p><a name="996217"> </a><a href="PortingProcess.html#996129">Table 2.4</a>, below, lists some of the commonly-used APIs that were renamed for Palm OS Cobalt.</p>

<p class="caption"><a name="996129"> </a><b>Table 2.4&nbsp;&nbsp;New names of some commonly-used APIs</b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="996133"> </a><b>Old API name</b></p>
    </th>
    <th><p class="tt"><a name="996135"> </a><b>New API name</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996137"> </a><code>DmFindSortPosition()</code></p>
    </td>
    <td><p class="tt"><a name="996139"> </a><code>DmGetRecordSortPosition()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996141"> </a><code>DmGetResourceIndex()</code></p>
    </td>
    <td><p class="tt"><a name="996143"> </a><code>DmGetResourceByIndex()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996145"> </a><code>DmPositionInCategory()</code></p>
    </td>
    <td><p class="tt"><a name="996147"> </a><code>DmGetPositionInCategory()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996149"> </a><code>DmSearchRecord()</code></p>
    </td>
    <td><p class="tt"><a name="996151"> </a><code>DmSearchRecordOpenDatabases()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996153"> </a><code>DmSearchResource()</code></p>
    </td>
    <td><p class="tt"><a name="996155"> </a><code>DmSearchResourceOpenDatabases()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996157"> </a><code>DmSeekRecordInCategory()</code></p>
    </td>
    <td><p class="tt"><a name="996159"> </a><code>DmFindRecordByOffsetInCategory()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996161"> </a><code>DmComparF()</code></p>
    </td>
    <td><p class="tt"><a name="996163"> </a><code>DmCompareFunctionType()</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996165"> </a><code>DmResID</code></p>
    </td>
    <td><p class="tt"><a name="996167"> </a><code>DmResourceID</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996169"> </a><code>DmResType</code></p>
    </td>
    <td><p class="tt"><a name="996171"> </a><code>DmResourceType</code></p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="996173"> </a><code>SortRecordInfoType</code></p>
    </td>
    <td><p class="tt"><a name="996175"> </a><code>DmSortRecordInfoType</code></p>
    </td>
  </tr>
</table>

</div>


<h4 class="hcH4">
  <a name="998746"> </a>Memory Manager Functions
</h4>

<p><a name="998761"> </a>Although the functions provided by the Memory Manager continue to work as documented, many of them simply call the standard POSIX memory management functions. You are encouraged to call these functions directly, rather than using the Memory Manager functions. So for instance, instead of <code>MemMove()</code> you could call <code>memmove()</code>. Refer to <code>posix/stdlib.h</code> for <code>malloc()</code> and related functions, and <code>posix/string.h</code> for functions such as <code>memmove()</code>, <code>memset()</code>, and so on.</p>

<div><hr>
  <a name="998774"> </a> <b>IMPORTANT: </b> When changing a function call from, for instance, <code>MemMove()</code> to <code>memmove()</code>, carefully examine the parameters to make sure that they correspond exactly. In particular, pay attention to parameter ordering; some of the Palm OS functions do not use the same parameter ordering as their POSIX counterparts.
<hr>
</div>

<h4 class="hcH4">
  <a name="999995"> </a>String Functions
</h4>

<p><a name="999996"> </a>As with the Memory Manager functions, you can use the POSIX string functions in place of many of the Palm OS <code>Str...</code> string functions. The POSIX functions are typically faster than their Palm OS counterparts. Note, however, that the POSIX functions don't necessarily respect the device's locale and don't necessarily work with multi-byte characters as the Palm OS versions do. So, while you can safely call <code>strlen()</code> in place of <code>StrLen()</code>, and <code>strcmp()</code> in place of <code>StrCompareAscii()</code>, other functions aren't directly interchangeable. For example:</p>
<ul type="disc">
  <li><a name="999997"> </a><code>StrCompare()</code> performs a localized string comparison.
  <li><a name="1000001"> </a><code>StrToLower()</code> and <code>StrToUpper()</code> respect the current locale.
  <li><a name="1000002"> </a><code>StrChr()</code> and <code>StrStr()</code> properly deal with multibyte characters.
  <li><a name="1000003"> </a><code>StrNCopy()</code> and <code>StrNCat()</code> won't truncate the string in the middle of a multibyte character.
</ul>
<h3 class="hbH3">
  <a name="995813"> </a>DmGetNextDatabaseByTypeCreator() Changes <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>

<p class="tt"><a name="995816"> </a><code>DmGetNextDatabaseByTypeCreator()</code> must now be used in conjunction with the new <code>DmOpenIteratorByTypeCreator()</code> function; you indicate what you are searching for when calling the latter function. <code>DmGetNextDatabaseByTypeCreator()</code> now optionally returns information about the found database in addition to its database ID.</p>
<p class="tt"><a name="995832"> </a>If you just want to locate a single database, and not iterate through all databases that match the given criteria, consider calling <code>DmFindDatabaseByTypeCreator()</code> instead.</p>
<h3 class="hbH3">
  <a name="997405"> </a>Changes in the Number of Ticks Per Second <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="997433"> </a>In Palm OS Cobalt, version 6.0 there are 1000 ticks per second (but code should use the <code>SysTicksPerSecond()</code> macro instead of relying on a constant value). Because of this, variables that hold tick counts should be declared as <code>uint64_t</code>; this is what is returned from functions such as <code>TimGetTicks()</code>.</p>

<p><a name="997616"> </a>The number of ticks per second should not be counted upon to remain unchanged. Palm OS Cobalt defines a number of macros that allow you to work with time values and intervals using more natural units, such as seconds or milliseconds. The various <code>SysTimeIn...</code> macros, such as <a href="../System_Management/SystemMgr.html#995079"><code>SysTimeInMilliSecs()</code></a>, allow you to convert a system time value (a time interval, in ticks) to more conventional units. To convert from such units back to a system time value, use one of the <code>SysTimeTo...</code> macros, such as <a href="../System_Management/SystemMgr.html#995327"><code>SysTimeToMilliSecs()</code></a>. Consider rewriting your applications to avoid working directly with ticks; this will insulate your applications from any future changes in the number of ticks per second.</p>

<p><a name="997584"> </a>Although the <code>TimGetTicks()</code> function could be used in a loop to implement a delay, applications should be rewritten to use the <a href="../System_Management/SystemMgr.html#994909"><code>SysTaskDelay()</code></a> function instead. The <code>SysTaskDelay()</code> function automatically puts the unit into low-power mode during the delay. Using <code>TimGetTicks()</code> in a loop consumes much more current.</p>
<h3 class="hbH3">
  <a name="997059"> </a>ERROR_CHECK_LEVEL Not Defined <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="997067"> </a>In Palm OS Cobalt the <code>ERROR_CHECK_LEVEL</code> #define has been replaced by <code>BUILD_TYPE</code>. In 68K-based SDKs, <code>ERROR_CHECK_LEVEL</code> could either be set to <code>ERROR_CHECK_NONE</code>, <code>ERROR_CHECK_PARTIAL</code>, or <code>ERROR_CHECK_FULL</code>. <code>BUILD_TYPE</code>, on the other hand, is either set to <code>BUILD_TYPE_DEBUG</code> or <code>BUILD_TYPE_RELEASE</code>, depending on whether you are building your project for debugging or for release.</p>

<p><a name="997134"> </a>The <code>ErrDisplay...</code>, <code>ErrFatalDisplay...</code>, and <code>ErrNonFatalDisplay...</code> macros have been adjusted accordingly. Note, however, that these macros are only provided for compatibility purposes; applications should now use <code>ErrFatalError...</code> and <code>DbgOnlyFatalError...</code> instead. Also note that Palm OS Cobalt supports the POSIX <code>assert()</code> macro (defined in <code>posix/assert.h</code>).</p>

<p><a name="997143"> </a>For more on the use of these #defines and macros, see <a href="../System_Management/Debugging.html#1023430">"Displaying Development Errors"</a> of <i>Exploring Palm OS: System Management</i>.</p>

<h2 class="haH2">
  <a name="994978"> </a>Common Run-Time Errors <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="998217"> </a>The following sections describe some of the errors you may encounter when running your application. Errors of this type won't be caught by the compiler. These sections are presented in no particular order.</p>
<h3 class="hbH3">
  <a name="998337"> </a>The "Save Behind" Bit <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="998483"> </a>Versions of Palm OS prior to Palm OS Cobalt saved and restored the area of the screen obscured by a form if Save Behind was selected in the form's resource. For ARM-native applications Palm OS Cobalt doesn't honor the Save Behind setting; in a debug build it will warn you of this fact when a form is displayed that has Save Behind set.</p>

<p><a name="998510"> </a>To deal with this, you need to:</p>
<ol type="1">
  <li value="1"><a name="998511"> </a>Turn off Save Behind. You can do this by opening each form in "Palm OS Resource Editor" (double-click it). Select the form, and un-check "Save Behind" if it has been checked. Alternatively, you can just open the XRD file in a text editor and change "SAVE_BEHIND" to "FALSE". The line you need to change in the XRD file looks like this:

<div class="CodeRule"><hr></div><pre class="CodeBlock">
&lt;SAVE_BEHIND&gt; TRUE &lt;/SAVE_BEHIND&gt;<a name="998339"> </a>
</pre><div class="CodeRule"><hr></div>

  <li value="2"><a name="998519"> </a>Make sure that your application correctly responds to updates. That is, make sure that it draws when it receives a <code>frmUpdateEvent</code> (and only when it receives a <code>frmUpdateEvent</code>).
</ol>

<p><a name="998524"> </a>For more on dealing with forms, see <a href="../User_Interface/UI_FormConcept.html#608590">Chapter 2, "Working with Forms and Dialogs,"</a> of <i>Exploring Palm OS: User Interface</i>. </p>
<h3 class="hbH3">
  <a name="998282"> </a>Restrictions on Callbacks <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="998283"> </a>There is no guarantee that your code will still be loaded, or that it will be loaded at the same location in memory after an application switch. Therefore, the use of callbacks to communicate between executable modules, while technically allowed in certain rare cases, is no longer encouraged. Instead, use custom launch codes to communicate between executable modules. This applies to notifications, the Attention Manager, and the like. </p>

<p><a name="998284"> </a>Also note that data structures passed along with launch codes&#8212;<code>SysNotifyParamType</code> structures that accompany notifications, for example&#8212;should not contain embedded pointers.</p>

<p><a name="999274"> </a>Note that callbacks within an executable module&#8212;to form event handlers, list drawing routines, and such&#8212;are fine.</p>

<h4 class="hcH4">
  <a name="998285"> </a>Streaming Sound Callbacks
</h4>

<p><a name="998286"> </a>Don't use the streaming sound callbacks to cause sounds to play after an application has quit. Instead, create a background thread and play the sounds from within that thread.</p>
<h3 class="hbH3">
  <a name="998287"> </a>Custom Drawing <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="999250"> </a>As explained under <a href="../User_Interface/UI_FormConcept.html#1003393">"Drawing or Updating a Form"</a> of <i>Exploring Palm OS: User Interface</i>, custom drawing in update-based windows should only be done in response to a <a href="../User_Interface/UI_Form.html#1089359"><code>frmUpdateEvent</code></a>. If you use legacy or transitional windows you can draw whenever you like. However, if you do any custom drawing you must handle <code>frmUpdateEvent</code>. To trigger a <code>frmUpdateEvent</code>, call <a href="../User_Interface/UI_Window.html#1522335"><code>WinInvalidateRect()</code></a> or <a href="../User_Interface/UI_Window.html#1522408"><code>WinInvalidateWindow()</code></a>.</p>

<p><a name="998301"> </a>Many of the window drawing operations (documented under <a href="../User_Interface/UI_Window.html#1094199">"WinDrawOperation"</a> of <i>Exploring Palm OS: User Interface</i>) are deprecated in the Palm OS Cobalt ARM-native APIs. Pay particular attention to <code>winInvert</code> and <code>winSwap</code>; these do not work when drawing text, drawing unfilled rectangles, or drawing to update-based windows. When you try to use them in these instances, nothing is drawn to the screen.</p>
<h3 class="hbH3">
  <a name="998345"> </a>PIM Database Access <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="998349"> </a>The PIM applications have been rewritten to use schema databases. Applications that directly access the PIM databases will quickly discover that the classic databases used by the 68K-based versions of the PIM applications are either not present or are empty. Such applications will have to be rewritten<a href="#998910"><sup>1</sup></a>. See <i>Exploring Palm OS: Memory, Databases, and Files</i> for information on reading and writing schema databases. <i>Exploring Palm OS: Palm OS File Formats</i> describes the schema of the PIM application databases.</p>
<h3 class="hbH3">
  <a name="998452"> </a>Differences in Endianness <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="998453"> </a>68K applications live in a big-endian world. Palm OS Cobalt, on the other hand, uses the ARM processor in little-endian mode. Because of this, to allow the exchange of data between a handheld running Palm OS Cobalt and one running Palm OS Garnet or an earlier Palm OS version, you'll need to develop a "wire format"&#8212;a processor-independent format&#8212;for the data being exchanged. The PIM applications do this by adopting standard exchange formats such as vCalendar.</p>

<p><a name="998467"> </a>Note that byte ordering can affect your application's conduits as well. If your application uses a conduit you can add byte-swapping routines to your conduit as needed.</p>
<h3 class="hbH3">
  <a name="998330"> </a>Application Process Tear-down <a href="#608590"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="998331"> </a>Applications run in a dedicated process. When the application quits, the application is torn down. Because of this, you no longer use <code>MemPtrSetOwner()</code> to share a block of memory between applications.</p>

<div><hr>
  <a name="998935"> </a> <b>NOTE: </b> Palm OS Cobalt maintains a "legacy heap" largely for use by PACE. All "legacy" memory (memory allocated from 68K code) resides in this heap. The legacy heap is persistent across invocations of PACE and native ARM applications. It is limited in size, and is size-checked at application shut-down. The legacy heap respects all of the behavior of the heap model used in Palm OS versions prior to Palm OS Cobalt, including the behavior related to owner IDs.
<hr>
</div>

<p><a name="1000006"> </a>The fact that the application process is torn down when your application quits also means that:</p>
<ul type="disc">
  <li><a name="1000007"> </a>You can't use callback notifications. There is no guarantee that your code will be loaded, or that it will be loaded at the same location after an application switch.
  <li><a name="1000008"> </a>You can't use embedded pointers in the <code>SysNotifyParamType</code> structures that accompany your notifications.
</ul>

<h2 class="haH2">
  <a name="995096"> </a>Beyond the Basic Port <a href="#608590"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="998728"> </a>Once your application is up and running natively on Palm OS Cobalt, you may want to take advantage of the many new features of the Palm OS Cobalt operating system. Features such as schema databases, multithreading, and the new multimedia subsystem can be used to greatly enhance a Palm OS application, making it richer and more powerful.</p>

<p><a name="998691"> </a>Even if you don't want to take advantage of these major new features, however, note that some of the programming techniques you had to employ in a 68k-based Palm OS application were "defensive" in nature&#8212;they were to work around limitations in the operating system. Palm OS Cobalt lifts many of these restrictions, so although the old code will continue to work, you may wish to simplify your application by removing any code that exists to work around these limitations. In particular, note that:</p>
<ul type="disc">
  <li><a name="999297"> </a>Using handles is rarely beneficial in Palm OS Cobalt, so use pointers for simplicity.
  <li><a name="998703"> </a>Global variables are now available for all launch codes and for shared libraries.
  <li><a name="998704"> </a>Memory chunks are no longer limited to a maximum of 64 KB. Extended database records can exceed 64 KB as well (but note that Classic databases retain this restriction).
  <li><a name="998705"> </a>Code segmentation of large applications is no longer necessary.
  <li><a name="998706"> </a>Applications can now be multi-threaded.
  <li><a name="999300"> </a>All applications are now shared libraries, exporting <code>PilotMain()</code>. Applications can also export other functions. Shared libraries are much easier to write in Palm OS Cobalt: there are no trap dispatch tables, and you can use global variables. To use a shared library, simply link against the library's stub file.
  <li><a name="1000028"> </a>MathLib has been ported to ARM. Note that in Palm OS Cobalt version 6.0 MathLib is not in ROM, however. It may well be in ROM in later releases of Palm OS Cobalt.
</ul>
 

<hr> 
<p class="FNFootnote">
<a name="998910"> </a><a href="#998349">1</a>. 68K-based applications that run courtesy of PACE continue to work, however; see "Accessing the PIM Application Databases" on page 13 for specifics.</p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 1996&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="PortingPalmApps_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="PortingPalmAppsTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PACE.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="PortingPalmApps_Part2.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>