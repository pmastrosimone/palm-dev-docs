<html>
<head>
<title>(Protein) Working with Menus | User Interface </title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource_HTML_2003 20041101">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks AutoMap 2003 for FrameMaker 8.0.6.2138">
<META NAME="LASTUPDATED" CONTENT="11/22/04 11:45:13">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="1005083"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="UI_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="UI_ControlConcept.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="UI_FieldConcept.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="UI_IX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">4 &nbsp;&nbsp;
Working with Menus</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">User Interface </p>
<p class="SubTitle">Exploring Palm OS&#174; </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1-PartTab"><a href="UI_PartConcept.html">Part I: Concepts</a> </h1>
<h1 class="SideTOC1"><a href="UI_MenuConcept.html">4  Working with Menus</a></h1>

   <h2 class="SideTOC2"><a href="#1027538">
   Menu Events </a></h2>

   <h2 class="SideTOC2"><a href="#1027126">
   Edit Menu</a></h2>

   <h2 class="SideTOC2"><a href="#1026985">
   Menu Command Shortcuts</a></h2>

   <h2 class="SideTOC2"><a href="#1007145">
   Dynamic Menus</a></h2>

   <h2 class="SideTOC2"><a href="#1027571">
   Summary of Menu Functions</a></h2>

</div>
</td>

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>

<!--END SIDETOC-->

<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="1007005"> </a>A menu bar is displayed whenever the user taps a Menu icon or whenever the user taps in a form's title bar. The menu bar, a horizontal list of menu titles, appears at the top of the screen in its own window, above all application windows. Pressing a menu title highlights the title and "pulls down" the menu below the title (see <a href="UI_MenuConcept.html#1007010">Figure 4.1</a>). </p>

<p class="FFigureCaption">
  <a name="1007010"> </a><b>Figure 4.1&nbsp;&nbsp;Menu</b>
</p>
<div align="left"><img src="images/EditMenu.jpg" height="142" width="480" border="0" hspace="0" vspace="0">
</div>

<p><a name="1007030"> </a>User actions have the following effect on a menu:</p>


<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1007033"> </a><b>When...</b></p>
    </th>
    <th><p class="tt"><a name="1007035"> </a><b>Then...</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1007037"> </a>User drags the pen through the menu</p>
    </td>
    <td><p class="tt"><a name="1007039"> </a>Command under the pen is highlighted</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1007041"> </a>Pen is released over a menu item</p>
    </td>
    <td><p class="tt"><a name="1007043"> </a>That item is selected and the menu bar and menu disappear</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1007045"> </a>Pen is released outside both the menu bar and the menu</p>
    </td>
    <td><p class="tt"><a name="1007047"> </a>Both menu and menu bar disappear and no selection is made</p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1007049"> </a>Pen is released in a menu title</p>
    </td>
    <td><p class="tt"><a name="1007051"> </a>Menu bar and Menu remain displayed until a selection is made from the menu. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1007053"> </a>Pen is tapped outside menu and menu bar</p>
    </td>
    <td><p class="tt"><a name="1007055"> </a>Both menu and menu bar are dismissed</p>
    </td>
  </tr>
</table>

</div>


<p><a name="1007057"> </a>A menu has the following features:</p>
<ul type="disc">
  <li><a name="1007058"> </a>Item separators, which are lines to group menu items.
  <li><a name="1007059"> </a>Menu shortcuts; the shortcut labels are right justified in menu items.
  <li><a name="1007060"> </a>A menu remembers its last selection; the next time a menu is displayed the prior selection appears highlighted.
</ul>

<h2 class="haH2">
  <a name="1027538"> </a>Menu Events  <a href="#1005083"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1027560"> </a>All applications that support menus should handle the <a href="UI_Menu.html#996623"><code>menuEvent</code></a>. This event is sent when the user selects a menu command from a menu. The application should respond by performing the requested action. </p>

<p><a name="1026743"> </a>General event handling for menus is performed by <a href="UI_Menu.html#994712"><code>MenuHandleEvent()</code></a>. <a href="UI_MenuConcept.html#1026814">Table 4.1</a> describes how user actions get translated into events and what <code>MenuHandleEvent()</code> does in response. </p>

<p class="caption"><a name="1026814"> </a><b>Table 4.1&nbsp;&nbsp;Event flow for menus </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1026820"> </a><b>User Action</b></p>
    </th>
    <th><p class="tt"><a name="1026822"> </a><b>Event Generated</b></p>
    </th>
    <th><p class="tt"><a name="1026824"> </a><b>MenuHandleEvent() Response</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1026826"> </a>Pen enters menu bar.</p>
    </td>
    <td><p class="tt"><a name="1026832"> </a><a href="../Input_Services/In_LowEvents.html#994048"><code>penDownEvent</code></a> with the x and y coordinates. </p>
<p class="tt"><a name="1027995"> </a><a href="UI_Window.html#1659238"><code>winEnterEvent</code></a> identifying menu's window is generated when a pull-down menu's window is opened. </p>
    </td>
    <td><p class="tt"><a name="1027940"> </a>Tracks the pen without blocking. Responds to <code>penMoveEvent</code> as appropriate. </p>
<p class="tt"><a name="1026835"> </a>If this is the first time the menu has been opened, adds a <a href="UI_Menu.html#996648"><code>menuOpenEvent</code></a> containing how the menu was opened. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1026841"> </a>User selects a menu item. </p>
    </td>
    <td><p class="tt"><a name="1026847"> </a><a href="../Input_Services/In_LowEvents.html#994097"><code>penUpEvent</code></a> with the x and y coordinates. </p>
    </td>
    <td><p class="tt"><a name="1026850"> </a>Adds a <code>menuEvent</code> with the item's ID to the event queue. </p>
    </td>
  </tr>
</table>

</div>


<h2 class="haH2">
  <a name="1027126"> </a>Edit Menu <a href="#1005083"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1027148"> </a>Forms that display editable text fields should provide the system default Edit menu. This menu is shown in <a href="UI_MenuConcept.html#1007010">Figure 4.1</a>. To provide the system default edit menu, do the following:</p>
<ol type="1">
  <li value="1"><a name="1027271"> </a>Create a menu resource in your application's resource file and give it the ID 10000. 
  <li value="2"><a name="1027284"> </a>Add the menu commands to the menu in the order shown in <a href="UI_MenuConcept.html#1007010">Figure 4.1</a>. 
  <li value="3"><a name="1027350"> </a>Associate the menu resource with the form's menu bar resource. 
</ol>

<p><a name="1027137"> </a>As long as you have given your Edit menu the ID 10000 and have the commands listed in the same order, Palm OS<sup>&#174;</sup> handles all of the <a href="UI_Menu.html#996623"><code>menuEvent</code></a>s for your Edit menu. You do not have to write any code. </p>

<h2 class="haH2">
  <a name="1026985"> </a>Menu Command Shortcuts <a href="#1005083"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1026987"> </a>As an alternative to selecting a menu command through the user interface, users can instead write a menu shortcut in the input area if the current handwriting recognition engine supports it. </p>

<div><hr>
  <a name="1028148"> </a> <b>IMPORTANT: </b> Only use a single character from A to Z (case-insensitive) to define a shortcut. Do not use accented characters. 
<hr>
</div>

<p><a name="1026988"> </a>The user can draw a menu command stroke followed by another character. If the next character matches one of the shortcut characters for an item on the active menu, a <a href="UI_Menu.html#996623"><code>menuEvent</code></a> with that menu item is generated. To support this behavior, you simply specify a shortcut character when you create a menu item resource. The default behavior of Palm OS handles this shortcut appropriately. </p>

<p><a name="1026993"> </a>Drawing the menu command stroke displays the command tool bar (see <a href="UI_MenuConcept.html#1026999">Figure 4.2</a>). This tool bar is the width of the screen. The command tool bar displays a status message on the left and buttons on the right. After drawing the command stroke, the user has the choice of writing a character or of tapping one of the buttons on the command tool bar. Both of these actions cause the status message to be briefly displayed and (in most cases) a <code>menuEvent</code> to be added to the event queue. </p>

<p class="FFigureCaption">
  <a name="1026999"> </a><b>Figure 4.2&nbsp;&nbsp;Command tool bar</b>
</p>
<div align="left"><img src="images/Toolbar.gif" border="0" hspace="0" vspace="0">
</div>

<p><a name="1027004"> </a>The buttons displayed on the tool bar depend on the user context. If the focus is in an editable field, the UI Library displays buttons for cut, copy, and paste on the command tool bar. If there is an action to undo, the UI Library also displays a button for undo. </p>

<p><a name="1027005"> </a>The active application may also add its own buttons to the tool bar. To do so, respond to the <a href="UI_Menu.html#996588"><code>menuCmdBarOpenEvent</code></a> and use <a href="UI_Menu.html#993982"><code>MenuCmdBarAddButton()</code></a> to add the button. <a href="UI_MenuConcept.html#1027018">Listing 4.1</a> shows some code from the Memo Pad application that adds to the command tool bar a button that displays the security dialog and then prevents the UI Library from adding other buttons. </p>
<p class="CCodeCaption">
  <a name="1027018"> </a><b>Listing 4.1&nbsp;&nbsp;Responding to menuCmdBarOpenEvent</b>
</p>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
else if (event-&gt;eType == menuCmdBarOpenEvent) {<a name="1027019"> </a>
 <a name="1027020"> </a>
   MenuCmdBarAddButton(menuCmdBarOnLeft, myAppDB, <a name="1027021"> </a>
      BarSecureBitmap, menuCmdBarResultMenuItem, <a name="1027022"> </a>
      ListOptionsSecurityCmd, 0);<a name="1027023"> </a>
 <a name="1027024"> </a>
   // Tell the field package to not add buttons <a name="1027025"> </a>
   // automatically; we've done it all ourselves.<a name="1027026"> </a>
   event-&gt;data.menuCmdBarOpen.preventFieldButtons = true;<a name="1027027"> </a>
 <a name="1027029"> </a>
   // Don't set handled to true; this event must <a name="1027030"> </a>
   // fall through to the system.<a name="1027031"> </a>
}<a name="1027032"> </a>
</pre><div class="CodeRule"><hr></div>


<p><a name="1027033"> </a>The system contains bitmaps that represent such commands as beaming and deleting records. If your application performs any of these actions, it should use the system bitmap. <a href="UI_MenuConcept.html#1027043">Table 4.2</a> shows the system bitmaps and the commands they represent. If you use any of these, you should use them in the order shown, from right to left. That is, <code>BarDeleteBitmap</code> should always be the rightmost of these bitmaps, and <code>BarInfoBitmap</code> should always be the leftmost. </p>

<p class="caption"><a name="1027043"> </a><b>Table 4.2&nbsp;&nbsp;System command tool bar bitmaps </b></p>
<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1027047"> </a><b>Bitmap</b></p>
    </th>
    <th><p class="tt"><a name="1027049"> </a><b>Command</b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027052"> </a><code>BarDeleteBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027054"> </a>Delete record. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027057"> </a><code>BarPasteBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027059"> </a>Paste clipboard contents at insertion point. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027062"> </a><code>BarCopyBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027064"> </a>Copy selection. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027067"> </a><code>BarCutBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027069"> </a>Cut selection. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027072"> </a><code>BarUndoBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027074"> </a>Undo previous action. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027077"> </a><code>BarSecureBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027079"> </a>Show Security dialog. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027082"> </a><code>BarBeamBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027084"> </a>Beam current record. </p>
    </td>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1027087"> </a><code>BarInfoBitmap</code> </p>
    </td>
    <td><p class="tt"><a name="1027089"> </a>Show Info dialog (Launcher). </p>
    </td>
  </tr>
</table>

</div>


<p><a name="1027091"> </a>You should limit the buttons displayed on the command tool bar to 4 or 5. There are two reasons to limit the number of buttons. You must leave room for the status message to be displayed before the action is performed. Also, consider that the tool bar is displayed only briefly. Users must be able to instantly understand the meaning of each of the buttons on the tool bar. If there are too many buttons, it reduces the chance that users can find what they need. </p>

<p><a name="1027092"> </a>Note that the UI Library already potentially displays 4 buttons by itself. If you want to suppress this behavior and display your own buttons when a field has focus, set the <code>preventFieldButtons</code> flag of the <code>menuCmdBarOpenEvent</code> to <code>true</code> as is shown in <a href="UI_MenuConcept.html#1027018">Listing 4.1</a>. </p>

<h2 class="haH2">
  <a name="1007145"> </a>Dynamic Menus <a href="#1005083"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1007147"> </a>You can add, hide, or unhide menu items while the menu resource is being loaded. </p>

<p><a name="1007152"> </a>A <a href="UI_Menu.html#996648"><code>menuOpenEvent</code></a> is sent when the menu resource is loaded. In response to this event, you can call <a href="UI_Menu.html#993721"><code>MenuAddItem()</code></a> to add a menu item to one of the pull-down menus, <a href="UI_Menu.html#1014967"><code>MenuHideItem()</code></a> to hide a menu item, or <a href="UI_Menu.html#995011"><code>MenuShowItem()</code></a> to display a menu item. </p>

<p><a name="1007165"> </a>You might receive <code>menuOpenEvent</code> several times during an application session. The menu resource is loaded each time the menu is made the active menu. A menu becomes active the first time the user either requests that the menu be displayed or enters the command keystroke on the current form. That menu remains active as long as the form with which it is associated is active. A menu loses its active status under these conditions:</p>
<ul type="disc">
  <li><a name="1007170"> </a>When <a href="UI_Form.html#1003742"><code>FrmSetMenu()</code></a> is called to change the active menu on the form. 
  <li><a name="1007171"> </a>When a new form, even a modal form or alert panel, becomes active.
</ul>

<p><a name="1007172"> </a>Suppose a user selects your application's About item from the Options menu then clicks the OK button to return to the main form. When the About dialog is displayed, it becomes the active form, which causes the main form's menu state to be erased. This menu state is not restored when the main form becomes active again. The next time the user requests the menu, the menu resource is reloaded, and a new <code>menuOpenEvent</code> is queued. </p>

<p><a name="1007173"> </a>You should only make changes to a menu the first time it is loaded after a form becomes active. You should not add, hide, or show items based on user context. Such practice is discouraged in the Palm OS user interface guidelines.</p>

<h2 class="haH2">
  <a name="1027571"> </a>Summary of Menu Functions <a href="#1005083"><span class="nav">^TOP^</span></a>
</h2>



<div class="tablediv"><table cellspacing="0" class="tTable">

  <tr valign="top">
    <th><p class="tt"><a name="1010006"> </a><b>Menu Functions</b></p>
    </th>
    <th><p class="tt"><a name="1010008"> </a><b></b></p>
    </th>
  </tr>
  <tr valign="top">
    <td><p class="tt"><a name="1010013"> </a><a href="UI_Menu.html#994382"><code>MenuDispose()</code></a><br><a href="UI_Menu.html#994546"><code>MenuEraseStatus()</code></a><br><a href="UI_Menu.html#994712"><code>MenuHandleEvent()</code></a><br><a href="UI_Menu.html#994923"><code>MenuSetActiveMenu()</code></a><br><a href="UI_Menu.html#993721"><code>MenuAddItem()</code></a><br><a href="UI_Menu.html#994048"><code>MenuCmdBarDisplay()</code></a><br><a href="UI_Menu.html#1014967"><code>MenuHideItem()</code></a></p>
    </td>
    <td><p class="tt"><a name="1010038"> </a><a href="UI_Menu.html#994504"><code>MenuDrawMenu()</code></a><br><a href="UI_Menu.html#994856"><code>MenuInit()</code></a><br><a href="UI_Menu.html#994672"><code>MenuGetActiveMenu()</code></a><br><a href="UI_Menu.html#994965"><code>MenuSetActiveMenuRscID()</code></a><br><a href="UI_Menu.html#993982"><code>MenuCmdBarAddButton()</code></a><br><a href="UI_Menu.html#994088"><code>MenuCmdBarGetButtonData()</code></a><br><a href="UI_Menu.html#995011"><code>MenuShowItem()</code></a></p>
    </td>
  </tr>
</table>

</div>


<p><a name="1003252"> </a></p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 2003&#8211;2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="UI_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="UI_TOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="UI_ControlConcept.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="UI_FieldConcept.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="UI_IX.html">Index</a>
</p>
</td>
</tr>
</table>
<!-- END FOOTER -->

</body>
</html>