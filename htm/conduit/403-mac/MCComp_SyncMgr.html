<html>
<head>
<title>PalmSource | Using the Sync Manager API</title> 
<link href="palmsource_styles.css" rel="stylesheet" type="text/css">
<link href="document.css" rel="stylesheet" type="text/css">

<!-- begin meta data -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PALMSOURCETEMPLATE" CONTENT="1006-006 PalmSource HTML 20030131">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="LASTUPDATED" CONTENT="03/03/03 11:18:28">
<!-- end meta data -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="972740"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td align="middle" bgcolor="#efefe4"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r1_c1" src="images/shim.gif" width="280" height="24" border="0" alt="" id="IMG1"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td align="middle"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="33" height="75" border="0" alt=""></td>
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="11" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>
<tr>
<td><img name="index_r6_c4" src="images/shim.gif" width="96" height="10" border="0" alt=""></td>
</tr>
</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--Begin masthead-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<!--Begin breadcrumbs-->
<tr>
<td><span class="nav">&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
&nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
&nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
&nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span></td>
</tr>
<!--End breadcrumbs-->
<tr>
<td><h2 class="HeadDocPage">6 &nbsp;&nbsp;Using the Sync Manager API</h2></td>
</tr>
<tr>
<td><span class="nav">
<a href="C++SyncMacCompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MCComp_GenCn.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MCComp_EntryPoints.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="C++SyncMacCompanionIX.html">Index</a>
</span></td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--End masthead-->

</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="10"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>

<!--BEGIN MINITOC-->
<td valign="top" width="175">
<p class="SideTitle"><a href="MCComp_Front.html">C/C++ Sync Suite Companion for Macintosh</a></p>
<p class="SideTOC1-PartTab">Palm OS® Conduit Development Kit for Macintosh, Version 4.03 </p>
<p class="SideTOC1"><a href="MCComp_SyncMgr.html">6  Using the Sync Manager API</a></p>


<p class="SideTOC2">
<a href="#972754">Communications Between Handheld and Desktop
</a></p>

<p class="SideTOC2">
<a href="#972759">Using the Sync Manager
</a></p>

<p class="SideTOC3">
<a href="#972767">Registering Your Conduit With Sync Manager
</a></p>

<p class="SideTOC3">
<a href="#972770">Opening Your Database
</a></p>

<p class="SideTOC3">
<a href="#972795">Working with Databases
</a></p>

<p class="SideTOC3">
<a href="#972866">Cleaning Up Records
</a></p>

<p class="SideTOC3">
<a href="#972892">Closing Your Database
</a></p>

</td>
<!--END MINITOC-->

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif">&nbsp;</td>
<td width="5">&nbsp;&nbsp;</td>
<td valign="top">

<!--BEGIN CONTENT-->
<p class="Body">
  <a name="972746"> </a>The Sync Manager API is the programming interface to HotSync<sup>®</sup> technology operations. This interface provides the following capabilities:
</p>

  <a name="972748"> </a><p class="B1Bullet"> &#8226; communication with the handheld</p>

  <a name="972749"> </a><p class="B1Bullet"> &#8226; access to databases on the handheld</p>

  <a name="972750"> </a><p class="B1Bullet"> &#8226; access to record level operations</p>

  <a name="972751"> </a><p class="B1Bullet"> &#8226; access to record categories</p>
<p class="Body">
  <a name="972752"> </a>The Sync Manager API libraries are located in the <span style="font-family: monospace">HotSync Folder</span> directory of the CDK. PalmSource, Inc. also provides debug versions of these libraries.
</p>

<h5 class="TgTable">

</h5>

<h2 class="HaHeadA">
  <a name="972754"> </a>Communications Between Handheld and Desktop <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972756"> </a>The Sync Manager manages all communications between the handheld and the desktop computer during synchronization operations. This allows conduits to perform their operations without any consideration of how the data is moving between them. 
</p>
<p class="Body">
  <a name="972757"> </a>The Sync Manager uses the HotSync transport to perform all communications. Your conduit does not need to distinguish between the various connection transports. In fact, your code doesn't need do anything with respect to the mechanics of exchanging data between the desktop computer and the handheld.
</p>

<h2 class="HaHeadA">
  <a name="972759"> </a>Using the Sync Manager <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972760"> </a>This section describes the flow of calls from a typical conduit to the Sync Manager. These calls falls into the following categories:
</p>

  <a name="972761"> </a><p class="B1Bullet"> &#8226; registering the conduit</p>

  <a name="972762"> </a><p class="B1Bullet"> &#8226; opening a database</p>

  <a name="972763"> </a><p class="B1Bullet"> &#8226; reading and writing records</p>

  <a name="972764"> </a><p class="B1Bullet"> &#8226; working with record categories</p>

  <a name="972765"> </a><p class="B1Bullet"> &#8226; closing the database</p>

<h2 class="HBHeadB">
  <a name="972767"> </a>Registering Your Conduit With Sync Manager <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972768"> </a>You must register your conduit with the Sync Manager by calling the <span style="font-family: monospace">SyncRegisterConduit</span> function. The Sync Manager returns a handle for your conduit, which you use in subsequent calls. When your conduit is done, you unregister it by calling the <span style="font-family: monospace">SyncUnRegisterConduit</span> function. Most conduits make these calls in their <span style="font-family: monospace">OpenConduit</span> or <span style="font-family: monospace">OpenConduitCarbon</span> functions. 
</p>

<h2 class="HBHeadB">
  <a name="972770"> </a>Opening Your Database <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972771"> </a>You can use the <span style="font-family: monospace">SyncCreateDB</span> function to create a new, opened database on the handheld, or you can use the <span style="font-family: monospace">SyncOpenDB</span> function open an existing handheld database. <a href="MCComp_SyncMgr.html#972776">Listing 6.1</a> shows a section of code from the <span style="font-family: monospace">OpenConduit</span> or <span style="font-family: monospace">OpenConduitCarbon</span> function of the template conduit. This function calls both the <span style="font-family: monospace">SyncCreateDB</span> and <span style="font-family: monospace">SyncOpenDB</span> functions.
</p>
<p class="CCodeCaption">
  <a name="972776"> </a>Listing 6.1  Opening a handheld database
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
err =  ::SyncOpenDB(inSyncProperties.m_RemoteName[0], 0, dbHandle);<a name="972777"> </a>
if (err == SYNCERR_FILE_NOT_FOUND  &amp;&amp; inSyncProperties.m_SyncType != eHHtoPC)<a name="972778"> </a>
{ <a name="972779"> </a>
  err = ::SyncAddLogEntry ("Creating new Sample database on Palm Powered
handheld\n");<a name="972780"> </a>
  CDbCreateDB dbInfo                = {}; <a name="972781"> </a>
<a name="972782"> </a>
  dbInfo.m_Creator                  = inSyncProperties.m_Creator; <a name="972783"> </a>
  dbInfo.m_Flags                    = eRecord; <a name="972784"> </a>
  dbInfo.m_CardNo                   = ( (BYTE)inSyncProperties.m_CardNo); <a name="972785"> </a>
  dbInfo.m_Type                     = inSyncProperties.m_DbType; <a name="972786"> </a>
<a name="972787"> </a>
  strcat( dbInfo.m_Name, inSyncProperties.m_RemoteName[0]);<a name="972788"> </a>
<a name="972789"> </a>
  err = ::SyncCreateDB(dbInfo);<a name="972790"> </a>
  if( err == 0 )<a name="972791"> </a>
    dbHandle = dbInfo.m_FileHandle; <a name="972792"> </a>
}<a name="972793"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="972795"> </a>Working with Databases <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972796"> </a>Each database is a collection of records with the following characteristics:
</p>

  <a name="972797"> </a><p class="B1Bullet"> &#8226; Each record in a database has an ID that is unique within the database.</p>

  <a name="972798"> </a><p class="B1Bullet"> &#8226; Each record in a database has flags that specify whether it has been marked as private, deleted, modified, archived, or busy.</p>

  <a name="972799"> </a><p class="B1Bullet"> &#8226; Each record in a database belongs to a category.</p>

  <a name="972800"> </a><p class="B1Bullet"> &#8226; The database contains an application information block that stores global information about the database. This block is typically used to store the names of categories for records in the database.</p>

  <a name="972801"> </a><p class="B1Bullet"> &#8226; The database has a sort information block that stores ordering information for records in the database. This block is for use by the application; the Palm OS<sup>®</sup> does not use it.</p>

<h4 class="HCHeadC">
  <a name="972803"> </a>Reading Records From a Handheld Database
</h4>
<p class="Body">
  <a name="972804"> </a>To read records from a handheld database, you can call one of functions shown in <a href="MCComp_SyncMgr.html#972811">Table 6.1</a>. Several of these functions iterate through a database: you call the function repeatedly and it automatically retrieves the next record for you until it reaches the last record meeting the specified criteria.
</p>

<h5 class="TgTable">


<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="972811"> </a><div class="TableTitle">Table 6.1  Functions for reading records from handheld databases </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="972818"> </a><div class="CellHeading">Function</div></th>
    <th><a name="972820"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr valign="top">
    <td><a name="972822"> </a><div class="CellBody"><span style="font-family: monospace">SyncReadNextModifiedRec</span></div></td>
    <td><a name="972824"> </a><div class="CellBody">An iterator function that retrieves the next modified, archived, or deleted record from an opened record database on the handheld. Each call retrieves the next modified record until all modified records have been returned.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="972826"> </a><div class="CellBody"><span style="font-family: monospace">SyncReadNextModifiedRecInCategory</span></div></td>
    <td><a name="972828"> </a><div class="CellBody">An iterator function that retrieves modified records in a category from an open database on the handheld. Each call retrieves the next modified record from the category, until all modified records have been retrieved.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="972830"> </a><div class="CellBody"><span style="font-family: monospace">SyncReadNextRecInCategory</span></div></td>
    <td><a name="972832"> </a><div class="CellBody">An iterator function that retrieves any record in a category from an open database on the handheld, including deleted, archived, and modified records. Each call retrieves the next record from the category, until all records have been retrieved.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="972834"> </a><div class="CellBody"><span style="font-family: monospace">SyncReadRecordById</span></div></td>
    <td><a name="972836"> </a><div class="CellBody">Retrieves a record, by ID, from an open database on the handheld.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="972838"> </a><div class="CellBody"><span style="font-family: monospace">SyncReadRecordByIndex</span></div></td>
    <td><a name="972840"> </a><div class="CellBody">Retrieves a record, by index, from an open database on the handheld.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="972842"> </a><div class="CellBody"><span style="font-family: monospace">SyncReadResRecordByIndex</span></div></td>
    <td><a name="972844"> </a><div class="CellBody">Retrieves a resource record, by index, from an open resource database on the handheld.</div></td>
  </tr>
</table>




</h5>
<p class="Body">
  <a name="972849"> </a><a href="MCComp_SyncMgr.html#972852">Listing 6.2</a> shows a section of code from the template conduit that iterates through the records in the database that have been modified.
</p>
<p class="CCodeCaption">
  <a name="972852"> </a>Listing 6.2  Reading modified records from a database
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
CRawRecordInfo rawRecordInfo = {};<a name="972853"> </a>
<a name="972854"> </a>
err = SYNCERR_NONE;<a name="972855"> </a>
while(err == SYNCERR_NONE)<a name="972856"> </a>
{<a name="972857"> </a>
  err = ::SyncReadNextModifiedRec(rawRecordInfo);<a name="972858"> </a>
  printf("SyncReadNextModifiedRec err == %d\n", err);<a name="972859"> </a>
  // **** work with this record<a name="972860"> </a>
}<a name="972861"> </a>
</pre><div class="CodeRule"><hr></div>

<h4 class="HCHeadC">
  <a name="972863"> </a>Writing Records To a Handheld Database
</h4>
<p class="Body">
  <a name="972864"> </a>You can use the <span style="font-family: monospace">SyncWriteRec</span> to write a record to a handheld record database, and you can use the <span style="font-family: monospace">SyncWriteResourceRec</span> to write a resource to a handheld resource database. 
</p>

<h2 class="HBHeadB">
  <a name="972866"> </a>Cleaning Up Records <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972870"> </a>You can use the functions shown in <a href="MCComp_SyncMgr.html#972874">Table 6.2</a> at the end of your synchronization operations to remove all of the deleted records in your handheld database, and to clear the record status flags. 
</p>

<h5 class="TgTable">


<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="972874"> </a><div class="TableTitle">Table 6.2  Record clean-up functions</div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="972878"> </a><div class="CellHeading">Function</div></th>
    <th><a name="972880"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr valign="top">
    <td><a name="972882"> </a><div class="CellBody"><span style="font-family: monospace">SyncPurgeDeletedRecs</span></div></td>
    <td><a name="972884"> </a><div class="CellBody">Deletes all of the records that are marked as deleted or archived from an open record database on the handheld</div></td>
  </tr>
  <tr valign="top">
    <td><a name="972886"> </a><div class="CellBody"><span style="font-family: monospace">SyncResetSyncFlags</span></div></td>
    <td><a name="972888"> </a><div class="CellBody">Resets the modified flag of all records in the opened record database on the handheld. Resets the backup date for an opened record or resource database.</div></td>
  </tr>
</table>




</h5>

<h2 class="HBHeadB">
  <a name="972892"> </a>Closing Your Database <a href="#972740"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="972893"> </a>After you have finished with a handheld database, you must call the <span style="font-family: monospace">SyncCloseDB</span> function or <span style="font-family: monospace">SyncCloseDBEx</span> function to close it. The Sync Manager allows only one database to be open at any time. 
</p>
<div class="NINoteImportant"><hr>
  <a name="972894"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">IMPORTANT:  </span> If you open a database, you must close it before exiting your conduit; otherwise, other conduits will not be able to open their databases. 
<hr>
</div>
&nbsp;<br>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="15" rowspan="2"><img name="index_x" src="images/shim.gif" width="15" height="33" border="0" alt=""></td>
<td align="middle"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p>&nbsp;</p>
<p class="footer">
Copyright © 1996 - 2002, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="MCComp_Front.html" target="_blank">Legal</a></p>
<p>&nbsp;</p>
</td>
</tr>
<!-- END FOOTER -->

</body>
</html>