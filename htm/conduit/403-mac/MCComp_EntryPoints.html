<html>
<head>
<title>PalmSource | Interfacing with the HotSync Manager Application</title> 
<link href="palmsource_styles.css" rel="stylesheet" type="text/css">
<link href="document.css" rel="stylesheet" type="text/css">

<!-- begin meta data -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="PALMSOURCETEMPLATE" CONTENT="1006-006 PalmSource HTML 20030131">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="LASTUPDATED" CONTENT="03/03/03 14:27:49">
<!-- end meta data -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="973649"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td align="middle" bgcolor="#efefe4"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r1_c1" src="images/shim.gif" width="280" height="24" border="0" alt="" id="IMG1"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td align="middle"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="33" height="75" border="0" alt=""></td>
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="11" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>
<tr>
<td><img name="index_r6_c4" src="images/shim.gif" width="96" height="10" border="0" alt=""></td>
</tr>
</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--Begin masthead-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<!--Begin breadcrumbs-->
<tr>
<td><span class="nav">&lt;&nbsp;<A HREF="http://www.palmos.com/index.html">Home</a> 
&nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/">Developers</a> 
&nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/">Development Support</a>
&nbsp;&nbsp;&lt;&nbsp;<A HREF="http://www.palmos.com/dev/support/docs/">Documentation</a></span></td>
</tr>
<!--End breadcrumbs-->
<tr>
<td><h2 class="HeadDocPage">7 &nbsp;&nbsp;Interfacing with the HotSync Manager Application</h2></td>
</tr>
<tr>
<td><span class="nav">
<a href="C++SyncMacCompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="MCComp_SyncMgr.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="CComp_Expansion.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="C++SyncMacCompanionIX.html">Index</a>
</span></td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--End masthead-->

</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="10"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>

<!--BEGIN MINITOC-->
<td valign="top" width="175">
<p class="SideTitle"><a href="MCComp_Front.html">C/C++ Sync Suite Companion for Macintosh</a></p>
<p class="SideTOC1-PartTab">Palm OS® Conduit Development Kit for Macintosh, Version 4.03 </p>
<p class="SideTOC1"><a href="MCComp_EntryPoints.html">7  Interfacing with the HotSync Manager Application</a></p>


<p class="SideTOC2">
<a href="#973660">The Conduit Entry Points
</a></p>

<p class="SideTOC3">
<a href="#973726">ConfigureConduit
</a></p>

<p class="SideTOC3">
<a href="#973746">GetActionString
</a></p>

<p class="SideTOC3">
<a href="#975881">CopyActionStringAsCFStringRef
</a></p>

<p class="SideTOC3">
<a href="#973791">GetConduitName
</a></p>

<p class="SideTOC3">
<a href="#976572">CopyConduitNameAsCFStringRef
</a></p>

<p class="SideTOC3">
<a href="#973840">GetConduitVersion
</a></p>

<p class="SideTOC3">
<a href="#977654">OpenConduit
</a></p>

<p class="SideTOC3">
<a href="#976785">OpenConduitCarbon
</a></p>

<p class="SideTOC2">
<a href="#973973">Logging Entries in the HotSync Log
</a></p>

</td>
<!--END MINITOC-->

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif">&nbsp;</td>
<td width="5">&nbsp;&nbsp;</td>
<td valign="top">

<!--BEGIN CONTENT-->
<p class="Body">
  <a name="973655"> </a>This chapter describes how conduits interface with the HotSync<sup>®</sup> Manager application. There are two areas of interaction between a conduit and the HotSync Manager application:
</p>

  <a name="973656"> </a><p class="B1Bullet"> &#8226; The conduit entry points are functions that your conduit provides for the HotSync Manager application to call during synchronization operations.</p>

  <a name="973657"> </a><p class="B1Bullet"> &#8226; Your conduit can call the HotSync log functions to add entries to the log that the user can view after synchronization operations are complete.</p>
<p class="Body">
  <a name="973658"> </a>The remainder of this chapter describes how to interface with the HotSync Manager application in these ways.
</p>

<h2 class="HaHeadA">
  <a name="973660"> </a>The Conduit Entry Points <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="973664"> </a><a href="MCComp_EntryPoints.html#977716">Table 7.1</a> shows a summary of the entry point functions. The remainder of this section provides a brief description of each function. For more information about these functions, see <a href="MCRef_CnAPI.html#985109">Chapter 1, "Conduit API,"</a> in the <i>C/C++ Sync Suite Reference for Macintosh</i>.
</p>
<div class="NINoteImportant"><hr>
  <a name="977711"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> The source for the sample conduits provided by PalmSource, Inc. includes functions <span style="font-family: monospace">ConduitInit</span> and <span style="font-family: monospace">ConduitExit</span>. These functions are an implementation detail; they are called when the conduit is loaded and unloaded by the operating system to perform low-level setup and teardown of the conduit library. You shouldn't need to change either of these functions.
<hr>
</div>

<h5 class="TgTable">


<table border="1" cellpadding="5" cellspacing="0">
  <caption><a name="977716"> </a><div class="TableTitle">Table 7.1  Conduit entry points called by the HotSync Manager application </div></caption>
  <tr bgcolor="#CCCCCC" valign="top">
    <th><a name="977723"> </a><div class="CellHeading">Function name</div></th>
    <th><a name="977725"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr valign="top">
    <td><a name="977730"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#973726"><span style="font-family: monospace">ConfigureConduit</span></a></div></td>
    <td><a name="977732"> </a><div class="CellBody">Presents a dialog that allows the user to configure the conduit.</div><a name="977733"> </a><div class="CellBody"><br></div><a name="977734"> </a><div class="CellBody">If your conduit does not provide a user interface, you can provide an empty version of this function.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="977739"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#973746"><span style="font-family: monospace">GetActionString</span></a></div></td>
    <td><a name="977741"> </a><div class="CellBody">Returns a string that the HotSync Manager application displays in the "Next HotSync action" window. <i>Note:</i> This function should be provided only for non-bundled conduits.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="977746"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#975881"><span style="font-family: monospace">CopyActionStringAsCFStringRef</span></a></div></td>
    <td><a name="977748"> </a><div class="CellBody">Returns a string, as a <span style="font-family: monospace">CFString</span> reference, that the HotSync Manager application displays in the "Next HotSync action" window. <i>Note:</i> This function should only be provided for bundled conduits.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="977753"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#973791"><span style="font-family: monospace">GetConduitName</span></a></div></td>
    <td><a name="977755"> </a><div class="CellBody">Returns the conduit's name for display purposes. <i>Note:</i> This function should be provided only for non-bundled conduits.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="977760"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#976572"><span style="font-family: monospace">CopyConduitNameAsCFStringRef</span></a></div></td>
    <td><a name="977762"> </a><div class="CellBody">Returns the conduit's name, as a <span style="font-family: monospace">CFString</span> reference, for display purposes. <i>Note:</i> This function should only be provided for bundled conduits.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="977767"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#973840"><span style="font-family: monospace">GetConduitVersion</span></a></div></td>
    <td><a name="977769"> </a><div class="CellBody">Returns the conduit's version number.</div><a name="977770"> </a><div class="CellBody"><br></div><a name="977771"> </a><div class="CellBody">The supported range for conduit versions is <span style="font-family: monospace">0x00000101</span> to <span style="font-family: monospace">0x00000300</span></div></td>
  </tr>
  <tr valign="top">
    <td><a name="977776"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#977654"><span style="font-family: monospace">OpenConduit</span></a></div></td>
    <td><a name="977778"> </a><div class="CellBody">The main conduit entry point. <i>Note:</i> This function should be provided only for non-bundled conduits.</div></td>
  </tr>
  <tr valign="top">
    <td><a name="977783"> </a><div class="CellBody"><a href="MCComp_EntryPoints.html#976785"><span style="font-family: monospace">OpenConduitCarbon</span></a></div></td>
    <td><a name="977785"> </a><div class="CellBody">The main conduit entry point. <i>Note:</i> This function should only be provided for bundled conduits.</div></td>
  </tr>
</table>




</h5>
<div class="NINoteImportant"><hr>
  <a name="977816"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> The source for the sample conduits provided by PalmSource, Inc. includes functions <span style="font-family: monospace">ConduitInit</span> and <span style="font-family: monospace">ConduitExit</span>. These functions are an implementation detail; they are called when the conduit is loaded and unloaded by the operating system to perform low-level setup and teardown of the conduit library. You shouldn't need to change either of these functions.
<hr>
</div>

<h2 class="HBHeadB">
  <a name="973726"> </a>ConfigureConduit <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="973727"> </a>The HotSync Manager application calls the <span style="font-family: monospace">ConfigureConduit</span> function when the user decides to customize your conduit with the following steps:
</p>

  <a name="973728"> </a><p class="B1Bullet"> &#8226; chooses <b>Conduit Settings </b>from the HotSync Manager application menu</p>

  <a name="973729"> </a><p class="B1Bullet"> &#8226; selects your conduit and clicks <b>Conduit Settings </b>in the HotSync Manager application's Conduit Settings dialog box</p>
<p class="Body">
  <a name="973730"> </a>When the HotSync Manager application calls this function, your conduit responds by displaying a modal configuration dialog box. This dialog box allows the user to specify what actions your conduit is to perform. <a href="MCComp_EntryPoints.html#973735">Figure 7.1</a> shows the configuration dialog box displayed by the To Do conduit that is provided by PalmSource.
</p>

<p class="FFigureCaption">
  <a name="973735"> </a>Figure 7.1	 The settings dialog box for the To Do conduit
</p>
<p class="FgFigure">
<div align="left"><img src="images/customizetodo.gif" border="0" hspace="20" vspace="0">
</div>
</p>
<p class="Body">
  <a name="973743"> </a><a href="MCComp_EntryPoints.html#973735">Figure 7.1</a> shows a typical configuration dialog box for a mirror-image synchronization. Your conduit might allow additional configuration options. 
</p>

<h2 class="HBHeadB">
  <a name="973746"> </a>GetActionString <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="973747"> </a>The HotSync Manager application calls the <span style="font-family: monospace">GetActionString</span> function to retrieve the string to display to the user in the "Next HotSync action" window. If your conduit does not use any settings, you can return a simple string such as "Normal" or "Synchronize."
</p>
<div class="NINoteImportant"><hr>
  <a name="975863"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> <span style="font-family: monospace">GetActionString</span> should only be implemented if your conduit isn't bundled. If your conduit is bundled, implement <span style="font-family: monospace">CopyActionStringAsCFStringRef</span> instead.
<hr>
</div>
<p class="Body">
  <a name="973751"> </a><a href="MCComp_EntryPoints.html#973754">Listing 7.1</a> shows the implementation of the <span style="font-family: monospace">GetActionString</span> function from the template conduit. This function uses the <span style="font-family: monospace">GetConduitCurrentSetting</span> function, which is one of many useful functions in the <span style="font-family: monospace">UConduitUtils</span> class; the code for this class is found in the <span style="font-family: monospace">Shared</span> folder inside of the <span style="font-family: monospace">Conduits</span> source code folder of the CDK.
</p>
<p class="CCodeCaption">
  <a name="973754"> </a>Listing 7.1  An example of the GetActionString function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
long GetActionString(CSyncPreference&amp; inSyncPrefs, char* ioActionString, <a name="973755"> </a>
                     WORD inStrLen)<a name="973756"> </a>
{<a name="973757"> </a>
  short currentSetting;<a name="973758"> </a>
  Str255 action;<a name="973759"> </a>
  short saveRsrcRefNum = ::CurResFile();<a name="973760"> </a>
  <a name="973761"> </a>
  Try_<a name="973762"> </a>
  {<a name="973763"> </a>
    currentSetting = UConduitUtils::GetConduitCurrentSetting <a name="973764"> </a>
                     (gRsrcFileRefNum,inSyncPrefs.u.m_UserDirFSSpec);<a name="973765"> </a>
  }<a name="973766"> </a>
  Catch_(error)<a name="973767"> </a>
  {<a name="973768"> </a>
    action[0] = 0;         // Return empty string if anything goes wrong.<a name="973769"> </a>
    return error;<a name="973770"> </a>
  }<a name="973771"> </a>
<a name="973772"> </a>
  ::UseResFile(gRsrcFileRefNum);<a name="973773"> </a>
<a name="973774"> </a>
  if(currentSetting == 2)<a name="973775"> </a>
    ::GetIndString(action, kActionStringResID, kDoNothingString);<a name="973776"> </a>
  else<a name="973777"> </a>
    ::GetIndString(action, kActionStringResID, kDoSomethingString);<a name="973778"> </a>
<a name="973779"> </a>
  if(action[0] &gt; inStrLen) action[0] = inStrLen;<a name="973780"> </a>
  // copy action to output as a C string<a name="973781"> </a>
  ::memcpy(ioActionString,&amp;(action[1]),action[0]); <a name="973782"> </a>
  ioActionString[action[0]] = 0;<a name="973783"> </a>
<a name="973784"> </a>
  ::UseResFile(saveRsrcRefNum);<a name="973785"> </a>
  <a name="973786"> </a>
  return 0;<a name="973787"> </a>
}<a name="973788"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="975881"> </a>CopyActionStringAsCFStringRef <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="975882"> </a>The HotSync Manager application calls the <span style="font-family: monospace">CopyActionStringAsCFStringRef</span> function to retrieve the string to display to the user in the "Next HotSync action" window. If your conduit does not use any settings, you can return a simple string such as "Normal" or "Synchronize."
</p>
<div class="NINoteImportant"><hr>
  <a name="975883"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> <span style="font-family: monospace">CopyActionStringAsCFStringRef</span> should only be implemented if your conduit is bundled. If your conduit isn't bundled, implement <span style="font-family: monospace">GetActionString</span> instead.
<hr>
</div>
<p class="Body">
  <a name="975887"> </a><a href="MCComp_EntryPoints.html#975890">Listing 7.2</a> shows the implementation of the <span style="font-family: monospace">CopyActionStringAsCFStringRef</span> function from the Install conduit. This function uses the <span style="font-family: monospace">GetConduitCurrentSetting</span> function, which is one of many useful functions in the <span style="font-family: monospace">UConduitUtils</span> class; the code for this class is found in the <span style="font-family: monospace">Shared</span> folder inside of the <span style="font-family: monospace">Conduits</span> source code folder of the CDK.
</p>
<p class="CCodeCaption">
  <a name="975890"> </a>Listing 7.2  An example of the CopyActionStringAsCFStringRef<br>function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
long CopyActionStringAsCFStringRef(CSyncPreference&amp;<a name="975969"> </a>
                  inSyncPrefs, CFStringRef* oActionString)<a name="976135"> </a>
{<a name="975970"> </a>
  #pragma unused( inSyncPrefs )<a name="975971"> </a>
  long	err = noErr;<a name="975972"> </a>
  SInt16	currentSetting;<a name="975973"> </a>
<a name="975974"> </a>
  require_action( oActionString != NULL,
    CopyActionStringAsCFStringRef_ParamErr, err = paramErr );<a name="975975"> </a>
  *oActionString = NULL;<a name="975976"> </a>
<a name="975977"> </a>
  try<a name="975978"> </a>
  {<a name="975979"> </a>
    currentSetting =<a name="975980"> </a>
        UConduitUtils::GetConduitCurrentSetting(<a name="976168"> </a>
                kInstallConduitCreator);<a name="976185"> </a>
  }<a name="975981"> </a>
  catch (LException err)<a name="975982"> </a>
  {<a name="975983"> </a>
    ::SysBeep(34);<a name="975984"> </a>
    return err.GetErrorCode();<a name="975985"> </a>
  }<a name="975986"> </a>
<a name="975987"> </a>
  if(currentSetting == eDoNothing)<a name="975988"> </a>
    *oActionString = CFCopyLocalizedStringFromTableInBundle(<a name="975989"> </a>
            CFSTR("Do Nothing"), <a name="976270"> </a>
            CFSTR("Localizable"),<a name="975990"> </a>
            gBundleRef,<a name="975991"> </a>
            CFSTR("Conduit Action") );<a name="975992"> </a>
  else<a name="975993"> </a>
    *oActionString = CFCopyLocalizedStringFromTableInBundle(<a name="976404"> </a>
            CFSTR("Install Files"), <a name="976408"> </a>
            CFSTR("Localizable"),<a name="976405"> </a>
            gBundleRef,<a name="975996"> </a>
            CFSTR("Conduit Action") );<a name="975997"> </a>
<a name="975998"> </a>
  CopyActionStringAsCFStringRef_ParamErr:<a name="975999"> </a>
<a name="976000"> </a>
  return err;<a name="976001"> </a>
}<a name="976002"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="973791"> </a>GetConduitName <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="973792"> </a>The HotSync Manager application calls the <span style="font-family: monospace">GetConduitName</span> function to retrieve the name of your conduit. Your implementation must fill in the name buffer with your conduit's name, and must return a status value that indicates whether the operation was successful.
</p>
<div class="NINoteImportant"><hr>
  <a name="976546"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> You should only implement the <span style="font-family: monospace">GetConduitName</span> function if your conduit isn't bundled. Bundled conduits should implement the <span style="font-family: monospace">CopyConduitNameAsCFStringRef</span> function instead.
<hr>
</div>
<p class="Body">
  <a name="973793"> </a>For example, the template conduit's version of <span style="font-family: monospace">GetConduitName</span> function, which is shown in <a href="MCComp_EntryPoints.html#973802">Listing 7.3</a> is typical. This function extracts the conduit's name from its <span style="font-family: monospace">'CInf'</span> resource and returns <span style="font-family: monospace">0</span> to indicate success.
</p>
<p class="Body">
  <a name="973797"> </a>The template conduit version of <span style="font-family: monospace">GetConduitName</span> uses a utility function named <span style="font-family: monospace">ExtractUserVisibleConduitName</span>, which is also shown in <a href="MCComp_EntryPoints.html#973802">Listing 7.3</a>, to retrieve the user name from resource. 
</p>
<p class="CCodeCaption">
  <a name="973802"> </a>Listing 7.3  An example of the GetConduitName function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
long GetConduitName(char* ioConduitName, WORD inStrLen)<a name="973803"> </a>
{<a name="973804"> </a>
  Str255        conduitName = "\p";<a name="973805"> </a>
  short         saveResFile = ::CurResFile();<a name="973806"> </a>
  ::UseResFile(gRsrcFileRefNum);<a name="973807"> </a>
<a name="973808"> </a>
  Handle cinfHandle = ::Get1Resource('CInf', 0);<a name="973809"> </a>
  ExtractUserVisibleConduitName(cinfHandle,  conduitName);<a name="973810"> </a>
  <a name="973811"> </a>
  ::memcpy(ioConduitName, &amp;conduitName[1], conduitName[0]);<a name="973812"> </a>
  ioConduitName[conduitName[0]] = 0;<a name="973813"> </a>
<a name="973814"> </a>
  ::UseResFile(saveResFile);<a name="973815"> </a>
  <a name="973816"> </a>
  return 0;<a name="973817"> </a>
}<a name="973818"> </a>
<a name="973819"> </a>
<a name="973820"> </a>
<a name="973821"> </a>
void ExtractUserVisibleConduitName(Handle inCinfResource, <a name="973822"> </a>
                                   StringPtr outConduitName)<a name="973823"> </a>
{<a name="973824"> </a>
  SInt8 saveState = ::HGetState(inCinfResource);<a name="973825"> </a>
  ::HLock(inCinfResource);<a name="973826"> </a>
  <a name="973827"> </a>
  StringPtr conduitName = (StringPtr)((*inCinfResource) + <a name="973828"> </a>
                           sizeof(short) +  //conduitType<a name="973829"> </a>
                           sizeof(long) +   //conduit version<a name="973830"> </a>
                           sizeof(long));   //conduit creator<a name="973831"> </a>
                           //next byte is beginning of conduit name<a name="973832"> </a>
<a name="973833"> </a>
  ::memcpy(outConduitName, conduitName, conduitName[0]+1);<a name="973834"> </a>
<a name="973835"> </a>
  ::HSetState(inCinfResource, saveState);<a name="973836"> </a>
}<a name="973837"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="976572"> </a>CopyConduitNameAsCFStringRef <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="976573"> </a>The HotSync Manager application calls the <span style="font-family: monospace">CopyConduitNameAsCFStringRef</span> function to retrieve the name of your conduit. Your implementation must fill in the name buffer with your conduit's name, and must return a status value that indicates whether the operation was successful.
</p>
<div class="NINoteImportant"><hr>
  <a name="976574"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> You should only implement the <span style="font-family: monospace">CopyConduitNameAsCFStringRef</span> function if your conduit is bundled. Non-bundled conduits should implement the <span style="font-family: monospace">GetConduitName</span> function instead.
<hr>
</div>
<p class="Body">
  <a name="976575"> </a>For example, the Install conduit's version of <span style="font-family: monospace">CopyConduitNameAsCFStringRef</span> function, which is shown in <a href="MCComp_EntryPoints.html#976584">Listing 7.4</a> is typical. This function extracts the conduit's name from its <span style="font-family: monospace">'CInf'</span> resource and returns <span style="font-family: monospace">0</span> to indicate success.
</p>
<p class="Body">
  <a name="976579"> </a>The Install conduit version of <span style="font-family: monospace">CopyConduitNameAsCFStringRef</span> uses a utility function in the <span style="font-family: monospace">UConduitUtils</span> class named <span style="font-family: monospace">ExtractUserVisibleConduitName</span>, which is also shown in <a href="MCComp_EntryPoints.html#976584">Listing 7.4</a>, to retrieve the user name from resource. 
</p>
<p class="CCodeCaption">
  <a name="976584"> </a>Listing 7.4  An example of the CopyConduitNameAsCFStringRef function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
long CopyConduitNameAsCFStringRef( CFStringRef* oConduitName )<a name="976690"> </a>
{<a name="976691"> </a>
  long err = noErr;<a name="976692"> </a>
<a name="976693"> </a>
  StCurResChain	saveRes( gNonLocalizedRsrcFileRefNum, gLocalizedRsrcFileRefNum<a name="976745"> </a>
);<a name="978731"> </a>
<a name="976694"> </a>
  require_action( oConduitName != NULL, CopyConduitNameAsCFStringRef_ParamErr,<a name="976695"> </a>
err = paramErr );<a name="978732"> </a>
<a name="976696"> </a>
  Handle cinfHandle = ::GetResource('CInf', 0);<a name="976697"> </a>
  UConduitUtils::ExtractUserVisibleConduitName(cinfHandle, oConduitName);<a name="976698"> </a>
<a name="976699"> </a>
  CopyConduitNameAsCFStringRef_ParamErr:<a name="976700"> </a>
<a name="976701"> </a>
  return err;<a name="976702"> </a>
}<a name="976703"> </a>
<a name="976601"> </a>
<a name="976602"> </a>
<a name="976603"> </a>
void UConduitUtils::ExtractUserVisibleConduitName(Handle inCinfResource, <a name="976604"> </a>
                                   StringPtr outConduitName)<a name="976605"> </a>
{<a name="976606"> </a>
  SInt8 saveState = ::HGetState(inCinfResource);<a name="976607"> </a>
  ::HLock(inCinfResource);<a name="976608"> </a>
  <a name="976609"> </a>
  StringPtr conduitName = (StringPtr)((*inCinfResource) + <a name="976610"> </a>
                           sizeof(short) +  //conduitType<a name="976611"> </a>
                           sizeof(long) +   //conduit version<a name="976612"> </a>
                           sizeof(long));   //conduit creator<a name="976613"> </a>
                           //next byte is beginning of conduit name<a name="976614"> </a>
<a name="976615"> </a>
  ::memcpy(outConduitName, conduitName, conduitName[0]+1);<a name="976616"> </a>
<a name="976617"> </a>
  ::HSetState(inCinfResource, saveState);<a name="976618"> </a>
}<a name="976619"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="973840"> </a>GetConduitVersion <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="973841"> </a>The HotSync Manager application calls the <span style="font-family: monospace">GetConduitVersion</span> function to retrieve the version of your conduit that is running on the desktop computer. Your implementation must pack your major version number into the high byte of the low word in the result, and must pack your minor version number into the low byte of the low word in the result.
</p>
<p class="Body">
  <a name="973842"> </a>For example, the template conduit's version of the <span style="font-family: monospace">GetConduitVersion</span> function, which is shown in <a href="MCComp_EntryPoints.html#973847">Listing 7.5</a> is typical. This function simply returns a constant value that specifies the version number.
</p>
<p class="CCodeCaption">
  <a name="973847"> </a>Listing 7.5  An example of the GetConduitVersion function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
#define TEMPLATE_CONDUIT_VERSION  0x00000300 <a name="973848"> </a>
// Must be 0x00000300 or higher to work with Palm Desktop 4.0<a name="973849"> </a>
or later<a name="978733"> </a>
<a name="973851"> </a>
DWORD GetConduitVersion()<a name="973852"> </a>
{<a name="973853"> </a>
  return TEMPLATE_CONDUIT_VERSION;<a name="973854"> </a>
}<a name="973855"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="977654"> </a>OpenConduit <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="977655"> </a>The HotSync Manager application calls the <span style="font-family: monospace">OpenConduit</span> function when your conduit is loaded to begin the process of synchronizing data between the desktop computer and the handheld. Your implementation of this function needs to perform operations such as the following:
</p>

  <a name="973860"> </a><p class="B1Bullet"> &#8226; register your conduit with the Sync Manager</p>

  <a name="973861"> </a><p class="B1Bullet"> &#8226; perform synchronization operations, either by instantiating a <span style="font-family: monospace">CSynchronizer</span> object, or by calling Sync Manager API functions</p>

  <a name="973862"> </a><p class="B1Bullet"> &#8226; unregister your conduit</p>
<div class="NINoteImportant"><hr>
  <a name="976866"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> You should only implement the <span style="font-family: monospace">OpenConduit</span> function if your conduit is non-bundled. Bundled conduits should implement the <span style="font-family: monospace">OpenConduitCarbon</span> function instead.
<hr>
</div>
<p class="Body">
  <a name="976774"> </a><a href="MCComp_EntryPoints.html#976776">Listing 7.6</a> shows the implementation of the <span style="font-family: monospace">OpenConduit</span> function from the template conduit.
</p>
<p class="CCodeCaption">
  <a name="976776"> </a>Listing 7.6  An example of the OpenConduit function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
long OpenConduit(PROGRESSFN inProgressCallBack, <a name="976777"> </a>
                 CSyncProperties&amp; inSyncProperties)<a name="973927"> </a>
{<a name="973928"> </a>
  long err = 0;<a name="973929"> </a>
  <a name="973930"> </a>
  CONDHANDLE conduitHandle = 0;<a name="973931"> </a>
  Byte dbHandle = 0;<a name="973932"> </a>
  WORD recCount = 0;<a name="973933"> </a>
  CRawRecordInfo rawRecordInfo = {};<a name="973934"> </a>
  <a name="973935"> </a>
  gProgressCallBack = inProgressCallBack;<a name="973936"> </a>
  <a name="973937"> </a>
  err =  ::SyncRegisterConduit(conduitHandle);<a name="973938"> </a>
<a name="973939"> </a>
  err =  ::SyncOpenDB(inSyncProperties.m_RemoteName[0], 0, dbHandle);<a name="973940"> </a>
<a name="973941"> </a>
  if (err == SYNCERR_FILE_NOT_FOUND  &amp;&amp; inSyncProperties.m_SyncType != eHHtoPC)<a name="973942"> </a>
    { <a name="973943"> </a>
    err = ::SyncAddLogEntry("Creating new Sample database on handheld\n");<a name="973944"> </a>
    CDbCreateDB dbInfo = {}; <a name="973945"> </a>
    dbInfo.m_Creator = inSyncProperties.m_Creator; <a name="973946"> </a>
    dbInfo.m_Flags = eRecord; <a name="973947"> </a>
    dbInfo.m_CardNo = ( (BYTE)inSyncProperties.m_CardNo); <a name="973948"> </a>
    dbInfo.m_Type = inSyncProperties.m_DbType; <a name="973949"> </a>
    strcat( dbInfo.m_Name, inSyncProperties.m_RemoteName[0]);<a name="973950"> </a>
<a name="973951"> </a>
    err = ::SyncCreateDB(dbInfo);<a name="973952"> </a>
    if( err == 0 )<a name="973953"> </a>
      dbHandle = dbInfo.m_FileHandle; <a name="973954"> </a>
  }<a name="973955"> </a>
<a name="973956"> </a>
  err = ::SyncGetDBRecordCount( dbHandle, recCount );<a name="973957"> </a>
  err = SYNCERR_NONE;<a name="973958"> </a>
  while(err == SYNCERR_NONE)<a name="973959"> </a>
    {<a name="973960"> </a>
    err = ::SyncReadNextModifiedRec(rawRecordInfo);<a name="973961"> </a>
    // -- perform the work of your conduit here --<a name="973962"> </a>
    }<a name="973963"> </a>
  <a name="973964"> </a>
    err = ::SyncCloseDB(dbHandle);<a name="973965"> </a>
    err = ::SyncResetSyncFlags(dbHandle);<a name="973966"> </a>
    err = ::SyncUnRegisterConduit(conduitHandle);<a name="973967"> </a>
<a name="973968"> </a>
  return err;<a name="973969"> </a>
}<a name="973970"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HBHeadB">
  <a name="976785"> </a>OpenConduitCarbon <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="976786"> </a>The HotSync Manager application calls the <span style="font-family: monospace">OpenConduitCarbon</span> function of a bundled conduit to begin the process of synchronizing data between the desktop computer and the handheld. Your implementation of this function needs to perform operations such as the following:
</p>

  <a name="976787"> </a><p class="B1Bullet"> &#8226; register your conduit with the Sync Manager</p>

  <a name="976788"> </a><p class="B1Bullet"> &#8226; perform synchronization operations, either by instantiating a <span style="font-family: monospace">CSynchronizer</span> object, or by calling Sync Manager API functions</p>

  <a name="976789"> </a><p class="B1Bullet"> &#8226; unregister your conduit</p>
<div class="NINoteImportant"><hr>
  <a name="978638"> </a> <span style="color: #333;  font-style: normal; font-weight: bold; text-decoration: none; text-transform: none; vertical-align: baseline">NOTE:  </span> You should only implement the <span style="font-family: monospace">OpenConduitCarbon</span> function if your conduit is bundled. Non-bundled conduits should implement the <span style="font-family: monospace">OpenConduit</span> function instead.
<hr>
</div>
<p class="Body">
  <a name="978643"> </a><a href="MCComp_EntryPoints.html#976796">Listing 7.7</a> shows the implementation of the <span style="font-family: monospace">OpenConduitCarbon </span>function from the template conduit.
</p>
<p class="CCodeCaption">
  <a name="976796"> </a>Listing 7.7  An example of the OpenConduitCarbon function
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
long OpenConduitCarbon(PROGRESSFNCARBON inProgressCallBack,<a name="976890"> </a>
                 CSyncProperties&amp; inSyncProperties)<a name="976935"> </a>
{<a name="976891"> </a>
  long retval = 0;<a name="976892"> </a>
  <a name="976893"> </a>
  try<a name="976894"> </a>
  {<a name="976895"> </a>
    if (inProgressCallBack)<a name="976896"> </a>
    {<a name="976897"> </a>
      CInstallConduit installConduit(gBundleRef, gNonLocalizedRsrcFileRefNum,<a name="976898"> </a>
                  gLocalizedRsrcFileRefNum, inProgressCallBack,<a name="976940"> </a>
                  inSyncProperties);<a name="976946"> </a>
<a name="976900"> </a>
      retval = installConduit.EngageInstall();<a name="976901"> </a>
    }<a name="976902"> </a>
  }<a name="976903"> </a>
  catch (LException err)<a name="976904"> </a>
  {<a name="976905"> </a>
    retval = err.GetErrorCode();<a name="976906"> </a>
  }<a name="976907"> </a>
  catch(...)<a name="976908"> </a>
  {<a name="976909"> </a>
    retval = SYNCERR_UNKNOWN;<a name="976910"> </a>
  }<a name="976911"> </a>
<a name="976912"> </a>
  return retval;<a name="976913"> </a>
}<a name="976914"> </a>
</pre><div class="CodeRule"><hr></div>

<h2 class="HaHeadA">
  <a name="973973"> </a>Logging Entries in the HotSync Log <a href="#973649"><span class="nav">^TOP^</span></a>
</h2>

<p class="Body">
  <a name="973974"> </a>During synchronization operations, the HotSync Manager application and any conduits that it runs can add messages to the HotSync log. If any unusual messages are added to the log during the synchronization, the HotSync Manager application notifies the user, who can then review the log.
</p>
<p class="Body">
  <a name="973975"> </a>Conduits can also use add messages to the HotSync log for debugging purposes, as described in <a href="MCComp_Debugging.html#979588">Chapter 10, "Debugging Conduits."</a>
</p>
<p class="Body">
  <a name="973980"> </a>The Sync Manager API provides the <span style="font-family: monospace">LogAddEntry</span> function, the declaration of which is shown here, for logging messages. 
</p>
<pre  class="Preformatted">
long LogAddEntry(LPCTSTR pszEntry,<a name="973981"> </a>
                 Activity act,<a name="973982"> </a>
                 BOOL bTimeStamp);<a name="973983"> </a>
</pre>
<p class="Body">
  <a name="973984"> </a>This function can optionally time stamp each message and associate it with an activity type. Here is a typical call to the <span style="font-family: monospace">AddLogEntry</span> function:
</p>
<div class="CodeRule"><hr></div><pre class="CodeBlock">
err = ::AddLogEntry ("Creating new database on handheld.\n");<a name="973985"> </a>
</pre><div class="CodeRule"><hr></div>
<p class="Body">
  <a name="973988"> </a>For more information about the logging functions, see <a href="MCRef_HotSyncLog.html#1006604">Chapter 3, "HotSync Log API,"</a> of <i>C/C++ Sync Suite Reference for Macintosh</i>. 
</p>
&nbsp;<br>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="15" rowspan="2"><img name="index_x" src="images/shim.gif" width="15" height="33" border="0" alt=""></td>
<td align="middle"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p>&nbsp;</p>
<p class="footer">
Copyright © 1996 - 2002, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="MCComp_Front.html" target="_blank">Legal</a></p>
<p>&nbsp;</p>
</td>
</tr>
<!-- END FOOTER -->

</body>
</html>