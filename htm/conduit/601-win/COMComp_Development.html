<html>
<head>
<title>Building a Conduit | COM Sync Suite Companion</title> 
<link href="psi_devpubs.css" rel="stylesheet" type="text/css">

<!-- BEGIN META DATA -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META NAME="KEYWORDS" CONTENT="COM, COM Sync, COM Sync Suite, develop, developing, start, create, build, debug, conduit, conduits, CDK">
<META NAME="DESCRIPTION" CONTENT="Helps you get started designing a Java-based conduit with the JSync Suite">
<META NAME="PSITEMPLATE" CONTENT="1006-007 PalmSource HTML 20040609">
<META NAME="GENERATOR" CONTENT="Quadralay WebWorks Publisher Professional Edition 6.0.7">
<META NAME="LASTUPDATED" CONTENT="06/28/04 08:33:41">
<!-- END META DATA -->
</head>

<body bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<a name="995935"></a>

<!-- BEGIN TOPNAV -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td><img src="images/shim.gif" width="7" height="75" border="0" alt=""></td>
<td align="left"><table border="0" cellpadding="0" cellspacing="0" width="744">
<tr>
<td><img name="index_r2_c1" src="images/shim.gif" width="25" height="75" border="0" alt=""></td>
<td valign="top"><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_r2_c4" src="images/shim.gif" width="96" height="15" border="0" alt=""></td>
</tr>
<tr>
<td><a href="http://www.palmsource.com/"><img name="ps_logo" src="images/ps_logo.gif" width="96" height="54" border="0" alt=""></a></td>
</tr>

</table>
</td>

<td><table border="0" cellpadding="0" cellspacing="0" width="30">
<td><img name="index_x" src="images/shim.gif" width="30" height="75" border="0" alt=""></td>
</table></td>

<!--BEGIN MASTHEAD-->
<td><table border="0" cellpadding="0" cellspacing="0" width="96">
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
<tr>
<td>
<!--BEGIN BOOK NAVIGATION-->
<span class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="COMSyncCompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="COMComp_Basics.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="COMComp_Install.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="COMSyncCompanionIX.html">Index</a>
</span>
<!--END BOOK NAVIGATION-->
</tr>
<tr>
<td>
<!--BEGIN PAGE TITLE-->
<h2 class="PageTitle">3 &nbsp;&nbsp;
Building a Conduit</h2></td>
<!--END PAGE TITLE-->
</tr>
<tr>
<td>
<!--BEGIN BOOK TITLE-->
<p class="BookTitle">COM Sync Suite Companion</p>
<p class="SubTitle">Palm OS&#174; Conduit Development Kit for  Windows, Version 6.0.1 </p>
<!--END BOOK TITLE-->
</td>
</tr>
<tr>
<td><img name="index_x" src="images/shim.gif" width="615" height="5" border="0" alt=""></td>
</tr>
</table>
</td>
<!--END MASTHEAD-->
</tr>
</table>
<img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
</tr>
</table>
<!-- END TOPNAV -->

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top" width="5"><img name="index_x" src="images/shim.gif" width="5" height="33" border="0" alt=""></td>

<!--BEGIN SIDETOC-->
<td valign="top" width="175">
<div id="sidetoc" valign="bottom">
<h1 class="SideTOC1"><a href="COMComp_Development.html">3  Building a Conduit</a></h1>

   <h2 class="SideTOC2"><a href="#995987">
   Requirements</a></h2>

   <h2 class="SideTOC2"><a href="#995992">
   Create the Debug Environment</a></h2>

      <h3 class="SideTOC3"><a href="#996038">
      Synchronizing with Palm OS Simulator</a></h3>

   <h2 class="SideTOC2"><a href="#996050">
   Start a Visual Basic Project</a></h2>

   <h2 class="SideTOC2"><a href="#996083">
   Create the Conduit</a></h2>

   <h2 class="SideTOC2"><a href="#996209">
   Debug the Conduit</a></h2>

   <h2 class="SideTOC2"><a href="#996220">
   Convert Your Conduit to an ActiveX Client</a></h2>

   <h2 class="SideTOC2"><a href="#996247">
   Implement the IPDClientNotify Interface</a></h2>

   <h2 class="SideTOC2"><a href="#996332">
   Developing a Conduit with Visual Basic .NET</a></h2>

      <h3 class="SideTOC3"><a href="#996350">
      Registration Steps</a></h3>

</div>
</td>
<!--END SIDETOC-->

<td width="5">&nbsp;&nbsp;</td>
<td width="2" background="images/index_r8_c10.gif"><img src="images/shim.gif" width="2" height="75" border="0" alt=""></td>
<td width="5">&nbsp;&nbsp;</td>
<td valign="top">

<!--BEGIN CONTENT-->
<div id="content" valign="bottom">
<p><a name="995939"> </a>In the following sections, this chapter describes how to build a COM-based conduit using the COM Sync Suite and Visual Basic:</p>
   <blockquote class = "bq"><a name="995943"> </a><a href="COMComp_Development.html#995987">Requirements</a> </blockquote>
   <blockquote class = "bq"><a name="995947"> </a><a href="COMComp_Development.html#995992">Create the Debug Environment</a> </blockquote>
   <blockquote class = "bq"><a name="995951"> </a><a href="COMComp_Development.html#996050">Start a Visual Basic Project</a> </blockquote>
   <blockquote class = "bq"><a name="995955"> </a><a href="COMComp_Development.html#996083">Create the Conduit</a> </blockquote>
   <blockquote class = "bq"><a name="995959"> </a><a href="COMComp_Development.html#996209">Debug the Conduit</a> </blockquote>
   <blockquote class = "bq"><a name="995963"> </a><a href="COMComp_Development.html#996220">Convert Your Conduit to an ActiveX Client</a> </blockquote>
   <blockquote class = "bq"><a name="995967"> </a><a href="COMComp_Development.html#996247">Implement the IPDClientNotify Interface</a> </blockquote>
   <blockquote class = "bq"><a name="995971"> </a><a href="COMComp_Development.html#996332">Developing a Conduit with Visual Basic .NET</a> </blockquote>

<p><a name="995976"> </a><a href="COMComp_Development.html#995979">Figure 3.1</a> shows the steps required to build a COM-based conduit.</p>

<p class="FFigureCaption">
  <a name="995979"> </a><b>Figure 3.1&nbsp;&nbsp;Building a COM-based conduit</b>
</p>
<div align="left"><img src="images/COMConduitBuilding.gif" height="590" width="364" border="0" hspace="0" vspace="0">
</div>

<h2 class="haH2">
  <a name="995987"> </a>Requirements <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>

<ul type="disc">
  <li><a name="995988"> </a>HotSync Manager versions earlier than 6.0 require that every conduit have an application on the handheld with a unique creator ID that matches the creator ID of the conduit; otherwise HotSync<sup>&#174;</sup> Manager will not run your conduit. 
</ul>
<div class="NINoteImportant"><hr>
  <a name="1005099"> </a> <b>NOTE: </b> HotSync Manager versions <i>6.0 and later</i> allow a conduit to "opt out" of the requirement that an application with the same creator ID exist on the handheld for the conduit to run. Creator IDs are still required for all conduits for unique identification, but depending on how a COM-based conduit responds when HotSync Manager calls its <a href="COMRef_Interface.html#995943"><code>IPDClientNotify</code></a>.<a href="COMRef_Meth.html#998209"><code>GetConduitInfo()</code></a> entry point, HotSync Manager runs the conduit even without a corresponding application on the handheld. But if a conduit does not respond to this query, then the default behavior is that HotSync Manager always runs the conduit. Note that this behavior differs from the default behavior in versions earlier than 6.0.
<hr>
</div>
<ul type="disc">
  <li><a name="1005103"> </a>Every conduit must be registered with HotSync Manager. COM Sync objects that access the handheld are active <i>only</i> during a HotSync operation.
  <li><a name="995990"> </a>The COM Sync module must be installed properly on every machine your conduit is to run on. 
</ul>

<h2 class="haH2">
  <a name="995992"> </a>Create the Debug Environment <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="995993"> </a>The COM Sync module can execute a development environment as a client application. For example, you can configure the COM Sync module to launch Visual Basic during a HotSync operation, which allows you to program and debug with your handheld online. This enables you to debug your conduit in real-time without the handheld timing out.</p>
<div class="NINoteImportant"><hr>
  <a name="995994"> </a> <b>IMPORTANT: </b> COM Sync objects that access the handheld are active <i>only</i> during a HotSync operation. You cannot interactively debug your conduit in Visual Basic unless you follow the steps below and start a HotSync operation. 
<hr>
</div>

<p><a name="999722"> </a>The first step to building a conduit is to create a debug environment. The following description shows how to do this with Visual Basic 6. Alternatively, see the Palm OS Knowledge Base article "<a href="http://kb.palmsource.com/cgi-bin/palmsource.cfg/php/enduser/std_adp.php?p_sid=2hjQ-T1h&p_lva=&p_faqid=359">How do I debug a COM-based conduit DLL using Visual Basic .Net</a>" (article 359).</p>
<ol type="1">
  <li value="1"><a name="999724"> </a>Start the Conduit Configuration utility (<code>&lt;CDK&gt;\Common\Bin\CondCfg.exe</code>) and click the <b>System Conduits</b> tab.
   <p><a name="995997"> </a>For a complete description of the CondCfg utility, see <a href="Util_CondCfg.html#995934">Chapter 3, "Conduit Configuration Utility,"</a> in the <i>Conduit Development Utilities Guide</i>.</p>
</ol>

<p class="FFigureCaption">
  <a name="996004"> </a><b>Figure 3.2&nbsp;&nbsp;Conduit Configuration utility, System Conduits tab</b>
</p>
<div align="left"><img src="images/CondCfg_SystemConduits.jpg" border="0" hspace="0" vspace="0">
</div>
<ol type="1">
  <li value="2"><a name="996009"> </a>From the <b>System Conduits</b> tab, click the <b>Add</b> button. 
   <p><a name="996010"> </a>The <b>Conduit Information</b> dialog box displays.</p>
</ol>

<p class="FFigureCaption">
  <a name="996015"> </a><b>Figure 3.3&nbsp;&nbsp;Conduit Information dialog box</b>
</p>
<div align="left"><img src="images/COMCondCfg-CondInfo.jpg" border="0" hspace="0" vspace="0">
</div>
<ol type="1">
  <li value="3"><a name="996020"> </a>Select the <b>COM-based conduit</b> option at the bottom of the dialog box shown in <a href="COMComp_Development.html#996015">Figure 3.3</a>.
  <li value="4"><a name="996024"> </a>Enter the full path for the Visual Basic IDE in the <b>COM client</b> box.
   <p><a name="996025"> </a>For example, the full path when the COM Client is the VB 6 IDE could be: <code>C:\Program Files\Microsoft Visual Studio\VB98\VB6.exe</code>. </p>
  <li value="5"><a name="996026"> </a>In <b>Creator ID</b>, type the creator ID of the application on the handheld whose data this conduit synchronizes. For example, to register the conduit in the <code>&lt;CDK&gt;\COM\Samples\SchemaDB\Tutorial\SimpleDb</code> sample, type <code>mems</code>. Note that if the standard Memo Pad conduit is still installed, CondCfg will not allow you to register a second conduit with the same creator ID, so you must delete the existing conduit first.
  <li value="6"><a name="996029"> </a>Fill in any other relevant text boxes in CondCfg. <a href="Util_CondCfg.html#995934">Chapter 3, "Conduit Configuration Utility,"</a> in the <i>Conduit Development Utilities Guide</i> contains a complete description of all of these fields.
</ol>
<div class="NINoteImportant"><hr>
  <a name="996034"> </a> <b>IMPORTANT: </b> You must register your conduit with a unique creator ID on the desktop.
<hr>
</div>
<ol type="1">
  <li value="7"><a name="996035"> </a>Click <b>OK</b> to add the new conduit information to the configuration entries.
</ol>

<p><a name="996036"> </a>Your debug environment is registered with HotSync Manager as if your IDE were a conduit. The next step is to use Visual Basic to build a simple client application and construct the client conduit as a standard EXE. </p>
<h3 class="hbH3">
  <a name="996038"> </a>Synchronizing with Palm OS Simulator <a href="#995935"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="996039"> </a>Though you will want to test your conduit with real handhelds, it is very useful during development to synchronize with Palm OS<sup>&#174;</sup> Simulator instead of a real handheld. For details on how to get and set up Simulator, see <a href="Util_Simulator.html#995933">Chapter 8, "Synchronizing with Palm OS Simulator,"</a> in the <i>Conduit Development Utilities Guide</i>.</p>

<h2 class="haH2">
  <a name="996050"> </a>Start a Visual Basic Project <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996051"> </a>To start a new Visual Basic 6 project, follow these steps:</p>
<ol type="1">
  <li value="1"><a name="996052"> </a>Start a new Visual Basic Project
  <li value="2"><a name="996053"> </a>To begin a new project, launch Visual Basic. The <b>New Project</b> dialog box in <a href="COMComp_Development.html#996058">Figure 3.4</a> appears.
</ol>

<p class="FFigureCaption">
  <a name="996058"> </a><b>Figure 3.4&nbsp;&nbsp;Visual Basic New Project screen</b>
</p>
<div align="left"><img src="images/COMnewprj.gif" border="0" hspace="0" vspace="0">
</div>


<ol type="1">
  <li value="3"><a name="1003282"> </a>Select <b>Project</b> &gt; <b>References</b> from the main menu.
  <li value="4"><a name="1003283"> </a>When the reference list appears, select one or more of the following COM Sync libraries that your project requires. 
  <ul type="disc">
    <li><a name="1003284"> </a><code>Palm OS&#174; Classic Databases</code> 
    <li><a name="1003285"> </a><code>Palm OS&#174; Classic Databases and Utilities</code> 
    <li><a name="1000250"> </a><code>Palm OS&#174; Extended Databases</code> 
    <li><a name="1000311"> </a><code>Palm OS&#174; Schema Databases</code> 
   <p><a name="1000312"> </a><a href="COMComp_Development.html#1000314">Figure 3.5</a> shows only the last selected, because the following section shows a sample that works only with schema databases.</p>
  </ul>
</ol>

<p class="FFigureCaption">
  <a name="1000314"> </a><b>Figure 3.5&nbsp;&nbsp;Select type library</b>
</p>
<div align="left"><img src="images/COMType_Library.jpg" border="0" hspace="0" vspace="0">
</div>
   <p><a name="996078"> </a>A standard EXE client allows you to debug your conduit within your IDE. The COM Sync module activates standard EXE clients and waits for them to terminate. </p>
   <p><a name="996079"> </a>These client modules may access the COM Sync objects using standard COM mechanisms. These clients are not required to access the COM Sync objects themselves and may spawn other processes/threads that access the COM Sync module. </p>

<p><a name="996080"> </a>Any EXE that includes a development environment, like Developer Studio or Visual Studio .NET, may be a COM Sync client. However, these client modules have no access to the HotSync Manager <b>Custom</b> menu.</p>

<p><a name="996081"> </a>For example, the COM Sync module can be configured to launch Microsoft Word. You can write a VBA macro that accesses the handheld through the COM Sync module, and run it within your Word document. </p>
<div class="NINoteImportant"><hr>
  <a name="1005980"> </a> <b>IMPORTANT: </b> If you are using Visual Basic .NET, then you must put your conduit in the HotSync Manager executable directory. Otherwise, COM Sync will not be able to find the libraries it needs and will cause an error. 
<hr>
</div>

<h2 class="haH2">
  <a name="996083"> </a>Create the Conduit <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="1002493"> </a>These are generally the steps that any synchronization conduit must perform for a schema database:</p>
<ol type="1">
  <li value="1"><a name="1002497"> </a>You first create a <a href="COMRef_Obj.html#1198575"><code>PSDDatabaseQuery</code></a> object, which contains all methods necessary to manage schema databases on the handheld.
  <li value="2"><a name="1002501"> </a>Then you open a database to get a <a href="COMRef_Obj.html#1197474"><code>PSDDatabaseAdapter</code></a> object, which represents a single open schema database. 
  <li value="3"><a name="1002502"> </a>Generally at this point, you can choose to perform the following three basic tasks in any order: manipulate rows, modify schemas and get/add/remove tables, and manipulate categories. 
</ol>

<p><a name="1003219"> </a>The remainder of this section discusses the sample, SimpleDb, which is located here:</p>
<pre class="sl">&lt;CDK&gt;\COM\Samples\SchemaDB\Tutorial\SimpleDb\</pre>

<p><a name="1003327"> </a>This sample uses a text field to enter a search string and a button to perform the search for this string in the Memo Pad database, which is a schema database in Palm OS Cobalt. The text field object is <code>txtSearch</code>; the button object is <code>btnSearch</code>. </p>

<p><a name="1002331"> </a>The following steps present the SimpleDb sample:</p>
<ol type="1">
  <li value="1"><a name="996092"> </a>Start with the <code>Click</code> event subroutine.
   <p><a name="996093"> </a>The button <code>Click</code> event subroutine begins below. Note that the <a href="COMRef_Obj.html#1198575"><code>PSDDatabaseQuery</code></a> object is created first, so that it can be used in the next step to open the Memo Pad schema database.</p>
</ol>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
Private Sub btnSearch_Click()<a name="1000495"> </a>
   ' Handle errors<a name="1000496"> </a>
   On Error GoTo Handler<a name="1000497"> </a>
<a name="1000498"> </a>
   ' Declare the PSDDatabaseQuery, PSDRowAdapter, and other objects.<a name="1000499"> </a>
   Dim pDbQuery As New PSDDatabaseQuery<a name="1000500"> </a>
   Dim pMemoDbAdapter As PSDDatabaseAdapter<a name="1000501"> </a>
   Dim pMemoSet As PSDRowSet<a name="1000502"> </a>
   Dim pData As PSDRowData<a name="1000503"> </a>
   Dim pRowAdapter As PSDRowAdapter<a name="1000504"> </a>
   Dim TableNames As Variant<a name="1000505"> </a>
<a name="1000506"> </a>
   ' Let the user know we're processing<a name="1000508"> </a>
   lblCount = "Please wait....."<a name="1000509"> </a>
</pre><div class="CodeRule"><hr></div>

<ol type="1">
  <li value="2"><a name="996117"> </a>Open the Memo Pad schema database and get a row adapter. Note that the <a href="COMRef_Obj.html#1198575"><code>PSDDatabaseQuery</code></a> object requires that you open a schema database before your conduit can access it. The <a href="COMRef_Meth.html#1610163"><code>OpenDatabase()</code></a> method returns a <a href="COMRef_Obj.html#1197474"><code>PSDDatabaseAdapter</code></a> object, which represents the open database and with which you can get a <a href="COMRef_Obj.html#1198992"><code>PSDRowAdapter</code></a> object.

<div class="CodeRule"><hr></div><pre class="CodeBlock">
   ' Open the Memo Pad database.<a name="1000859"> </a>
   Set pMemoDbAdapter = pDbQuery.OpenDatabase("MemoDBS", "mems", _ <a name="1000860"> </a>
      ePSDReadWrite, EPSDShareNone)<a name="1001659"> </a>
<a name="1000861"> </a>
   ' We want to read all the rows in MemoPad, so first <a name="1000935"> </a>
   ' get the row adapter.<a name="1000936"> </a>
   ' Set pRowAdapter = pMemoDbAdapter.GetRowAdapter<a name="1000863"> </a>
</pre><div class="CodeRule"><hr></div>

</ol>
<ol type="1">
  <li value="3"><a name="1002894"> </a>Get the table and column names. The Memo Pad database has only one table with one column in it. Use the <a href="COMRef_Obj.html#1197474"><code>PSDDatabaseAdapter</code></a> object to get this information.

<div class="CodeRule"><hr></div><pre class="CodeBlock">
   ' Now get the table name and column name.<a name="1001049"> </a>
   ' For Memo Pad, the table name is "MemoDBSchema" and there is only one<a name="1001092"> </a>
   ' column named "MemoText".<a name="1003362"> </a>
   pMemoDbAdapter.GetTableNames TableNames<a name="1001050"> </a>
<a name="1001051"> </a>
   ' Alternatively, we can use the following code to find <a name="1001052"> </a>
   ' the table name and column name.<a name="1001115"> </a>
   Dim pTableInfo As PSDTable<a name="1001053"> </a>
   Dim pColInfo As PSDColumnInfo<a name="1001054"> </a>
   Set pTableInfo = pMemoDbAdapter.GetTableInfo(TableNames(0))<a name="1001055"> </a>
   Dim ColNames As Variant<a name="1001056"> </a>
   Dim ColCount As Long<a name="1001057"> </a>
   ColCount = pTableInfo.GetColumnNames(ColNames)<a name="1001058"> </a>
</pre><div class="CodeRule"><hr></div>

  <li value="4"><a name="996144"> </a>Get a row set and iterate over the rows searching for the specified string. From the <a href="COMRef_Obj.html#1198992"><code>PSDRowAdapter</code></a> object, get a <a href="COMRef_Obj.html#1199637"><code>PSDRowSet</code></a> object and iterate over each row (a memo), searching for the matching string in individual rows represented by a <a href="COMRef_Obj.html#1199377"><code>PSDRowData</code></a> object.

<div class="CodeRule"><hr></div><pre class="CodeBlock">
   ' Declare the Memo string.<a name="1001276"> </a>
   Dim sMemo As String<a name="1001277"> </a>
<a name="1001278"> </a>
   ' Declare the count of rows that contain the string.<a name="1001279"> </a>
   Dim nCount As Long<a name="1001280"> </a>
   Dim nTest As Variant<a name="1001281"> </a>
<a name="1001282"> </a>
   ' Read the row set. ReadRows() returns a PSDRowSet object that can be <a name="1001283"> </a>
   ' used to iterate over the set of rows looking for data.<a name="1001689"> </a>
   Set pMemoSet = pRowAdapter.ReadRows(TableNames(0), Null, eDbMatchAll)<a name="1001284"> </a>
<a name="1001285"> </a>
   ' Start iterating over the row set looking for the specified string.<a name="1001286"> </a>
   Set pData = pMemoSet.MoveFirst<a name="1001287"> </a>
<a name="1001288"> </a>
   ' Loop and search each row for the string.<a name="1001289"> </a>
   Do While Not pMemoSet.EOF<a name="1001290"> </a>
      sMemo = pData.Value("MemoText")<a name="1001291"> </a>
<a name="1001292"> </a>
      ' Check whether the search string is in the Memo.<a name="1001293"> </a>
      nTest = InStr(sMemo, txtSearch.Text)<a name="1001294"> </a>
      If VarType(nTest) &lt;&gt; vbNull And nTest &gt; 0 Then nCount = nCount + 1<a name="1001295"> </a>
<a name="1001296"> </a>
</ol>
      ' Read the next row.<a name="1001297"> </a>
      Set pData = pMemoSet.MoveNext<a name="1001298"> </a>
   Loop<a name="1001299"> </a>
<a name="1001300"> </a>
   ' Prepare the result.<a name="1001301"> </a>
   lblCount.Caption = Str(nCount) &amp; " of " &amp; Str(pMemoSet.GetRowCount) &amp; _<a name="1001302"> </a>
   " rows contained the string."<a name="1001303"> </a>
</pre><div class="CodeRule"><hr></div>

<ol type="1">
  <li value="5"><a name="1001038"> </a>Close the database and clean up. 
</ol>
<div class="NINoteImportant"><hr>
  <a name="1003372"> </a> <b>IMPORTANT: </b> Note that the <a href="COMRef_Obj.html#1198575"><code>PSDDatabaseQuery</code></a> object requires that you call <a href="COMRef_Meth.html#1455819"><code>CloseDatabase()</code></a> to close a schema database before your conduit exits. A mirror-image synchronization conduit&#8212which this sample is not&#8212must also pass in <code>True</code> in the <code class="par">bSeenAllChanges</code> parameter to reset change tracking for this schema database.
<hr>
</div>

<div class="CodeRule"><hr></div><pre class="CodeBlock">
   pDbQuery.CloseDatabase pMemoDbAdapter, ePSDNone, False<a name="1001710"> </a>
<a name="1001835"> </a>
   ' Don't need the objects anymore<a name="1001836"> </a>
   Set pDbQuery = Nothing<a name="1001837"> </a>
   Set pMemoDbAdapter = Nothing<a name="1001715"> </a>
   Set pRowAdapter = Nothing<a name="1001716"> </a>
   Set pMemoSet = Nothing<a name="1001717"> </a>
<a name="1001718"> </a>
   ' Normal exit<a name="1001719"> </a>
   Exit Sub<a name="1001720"> </a>
<a name="1001721"> </a>
Handler:<a name="1001722"> </a>
   MsgBox "There was an error performing the search." &amp; vbNewLine &amp; _<a name="1001723"> </a>
      Err.Description &amp; vbNewLine &amp; _<a name="1001724"> </a>
      "Number = " &amp; Hex(Err.Number)<a name="1001725"> </a>
<a name="1001726"> </a>
   pDbQuery.CloseDatabase pMemoDbAdapter, ePSDNone, False<a name="1001727"> </a>
<a name="1001728"> </a>
   ' Don't need the objects anymore<a name="1001730"> </a>
   Set pDbQuery = Nothing<a name="1001731"> </a>
   Set pMemoDbAdapter = Nothing<a name="1001732"> </a>
   Set pRowAdapter = Nothing<a name="1001733"> </a>
   Set pMemoSet = Nothing<a name="1001734"> </a>
<a name="1001735"> </a>
End Sub<a name="1001708"> </a>
</pre><div class="CodeRule"><hr></div>


<h2 class="haH2">
  <a name="996209"> </a>Debug the Conduit <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996210"> </a>After creating your debug environment in the previous section, you are now ready to debug your conduit. </p>
<ol type="1">
  <li value="1"><a name="1005929"> </a>Open the standard EXE conduit.
  <li value="2"><a name="996212"> </a>Set breakpoints, watches, <code>debug.print</code> statements, and so on, in the code.
  <li value="3"><a name="996213"> </a>Use the COM Sync module to debug your conduit and verify that it works. 
</ol>

<p><a name="996214"> </a>The COM Sync module can launch an EXE or ActiveX DLL during the HotSync process, providing you real-time access to the handheld data during the debug process. As a developer, this gives you ultimate flexibility for your product. </p>
<div class="NINoteImportant"><hr>
  <a name="996217"> </a> <b>IMPORTANT: </b> You must have followed the steps in <a href="COMComp_Development.html#995992">"Create the Debug Environment"</a> before you can debug your conduit in Visual Basic. 
<hr>
</div>

<h2 class="haH2">
  <a name="996220"> </a>Convert Your Conduit to an ActiveX Client <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996224"> </a>The ActiveX client allows you to use the <a href="COMRef_Meth.html#996402"><code>CfgConduit()</code></a> method to configure your conduit from the HotSync Manager's <b>Custom</b> menu and provides location independence through DCOM. In other words, you can access the conduit from anywhere on a network through DCOM.</p>

<p><a name="996225"> </a>The COM Sync module notifies you or activates an ActiveX client for one of two reasons: </p>
<ul type="disc">
  <li><a name="996226"> </a>when a user selects the conduit from the HotSync Manager's <b>Custom</b> menu
  <li><a name="996227"> </a>when HotSync Manager is ready to run the client module 
</ul>

<p><a name="996228"> </a>The COM Sync module uses standard COM mechanisms to point to your client object that implements the <a href="COMRef_Interface.html#995943"><code>IPDClientNotify</code></a> interface. You must build a public object that exposes the interface. </p>

<p><a name="996232"> </a>The COM Sync module calls one of two interface methods based on whether the request is coming from HotSync Manager or the <b>Custom</b> menu. ActiveX clients implement configuration and conduit logic in these two interface methods.</p>

<p><a name="996233"> </a>Some enterprise data servers run nonstop. If you want to synchronize handheld data with this type of an application, the conduit must notify the data server when it is ready to go. <code>IPDClientNotify</code> can be used for this.</p>

<p><a name="996234"> </a>The conduit should be in the ActiveX format to allow HotSync Manager to see the <code>IPDClientNotify</code> interface. </p>

<p><a name="996235"> </a>There are two examples of the schema version of the SimpleDb sample in the <code>&lt;CDK&gt;\COM\Samples\SchemaDB\Tutorial</code> directory, <code>ActiveXExe</code> and <code>ActiveXDll</code>. The code is identical with the only difference being the Visual Basic project properties. </p>

<p><a name="996236"> </a>To convert SimpleDb to ActiveX, follow these steps:</p>
<ol type="1">
  <li value="1"><a name="996237"> </a>Open the <b>Project Properties</b> dialog box and change the <b>Project Type</b> to <b>ActiveX DLL</b>.
</ol>

<p class="FFigureCaption">
  <a name="996238"> </a><b>Figure 3.6&nbsp;&nbsp;General Project Properties</b>
</p>
<div align="left"><img src="images/COMActiveXDLL.gif" border="0" hspace="0" vspace="0">
</div>
<ol type="1">
  <li value="2"><a name="996243"> </a>Set <b>Threading Model</b> to <b>Apartment Threaded</b>.
   <p><a name="996244"> </a>If you do not implement this setting, there are no restrictions.</p>
</ol>

<h2 class="haH2">
  <a name="996247"> </a>Implement the IPDClientNotify Interface <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>

<ol type="1">
  <li value="1"><a name="996251"> </a>Add a class module that implements <a href="COMRef_Interface.html#995943"><code>IPDClientNotify</code></a>. 
   <p><a name="996252"> </a>The COM Sync Suite defines a notification interface, <code>IPDClientNotify</code>, which has four methods, including:</p>
  <ul type="disc">
    <li><a name="996256"> </a><a href="COMRef_Meth.html#996087"><code>BeginProcess()</code></a> 
    <li><a name="996260"> </a><a href="COMRef_Meth.html#996402"><code>CfgConduit()</code></a> 
    <li><a name="996264"> </a><a href="COMRef_Meth.html#996758"><code>ConfigureConduit()</code></a> 
    <li><a name="996268"> </a><a href="COMRef_Meth.html#998209"><code>GetConduitInfo()</code></a> 
   <p><a name="996269"> </a>The first method is used to notify client modules that they can run their conduit logic. The second and third methods permit client conduits to display a dialog box when a user selects their conduit from the HotSync Manager's <b>Custom</b> menu. The last method provides HotSync Manager with information about your conduit. </p>
   <p><a name="996270"> </a>Call your conduit code from the <code>BeginProcess</code> method and return <code>False</code> when you are done. Returning <code>False</code> tells the conduit that your process is done with the server and it should continue with the HotSync Manager process. </p>
  </ul>
  <li value="2"><a name="996271"> </a>Set <code>Cnotify.cls</code>. 
   <p><a name="996275"> </a>This class contains the <a href="COMRef_Interface.html#995943"><code>IPDClientNotify</code></a> interface's <a href="COMRef_Meth.html#996087"><code>BeginProcess()</code></a> and other entry points that are not available in a standard EXE for "MultiUse" instancing.</p>
   <p><a name="996279"> </a>If you want your conduit to be notified when HotSync Manager is ready for it to process, then you must implement this interface and expose it using a single object. </p>
   <p><a name="996280"> </a>The COM Sync module includes the <code>IPDClientNotify</code> interface in its type library. If you choose to implement the interface, Visual Basic developers create a class that uses the "Implements" keyword and make the project either an ActiveX EXE or ActiveX DLL.</p>
   <p><a name="996281"> </a>The SimpleDb tutorial contains samples for both ActiveXExe and ActiveXDll. The <code>IPDClientNotify</code> interface is not required and is used only in conjunction with ActiveX client module types.</p>
  <li value="3"><a name="996282"> </a>Select <b>File</b> &gt; <b>Make Project</b> to compile a DLL.
   <p><a name="996283"> </a>This compiles a DLL and links your application.</p>
  <li value="4"><a name="996284"> </a>In <b>Project Properties</b>, set the component's <b>Version Compatibility</b> to <b>Binary Compatibility</b>. 
</ol>

<p class="FFigureCaption">
  <a name="996285"> </a><b>Figure 3.7&nbsp;&nbsp;Component Project Properties </b>
</p>
<div align="left"><img src="images/COMCompObjProps.gif" border="0" hspace="0" vspace="0">
</div>

   <p><a name="996291"> </a>"Binary Compatibility" ensures the GUID of the <code>IPDClientNotify</code> object remains constant. (For help on the difference between "Binary Compatibility" and "Project Compatibility," see the Visual Basic help files.)</p>
<ol type="1">
  <li value="5"><a name="996292"> </a>Launch <code>CondCfg.exe</code>. 
</ol>

<p class="FFigureCaption">
  <a name="996294"> </a><b>Figure 3.8&nbsp;&nbsp;Registering your COM client using CondCfg</b>
</p>
<div align="left"><img src="images/COMCondCfg-CondInfo-SimpleDb.jpg" border="0" hspace="0" vspace="0">
</div>
<ol type="1">
  <li value="6"><a name="996299"> </a>Click the <b>COM conduit</b> option button and fill in the COM Client box with the ProgID of your module (see <a href="COMComp_Development.html#996294">Figure 3.8</a>).
   <p><a name="996303"> </a>For example, the <code>SimpleDb</code> ActiveX DLL sample has a ProgID of <code>simpledbdll.CNotifyDll</code>. </p>
   <p><a name="996304"> </a>For standalone EXEs, type the EXE name with its full path in <b>COM client</b>. </p>
  <li value="7"><a name="1003528"> </a>In <b>Creator ID</b>, type the creator ID of the application on the handheld whose data this conduit synchronizes. For example, to register the conduit in the <code>&lt;CDK&gt;\COM\Samples\SchemaDB\Tutorial\SimpleDb</code> sample, type <code>mems</code>. Note that if the standard Memo Pad conduit is still installed, CondCfg will not allow you to register a second conduit with the same creator ID, so you must delete the existing conduit first.
  <li value="8"><a name="996308"> </a>Fill in any other relevant text boxes in CondCfg. <a href="Util_CondCfg.html#995934">Chapter 3, "Conduit Configuration Utility,"</a> in the <i>Conduit Development Utilities Guide</i> contains a complete description of all of these fields.
  <li value="9"><a name="996316"> </a>When you write your own installer, use the <a href="COMRef_Obj.html#1141502"><code>PDCondMgr</code></a> (or <a href="COMRef_Obj.html#1232524"><code>PDSystemCondMgr</code></a>) and <a href="COMRef_Obj.html#1144549"><code>PDConduitInfo</code></a> objects, setting the <a href="COMRef_Prop.html#997135"><code>FileName</code></a> property to <code>COMConduit.dll</code> and the <a href="COMRef_Prop.html#996327"><code>COMClassID</code></a> property to your conduit's ProgID. 
</ol>

<p><a name="996326"> </a>Once you write, debug, and convert your conduit to the required form, you write a setup/installation routine to deploy the conduit. This is typically done with InstallShield or other installation software packages. For more information, see <a href="COMComp_Install.html#995936">Chapter 4, "Writing an Installer."</a> </p>
<div class="NINoteImportant"><hr>
  <a name="1006042"> </a> <b>IMPORTANT: </b> If you are using Visual Basic .NET to develop your conduit, then you must deploy your conduit in the end user's HotSync Manager executable directory. Otherwise, COM Sync will not be able to find the libraries it needs and will cause an error.
<hr>
</div>

<h2 class="haH2">
  <a name="996332"> </a>Developing a Conduit with Visual Basic .NET <a href="#995935"><span class="nav">^TOP^</span></a>
</h2>


<p><a name="996333"> </a>Conduits written or compiled under Visual Basic .NET produce an <b>assembly</b>. HotSync Manager can load these assemblies using COM interoperability. Because COM Sync components still use the underlying COM architecture, you must add references to COM Sync components in your project. To do so in VB .NET, click <b>Project</b> &gt; <b>Add Resources</b> &gt; <b>COM</b> and select one or more of the following COM Sync libraries that your project requires. </p>
<ul type="disc">
  <li><a name="1003541"> </a><code>Palm OS&#174; Classic Databases</code> 
  <li><a name="1003542"> </a><code>Palm OS&#174; Classic Databases and Utilities</code> 
  <li><a name="1003543"> </a><code>Palm OS&#174; Extended Databases</code> 
  <li><a name="1003544"> </a><code>Palm OS&#174; Schema Databases</code> 
</ul>

<p><a name="996334"> </a>Remember that to enable the user to configure your conduit from HotSync Manager's <b>Custom</b> dialog box, you must implement the <a href="COMRef_Interface.html#995943"><code>IPDClientNotify</code></a> interface in your conduit (see <a href="COMComp_Development.html#996247">"Implement the IPDClientNotify Interface"</a>). In the <a href="COMRef_Obj.html#1144549"><code>PDConduitInfo</code></a>.<a href="COMRef_Prop.html#996327"><code>COMClassID</code></a> property for conduit registration, place the classID of the class that implements this interface. If your conduit is a standard EXE and does not implement this interface, set the <a href="COMRef_Prop.html#996327"><code>COMClassID</code></a> property to the full path and filename of the EXE.</p>
<div class="NINoteImportant"><hr>
  <a name="1005671"> </a> <b>NOTE: </b> If you use VB .NET to upgrade a VB 6 ActiveX conduit (like one of the samples in the CDK) to VB .NET 2003, then the VB .NET upgrade wizard inserts a line of code at the beginning of the notification class that looks like this: <br><br><code>&lt;System.Runtime.InteropServices.ProgId<br>("CNotify_NET.CNotify")&gt; Public Class CNotify</code><span style="color: #333;;  font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline"> <br></span><br>The upgrade wizard does this to avoid using the same ProgID as the conduit built with VB 6.<br><br>If you retain the code between the &lt;&gt; symbols, then when you register your conduit, you must specify <code>CNotify_NET.Cnotify</code> in the <code>ComClient</code> field. However, if you remove this code, then specifying <code>SimpleDB.CNotify</code> in <code>COMClient</code> works.
<hr>
</div>
<h3 class="hbH3">
  <a name="996350"> </a>Registration Steps <a href="#995935"><span class="nav">^TOP^</span></a>
</h3>


<p><a name="996351"> </a>These steps point out what you need to do differently to get HotSync Manager to run a conduit you build with VB .NET:</p>
<ol type="1">
  <li value="1"><a name="996352"> </a>For HotSync Manager to recognize VB .NET assemblies, they must be in the same directory as HotSync Manager. To do this, you can either copy your conduit to the HotSync Manager directory or change your project's output directory to the HotSync Manager directory (in VB .NET, do this in the project's <b>Property Pages</b>). 
  <li value="2"><a name="996353"> </a>Run <code>Regasm.exe</code> on your conduit so that the component details are placed in the registry. (<code>Regasm.exe</code> is under <code>&lt;Windows&gt;\Microsoft.Net\Framework</code> if you have installed the .NET framework on your computer.) 
</ol>

<p><a name="996354"> </a>Then as with VB, register your conduit with HotSync Manager as described in <a href="COMComp_Development.html#995992">"Create the Debug Environment"</a> (or in <a href="COMComp_Install.html#995936">"Writing an Installer"</a> if you're writing an installer). </p>
&nbsp;<br>
</div>
<!--END CONTENT-->

</td>
<td width="5">&nbsp;&nbsp;</td>
</tr>

</table>

<!-- BEGIN FOOTER -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td width="7" rowspan="2"><img name="index_x" src="images/shim.gif" width="7" height="33" border="0" alt=""></td>
<td align="left"><img name="dashes" src="images/dashes.gif" width="744" height="3" border="0" alt=""></td>
<td width="10" rowspan="2"><img name="index_x" src="images/shim.gif" width="10" height="33" border="0" alt=""></td>
</tr>
<tr>
<td align="center">
<p class="footer">
Copyright © 2000-2004, PalmSource, Inc. and its affiliates. All rights reserved.<br>
<a href="http://www.palmsource.com/contact/">Write Us</a> | <a href="http://www.palmos.com/dev/training/">Training</a> | <a href="http://www.palmos.com/dev/support/kb/">Knowledge Base</a> | <a href="COMComp_Front.html" target="_blank">Legal</a></p>
<br>
<!--BEGIN BOOK NAVIGATION-->
<p class="nav">
<A href="http://www.palmos.com/dev/support/docs/">Documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
<a href="COMSyncCompanionTOC.html">Table of Contents</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="COMComp_Basics.html">&lt;&nbsp;Previous</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="COMComp_Install.html">Next&nbsp;&gt;</a>&nbsp;&nbsp;
             |&nbsp;&nbsp;<a href="COMSyncCompanionIX.html">Index</a>
</p>
</td>
</tr>
<!-- END FOOTER -->

</body>
</html>